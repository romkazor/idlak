<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: kaldi::nnet2 Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacekaldi_1_1nnet2.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">kaldi::nnet2 Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1AdditiveNoiseComponent.html">AdditiveNoiseComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is a bit similar to dropout but adding (not multiplying) Gaussian noise with a given standard deviation.  <a href="classkaldi_1_1nnet2_1_1AdditiveNoiseComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1AffineComponent.html">AffineComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html">AffineComponentPreconditioned</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline.html">AffineComponentPreconditionedOnline</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Keywords: natural gradient descent, NG-SGD, naturalgradient.  <a href="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1AmNnet.html">AmNnet</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1BlockAffineComponent.html">BlockAffineComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1BlockAffineComponentPreconditioned.html">BlockAffineComponentPreconditioned</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet2_1_1ChunkInfo.html" title="ChunkInfo is a class whose purpose is to describe the structure of matrices holding features...">ChunkInfo</a> is a class whose purpose is to describe the structure of matrices holding features.  <a href="classkaldi_1_1nnet2_1_1ChunkInfo.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1Component.html">Component</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Abstract class, basic element of the network, it is a box with defined inputs, outputs, and tranformation functions interface.  <a href="classkaldi_1_1nnet2_1_1Component.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html">Convolutional1dComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html" title="Convolutional1dComponent implements convolution over frequency axis. ">Convolutional1dComponent</a> implements convolution over frequency axis.  <a href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1DctComponent.html">DctComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Discrete cosine transform.  <a href="classkaldi_1_1nnet2_1_1DctComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1DecodableAmNnet.html">DecodableAmNnet</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet2_1_1DecodableAmNnet.html" title="DecodableAmNnet is a decodable object that decodes with a neural net acoustic model of type AmNnet...">DecodableAmNnet</a> is a decodable object that decodes with a neural net acoustic model of type <a class="el" href="classkaldi_1_1nnet2_1_1AmNnet.html">AmNnet</a>.  <a href="classkaldi_1_1nnet2_1_1DecodableAmNnet.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1DecodableAmNnetParallel.html">DecodableAmNnetParallel</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This version of <a class="el" href="classkaldi_1_1nnet2_1_1DecodableAmNnet.html" title="DecodableAmNnet is a decodable object that decodes with a neural net acoustic model of type AmNnet...">DecodableAmNnet</a> is intended for a version of the decoder that processes different utterances with multiple threads.  <a href="classkaldi_1_1nnet2_1_1DecodableAmNnetParallel.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1DecodableNnet2Online.html">DecodableNnet2Online</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This Decodable object for class <a class="el" href="classkaldi_1_1nnet2_1_1AmNnet.html">nnet2::AmNnet</a> takes feature input from class <a class="el" href="classkaldi_1_1OnlineFeatureInterface.html" title="OnlineFeatureInterface is an interface for online feature processing (it is also usable in the offlin...">OnlineFeatureInterface</a>, unlike, say, class <a class="el" href="classkaldi_1_1nnet2_1_1DecodableAmNnet.html" title="DecodableAmNnet is a decodable object that decodes with a neural net acoustic model of type AmNnet...">DecodableAmNnet</a> which takes feature input from a matrix.  <a href="classkaldi_1_1nnet2_1_1DecodableNnet2Online.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions.html">DecodableNnet2OnlineOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1DiscriminativeExampleSplitter.html">DiscriminativeExampleSplitter</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">For each frame, judge:  <a href="classkaldi_1_1nnet2_1_1DiscriminativeExampleSplitter.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1DiscriminativeExamplesRepository.html">DiscriminativeExamplesRepository</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This struct stores neural net training examples to be used in multi-threaded training.  <a href="classkaldi_1_1nnet2_1_1DiscriminativeExamplesRepository.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This struct is used to store the information we need for discriminative training (MMI or MPE).  <a href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1DiscTrainParallelClass.html">DiscTrainParallelClass</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1DoBackpropParallelClass.html">DoBackpropParallelClass</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1DropoutComponent.html">DropoutComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This <a class="el" href="classkaldi_1_1nnet2_1_1Component.html" title="Abstract class, basic element of the network, it is a box with defined inputs, outputs, and tranformation functions interface. ">Component</a>, if present, randomly zeroes half of the inputs and multiplies the other half by two.  <a href="classkaldi_1_1nnet2_1_1DropoutComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1ExamplesRepository.html">ExamplesRepository</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class stores neural net training examples to be used in multi-threaded training.  <a href="classkaldi_1_1nnet2_1_1ExamplesRepository.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1FastNnetCombiner.html">FastNnetCombiner</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1FisherComputationClass.html">FisherComputationClass</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1FixedAffineComponent.html">FixedAffineComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet2_1_1FixedAffineComponent.html" title="FixedAffineComponent is an affine transform that is supplied at network initialization time and is no...">FixedAffineComponent</a> is an affine transform that is supplied at network initialization time and is not trainable.  <a href="classkaldi_1_1nnet2_1_1FixedAffineComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1FixedBiasComponent.html">FixedBiasComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet2_1_1FixedBiasComponent.html" title="FixedBiasComponent applies a fixed per-element bias; it&#39;s similar to the AddShift component in the nn...">FixedBiasComponent</a> applies a fixed per-element bias; it's similar to the AddShift component in the <a class="el" href="namespacekaldi_1_1nnet1.html">nnet1</a> setup (and only needed for <a class="el" href="namespacekaldi_1_1nnet1.html">nnet1</a> model conversion.  <a href="classkaldi_1_1nnet2_1_1FixedBiasComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1FixedLinearComponent.html">FixedLinearComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet2_1_1FixedLinearComponent.html" title="FixedLinearComponent is a linear transform that is supplied at network initialization time and is not...">FixedLinearComponent</a> is a linear transform that is supplied at network initialization time and is not trainable.  <a href="classkaldi_1_1nnet2_1_1FixedLinearComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1FixedScaleComponent.html">FixedScaleComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet2_1_1FixedScaleComponent.html" title="FixedScaleComponent applies a fixed per-element scale; it&#39;s similar to the Rescale component in the n...">FixedScaleComponent</a> applies a fixed per-element scale; it's similar to the Rescale component in the <a class="el" href="namespacekaldi_1_1nnet1.html">nnet1</a> setup (and only needed for <a class="el" href="namespacekaldi_1_1nnet1.html">nnet1</a> model conversion).  <a href="classkaldi_1_1nnet2_1_1FixedScaleComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1LimitRankClass.html">LimitRankClass</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1LogSoftmaxComponent.html">LogSoftmaxComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1MaxoutComponent.html">MaxoutComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1MaxpoolingComponent.html">MaxpoolingComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">MaxPoolingComponent : Maxpooling component was firstly used in ConvNet for selecting an representative activation in an area.  <a href="classkaldi_1_1nnet2_1_1MaxpoolingComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetCombineAconfig.html">NnetCombineAconfig</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetCombineConfig.html">NnetCombineConfig</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration class that controls neural net combination, where we combine a number of neural nets, trying to find for each layer the optimal weighted combination of the different neural-net parameters.  <a href="structkaldi_1_1nnet2_1_1NnetCombineConfig.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetCombineFastConfig.html">NnetCombineFastConfig</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration class that controls neural net combination, where we combine a number of neural nets, trying to find for each layer the optimal weighted combination of the different neural-net parameters.  <a href="structkaldi_1_1nnet2_1_1NnetCombineFastConfig.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1NnetComputer.html">NnetComputer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetDiscriminativeStats.html">NnetDiscriminativeStats</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetDiscriminativeUpdateOptions.html">NnetDiscriminativeUpdateOptions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1NnetDiscriminativeUpdater.html">NnetDiscriminativeUpdater</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1NnetEnsembleTrainer.html">NnetEnsembleTrainer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetEnsembleTrainerConfig.html">NnetEnsembleTrainerConfig</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html" title="NnetExample is the input data and corresponding label (or labels) for one or more frames of input...">NnetExample</a> is the input data and corresponding label (or labels) for one or more frames of input, used for standard cross-entropy training of neural nets (and possibly for other objective functions).  <a href="structkaldi_1_1nnet2_1_1NnetExample.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1NnetExampleBackgroundReader.html">NnetExampleBackgroundReader</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetFixConfig.html">NnetFixConfig</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetLimitRankOpts.html">NnetLimitRankOpts</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetMixupConfig.html">NnetMixupConfig</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1NnetOnlineComputer.html">NnetOnlineComputer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetRescaleConfig.html">NnetRescaleConfig</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1NnetRescaler.html">NnetRescaler</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetShrinkConfig.html">NnetShrinkConfig</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration class that controls neural net "shrinkage" which is actually a scaling on the parameters of each of the updatable layers.  <a href="structkaldi_1_1nnet2_1_1NnetShrinkConfig.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetSimpleTrainerConfig.html">NnetSimpleTrainerConfig</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1NnetStats.html">NnetStats</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetStatsConfig.html">NnetStatsConfig</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1NnetUpdater.html">NnetUpdater</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1NnetWidenConfig.html">NnetWidenConfig</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration class that controls neural net "widening", which means increasing the dimension of the hidden layers of an already-trained neural net.  <a href="structkaldi_1_1nnet2_1_1NnetWidenConfig.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1NonlinearComponent.html">NonlinearComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This kind of <a class="el" href="classkaldi_1_1nnet2_1_1Component.html" title="Abstract class, basic element of the network, it is a box with defined inputs, outputs, and tranformation functions interface. ">Component</a> is a base-class for things like sigmoid and softmax.  <a href="classkaldi_1_1nnet2_1_1NonlinearComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1NormalizeComponent.html">NormalizeComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html">OnlinePreconditioner</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Keywords for search: natural gradient, naturalgradient, NG-SGD.  <a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditionerSimple.html">OnlinePreconditionerSimple</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1PermuteComponent.html">PermuteComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classkaldi_1_1nnet2_1_1PermuteComponent.html" title="PermuteComponent does a permutation of the dimensions (by default, a fixed random permutation...">PermuteComponent</a> does a permutation of the dimensions (by default, a fixed random permutation, but it may be specified).  <a href="classkaldi_1_1nnet2_1_1PermuteComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1PnormComponent.html">PnormComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1PowerComponent.html">PowerComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Take the absoute values of an input vector to a power.  <a href="classkaldi_1_1nnet2_1_1PowerComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1RectifiedLinearComponent.html">RectifiedLinearComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1ScaleComponent.html">ScaleComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1SigmoidComponent.html">SigmoidComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1SoftHingeComponent.html">SoftHingeComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1SoftmaxComponent.html">SoftmaxComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1SpliceComponent.html">SpliceComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Splices a context window of frames together [over time].  <a href="classkaldi_1_1nnet2_1_1SpliceComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html">SpliceMaxComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is as <a class="el" href="classkaldi_1_1nnet2_1_1SpliceComponent.html" title="Splices a context window of frames together [over time]. ">SpliceComponent</a> but outputs the max of any of the inputs (taking the max across time).  <a href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1SplitDiscriminativeExampleConfig.html">SplitDiscriminativeExampleConfig</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Config structure for SplitExample, for splitting discriminative training examples.  <a href="structkaldi_1_1nnet2_1_1SplitDiscriminativeExampleConfig.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1nnet2_1_1SplitExampleStats.html">SplitExampleStats</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This struct exists only for diagnostic purposes.  <a href="structkaldi_1_1nnet2_1_1SplitExampleStats.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html">SumGroupComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1TanhComponent.html">TanhComponent</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html">UpdatableComponent</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class <a class="el" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html" title="Class UpdatableComponent is a Component which has trainable parameters and contains some global param...">UpdatableComponent</a> is a <a class="el" href="classkaldi_1_1nnet2_1_1Component.html" title="Abstract class, basic element of the network, it is a box with defined inputs, outputs, and tranformation functions interface. ">Component</a> which has trainable parameters and contains some global parameters for stochastic gradient descent (learning rate, L2 regularization constant).  <a href="classkaldi_1_1nnet2_1_1UpdatableComponent.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:af2246cc04a2596de3c09fad3c3513671"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1TableWriter.html">TableWriter</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a></td></tr>
<tr class="separator:af2246cc04a2596de3c09fad3c3513671"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a206084ee5d66f24aeb8828c6bf8cb13d"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1SequentialTableReader.html">SequentialTableReader</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a206084ee5d66f24aeb8828c6bf8cb13d">SequentialNnetExampleReader</a></td></tr>
<tr class="separator:a206084ee5d66f24aeb8828c6bf8cb13d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96242234768bbde2864c47396903675e"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1RandomAccessTableReader.html">RandomAccessTableReader</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a96242234768bbde2864c47396903675e">RandomAccessNnetExampleReader</a></td></tr>
<tr class="separator:a96242234768bbde2864c47396903675e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6948db4569b0e2c5d3bdcef6d2ff732f"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1TableWriter.html">TableWriter</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a6948db4569b0e2c5d3bdcef6d2ff732f">DiscriminativeNnetExampleWriter</a></td></tr>
<tr class="separator:a6948db4569b0e2c5d3bdcef6d2ff732f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19617e2d7fdd519e551f8228e1041dac"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1SequentialTableReader.html">SequentialTableReader</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a19617e2d7fdd519e551f8228e1041dac">SequentialDiscriminativeNnetExampleReader</a></td></tr>
<tr class="separator:a19617e2d7fdd519e551f8228e1041dac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a091885a154db076533873b4d51da62a7"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classkaldi_1_1RandomAccessTableReader.html">RandomAccessTableReader</a>&lt; <a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt; <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a091885a154db076533873b4d51da62a7">RandomAccessDiscriminativeNnetExampleReader</a></td></tr>
<tr class="separator:a091885a154db076533873b4d51da62a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a97ed7c24ff06882cc480c5744ab8edb3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a97ed7c24ff06882cc480c5744ab8edb3">UnitTestAmNnet</a> ()</td></tr>
<tr class="separator:a97ed7c24ff06882cc480c5744ab8edb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff85e4bd1e5f472b2869f9cdfa71c93a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#aff85e4bd1e5f472b2869f9cdfa71c93a">GetUpdateDirection</a> (const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;nnets, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *direction)</td></tr>
<tr class="separator:aff85e4bd1e5f472b2869f9cdfa71c93a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a569b33d168ce7ea3fed7da40ed127f79"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a569b33d168ce7ea3fed7da40ed127f79">AddDirection</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;orig_nnet, const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;direction, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;scales, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *dest)</td></tr>
<tr class="memdesc:a569b33d168ce7ea3fed7da40ed127f79"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets "dest" to orig_nnet plus "direction", with each updatable component of "direction" first scaled by the appropriate scale.  <a href="#a569b33d168ce7ea3fed7da40ed127f79">More...</a><br /></td></tr>
<tr class="separator:a569b33d168ce7ea3fed7da40ed127f79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04d30a6731c95341c9eef5f6ceffe4c5"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a04d30a6731c95341c9eef5f6ceffe4c5">ComputeObjfAndGradient</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;validation_set, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; &amp;scale_params, const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;orig_nnet, const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;direction, <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; *gradient)</td></tr>
<tr class="separator:a04d30a6731c95341c9eef5f6ceffe4c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fbd108b9e92078515559963ace4effc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a9fbd108b9e92078515559963ace4effc">CombineNnetsA</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetCombineAconfig.html">NnetCombineAconfig</a> &amp;config, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;validation_set, const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;nnets, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet_out)</td></tr>
<tr class="separator:a9fbd108b9e92078515559963ace4effc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b7ada37bc6fe37cc4eb784686fc2c82"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a1b7ada37bc6fe37cc4eb784686fc2c82">CombineNnetsFast</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetCombineFastConfig.html">NnetCombineFastConfig</a> &amp;combine_config, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;validation_set, const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;nnets_in, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet_out)</td></tr>
<tr class="separator:a1b7ada37bc6fe37cc4eb784686fc2c82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0c722fcb5bb432bb7e54d70b742885c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ac0c722fcb5bb432bb7e54d70b742885c">CombineNnets</a> (const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;scale_params, const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;nnets, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *dest)</td></tr>
<tr class="separator:ac0c722fcb5bb432bb7e54d70b742885c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83c0e9b3cc3644b1c7027de9f29daafd"><td class="memItemLeft" align="right" valign="top">static int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a83c0e9b3cc3644b1c7027de9f29daafd">GetInitialModel</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;validation_set, const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;nnets)</td></tr>
<tr class="memdesc:a83c0e9b3cc3644b1c7027de9f29daafd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns an integer saying which model to use: either 0 ...  <a href="#a83c0e9b3cc3644b1c7027de9f29daafd">More...</a><br /></td></tr>
<tr class="separator:a83c0e9b3cc3644b1c7027de9f29daafd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a103073fe3eed1a67996f168cae60f73d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a103073fe3eed1a67996f168cae60f73d">GetInitialScaleParams</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetCombineConfig.html">NnetCombineConfig</a> &amp;combine_config, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;validation_set, const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;nnets, <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; *scale_params)</td></tr>
<tr class="separator:a103073fe3eed1a67996f168cae60f73d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7288d7be65892fb998c9ee5a6d10ea7c"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a7288d7be65892fb998c9ee5a6d10ea7c">ComputeObjfAndGradient</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;validation_set, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; &amp;scale_params, const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;nnets, <a class="el" href="classbool.html">bool</a> debug, <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; *gradient)</td></tr>
<tr class="separator:a7288d7be65892fb998c9ee5a6d10ea7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c0d6a9ebb01f8cf3e31496c52956ae4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a5c0d6a9ebb01f8cf3e31496c52956ae4">CombineNnets</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetCombineConfig.html">NnetCombineConfig</a> &amp;combine_config, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;validation_set, const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;nnets, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet_out)</td></tr>
<tr class="separator:a5c0d6a9ebb01f8cf3e31496c52956ae4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af53b1dc301e038dffa347e0e40268811"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#af53b1dc301e038dffa347e0e40268811">GiveNnetCorrectTopology</a> (<a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet, <a class="el" href="classkaldi_1_1nnet2_1_1AffineComponent.html">AffineComponent</a> **affine_component, <a class="el" href="classkaldi_1_1nnet2_1_1SoftmaxComponent.html">SoftmaxComponent</a> **softmax_component, <a class="el" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html">SumGroupComponent</a> **sum_group_component)</td></tr>
<tr class="memdesc:af53b1dc301e038dffa347e0e40268811"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function makes sure the neural net ends with a <a class="el" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html">SumGroupComponent</a>.  <a href="#af53b1dc301e038dffa347e0e40268811">More...</a><br /></td></tr>
<tr class="separator:af53b1dc301e038dffa347e0e40268811"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4aeed69b647fd9b2f223551a5bc5865"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ac4aeed69b647fd9b2f223551a5bc5865">MixupNnet</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetMixupConfig.html">NnetMixupConfig</a> &amp;mixup_config, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:ac4aeed69b647fd9b2f223551a5bc5865"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function works as follows.  <a href="#ac4aeed69b647fd9b2f223551a5bc5865">More...</a><br /></td></tr>
<tr class="separator:ac4aeed69b647fd9b2f223551a5bc5865"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4c4fdf15dc5a6dde37ef0ac0598f04e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ad4c4fdf15dc5a6dde37ef0ac0598f04e">UnitTestGenericComponentInternal</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Component.html">Component</a> &amp;component, const <a class="el" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a> in_info, const <a class="el" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a> out_info)</td></tr>
<tr class="separator:ad4c4fdf15dc5a6dde37ef0ac0598f04e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac68689fc81582215989c6b2c40e95cf5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Component.html">Component</a> &amp;component)</td></tr>
<tr class="separator:ac68689fc81582215989c6b2c40e95cf5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ba048e4d06760178b1299c153327b6b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a9ba048e4d06760178b1299c153327b6b">UnitTestSigmoidComponent</a> ()</td></tr>
<tr class="separator:a9ba048e4d06760178b1299c153327b6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6078b00a82b51e13d84339f447ce1e7c"><td class="memTemplParams" colspan="2">template&lt;class T &gt; </td></tr>
<tr class="memitem:a6078b00a82b51e13d84339f447ce1e7c"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a6078b00a82b51e13d84339f447ce1e7c">UnitTestGenericComponent</a> (std::string extra_str=&quot;&quot;)</td></tr>
<tr class="separator:a6078b00a82b51e13d84339f447ce1e7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c0449c6e01b874d26ac39ad77f2ddea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a2c0449c6e01b874d26ac39ad77f2ddea">UnitTestMaxoutComponent</a> ()</td></tr>
<tr class="separator:a2c0449c6e01b874d26ac39ad77f2ddea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae348b18eedab6f65394f3d9d3de311ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ae348b18eedab6f65394f3d9d3de311ad">UnitTestPnormComponent</a> ()</td></tr>
<tr class="separator:ae348b18eedab6f65394f3d9d3de311ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d1b9a108cc620a52a9ed9de184cc5a1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a7d1b9a108cc620a52a9ed9de184cc5a1">UnitTestMaxpoolingComponent</a> ()</td></tr>
<tr class="separator:a7d1b9a108cc620a52a9ed9de184cc5a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a403d536b850a10805602371bd5d72bde"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a403d536b850a10805602371bd5d72bde">UnitTestAffineComponent</a> ()</td></tr>
<tr class="separator:a403d536b850a10805602371bd5d72bde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b28af76b095019161d365895f18a60a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a7b28af76b095019161d365895f18a60a">UnitTestConvolutional1dComponent</a> ()</td></tr>
<tr class="separator:a7b28af76b095019161d365895f18a60a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79621579ccc2522fa6886a1d65494710"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a79621579ccc2522fa6886a1d65494710">UnitTestDropoutComponent</a> ()</td></tr>
<tr class="separator:a79621579ccc2522fa6886a1d65494710"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16c7add606af3409cf96193aeaf4ff90"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a16c7add606af3409cf96193aeaf4ff90">UnitTestAdditiveNoiseComponent</a> ()</td></tr>
<tr class="separator:a16c7add606af3409cf96193aeaf4ff90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb391e7c6c191be6fef596cf0e7a3b98"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#acb391e7c6c191be6fef596cf0e7a3b98">UnitTestScaleComponent</a> ()</td></tr>
<tr class="separator:acb391e7c6c191be6fef596cf0e7a3b98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe21d513126bdd1228b3592bfc86734a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#afe21d513126bdd1228b3592bfc86734a">UnitTestAffineComponentPreconditioned</a> ()</td></tr>
<tr class="separator:afe21d513126bdd1228b3592bfc86734a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7be00dbe5b62ee5d4d16a92beb52c6fb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a7be00dbe5b62ee5d4d16a92beb52c6fb">UnitTestAffineComponentPreconditionedOnline</a> ()</td></tr>
<tr class="separator:a7be00dbe5b62ee5d4d16a92beb52c6fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a636f0cfcf362f3fd112ab2fdf7b165d1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a636f0cfcf362f3fd112ab2fdf7b165d1">UnitTestBlockAffineComponent</a> ()</td></tr>
<tr class="separator:a636f0cfcf362f3fd112ab2fdf7b165d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cea1bbd66e10c9f11a2fb11c43e2014"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a7cea1bbd66e10c9f11a2fb11c43e2014">UnitTestBlockAffineComponentPreconditioned</a> ()</td></tr>
<tr class="separator:a7cea1bbd66e10c9f11a2fb11c43e2014"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0d7c891bd2fa39a24d2b650d07ffb6e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ab0d7c891bd2fa39a24d2b650d07ffb6e">UnitTestSumGroupComponent</a> ()</td></tr>
<tr class="separator:ab0d7c891bd2fa39a24d2b650d07ffb6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7802a35ba6ea5aee400f6fff59ecf0a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ae7802a35ba6ea5aee400f6fff59ecf0a">UnitTestDctComponent</a> ()</td></tr>
<tr class="separator:ae7802a35ba6ea5aee400f6fff59ecf0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1045b7fdf9b165bb8b23cf9d7d7e1f34"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a1045b7fdf9b165bb8b23cf9d7d7e1f34">UnitTestFixedLinearComponent</a> ()</td></tr>
<tr class="separator:a1045b7fdf9b165bb8b23cf9d7d7e1f34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45daf90607644621a0b6385aa596ef54"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a45daf90607644621a0b6385aa596ef54">UnitTestFixedAffineComponent</a> ()</td></tr>
<tr class="separator:a45daf90607644621a0b6385aa596ef54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ef7ee2222ce1bc44d63182f0bf5524f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a2ef7ee2222ce1bc44d63182f0bf5524f">UnitTestFixedScaleComponent</a> ()</td></tr>
<tr class="separator:a2ef7ee2222ce1bc44d63182f0bf5524f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37650aea3e79156eff23744e83684ce6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a37650aea3e79156eff23744e83684ce6">UnitTestFixedBiasComponent</a> ()</td></tr>
<tr class="separator:a37650aea3e79156eff23744e83684ce6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaca439d5f248e1204633705a2ff0ab22"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#aaca439d5f248e1204633705a2ff0ab22">UnitTestParsing</a> ()</td></tr>
<tr class="separator:aaca439d5f248e1204633705a2ff0ab22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac47787f606d21f80ac21b663103b8ef9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ac47787f606d21f80ac21b663103b8ef9">UnitTestSpliceComponent</a> ()</td></tr>
<tr class="separator:ac47787f606d21f80ac21b663103b8ef9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c56471e50ec713f799025d52860a8f0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a5c56471e50ec713f799025d52860a8f0">BasicDebugTestForSpliceMax</a> (<a class="el" href="classbool.html">bool</a> output=false)</td></tr>
<tr class="separator:a5c56471e50ec713f799025d52860a8f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c661e4a6e94e5d0abaa2bdf325172bc"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a0c661e4a6e94e5d0abaa2bdf325172bc">ExpectOneOrTwoTokens</a> (std::istream &amp;is, <a class="el" href="classbool.html">bool</a> binary, const std::string &amp;token1, const std::string &amp;token2)</td></tr>
<tr class="separator:a0c661e4a6e94e5d0abaa2bdf325172bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e18825b4c5b0834e638296b2f5bb35a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a> (const std::string &amp;name, std::string *string, int32 *param)</td></tr>
<tr class="memdesc:a0e18825b4c5b0834e638296b2f5bb35a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Functions used in Init routines.  <a href="#a0e18825b4c5b0834e638296b2f5bb35a">More...</a><br /></td></tr>
<tr class="separator:a0e18825b4c5b0834e638296b2f5bb35a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06c170854db9a3b5bb3915dfb52380c2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a06c170854db9a3b5bb3915dfb52380c2">ParseFromString</a> (const std::string &amp;name, std::string *string, <a class="el" href="classbool.html">bool</a> *param)</td></tr>
<tr class="memdesc:a06c170854db9a3b5bb3915dfb52380c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This version is for parameters of type bool, which can appear as any string beginning with f, F, t or T.  <a href="#a06c170854db9a3b5bb3915dfb52380c2">More...</a><br /></td></tr>
<tr class="separator:a06c170854db9a3b5bb3915dfb52380c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7eac951c4af19775f3ba550efa12f385"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a7eac951c4af19775f3ba550efa12f385">ParseFromString</a> (const std::string &amp;name, std::string *string, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *param)</td></tr>
<tr class="memdesc:a7eac951c4af19775f3ba550efa12f385"><td class="mdescLeft">&#160;</td><td class="mdescRight">This version is for parameters of type BaseFloat.  <a href="#a7eac951c4af19775f3ba550efa12f385">More...</a><br /></td></tr>
<tr class="separator:a7eac951c4af19775f3ba550efa12f385"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5e10df5a302978244f7c6d78cefe0ca"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ac5e10df5a302978244f7c6d78cefe0ca">ParseFromString</a> (const std::string &amp;name, std::string *string, std::string *param)</td></tr>
<tr class="separator:ac5e10df5a302978244f7c6d78cefe0ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f7f50f1457000af31efe2ecd53f983a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a7f7f50f1457000af31efe2ecd53f983a">ParseFromString</a> (const std::string &amp;name, std::string *string, std::vector&lt; int32 &gt; *param)</td></tr>
<tr class="memdesc:a7f7f50f1457000af31efe2ecd53f983a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This version is for parameters of type std::vector&lt;int32&gt;; it expects them as a colon-separated list, without spaces.  <a href="#a7f7f50f1457000af31efe2ecd53f983a">More...</a><br /></td></tr>
<tr class="separator:a7f7f50f1457000af31efe2ecd53f983a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac16225f341eee2b74a810b87f774d265"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ac16225f341eee2b74a810b87f774d265">NnetDiscriminativeUpdateParallel</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1AmNnet.html">AmNnet</a> &amp;am_nnet, const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;tmodel, const <a class="el" href="structkaldi_1_1nnet2_1_1NnetDiscriminativeUpdateOptions.html">NnetDiscriminativeUpdateOptions</a> &amp;opts, int32 num_threads, <a class="el" href="namespacekaldi_1_1nnet2.html#a19617e2d7fdd519e551f8228e1041dac">SequentialDiscriminativeNnetExampleReader</a> *example_reader, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet_to_update, <a class="el" href="structkaldi_1_1nnet2_1_1NnetDiscriminativeStats.html">NnetDiscriminativeStats</a> *stats)</td></tr>
<tr class="separator:ac16225f341eee2b74a810b87f774d265"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcc64cd1d4a814c4da3dd1a2e9a560d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#afcc64cd1d4a814c4da3dd1a2e9a560d7">NnetDiscriminativeUpdate</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1AmNnet.html">AmNnet</a> &amp;am_nnet, const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;tmodel, const <a class="el" href="structkaldi_1_1nnet2_1_1NnetDiscriminativeUpdateOptions.html">NnetDiscriminativeUpdateOptions</a> &amp;opts, const <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &amp;eg, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet_to_update, <a class="el" href="structkaldi_1_1nnet2_1_1NnetDiscriminativeStats.html">NnetDiscriminativeStats</a> *stats)</td></tr>
<tr class="memdesc:afcc64cd1d4a814c4da3dd1a2e9a560d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does the neural net computation, lattice forward-backward, and backprop, for either the MMI, MPFE or SMBR objective functions.  <a href="#afcc64cd1d4a814c4da3dd1a2e9a560d7">More...</a><br /></td></tr>
<tr class="separator:afcc64cd1d4a814c4da3dd1a2e9a560d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0da3631bf3928fbe3e69301cab4b042"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#aa0da3631bf3928fbe3e69301cab4b042">UnitTestNnetCompute</a> ()</td></tr>
<tr class="separator:aa0da3631bf3928fbe3e69301cab4b042"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a327c0e20b1d09d390e3ca08e396803dd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a327c0e20b1d09d390e3ca08e396803dd">UnitTestNnetComputeChunked</a> ()</td></tr>
<tr class="separator:a327c0e20b1d09d390e3ca08e396803dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeff1c1ada8948d90166bccf6ff83cf3e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#aeff1c1ada8948d90166bccf6ff83cf3e">NnetComputation</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;input, <a class="el" href="classbool.html">bool</a> pad_input, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *output)</td></tr>
<tr class="memdesc:aeff1c1ada8948d90166bccf6ff83cf3e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does the basic neural net computation, on a sequence of data (e.g.  <a href="#aeff1c1ada8948d90166bccf6ff83cf3e">More...</a><br /></td></tr>
<tr class="separator:aeff1c1ada8948d90166bccf6ff83cf3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a532f607f0ac5014ef8d4c9ff116a22b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a532f607f0ac5014ef8d4c9ff116a22b8">NnetComputationChunked</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;input, int32 chunk_size, <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *output)</td></tr>
<tr class="memdesc:a532f607f0ac5014ef8d4c9ff116a22b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does the basic neural net computation, on a sequence of data (e.g.  <a href="#a532f607f0ac5014ef8d4c9ff116a22b8">More...</a><br /></td></tr>
<tr class="separator:a532f607f0ac5014ef8d4c9ff116a22b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d529cdc30870c6a7802f80c8518fa0c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a3d529cdc30870c6a7802f80c8518fa0c">NnetGradientComputation</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;input, <a class="el" href="classbool.html">bool</a> pad_input, const <a class="el" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> &amp;pdf_post, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet_to_update)</td></tr>
<tr class="separator:a3d529cdc30870c6a7802f80c8518fa0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31bfa0c64c303a78039d017e47d4b25e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a31bfa0c64c303a78039d017e47d4b25e">NnetGradientComputation</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;input, <a class="el" href="classbool.html">bool</a> pad_input, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> utterance_weight, const std::vector&lt; int32 &gt; &amp;labels, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet_to_update)</td></tr>
<tr class="memdesc:a31bfa0c64c303a78039d017e47d4b25e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does the neural net computation and backprop, given input and labels.  <a href="#a31bfa0c64c303a78039d017e47d4b25e">More...</a><br /></td></tr>
<tr class="separator:a31bfa0c64c303a78039d017e47d4b25e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2690f0a09f0e254c3308e6ac08ec23c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ad2690f0a09f0e254c3308e6ac08ec23c">UnitTestSolvePackingProblem</a> ()</td></tr>
<tr class="separator:ad2690f0a09f0e254c3308e6ac08ec23c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4e03e0116acc5d26e9f3741a31302c7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ab4e03e0116acc5d26e9f3741a31302c7">LatticeToDiscriminativeExample</a> (const std::vector&lt; int32 &gt; &amp;alignment, const <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;feats, const <a class="el" href="namespacekaldi.html#aeba2c05d999bd2f794db8919ac816bb3">CompactLattice</a> &amp;clat, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> weight, int32 left_context, int32 right_context, <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> *eg)</td></tr>
<tr class="memdesc:ab4e03e0116acc5d26e9f3741a31302c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts lattice to discriminative training example.  <a href="#ab4e03e0116acc5d26e9f3741a31302c7">More...</a><br /></td></tr>
<tr class="separator:ab4e03e0116acc5d26e9f3741a31302c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8510e0db1a30077f74f88fbf26bc4c95"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a8510e0db1a30077f74f88fbf26bc4c95">SplitDiscriminativeExample</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1SplitDiscriminativeExampleConfig.html">SplitDiscriminativeExampleConfig</a> &amp;config, const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;tmodel, const <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &amp;eg, std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; *egs_out, <a class="el" href="structkaldi_1_1nnet2_1_1SplitExampleStats.html">SplitExampleStats</a> *stats_out)</td></tr>
<tr class="memdesc:a8510e0db1a30077f74f88fbf26bc4c95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Split a "discriminative example" into multiple pieces, splitting where the lattice has "pinch points".  <a href="#a8510e0db1a30077f74f88fbf26bc4c95">More...</a><br /></td></tr>
<tr class="separator:a8510e0db1a30077f74f88fbf26bc4c95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e0593085a277bbdc9522aaacd9d07bb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a2e0593085a277bbdc9522aaacd9d07bb">ExciseDiscriminativeExample</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1SplitDiscriminativeExampleConfig.html">SplitDiscriminativeExampleConfig</a> &amp;config, const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;tmodel, const <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &amp;eg, std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; *egs_out, <a class="el" href="structkaldi_1_1nnet2_1_1SplitExampleStats.html">SplitExampleStats</a> *stats_out)</td></tr>
<tr class="memdesc:a2e0593085a277bbdc9522aaacd9d07bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove unnecessary frames from discriminative training example.  <a href="#a2e0593085a277bbdc9522aaacd9d07bb">More...</a><br /></td></tr>
<tr class="separator:a2e0593085a277bbdc9522aaacd9d07bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad559d485323ab12842e3992b42bc94f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ad559d485323ab12842e3992b42bc94f8">UpdateHash</a> (const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;tmodel, const <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &amp;eg, std::string criterion, <a class="el" href="classbool.html">bool</a> drop_frames, <a class="el" href="classbool.html">bool</a> one_silence_class, <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; double &gt; *hash, double *num_weight, double *den_weight, double *tot_t)</td></tr>
<tr class="memdesc:ad559d485323ab12842e3992b42bc94f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is used in code that tests the functionality that we provide here, about splitting and excising nnet examples.  <a href="#ad559d485323ab12842e3992b42bc94f8">More...</a><br /></td></tr>
<tr class="separator:ad559d485323ab12842e3992b42bc94f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88d4fabba85290cdc0e10da135458baf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a88d4fabba85290cdc0e10da135458baf">ExampleToPdfPost</a> (const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;tmodel, const std::vector&lt; int32 &gt; &amp;silence_phones, std::string criterion, <a class="el" href="classbool.html">bool</a> drop_frames, <a class="el" href="classbool.html">bool</a> one_silence_class, const <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &amp;eg, <a class="el" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> *post)</td></tr>
<tr class="memdesc:a88d4fabba85290cdc0e10da135458baf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given a discriminative training example, this function works out posteriors at the pdf level (note: these are "discriminative-training posteriors" that may be positive or negative.  <a href="#a88d4fabba85290cdc0e10da135458baf">More...</a><br /></td></tr>
<tr class="separator:a88d4fabba85290cdc0e10da135458baf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dbcd705d1a304dd958607aedb503f72"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a6dbcd705d1a304dd958607aedb503f72">SolvePackingProblem</a> (<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> max_cost, const std::vector&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;costs, std::vector&lt; std::vector&lt; <a class="el" href="classsize__t.html">size_t</a> &gt; &gt; *groups)</td></tr>
<tr class="memdesc:a6dbcd705d1a304dd958607aedb503f72"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function solves the "packing problem" using the "first fit" algorithm.  <a href="#a6dbcd705d1a304dd958607aedb503f72">More...</a><br /></td></tr>
<tr class="separator:a6dbcd705d1a304dd958607aedb503f72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17af9ef5bb2426d326168af50e42688d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a17af9ef5bb2426d326168af50e42688d">AppendDiscriminativeExamples</a> (const std::vector&lt; const <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> * &gt; &amp;input, <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> *output)</td></tr>
<tr class="memdesc:a17af9ef5bb2426d326168af50e42688d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Appends the given vector of examples (which must be non-empty) into a single output example (called by CombineExamples, which might be a more convenient interface).  <a href="#a17af9ef5bb2426d326168af50e42688d">More...</a><br /></td></tr>
<tr class="separator:a17af9ef5bb2426d326168af50e42688d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f916be98d9e9721a644ecc9ca6d2d2d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a9f916be98d9e9721a644ecc9ca6d2d2d">CombineDiscriminativeExamples</a> (int32 max_length, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; &amp;input, std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; *output)</td></tr>
<tr class="memdesc:a9f916be98d9e9721a644ecc9ca6d2d2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is used to combine multiple discriminative-training examples (each corresponding to a segment of a lattice), into one.  <a href="#a9f916be98d9e9721a644ecc9ca6d2d2d">More...</a><br /></td></tr>
<tr class="separator:a9f916be98d9e9721a644ecc9ca6d2d2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ec833548abe8d9297fc97688121cc4b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a0ec833548abe8d9297fc97688121cc4b">HasSimpleLabels</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &amp;eg, std::vector&lt; int32 &gt; *simple_labels)</td></tr>
<tr class="separator:a0ec833548abe8d9297fc97688121cc4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa77340a2c9a6f9eaacd47049ea5dea4e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#aa77340a2c9a6f9eaacd47049ea5dea4e">FixNnet</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetFixConfig.html">NnetFixConfig</a> &amp;config, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="separator:aa77340a2c9a6f9eaacd47049ea5dea4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab0e83dcfbed9677c5715a4175dcdcf6"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#aab0e83dcfbed9677c5715a4175dcdcf6">IndexOfSoftmaxLayer</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet)</td></tr>
<tr class="memdesc:aab0e83dcfbed9677c5715a4175dcdcf6"><td class="mdescLeft">&#160;</td><td class="mdescRight">If "nnet" has exactly one softmax layer, this function will return its index; otherwise it will return -1.  <a href="#aab0e83dcfbed9677c5715a4175dcdcf6">More...</a><br /></td></tr>
<tr class="separator:aab0e83dcfbed9677c5715a4175dcdcf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3f065d6fa293976c2276045cf713841"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ae3f065d6fa293976c2276045cf713841">InsertComponents</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;src_nnet, int32 c, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *dest_nnet)</td></tr>
<tr class="memdesc:ae3f065d6fa293976c2276045cf713841"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inserts the components of one neural network into a particular place in the other one.  <a href="#ae3f065d6fa293976c2276045cf713841">More...</a><br /></td></tr>
<tr class="separator:ae3f065d6fa293976c2276045cf713841"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a343d868474474434765c0d85d62c27ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a343d868474474434765c0d85d62c27ad">ReplaceLastComponents</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;src_nnet, int32 num_to_remove, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *dest_nnet)</td></tr>
<tr class="memdesc:a343d868474474434765c0d85d62c27ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes the last "num_to_remove" components and adds the components from "src_nnet".  <a href="#a343d868474474434765c0d85d62c27ad">More...</a><br /></td></tr>
<tr class="separator:a343d868474474434765c0d85d62c27ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a071dd91b80c074ef845397ff96472663"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a071dd91b80c074ef845397ff96472663">LimitRankParallel</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetLimitRankOpts.html">NnetLimitRankOpts</a> &amp;opts, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a071dd91b80c074ef845397ff96472663"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function limits the rank of each affine transform in the neural net, by zeroing out the smallest singular values.  <a href="#a071dd91b80c074ef845397ff96472663">More...</a><br /></td></tr>
<tr class="separator:a071dd91b80c074ef845397ff96472663"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fb99b022cdfb98d97d51ebb36752dcc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a2fb99b022cdfb98d97d51ebb36752dcc">UnitTestNnet</a> ()</td></tr>
<tr class="separator:a2fb99b022cdfb98d97d51ebb36752dcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07117e22b53a7ee4fe7262df208bc70d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a07117e22b53a7ee4fe7262df208bc70d">GenRandomNnet</a> (int32 input_dim, int32 output_dim)</td></tr>
<tr class="memdesc:a07117e22b53a7ee4fe7262df208bc70d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function generates a random neural net, for testing purposes.  <a href="#a07117e22b53a7ee4fe7262df208bc70d">More...</a><br /></td></tr>
<tr class="separator:a07117e22b53a7ee4fe7262df208bc70d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57b7c946a7595e2060af3518bc3db512"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a57b7c946a7595e2060af3518bc3db512">UnitTestPreconditionDirectionsOnline</a> ()</td></tr>
<tr class="separator:a57b7c946a7595e2060af3518bc3db512"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a761b9716989ec9bc47f55a6cf2445540"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a761b9716989ec9bc47f55a6cf2445540">UnitTestPreconditionDirections</a> ()</td></tr>
<tr class="separator:a761b9716989ec9bc47f55a6cf2445540"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af25337b8d10c63cb5a7dfb06cb732f17"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#af25337b8d10c63cb5a7dfb06cb732f17">PreconditionDirections</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;R, double lambda, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *P)</td></tr>
<tr class="memdesc:af25337b8d10c63cb5a7dfb06cb732f17"><td class="mdescLeft">&#160;</td><td class="mdescRight">See below for comment.  <a href="#af25337b8d10c63cb5a7dfb06cb732f17">More...</a><br /></td></tr>
<tr class="separator:af25337b8d10c63cb5a7dfb06cb732f17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a199b32ed158301df174b4b4a52edb2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a4a199b32ed158301df174b4b4a52edb2">PreconditionDirectionsAlpha</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;R, double alpha, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *P)</td></tr>
<tr class="memdesc:a4a199b32ed158301df174b4b4a52edb2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This wrapper for PreconditionDirections computes lambda using  = /(N D) trace(R^T, R), and calls PreconditionDirections.  <a href="#a4a199b32ed158301df174b4b4a52edb2">More...</a><br /></td></tr>
<tr class="separator:a4a199b32ed158301df174b4b4a52edb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d1d9b8171ab8e9a3c26bf3160f774fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a8d1d9b8171ab8e9a3c26bf3160f774fc">PreconditionDirectionsAlphaRescaled</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;R, double alpha, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *P)</td></tr>
<tr class="memdesc:a8d1d9b8171ab8e9a3c26bf3160f774fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">This wrapper for PreconditionDirections computes lambda using  = /(N D) trace(R^T, R), and calls PreconditionDirections.  <a href="#a8d1d9b8171ab8e9a3c26bf3160f774fc">More...</a><br /></td></tr>
<tr class="separator:a8d1d9b8171ab8e9a3c26bf3160f774fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af25faf523f3c6bf1c1297e49f6d4cd4b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#af25faf523f3c6bf1c1297e49f6d4cd4b">GetNnetStats</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetStatsConfig.html">NnetStatsConfig</a> &amp;config, const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1NnetStats.html">NnetStats</a> &gt; *stats)</td></tr>
<tr class="separator:af25faf523f3c6bf1c1297e49f6d4cd4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61fa49633f88cf2d21b894729c52df59"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a61fa49633f88cf2d21b894729c52df59">DoBackpropParallel</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, int32 minibatch_size, <a class="el" href="namespacekaldi_1_1nnet2.html#a206084ee5d66f24aeb8828c6bf8cb13d">SequentialNnetExampleReader</a> *example_reader, double *tot_weight, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet_to_update)</td></tr>
<tr class="memdesc:a61fa49633f88cf2d21b894729c52df59"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is similar to "DoBackprop" in <a class="el" href="nnet-update_8h.html" title="This header provides functionality for sample-by-sample stochastic gradient descent and gradient comp...">nnet-update.h</a> This function computes the objective function and either updates the model or computes parameter gradients.  <a href="#a61fa49633f88cf2d21b894729c52df59">More...</a><br /></td></tr>
<tr class="separator:a61fa49633f88cf2d21b894729c52df59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a643695e030a733b756fedd9ecd81839d"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a643695e030a733b756fedd9ecd81839d">DoBackpropSingleThreaded</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, int32 minibatch_size, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;egs, double *tot_weight, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet_to_update)</td></tr>
<tr class="separator:a643695e030a733b756fedd9ecd81839d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2fd8126b97e66ed2a8f71bd16a458cd"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ac2fd8126b97e66ed2a8f71bd16a458cd">DoBackpropParallel</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, int32 minibatch_size, int32 num_threads, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;examples, double *num_frames, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet_to_update)</td></tr>
<tr class="memdesc:ac2fd8126b97e66ed2a8f71bd16a458cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">This version of DoBackpropParallel takes a vector of examples, and will typically be used to compute the exact gradient.  <a href="#ac2fd8126b97e66ed2a8f71bd16a458cd">More...</a><br /></td></tr>
<tr class="separator:ac2fd8126b97e66ed2a8f71bd16a458cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29b896682d92f38ea7d6e4ea32ad6544"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a29b896682d92f38ea7d6e4ea32ad6544">ComputeNnetObjfParallel</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, int32 minibatch_size, int32 num_threads, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;examples, double *num_frames)</td></tr>
<tr class="memdesc:a29b896682d92f38ea7d6e4ea32ad6544"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is basically to clarify the fact that DoBackpropParallel will also work with nnet_to_update == NULL, and will compute the objf.  <a href="#a29b896682d92f38ea7d6e4ea32ad6544">More...</a><br /></td></tr>
<tr class="separator:a29b896682d92f38ea7d6e4ea32ad6544"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a748e54923cf54a322ea122b53bdf3850"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a748e54923cf54a322ea122b53bdf3850">FormatNnetInput</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;data, <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *mat)</td></tr>
<tr class="memdesc:a748e54923cf54a322ea122b53bdf3850"><td class="mdescLeft">&#160;</td><td class="mdescRight">Takes the input to the nnet for a minibatch of examples, and formats as a single matrix.  <a href="#a748e54923cf54a322ea122b53bdf3850">More...</a><br /></td></tr>
<tr class="separator:a748e54923cf54a322ea122b53bdf3850"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61238a092268dc3deaed1a23e8c3934b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a61238a092268dc3deaed1a23e8c3934b">TotalNnetTrainingWeight</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;egs)</td></tr>
<tr class="memdesc:a61238a092268dc3deaed1a23e8c3934b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the total weight summed over all the examples...  <a href="#a61238a092268dc3deaed1a23e8c3934b">More...</a><br /></td></tr>
<tr class="separator:a61238a092268dc3deaed1a23e8c3934b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1e4c84069b238f969a6104126d08d62"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#af1e4c84069b238f969a6104126d08d62">ComputeNnetObjf</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;examples, double *tot_accuracy=NULL)</td></tr>
<tr class="memdesc:af1e4c84069b238f969a6104126d08d62"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes objective function over a minibatch.  <a href="#af1e4c84069b238f969a6104126d08d62">More...</a><br /></td></tr>
<tr class="separator:af1e4c84069b238f969a6104126d08d62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc8d23d090fac8b744294c4a452a5928"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#acc8d23d090fac8b744294c4a452a5928">DoBackprop</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;examples, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet_to_update, double *tot_accuracy=NULL)</td></tr>
<tr class="memdesc:acc8d23d090fac8b744294c4a452a5928"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function computes the objective function and either updates the model or adds to parameter gradients.  <a href="#acc8d23d090fac8b744294c4a452a5928">More...</a><br /></td></tr>
<tr class="separator:acc8d23d090fac8b744294c4a452a5928"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8165f467036bd51b5447fd785d1a6e6c"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a8165f467036bd51b5447fd785d1a6e6c">DoBackprop</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;examples, <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *examples_formatted, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet_to_update, double *tot_accuracy=NULL)</td></tr>
<tr class="memdesc:a8165f467036bd51b5447fd785d1a6e6c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This version of DoBackprop allows you to separately call FormatNnetInput and provide the result to DoBackprop; this can be useful when using GPUs because the call to FormatNnetInput can be in a separate thread from the one that uses the GPU.  <a href="#a8165f467036bd51b5447fd785d1a6e6c">More...</a><br /></td></tr>
<tr class="separator:a8165f467036bd51b5447fd785d1a6e6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bdd75d853c6cdd4107d89f91e5f4a4c"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a4bdd75d853c6cdd4107d89f91e5f4a4c">ComputeNnetGradient</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;examples, int32 batch_size, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *gradient)</td></tr>
<tr class="memdesc:a4bdd75d853c6cdd4107d89f91e5f4a4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">ComputeNnetGradient is mostly used to compute gradients on validation sets; it divides the example into batches and calls <a class="el" href="namespacekaldi_1_1nnet2.html#acc8d23d090fac8b744294c4a452a5928" title="This function computes the objective function and either updates the model or adds to parameter gradi...">DoBackprop()</a> on each.  <a href="#a4bdd75d853c6cdd4107d89f91e5f4a4c">More...</a><br /></td></tr>
<tr class="separator:a4bdd75d853c6cdd4107d89f91e5f4a4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6643f605d627f98200da75dea1f23ad7"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a6643f605d627f98200da75dea1f23ad7">ComputeNnetObjf</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;examples, int32 minibatch_size, double *tot_accuracy=NULL)</td></tr>
<tr class="memdesc:a6643f605d627f98200da75dea1f23ad7"><td class="mdescLeft">&#160;</td><td class="mdescRight">This version of ComputeNnetObjf breaks up the examples into multiple minibatches to do the computation.  <a href="#a6643f605d627f98200da75dea1f23ad7">More...</a><br /></td></tr>
<tr class="separator:a6643f605d627f98200da75dea1f23ad7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a7990555e9bc1055173eb2628e2b540"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a7a7990555e9bc1055173eb2628e2b540">UnitTestNnetDecodable</a> ()</td></tr>
<tr class="separator:a7a7990555e9bc1055173eb2628e2b540"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adea380e52ef5a0a021e422f976716ab9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#adea380e52ef5a0a021e422f976716ab9">RescaleNnet</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetRescaleConfig.html">NnetRescaleConfig</a> &amp;rescale_config, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;examples, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="separator:adea380e52ef5a0a021e422f976716ab9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac44c6079a65265ad03f7e7d03a598b9f"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#ac44c6079a65265ad03f7e7d03a598b9f">ComputeObjfAndGradient</a> (const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;validation_set, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; &amp;log_scale_params, const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; *gradient)</td></tr>
<tr class="separator:ac44c6079a65265ad03f7e7d03a598b9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e858446644e4e4190b19ff73ce568d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a7e858446644e4e4190b19ff73ce568d7">ShrinkNnet</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetShrinkConfig.html">NnetShrinkConfig</a> &amp;shrink_config, const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;validation_set, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="separator:a7e858446644e4e4190b19ff73ce568d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a573bbaf2d11e8ffa24babe6da86a9c89"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structInt32Pair.html">Int32Pair</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a573bbaf2d11e8ffa24babe6da86a9c89">MakePair</a> (int32 first, int32 second)</td></tr>
<tr class="separator:a573bbaf2d11e8ffa24babe6da86a9c89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b65957690de074074ed5c356e932e63"><td class="memItemLeft" align="right" valign="top">int64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a8b65957690de074074ed5c356e932e63">TrainNnetSimple</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetSimpleTrainerConfig.html">NnetSimpleTrainerConfig</a> &amp;config, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet, <a class="el" href="namespacekaldi_1_1nnet2.html#a206084ee5d66f24aeb8828c6bf8cb13d">SequentialNnetExampleReader</a> *reader, double *tot_weight=NULL, double *tot_logprob=NULL)</td></tr>
<tr class="memdesc:a8b65957690de074074ed5c356e932e63"><td class="mdescLeft">&#160;</td><td class="mdescRight">Train on all the examples it can read from the reader.  <a href="#a8b65957690de074074ed5c356e932e63">More...</a><br /></td></tr>
<tr class="separator:a8b65957690de074074ed5c356e932e63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a8109623bc5211ffc3b6f0594aaad24"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a6a8109623bc5211ffc3b6f0594aaad24">WidenNnet</a> (const <a class="el" href="structkaldi_1_1nnet2_1_1NnetWidenConfig.html">NnetWidenConfig</a> &amp;widen_config, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="memdesc:a6a8109623bc5211ffc3b6f0594aaad24"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function widens a neural network by increasing the hidden-layer dimensions to the target.  <a href="#a6a8109623bc5211ffc3b6f0594aaad24">More...</a><br /></td></tr>
<tr class="separator:a6a8109623bc5211ffc3b6f0594aaad24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6efb3388f9385fddcae0b3087be5d5e4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a6efb3388f9385fddcae0b3087be5d5e4">KlDivergence</a> (const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;p, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;q)</td></tr>
<tr class="separator:a6efb3388f9385fddcae0b3087be5d5e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a880911e40d95a819b4d844364ce8efbb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a880911e40d95a819b4d844364ce8efbb">PrintPriorDiagnostics</a> (const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;old_priors, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;new_priors)</td></tr>
<tr class="separator:a880911e40d95a819b4d844364ce8efbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcaa21a4f5d88c32a8f3066fa74d0343"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#abcaa21a4f5d88c32a8f3066fa74d0343">GetCount</a> (double expected_count)</td></tr>
<tr class="separator:abcaa21a4f5d88c32a8f3066fa74d0343"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32824daa05f90c556cada53bb72384c4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a32824daa05f90c556cada53bb72384c4">AverageConstPart</a> (int32 const_feat_dim, <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> *eg)</td></tr>
<tr class="separator:a32824daa05f90c556cada53bb72384c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a861f24cf478a9cb02c1e0b1c39ea65be"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a861f24cf478a9cb02c1e0b1c39ea65be">ProcessFile</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;feats, const <a class="el" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> &amp;pdf_post, const std::string &amp;utt_id, int32 left_context, int32 right_context, int32 num_frames, int32 const_feat_dim, int64 *num_frames_written, int64 *num_egs_written, <a class="el" href="namespacekaldi_1_1nnet2.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a> *example_writer)</td></tr>
<tr class="separator:a861f24cf478a9cb02c1e0b1c39ea65be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed36521b08bfc3cf9f850e9fdc963976"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#aed36521b08bfc3cf9f850e9fdc963976">ProcessFile</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;feats, const <a class="el" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> &amp;pdf_post, const std::string &amp;utt_id, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;weights, int32 left_context, int32 right_context, int32 const_feat_dim, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> keep_proportion, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> weight_threshold, <a class="el" href="classbool.html">bool</a> use_frame_selection, <a class="el" href="classbool.html">bool</a> use_frame_weights, int64 *num_frames_written, int64 *num_frames_skipped, <a class="el" href="namespacekaldi_1_1nnet2.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a> *example_writer)</td></tr>
<tr class="separator:aed36521b08bfc3cf9f850e9fdc963976"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4799af744c68a53e61dbb825cb7a0426"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a4799af744c68a53e61dbb825cb7a0426">SetMaxChange</a> (<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> max_change, <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet)</td></tr>
<tr class="separator:a4799af744c68a53e61dbb825cb7a0426"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacf76cbfac182afbc1e1cf03166f1401"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#aacf76cbfac182afbc1e1cf03166f1401">SetPriors</a> (const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;tmodel, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; &amp;transition_accs, double prior_floor, <a class="el" href="classkaldi_1_1nnet2_1_1AmNnet.html">AmNnet</a> *am_nnet)</td></tr>
<tr class="separator:aacf76cbfac182afbc1e1cf03166f1401"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a61aa1571f96bd1f5bcbc3741d4adb26f"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a61aa1571f96bd1f5bcbc3741d4adb26f">nnet_example_warned_left</a> = false</td></tr>
<tr class="separator:a61aa1571f96bd1f5bcbc3741d4adb26f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16676aa9ae521c698fec8fd0f60d383e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacekaldi_1_1nnet2.html#a16676aa9ae521c698fec8fd0f60d383e">nnet_example_warned_right</a> = false</td></tr>
<tr class="separator:a16676aa9ae521c698fec8fd0f60d383e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a6948db4569b0e2c5d3bdcef6d2ff732f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6948db4569b0e2c5d3bdcef6d2ff732f">&#9670;&nbsp;</a></span>DiscriminativeNnetExampleWriter</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1TableWriter.html">TableWriter</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet2.html#a6948db4569b0e2c5d3bdcef6d2ff732f">DiscriminativeNnetExampleWriter</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-example_8h_source.html#l00181">181</a> of file <a class="el" href="nnet2_2nnet-example_8h_source.html">nnet-example.h</a>.</p>

</div>
</div>
<a id="af2246cc04a2596de3c09fad3c3513671"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2246cc04a2596de3c09fad3c3513671">&#9670;&nbsp;</a></span>NnetExampleWriter</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1TableWriter.html">TableWriter</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet2.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-example_8h_source.html#l00092">92</a> of file <a class="el" href="nnet2_2nnet-example_8h_source.html">nnet-example.h</a>.</p>

</div>
</div>
<a id="a091885a154db076533873b4d51da62a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a091885a154db076533873b4d51da62a7">&#9670;&nbsp;</a></span>RandomAccessDiscriminativeNnetExampleReader</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1RandomAccessTableReader.html">RandomAccessTableReader</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet2.html#a091885a154db076533873b4d51da62a7">RandomAccessDiscriminativeNnetExampleReader</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-example_8h_source.html#l00185">185</a> of file <a class="el" href="nnet2_2nnet-example_8h_source.html">nnet-example.h</a>.</p>

</div>
</div>
<a id="a96242234768bbde2864c47396903675e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96242234768bbde2864c47396903675e">&#9670;&nbsp;</a></span>RandomAccessNnetExampleReader</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1RandomAccessTableReader.html">RandomAccessTableReader</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet2.html#a96242234768bbde2864c47396903675e">RandomAccessNnetExampleReader</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-example_8h_source.html#l00094">94</a> of file <a class="el" href="nnet2_2nnet-example_8h_source.html">nnet-example.h</a>.</p>

</div>
</div>
<a id="a19617e2d7fdd519e551f8228e1041dac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19617e2d7fdd519e551f8228e1041dac">&#9670;&nbsp;</a></span>SequentialDiscriminativeNnetExampleReader</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1SequentialTableReader.html">SequentialTableReader</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet2.html#a19617e2d7fdd519e551f8228e1041dac">SequentialDiscriminativeNnetExampleReader</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-example_8h_source.html#l00183">183</a> of file <a class="el" href="nnet2_2nnet-example_8h_source.html">nnet-example.h</a>.</p>

</div>
</div>
<a id="a206084ee5d66f24aeb8828c6bf8cb13d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a206084ee5d66f24aeb8828c6bf8cb13d">&#9670;&nbsp;</a></span>SequentialNnetExampleReader</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classkaldi_1_1SequentialTableReader.html">SequentialTableReader</a>&lt;<a class="el" href="classkaldi_1_1KaldiObjectHolder.html">KaldiObjectHolder</a>&lt;<a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &gt; <a class="el" href="namespacekaldi_1_1nnet2.html#a206084ee5d66f24aeb8828c6bf8cb13d">SequentialNnetExampleReader</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-example_8h_source.html#l00093">93</a> of file <a class="el" href="nnet2_2nnet-example_8h_source.html">nnet-example.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a569b33d168ce7ea3fed7da40ed127f79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a569b33d168ce7ea3fed7da40ed127f79">&#9670;&nbsp;</a></span>AddDirection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet2::AddDirection </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>orig_nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>scales</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets "dest" to orig_nnet plus "direction", with each updatable component of "direction" first scaled by the appropriate scale. </p>

<p class="definition">Definition at line <a class="el" href="combine-nnet-a_8cc_source.html#l00052">52</a> of file <a class="el" href="combine-nnet-a_8cc_source.html">combine-nnet-a.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00576">Nnet::AddNnet()</a>.</p>

<p class="reference">Referenced by <a class="el" href="combine-nnet-a_8cc_source.html#l00102">CombineNnetsA()</a>, and <a class="el" href="combine-nnet-a_8cc_source.html#l00061">ComputeObjfAndGradient()</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                                     {</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  *dest = orig_nnet;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  dest-&gt;AddNnet(scales, direction);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a17af9ef5bb2426d326168af50e42688d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17af9ef5bb2426d326168af50e42688d">&#9670;&nbsp;</a></span>AppendDiscriminativeExamples()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AppendDiscriminativeExamples </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; const <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Appends the given vector of examples (which must be non-empty) into a single output example (called by CombineExamples, which might be a more convenient interface). </p>
<p>When combining examples it directly appends the features, and then adds a "fake" segment to the lattice and alignment in between, padding with transition-ids that are all ones. This is necessary in case the network needs acoustic context, and only because of a kind of limitation in the nnet training code that doesn't support varying 'chunk' sizes within a minibatch.</p>
<p>Will fail if all the input examples don't have the same weight (this will normally be 1.0 anyway), or if the feature dimension (i.e. basic feature dimension plus spk_info dimension) differs between the examples. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-functions_8cc_source.html#l00891">891</a> of file <a class="el" href="nnet-example-functions_8cc_source.html">nnet-example-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet2_2nnet-example_8h_source.html#l00148">DiscriminativeNnetExample::den_lat</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00159">DiscriminativeNnetExample::input_frames</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00164">DiscriminativeNnetExample::left_context</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00143">DiscriminativeNnetExample::num_ali</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="lattice-weight_8h_source.html#l00461">CompactLatticeWeightTpl&lt; WeightType, IntType &gt;::One()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00199">MatrixBase&lt; Real &gt;::Range()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00818">Matrix&lt; Real &gt;::Resize()</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00171">DiscriminativeNnetExample::spk_info</a>, and <a class="el" href="nnet2_2nnet-example_8h_source.html#l00140">DiscriminativeNnetExample::weight</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-example-functions_8cc_source.html#l00970">CombineDiscriminativeExamples()</a>, and <a class="el" href="nnet-example-functions_8h_source.html#l00133">SplitExampleStats::SplitExampleStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                                       {</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!input.empty());</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="keyword">const</span> DiscriminativeNnetExample &amp;eg0 = *(input[0]);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  </div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  int32 dim = eg0.input_frames.NumCols() + eg0.spk_info.Dim(),</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      left_context = eg0.left_context,</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      num_frames = eg0.num_ali.size(),</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      right_context = eg0.input_frames.NumRows() - num_frames - left_context;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  int32 tot_frames = eg0.input_frames.NumRows();  <span class="comment">// total frames (appended,</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                                                  <span class="comment">// with context)</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; input.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    tot_frames += input[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;input_frames.NumRows();</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  int32 arbitrary_tid = 1;  <span class="comment">// arbitrary transition-id that we use to pad the</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                            <span class="comment">// num_ali and den_lat members between segments</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                            <span class="comment">// (since they&#39;re both the same, and the den-lat in</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                            <span class="comment">// those parts is linear, they contribute no</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                            <span class="comment">// derivative to the training).</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  </div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  output-&gt;den_lat = eg0.den_lat;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  output-&gt;num_ali = eg0.num_ali;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  output-&gt;input_frames.Resize(tot_frames, dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  output-&gt;input_frames.Range(0, eg0.input_frames.NumRows(),</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                             0, eg0.input_frames.NumCols()).CopyFromMat(eg0.input_frames);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="keywordflow">if</span> (eg0.spk_info.Dim() != 0) {</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    output-&gt;input_frames.Range(0, eg0.input_frames.NumRows(),</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                               eg0.input_frames.NumCols(), eg0.spk_info.Dim()).</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        CopyRowsFromVec(eg0.spk_info);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  }</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  </div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  output-&gt;num_ali.reserve(tot_frames - left_context - right_context);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  output-&gt;weight = eg0.weight;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  output-&gt;left_context = eg0.left_context;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  output-&gt;spk_info.Resize(0);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <a class="code" href="namespacekaldi.html#aeba2c05d999bd2f794db8919ac816bb3">CompactLattice</a> inter_segment_clat;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  int32 initial = inter_segment_clat.AddState(); <span class="comment">// state 0.</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  inter_segment_clat.SetStart(initial);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  </div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  std::vector&lt;int32&gt; inter_segment_ali(left_context + right_context);</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  std::fill(inter_segment_ali.begin(), inter_segment_ali.end(), arbitrary_tid);</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <a class="code" href="namespacefst.html#a4b96c2715539a4b5008546dbe9d5085b">CompactLatticeWeight</a> final_weight = CompactLatticeWeight::One();</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  final_weight.SetString(inter_segment_ali);</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  inter_segment_clat.SetFinal(initial, final_weight);</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  </div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  int32 feat_offset = eg0.input_frames.NumRows();</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  </div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; input.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keyword">const</span> DiscriminativeNnetExample &amp;eg_i = *(input[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        </div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    output-&gt;input_frames.Range(feat_offset, eg_i.input_frames.NumRows(),</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                               0, eg_i.input_frames.NumCols()).CopyFromMat(</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                                   eg_i.input_frames);</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">if</span> (eg_i.spk_info.Dim() != 0) {</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      output-&gt;input_frames.Range(feat_offset, eg_i.input_frames.NumRows(),</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                                 eg_i.input_frames.NumCols(),</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                                 eg_i.spk_info.Dim()).CopyRowsFromVec(</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                                     eg_i.spk_info);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(eg_i.input_frames.NumCols() +</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                   eg_i.spk_info.Dim() == dim);</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    }</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    </div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    output-&gt;num_ali.insert(output-&gt;num_ali.end(),</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                           inter_segment_ali.begin(), inter_segment_ali.end());</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    output-&gt;num_ali.insert(output-&gt;num_ali.end(),</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                           eg_i.num_ali.begin(), eg_i.num_ali.end());</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    Concat(&amp;(output-&gt;den_lat), inter_segment_clat);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    Concat(&amp;(output-&gt;den_lat), eg_i.den_lat);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output-&gt;weight == eg_i.weight);</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(output-&gt;left_context == eg_i.left_context);</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    feat_offset += eg_i.input_frames.NumRows();</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  }</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(feat_offset == tot_frames);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_html_aeba2c05d999bd2f794db8919ac816bb3"><div class="ttname"><a href="namespacekaldi.html#aeba2c05d999bd2f794db8919ac816bb3">kaldi::CompactLattice</a></div><div class="ttdeci">fst::VectorFst&lt; CompactLatticeArc &gt; CompactLattice</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-lattice_8h_source.html#l00046">kaldi-lattice.h:46</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacefst_html_a4b96c2715539a4b5008546dbe9d5085b"><div class="ttname"><a href="namespacefst.html#a4b96c2715539a4b5008546dbe9d5085b">fst::CompactLatticeWeight</a></div><div class="ttdeci">CompactLatticeWeightTpl&lt; LatticeWeight, int32 &gt; CompactLatticeWeight</div><div class="ttdef"><b>Definition:</b> <a href="lattice-weight-test_8cc_source.html#l00030">lattice-weight-test.cc:30</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a32824daa05f90c556cada53bb72384c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32824daa05f90c556cada53bb72384c4">&#9670;&nbsp;</a></span>AverageConstPart()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::AverageConstPart </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>const_feat_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> *&#160;</td>
          <td class="paramname"><em>eg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-copy-egs-discriminative_8cc_source.html#l00042">42</a> of file <a class="el" href="nnet-copy-egs-discriminative_8cc_source.html">nnet-copy-egs-discriminative.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet2_2nnet-example_8h_source.html#l00159">DiscriminativeNnetExample::input_frames</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00199">MatrixBase&lt; Real &gt;::Range()</a>, and <a class="el" href="nnet2_2nnet-example_8h_source.html#l00171">DiscriminativeNnetExample::spk_info</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-copy-egs-discriminative_8cc_source.html#l00065">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                                                     {</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordflow">if</span> (eg-&gt;<a class="code" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html#ad870f332576dd0b02de55b901f64de52">spk_info</a>.Dim() != 0) {  <span class="comment">// already has const part.</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(eg-&gt;<a class="code" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html#ad870f332576dd0b02de55b901f64de52">spk_info</a>.Dim() == const_feat_dim);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// and nothing to do.</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    int32 dim = eg-&gt;<a class="code" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html#a592a3e7118d5ebe1cda49e6e6d06ba7c">input_frames</a>.<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>(),</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        basic_dim = dim - const_feat_dim;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(const_feat_dim &lt; eg-&gt;input_frames.NumCols());</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> mat(eg-&gt;<a class="code" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html#a592a3e7118d5ebe1cda49e6e6d06ba7c">input_frames</a>);  <span class="comment">// copy to non-compressed matrix.</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    eg-&gt;<a class="code" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html#a592a3e7118d5ebe1cda49e6e6d06ba7c">input_frames</a> = mat.<a class="code" href="classkaldi_1_1MatrixBase.html#a25e0f58aedf2cfe1388e09f2396ff86a">Range</a>(0, mat.NumRows(), 0, basic_dim);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    eg-&gt;<a class="code" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html#ad870f332576dd0b02de55b901f64de52">spk_info</a>.Resize(const_feat_dim);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    eg-&gt;<a class="code" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html#ad870f332576dd0b02de55b901f64de52">spk_info</a>.AddRowSumMat(1.0 / mat.NumRows(),</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                              mat.Range(0, mat.NumRows(),</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                                        basic_dim, const_feat_dim),</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                              0.0);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  }</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div><div class="ttc" id="classkaldi_1_1MatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::MatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdoc">Returns number of columns (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00064">kaldi-matrix.h:64</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample_html_ad870f332576dd0b02de55b901f64de52"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html#ad870f332576dd0b02de55b901f64de52">kaldi::nnet2::DiscriminativeNnetExample::spk_info</a></div><div class="ttdeci">Vector&lt; BaseFloat &gt; spk_info</div><div class="ttdoc">spk_info contains any component of the features that varies slowly or not at all with time (and hence...</div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-example_8h_source.html#l00171">nnet-example.h:171</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample_html_a592a3e7118d5ebe1cda49e6e6d06ba7c"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html#a592a3e7118d5ebe1cda49e6e6d06ba7c">kaldi::nnet2::DiscriminativeNnetExample::input_frames</a></div><div class="ttdeci">Matrix&lt; BaseFloat &gt; input_frames</div><div class="ttdoc">The input data typically with a number of frames [NumRows()] larger than labels.size(), because it includes features to the left and right as needed for the temporal context of the network. </div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-example_8h_source.html#l00159">nnet-example.h:159</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a25e0f58aedf2cfe1388e09f2396ff86a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a25e0f58aedf2cfe1388e09f2396ff86a">kaldi::MatrixBase::Range</a></div><div class="ttdeci">SubMatrix&lt; Real &gt; Range(const MatrixIndexT row_offset, const MatrixIndexT num_rows, const MatrixIndexT col_offset, const MatrixIndexT num_cols) const</div><div class="ttdoc">Return a sub-part of matrix. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00199">kaldi-matrix.h:199</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5c56471e50ec713f799025d52860a8f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c56471e50ec713f799025d52860a8f0">&#9670;&nbsp;</a></span>BasicDebugTestForSpliceMax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::BasicDebugTestForSpliceMax </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>output</em> = <code>false</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00811">811</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l02891">SpliceMaxComponent::Backprop()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02814">SpliceMaxComponent::Init()</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="_2nnet-component_8h_source.html#l01142">SpliceMaxComponent::OutputDim()</a>, and <a class="el" href="_2nnet-component_8cc_source.html#l02847">SpliceMaxComponent::Propagate()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                                                   {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  int32 C=5,</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        context_len=2,</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        R= 3 + 2*context_len;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html">SpliceMaxComponent</a> *c = <span class="keyword">new</span> <a class="code" href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html">SpliceMaxComponent</a>();</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  std::vector&lt;int32&gt; context(2 * context_len + 1);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = -1 * context_len; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= context_len; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    context[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + context_len] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  c-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html#a8286941a4d0a51a26f0e914385772e89">Init</a>(C, context);</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> in(R, C), in_deriv(R, C);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> out(R, c-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html#a323155ad8034c0b14762dd78ae4415b5">OutputDim</a>());</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a> in_info = <a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a>(C, 1, 0, R - 1),</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            out_info = <a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a>(C, 1, context_len, R - 1 - context_len);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  in.SetRandn();</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="keywordflow">if</span> (output)</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; in;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  c-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html#ace7d241fd0c2d8eda4773cd1f1d2a815">Propagate</a>(in_info, out_info, in, &amp;out);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="keywordflow">if</span> (output)</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; out;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  out.Set(5.0);</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordflow">if</span> (output)</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; out;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  c-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html#a670865907cd1d8cd6e12e5ea93ff97f9">Backprop</a>(in_info, out_info, in, in, out, c, &amp;in_deriv);</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="keywordflow">if</span> (output)</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; in_deriv;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keyword">delete</span> c;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1SpliceMaxComponent_html_ace7d241fd0c2d8eda4773cd1f1d2a815"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html#ace7d241fd0c2d8eda4773cd1f1d2a815">kaldi::nnet2::SpliceMaxComponent::Propagate</a></div><div class="ttdeci">virtual void Propagate(const ChunkInfo &amp;in_info, const ChunkInfo &amp;out_info, const CuMatrixBase&lt; BaseFloat &gt; &amp;in, CuMatrixBase&lt; BaseFloat &gt; *out) const</div><div class="ttdoc">Perform forward pass propagation Input-&gt;Output. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l02847">nnet-component.cc:2847</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1SpliceMaxComponent_html_a323155ad8034c0b14762dd78ae4415b5"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html#a323155ad8034c0b14762dd78ae4415b5">kaldi::nnet2::SpliceMaxComponent::OutputDim</a></div><div class="ttdeci">virtual int32 OutputDim() const</div><div class="ttdoc">Get size of output vectors. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01142">nnet-component.h:1142</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1SpliceMaxComponent_html_a670865907cd1d8cd6e12e5ea93ff97f9"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html#a670865907cd1d8cd6e12e5ea93ff97f9">kaldi::nnet2::SpliceMaxComponent::Backprop</a></div><div class="ttdeci">virtual void Backprop(const ChunkInfo &amp;in_info, const ChunkInfo &amp;out_info, const CuMatrixBase&lt; BaseFloat &gt; &amp;in_value, const CuMatrixBase&lt; BaseFloat &gt; &amp;out_value, const CuMatrixBase&lt; BaseFloat &gt; &amp;out_deriv, Component *to_update, CuMatrix&lt; BaseFloat &gt; *in_deriv) const</div><div class="ttdoc">Perform backward pass propagation of the derivative, and also either update the model (if to_update =...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l02891">nnet-component.cc:2891</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1SpliceMaxComponent_html_a8286941a4d0a51a26f0e914385772e89"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html#a8286941a4d0a51a26f0e914385772e89">kaldi::nnet2::SpliceMaxComponent::Init</a></div><div class="ttdeci">void Init(int32 dim, std::vector&lt; int32 &gt; context)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l02814">nnet-component.cc:2814</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1ChunkInfo_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1ChunkInfo.html">kaldi::nnet2::ChunkInfo</a></div><div class="ttdoc">ChunkInfo is a class whose purpose is to describe the structure of matrices holding features...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00072">nnet-component.h:72</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1SpliceMaxComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1SpliceMaxComponent.html">kaldi::nnet2::SpliceMaxComponent</a></div><div class="ttdoc">This is as SpliceComponent but outputs the max of any of the inputs (taking the max across time)...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01133">nnet-component.h:1133</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9f916be98d9e9721a644ecc9ca6d2d2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f916be98d9e9721a644ecc9ca6d2d2d">&#9670;&nbsp;</a></span>CombineDiscriminativeExamples()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CombineDiscriminativeExamples </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>max_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is used to combine multiple discriminative-training examples (each corresponding to a segment of a lattice), into one. </p>
<p>It combines examples into groups such that each group will have a total length (number of rows of the feature matrix) less than or equal to max_length. However, if individual examples are longer than max_length they will still be processed; they will be given their own group.</p>
<p>See also the documentation for <a class="el" href="namespacekaldi_1_1nnet2.html#a17af9ef5bb2426d326168af50e42688d" title="Appends the given vector of examples (which must be non-empty) into a single output example (called b...">AppendDiscriminativeExamples()</a> which gives more details on how we append the examples.</p>
<p>Will fail if all the input examples don't have the same weight (this will normally be 1.0 anyway).</p>
<p>If the spk_info variables are non-empty, it will move them into the features of the output, so the spk_info of the output will be empty but the appropriate speaker vectors will be appended to each row of the features. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-functions_8cc_source.html#l00970">970</a> of file <a class="el" href="nnet-example-functions_8cc_source.html">nnet-example-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-example-functions_8cc_source.html#l00891">AppendDiscriminativeExamples()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, and <a class="el" href="nnet-example-functions_8cc_source.html#l00867">SolvePackingProblem()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-combine-egs-discriminative_8cc_source.html#l00025">main()</a>, and <a class="el" href="nnet-example-functions_8h_source.html#l00133">SplitExampleStats::SplitExampleStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                                                  {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  </div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  std::vector&lt;BaseFloat&gt; costs(input.size());</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; input.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    costs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = static_cast&lt;BaseFloat&gt;(input[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].input_frames.NumRows());</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  std::vector&lt;std::vector&lt;size_t&gt; &gt; groups;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#a6dbcd705d1a304dd958607aedb503f72">SolvePackingProblem</a>(max_length,</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                      costs,</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                      &amp;groups);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  output-&gt;clear();</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  output-&gt;resize(groups.size());</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; groups.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    std::vector&lt;const DiscriminativeNnetExample*&gt; group_egs;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; groups[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      <span class="keywordtype">size_t</span> index = groups[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      group_egs.push_back(&amp;(input[index]));</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    }</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#a17af9ef5bb2426d326168af50e42688d">AppendDiscriminativeExamples</a>(group_egs, &amp;((*output)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  }</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a17af9ef5bb2426d326168af50e42688d"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a17af9ef5bb2426d326168af50e42688d">kaldi::nnet2::AppendDiscriminativeExamples</a></div><div class="ttdeci">void AppendDiscriminativeExamples(const std::vector&lt; const DiscriminativeNnetExample *&gt; &amp;input, DiscriminativeNnetExample *output)</div><div class="ttdoc">Appends the given vector of examples (which must be non-empty) into a single output example (called b...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-functions_8cc_source.html#l00891">nnet-example-functions.cc:891</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a6dbcd705d1a304dd958607aedb503f72"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a6dbcd705d1a304dd958607aedb503f72">kaldi::nnet2::SolvePackingProblem</a></div><div class="ttdeci">void SolvePackingProblem(BaseFloat max_cost, const std::vector&lt; BaseFloat &gt; &amp;costs, std::vector&lt; std::vector&lt; size_t &gt; &gt; *groups)</div><div class="ttdoc">This function solves the &quot;packing problem&quot; using the &quot;first fit&quot; algorithm. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-functions_8cc_source.html#l00867">nnet-example-functions.cc:867</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac0c722fcb5bb432bb7e54d70b742885c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0c722fcb5bb432bb7e54d70b742885c">&#9670;&nbsp;</a></span>CombineNnets() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet2::CombineNnets </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>scale_params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>nnets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="combine-nnet_8cc_source.html#l00028">28</a> of file <a class="el" href="combine-nnet_8cc_source.html">combine-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00576">Nnet::AddNnet()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-utils_8cc_source.html#l00413">kaldi::nnet3::NumUpdatableComponents()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00421">Nnet::ScaleComponents()</a>.</p>

<p class="reference">Referenced by <a class="el" href="combine-nnet_8cc_source.html#l00193">CombineNnets()</a>, <a class="el" href="combine-nnet-fast_8cc_source.html#l00356">FastNnetCombiner::ComputeCurrentNnet()</a>, <a class="el" href="combine-nnet_8cc_source.html#l00124">ComputeObjfAndGradient()</a>, <a class="el" href="combine-nnet-fast_8cc_source.html#l00104">FastNnetCombiner::FastNnetCombiner()</a>, <a class="el" href="combine-nnet_8cc_source.html#l00049">GetInitialModel()</a>, <a class="el" href="combine-nnet-fast_8cc_source.html#l00381">FastNnetCombiner::GetInitialModel()</a>, <a class="el" href="nnet-combine_8cc_source.html#l00027">main()</a>, and <a class="el" href="combine-nnet_8h_source.html#l00050">NnetCombineConfig::Register()</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                                     {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  int32 num_nnets = nnets.size();</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_nnets &gt;= 1);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  int32 num_uc = nnets[0].NumUpdatableComponents();</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_nnets * nnets[0].<a class="code" href="namespacekaldi_1_1nnet3.html#a25df665b8f7a712a34469e53fc875851">NumUpdatableComponents</a>());</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  </div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  </div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  *dest = nnets[0];</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  SubVector&lt;BaseFloat&gt; scale_params0(scale_params, 0, num_uc);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  dest-&gt;ScaleComponents(scale_params0);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 1; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_nnets; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    SubVector&lt;BaseFloat&gt; scale_params_n(scale_params, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> * num_uc, num_uc);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    dest-&gt;AddNnet(scale_params_n, nnets[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>]);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  }</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a25df665b8f7a712a34469e53fc875851"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a25df665b8f7a712a34469e53fc875851">kaldi::nnet3::NumUpdatableComponents</a></div><div class="ttdeci">int32 NumUpdatableComponents(const Nnet &amp;dest)</div><div class="ttdoc">Returns the number of updatable components in the nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00413">nnet-utils.cc:413</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5c0d6a9ebb01f8cf3e31496c52956ae4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c0d6a9ebb01f8cf3e31496c52956ae4">&#9670;&nbsp;</a></span>CombineNnets() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CombineNnets </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetCombineConfig.html">NnetCombineConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>combine_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>validation_set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>nnets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="combine-nnet_8cc_source.html#l00193">193</a> of file <a class="el" href="combine-nnet_8cc_source.html">combine-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="combine-nnet_8cc_source.html#l00028">CombineNnets()</a>, <a class="el" href="combine-nnet-a_8cc_source.html#l00061">ComputeObjfAndGradient()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00228">VectorBase&lt; Real &gt;::CopyFromVec()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00996">MatrixBase&lt; Real &gt;::CopyRowsFromVec()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="optimization_8cc_source.html#l00383">OptimizeLbfgs&lt; Real &gt;::DoStep()</a>, <a class="el" href="optimization_8h_source.html#l00094">LbfgsOptions::first_step_impr</a>, <a class="el" href="combine-nnet_8cc_source.html#l00091">GetInitialScaleParams()</a>, <a class="el" href="optimization_8h_source.html#l00134">OptimizeLbfgs&lt; Real &gt;::GetProposedValue()</a>, <a class="el" href="optimization_8cc_source.html#l00416">OptimizeLbfgs&lt; Real &gt;::GetValue()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="combine-nnet_8h_source.html#l00044">NnetCombineConfig::initial_impr</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>, <a class="el" href="optimization_8h_source.html#l00086">LbfgsOptions::m</a>, <a class="el" href="optimization_8h_source.html#l00085">LbfgsOptions::minimize</a>, <a class="el" href="combine-nnet_8h_source.html#l00038">NnetCombineConfig::num_bfgs_iters</a>, and <a class="el" href="combine-nnet_8h_source.html#l00045">NnetCombineConfig::test_gradient</a>.</p>
<div class="fragment"><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                  {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  Vector&lt;double&gt; scale_params;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#a103073fe3eed1a67996f168cae60f73d">GetInitialScaleParams</a>(combine_config,</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                        validation_set,</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                        nnets,</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                        &amp;scale_params);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  int32 dim = scale_params.Dim();</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(dim &gt; 0);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  Vector&lt;double&gt; gradient(dim);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  </div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">double</span> objf, initial_objf;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  LbfgsOptions lbfgs_options;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  lbfgs_options.minimize = <span class="keyword">false</span>; <span class="comment">// We&#39;re maximizing.</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  lbfgs_options.m = dim; <span class="comment">// Store the same number of vectors as the dimension</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">// itself, so this is BFGS.</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  lbfgs_options.first_step_impr = combine_config.initial_impr;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  </div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  OptimizeLbfgs&lt;double&gt; lbfgs(scale_params,</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                              lbfgs_options);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  </div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; combine_config.num_bfgs_iters; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {    </div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    scale_params.CopyFromVec(lbfgs.GetProposedValue());</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    objf = <a class="code" href="namespacekaldi_1_1nnet2.html#a7288d7be65892fb998c9ee5a6d10ea7c">ComputeObjfAndGradient</a>(validation_set,</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                                  scale_params,</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                                  nnets,</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                                  combine_config.test_gradient,</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                                  &amp;gradient);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(2) &lt;&lt; <span class="stringliteral">&quot;Iteration &quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot; scale-params = &quot;</span> &lt;&lt; scale_params</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;, objf = &quot;</span> &lt;&lt; objf &lt;&lt; <span class="stringliteral">&quot;, gradient = &quot;</span> &lt;&lt; gradient;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    </div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) initial_objf = objf;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    </div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    lbfgs.DoStep(objf, gradient);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  scale_params.CopyFromVec(lbfgs.GetValue(&amp;objf));</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  Vector&lt;BaseFloat&gt; scale_params_float(scale_params);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Combining nnets, validation objf per frame changed from &quot;</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            &lt;&lt; initial_objf &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; objf;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  Matrix&lt;BaseFloat&gt; scale_params_mat(nnets.size(),</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                                     nnets[0].NumUpdatableComponents());</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  scale_params_mat.CopyRowsFromVec(scale_params_float);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Final scale factors are &quot;</span> &lt;&lt; scale_params_mat;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  </div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#a5c0d6a9ebb01f8cf3e31496c52956ae4">CombineNnets</a>(scale_params_float, nnets, nnet_out);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_a103073fe3eed1a67996f168cae60f73d"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a103073fe3eed1a67996f168cae60f73d">kaldi::nnet2::GetInitialScaleParams</a></div><div class="ttdeci">static void GetInitialScaleParams(const NnetCombineConfig &amp;combine_config, const std::vector&lt; NnetExample &gt; &amp;validation_set, const std::vector&lt; Nnet &gt; &amp;nnets, Vector&lt; double &gt; *scale_params)</div><div class="ttdef"><b>Definition:</b> <a href="combine-nnet_8cc_source.html#l00091">combine-nnet.cc:91</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a7288d7be65892fb998c9ee5a6d10ea7c"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a7288d7be65892fb998c9ee5a6d10ea7c">kaldi::nnet2::ComputeObjfAndGradient</a></div><div class="ttdeci">static double ComputeObjfAndGradient(const std::vector&lt; NnetExample &gt; &amp;validation_set, const Vector&lt; double &gt; &amp;scale_params, const std::vector&lt; Nnet &gt; &amp;nnets, bool debug, Vector&lt; double &gt; *gradient)</div><div class="ttdef"><b>Definition:</b> <a href="combine-nnet_8cc_source.html#l00124">combine-nnet.cc:124</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a5c0d6a9ebb01f8cf3e31496c52956ae4"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a5c0d6a9ebb01f8cf3e31496c52956ae4">kaldi::nnet2::CombineNnets</a></div><div class="ttdeci">void CombineNnets(const NnetCombineConfig &amp;combine_config, const std::vector&lt; NnetExample &gt; &amp;validation_set, const std::vector&lt; Nnet &gt; &amp;nnets, Nnet *nnet_out)</div><div class="ttdef"><b>Definition:</b> <a href="combine-nnet_8cc_source.html#l00193">combine-nnet.cc:193</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9fbd108b9e92078515559963ace4effc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fbd108b9e92078515559963ace4effc">&#9670;&nbsp;</a></span>CombineNnetsA()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CombineNnetsA </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetCombineAconfig.html">NnetCombineAconfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>validation_set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>nnets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="combine-nnet-a_8cc_source.html#l00102">102</a> of file <a class="el" href="combine-nnet-a_8cc_source.html">combine-nnet-a.cc</a>.</p>

<p class="reference">References <a class="el" href="combine-nnet-a_8cc_source.html#l00052">AddDirection()</a>, <a class="el" href="combine-nnet-a_8cc_source.html#l00061">ComputeObjfAndGradient()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00228">VectorBase&lt; Real &gt;::CopyFromVec()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="optimization_8cc_source.html#l00383">OptimizeLbfgs&lt; Real &gt;::DoStep()</a>, <a class="el" href="optimization_8h_source.html#l00090">LbfgsOptions::first_step_length</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, <a class="el" href="optimization_8h_source.html#l00134">OptimizeLbfgs&lt; Real &gt;::GetProposedValue()</a>, <a class="el" href="combine-nnet-a_8cc_source.html#l00031">GetUpdateDirection()</a>, <a class="el" href="optimization_8cc_source.html#l00416">OptimizeLbfgs&lt; Real &gt;::GetValue()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="combine-nnet-a_8h_source.html#l00036">NnetCombineAconfig::initial_step</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="_2nnet-component_8h_source.html#l00323">UpdatableComponent::LearningRate()</a>, <a class="el" href="optimization_8h_source.html#l00086">LbfgsOptions::m</a>, <a class="el" href="combine-nnet-a_8h_source.html#l00042">NnetCombineAconfig::max_learning_rate_factor</a>, <a class="el" href="combine-nnet-a_8h_source.html#l00043">NnetCombineAconfig::min_learning_rate</a>, <a class="el" href="combine-nnet-a_8h_source.html#l00041">NnetCombineAconfig::min_learning_rate_factor</a>, <a class="el" href="optimization_8h_source.html#l00085">LbfgsOptions::minimize</a>, <a class="el" href="combine-nnet-a_8h_source.html#l00032">NnetCombineAconfig::num_bfgs_iters</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00413">kaldi::nnet3::NumUpdatableComponents()</a>, <a class="el" href="combine-nnet-a_8h_source.html#l00039">NnetCombineAconfig::overshoot</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00336">VectorBase&lt; Real &gt;::Set()</a>, <a class="el" href="_2nnet-component_8h_source.html#l00321">UpdatableComponent::SetLearningRate()</a>, and <a class="el" href="combine-nnet-a_8h_source.html#l00038">NnetCombineAconfig::valid_impr_thresh</a>.</p>

<p class="reference">Referenced by <a class="el" href="combine-nnet-a_8h_source.html#l00052">NnetCombineAconfig::Register()</a>.</p>
<div class="fragment"><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                                   {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  Nnet direction; <span class="comment">// the update direction = avg(nnets[1 ... N]) - nnets[0].</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#aff85e4bd1e5f472b2869f9cdfa71c93a">GetUpdateDirection</a>(nnets, &amp;direction);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  </div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  Vector&lt;double&gt; scale_params(nnets[0].<a class="code" href="namespacekaldi_1_1nnet3.html#a25df665b8f7a712a34469e53fc875851">NumUpdatableComponents</a>()); <span class="comment">// initial</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="comment">// scale on &quot;direction&quot;.</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  int32 dim = scale_params.Dim();</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(dim &gt; 0);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  Vector&lt;double&gt; gradient(dim);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  </div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordtype">double</span> objf, initial_objf, zero_objf;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="comment">// Compute objf at zero; we don&#39;t actually need this gradient.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  zero_objf = <a class="code" href="namespacekaldi_1_1nnet2.html#a04d30a6731c95341c9eef5f6ceffe4c5">ComputeObjfAndGradient</a>(validation_set,</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                                     scale_params,</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                                     nnets[0],</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                     direction,</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                                     &amp;gradient);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Objective function at old parameters is &quot;</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            &lt;&lt; zero_objf;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  </div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  scale_params.Set(1.0); <span class="comment">// start optimization from the average of the parameters.</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  LbfgsOptions lbfgs_options;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  lbfgs_options.minimize = <span class="keyword">false</span>; <span class="comment">// We&#39;re maximizing.</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  lbfgs_options.m = dim; <span class="comment">// Store the same number of vectors as the dimension</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">// itself, so this is BFGS.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  lbfgs_options.first_step_length = config.initial_step;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  </div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  OptimizeLbfgs&lt;double&gt; lbfgs(scale_params,</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                              lbfgs_options);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  </div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; config.num_bfgs_iters; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {    </div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    scale_params.CopyFromVec(lbfgs.GetProposedValue());</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    objf = <a class="code" href="namespacekaldi_1_1nnet2.html#a04d30a6731c95341c9eef5f6ceffe4c5">ComputeObjfAndGradient</a>(validation_set,</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                                  scale_params,</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                  nnets[0],</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                                  direction,</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                                  &amp;gradient);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(2) &lt;&lt; <span class="stringliteral">&quot;Iteration &quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot; scale-params = &quot;</span> &lt;&lt; scale_params</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;, objf = &quot;</span> &lt;&lt; objf &lt;&lt; <span class="stringliteral">&quot;, gradient = &quot;</span> &lt;&lt; gradient;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    </div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) initial_objf = objf;    </div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    lbfgs.DoStep(objf, gradient);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  scale_params.CopyFromVec(lbfgs.GetValue(&amp;objf));</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Combining nnets, after BFGS, validation objf per frame changed from &quot;</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            &lt;&lt; zero_objf &lt;&lt; <span class="stringliteral">&quot; (no change), or &quot;</span> &lt;&lt; initial_objf &lt;&lt; <span class="stringliteral">&quot; (default change), &quot;</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; objf &lt;&lt; <span class="stringliteral">&quot;; scale factors on update direction are &quot;</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            &lt;&lt; scale_params;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> objf_change = objf - zero_objf;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(objf_change &gt;= 0.0); <span class="comment">// This is guaranteed by the L-BFGS code.</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">if</span> (objf_change &lt; config.valid_impr_thresh) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// We&#39;ll overshoot.  To have a smooth transition between the two regimes, if</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// objf_change is close to valid_impr_thresh we don&#39;t overshoot as far.</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> overshoot = config.overshoot,</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        overshoot_max = config.valid_impr_thresh / objf_change; <span class="comment">// &gt;= 1.0.</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">if</span> (overshoot_max &lt; overshoot) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Limiting overshoot from &quot;</span> &lt;&lt; overshoot &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; overshoot_max</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; since the objf-impr &quot;</span> &lt;&lt; objf_change &lt;&lt; <span class="stringliteral">&quot; is close to &quot;</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;--valid-impr-thresh=&quot;</span> &lt;&lt; config.valid_impr_thresh;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      overshoot = overshoot_max;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(overshoot &lt; 2.0 &amp;&amp; <span class="stringliteral">&quot;--valid-impr-thresh must be &lt; 2.0 or &quot;</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                 <span class="stringliteral">&quot;it will lead to instability.&quot;</span>);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    scale_params.Scale(overshoot);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> optimized_objf = objf;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    objf = <a class="code" href="namespacekaldi_1_1nnet2.html#a04d30a6731c95341c9eef5f6ceffe4c5">ComputeObjfAndGradient</a>(validation_set,</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                  scale_params,</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                  nnets[0],</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                  direction,</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                  &amp;gradient);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Combining nnets, after overshooting, validation objf changed &quot;</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;to &quot;</span> &lt;&lt; objf &lt;&lt; <span class="stringliteral">&quot;.  Note: (zero, start, optimized) objfs were &quot;</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;              &lt;&lt; zero_objf &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; initial_objf &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; optimized_objf;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span> (objf &lt; zero_objf) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="comment">// Note: this should not happen according to a quadratic approximation, and we</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="comment">// expect this branch to be taken only rarely if at all.</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;After overshooting, objf was worse than not updating; not doing the &quot;</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;overshoot. &quot;</span>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;     scale_params.Scale(1.0 / overshoot);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  } <span class="comment">// Else don&#39;t do the &quot;overshoot&quot; stuff.</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  </div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  Vector&lt;BaseFloat&gt; scale_params_float(scale_params);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="comment">// Output to &quot;nnet_out&quot;:</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#a569b33d168ce7ea3fed7da40ed127f79">AddDirection</a>(nnets[0], direction, scale_params_float, nnet_out);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="comment">// Now update the neural net learning rates.</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; nnet_out-&gt;NumComponents(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    UpdatableComponent *uc =</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keyword">dynamic_cast&lt;</span>UpdatableComponent*<span class="keyword">&gt;</span>(&amp;(nnet_out-&gt;GetComponent(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>)));</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">if</span> (uc != NULL) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> step_length = scale_params(i), factor = step_length;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="comment">// Our basic rule is to update the learning rate by multiplying it</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="comment">// by &quot;step_lenght&quot;, but this is subject to certain limits.</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordflow">if</span> (factor &lt; config.min_learning_rate_factor)</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        factor = config.min_learning_rate_factor;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <span class="keywordflow">if</span> (factor &gt; config.max_learning_rate_factor)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        factor = config.max_learning_rate_factor;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> new_learning_rate = factor * uc-&gt;LearningRate();</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keywordflow">if</span> (new_learning_rate &lt; config.min_learning_rate)</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        new_learning_rate = config.min_learning_rate;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;For component &quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;&lt; <span class="stringliteral">&quot;, step length was &quot;</span> &lt;&lt; step_length</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;, updating learning rate by factor &quot;</span> &lt;&lt; factor &lt;&lt; <span class="stringliteral">&quot;, changing &quot;</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;learning rate from &quot;</span> &lt;&lt; uc-&gt;LearningRate() &lt;&lt; <span class="stringliteral">&quot; to &quot;</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                &lt;&lt; new_learning_rate;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      uc-&gt;SetLearningRate(new_learning_rate);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      i++;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a569b33d168ce7ea3fed7da40ed127f79"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a569b33d168ce7ea3fed7da40ed127f79">kaldi::nnet2::AddDirection</a></div><div class="ttdeci">static void AddDirection(const Nnet &amp;orig_nnet, const Nnet &amp;direction, const VectorBase&lt; BaseFloat &gt; &amp;scales, Nnet *dest)</div><div class="ttdoc">Sets &quot;dest&quot; to orig_nnet plus &quot;direction&quot;, with each updatable component of &quot;direction&quot; first scaled ...</div><div class="ttdef"><b>Definition:</b> <a href="combine-nnet-a_8cc_source.html#l00052">combine-nnet-a.cc:52</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_aff85e4bd1e5f472b2869f9cdfa71c93a"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#aff85e4bd1e5f472b2869f9cdfa71c93a">kaldi::nnet2::GetUpdateDirection</a></div><div class="ttdeci">static void GetUpdateDirection(const std::vector&lt; Nnet &gt; &amp;nnets, Nnet *direction)</div><div class="ttdef"><b>Definition:</b> <a href="combine-nnet-a_8cc_source.html#l00031">combine-nnet-a.cc:31</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a25df665b8f7a712a34469e53fc875851"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a25df665b8f7a712a34469e53fc875851">kaldi::nnet3::NumUpdatableComponents</a></div><div class="ttdeci">int32 NumUpdatableComponents(const Nnet &amp;dest)</div><div class="ttdoc">Returns the number of updatable components in the nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00413">nnet-utils.cc:413</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a04d30a6731c95341c9eef5f6ceffe4c5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a04d30a6731c95341c9eef5f6ceffe4c5">kaldi::nnet2::ComputeObjfAndGradient</a></div><div class="ttdeci">static BaseFloat ComputeObjfAndGradient(const std::vector&lt; NnetExample &gt; &amp;validation_set, const Vector&lt; double &gt; &amp;scale_params, const Nnet &amp;orig_nnet, const Nnet &amp;direction, Vector&lt; double &gt; *gradient)</div><div class="ttdef"><b>Definition:</b> <a href="combine-nnet-a_8cc_source.html#l00061">combine-nnet-a.cc:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1b7ada37bc6fe37cc4eb784686fc2c82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b7ada37bc6fe37cc4eb784686fc2c82">&#9670;&nbsp;</a></span>CombineNnetsFast()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CombineNnetsFast </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetCombineFastConfig.html">NnetCombineFastConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>combine_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>validation_set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>nnets_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="combine-nnet-fast_8cc_source.html#l00430">430</a> of file <a class="el" href="combine-nnet-fast_8cc_source.html">combine-nnet-fast.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-combine-fast_8cc_source.html#l00027">main()</a>, and <a class="el" href="combine-nnet-fast_8h_source.html#l00073">NnetCombineFastConfig::Register()</a>.</p>
<div class="fragment"><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                                      {</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="comment">// Everything happens in the initializer.</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  FastNnetCombiner combiner(combine_config,</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                            validation_set,</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                            nnets_in,</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                            nnet_out);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a4bdd75d853c6cdd4107d89f91e5f4a4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bdd75d853c6cdd4107d89f91e5f4a4c">&#9670;&nbsp;</a></span>ComputeNnetGradient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ComputeNnetGradient </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>examples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>batch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>gradient</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ComputeNnetGradient is mostly used to compute gradients on validation sets; it divides the example into batches and calls <a class="el" href="namespacekaldi_1_1nnet2.html#acc8d23d090fac8b744294c4a452a5928" title="This function computes the objective function and either updates the model or adds to parameter gradi...">DoBackprop()</a> on each. </p>
<p>It returns the *average* objective function per frame. </p>

<p class="definition">Definition at line <a class="el" href="nnet-update_8cc_source.html#l00302">302</a> of file <a class="el" href="nnet-update_8cc_source.html">nnet-update.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-update_8cc_source.html#l00265">DoBackprop()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00151">Nnet::SetZero()</a>.</p>

<p class="reference">Referenced by <a class="el" href="combine-nnet-a_8cc_source.html#l00061">ComputeObjfAndGradient()</a>, and <a class="el" href="nnet-show-progress_8cc_source.html#l00027">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                    {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordtype">bool</span> treat_as_gradient = <span class="keyword">true</span>;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  gradient-&gt;SetZero(treat_as_gradient);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  std::vector&lt;NnetExample&gt; batch;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  batch.reserve(batch_size);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordtype">double</span> tot_objf = 0.0;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordflow">for</span> (int32 start_pos = 0;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;       start_pos &lt; static_cast&lt;int32&gt;(validation_set.size());</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;       start_pos += batch_size) {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    batch.clear();</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = start_pos;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;         <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; std::min(start_pos + batch_size,</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                      static_cast&lt;int32&gt;(validation_set.size()));</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;         <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      batch.push_back(validation_set[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    tot_objf += <a class="code" href="namespacekaldi_1_1nnet2.html#a8165f467036bd51b5447fd785d1a6e6c">DoBackprop</a>(nnet,</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                           batch,</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                           gradient);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  }</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordflow">return</span> tot_objf / validation_set.size();</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_a8165f467036bd51b5447fd785d1a6e6c"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a8165f467036bd51b5447fd785d1a6e6c">kaldi::nnet2::DoBackprop</a></div><div class="ttdeci">double DoBackprop(const Nnet &amp;nnet, const std::vector&lt; NnetExample &gt; &amp;examples, Matrix&lt; BaseFloat &gt; *examples_formatted, Nnet *nnet_to_update, double *tot_accuracy)</div><div class="ttdoc">This version of DoBackprop allows you to separately call FormatNnetInput and provide the result to Do...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-update_8cc_source.html#l00281">nnet-update.cc:281</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af1e4c84069b238f969a6104126d08d62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1e4c84069b238f969a6104126d08d62">&#9670;&nbsp;</a></span>ComputeNnetObjf() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ComputeNnetObjf </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>examples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>tot_accuracy</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes objective function over a minibatch. </p>
<p>Returns the *total* weighted objective function over the minibatch. If tot_accuracy != NULL, it outputs to that pointer the total (weighted) accuracy. </p>

<p class="definition">Definition at line <a class="el" href="nnet-update_8cc_source.html#l00258">258</a> of file <a class="el" href="nnet-update_8cc_source.html">nnet-update.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-update_8cc_source.html#l00046">NnetUpdater::ComputeForMinibatch()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-update_8cc_source.html#l00329">ComputeNnetObjf()</a>, <a class="el" href="nnet-update_8cc_source.html#l00265">DoBackprop()</a>, <a class="el" href="combine-nnet_8cc_source.html#l00049">GetInitialModel()</a>, <a class="el" href="nnet-compute-prob_8cc_source.html#l00027">main()</a>, and <a class="el" href="nnet-update-parallel_8cc_source.html#l00079">DoBackpropParallelClass::operator()()</a>.</p>
<div class="fragment"><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                             {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  NnetUpdater updater(nnet, NULL);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">return</span> updater.ComputeForMinibatch(examples, tot_accuracy);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a6643f605d627f98200da75dea1f23ad7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6643f605d627f98200da75dea1f23ad7">&#9670;&nbsp;</a></span>ComputeNnetObjf() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ComputeNnetObjf </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>examples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>minibatch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>tot_accuracy</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This version of ComputeNnetObjf breaks up the examples into multiple minibatches to do the computation. </p>
<p>Returns the *total* (weighted) objective function. If tot_accuracy != NULL, it outputs to that pointer the total (weighted) accuracy. </p>

<p class="definition">Definition at line <a class="el" href="nnet-update_8cc_source.html#l00329">329</a> of file <a class="el" href="nnet-update_8cc_source.html">nnet-update.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-update_8cc_source.html#l00258">ComputeNnetObjf()</a>, and <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>
<div class="fragment"><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                          {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordtype">double</span> tot_accuracy_tmp;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordflow">if</span> (tot_accuracy)</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    *tot_accuracy = 0.0;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  std::vector&lt;NnetExample&gt; batch;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  batch.reserve(batch_size);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordtype">double</span> tot_objf = 0.0;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">for</span> (int32 start_pos = 0;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;       start_pos &lt; static_cast&lt;int32&gt;(validation_set.size());</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;       start_pos += batch_size) {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    batch.clear();</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = start_pos;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;         <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; std::min(start_pos + batch_size,</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                      static_cast&lt;int32&gt;(validation_set.size()));</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;         <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      batch.push_back(validation_set[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    tot_objf += <a class="code" href="namespacekaldi_1_1nnet2.html#a6643f605d627f98200da75dea1f23ad7">ComputeNnetObjf</a>(nnet, batch,</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                tot_accuracy != NULL ? &amp;tot_accuracy_tmp : NULL);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">if</span> (tot_accuracy)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      *tot_accuracy += tot_accuracy_tmp;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordflow">return</span> tot_objf;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_a6643f605d627f98200da75dea1f23ad7"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a6643f605d627f98200da75dea1f23ad7">kaldi::nnet2::ComputeNnetObjf</a></div><div class="ttdeci">double ComputeNnetObjf(const Nnet &amp;nnet, const std::vector&lt; NnetExample &gt; &amp;validation_set, int32 batch_size, double *tot_accuracy)</div><div class="ttdoc">This version of ComputeNnetObjf breaks up the examples into multiple minibatches to do the computatio...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-update_8cc_source.html#l00329">nnet-update.cc:329</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a29b896682d92f38ea7d6e4ea32ad6544"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29b896682d92f38ea7d6e4ea32ad6544">&#9670;&nbsp;</a></span>ComputeNnetObjfParallel()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double kaldi::nnet2::ComputeNnetObjfParallel </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>minibatch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_threads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>examples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>num_frames</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This is basically to clarify the fact that DoBackpropParallel will also work with nnet_to_update == NULL, and will compute the objf. </p>
<p>Both versions of the function will support it, but this version (that takes a vector) is currently the only one we need to do this with. </p>

<p class="definition">Definition at line <a class="el" href="nnet-update-parallel_8h_source.html#l00071">71</a> of file <a class="el" href="nnet-update-parallel_8h_source.html">nnet-update-parallel.h</a>.</p>

<p class="reference">References <a class="el" href="nnet-update-parallel_8cc_source.html#l00147">DoBackpropParallel()</a>.</p>

<p class="reference">Referenced by <a class="el" href="combine-nnet-fast_8cc_source.html#l00381">FastNnetCombiner::GetInitialModel()</a>.</p>
<div class="fragment"><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                        {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacekaldi_1_1nnet2.html#a61fa49633f88cf2d21b894729c52df59">DoBackpropParallel</a>(nnet, minibatch_size, num_threads,</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                            examples, num_frames, NULL);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_a61fa49633f88cf2d21b894729c52df59"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a61fa49633f88cf2d21b894729c52df59">kaldi::nnet2::DoBackpropParallel</a></div><div class="ttdeci">double DoBackpropParallel(const Nnet &amp;nnet, int32 minibatch_size, SequentialNnetExampleReader *examples_reader, double *tot_weight, Nnet *nnet_to_update)</div><div class="ttdoc">This function is similar to &quot;DoBackprop&quot; in nnet-update.h This function computes the objective functi...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-update-parallel_8cc_source.html#l00147">nnet-update-parallel.cc:147</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac44c6079a65265ad03f7e7d03a598b9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac44c6079a65265ad03f7e7d03a598b9f">&#9670;&nbsp;</a></span>ComputeObjfAndGradient() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> kaldi::nnet2::ComputeObjfAndGradient </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>validation_set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>log_scale_params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>gradient</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="shrink-nnet_8cc_source.html#l00025">25</a> of file <a class="el" href="shrink-nnet_8cc_source.html">shrink-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8cc_source.html#l00805">VectorBase&lt; Real &gt;::ApplyExp()</a>, <a class="el" href="nnet-update_8cc_source.html#l00302">ComputeNnetGradient()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">UpdatableComponent::DotProduct()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00421">Nnet::ScaleComponents()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00151">Nnet::SetZero()</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                              {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  Vector&lt;BaseFloat&gt; scale_params(log_scale_params);</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  scale_params.ApplyExp();</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  Nnet nnet_scaled(nnet);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  nnet_scaled.ScaleComponents(scale_params);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  </div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  Nnet nnet_gradient(nnet);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordtype">bool</span> is_gradient = <span class="keyword">true</span>;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  nnet_gradient.SetZero(is_gradient);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="comment">// note: &quot;ans&quot; is normalized by the total weight of validation frames.</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  int32 batch_size = 1024;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> ans = <a class="code" href="namespacekaldi_1_1nnet2.html#a4bdd75d853c6cdd4107d89f91e5f4a4c">ComputeNnetGradient</a>(nnet_scaled,</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                                      validation_set,</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                                      batch_size,</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                                      &amp;nnet_gradient);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> tot_count = validation_set.size();</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <span class="comment">// index into log_scale_params.</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; nnet_scaled.NumComponents(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keyword">const</span> UpdatableComponent *uc =</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(&amp;(nnet.GetComponent(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>))),</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        *uc_gradient =</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(&amp;(nnet_gradient.GetComponent(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>)));</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">if</span> (uc != NULL) {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> dotprod = uc-&gt;DotProduct(*uc_gradient) / tot_count;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      (*gradient)(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) = dotprod * scale_params(i); <span class="comment">// gradient w.r.t log of scaling factor.</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <span class="comment">// We multiply by scale_params(i) to take into account d/dx exp(x); &quot;gradient&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="comment">// is the gradient w.r.t. the log of the scale_params.</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      i++;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    }</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  }</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(i == log_scale_params.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>());</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a4bdd75d853c6cdd4107d89f91e5f4a4c"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a4bdd75d853c6cdd4107d89f91e5f4a4c">kaldi::nnet2::ComputeNnetGradient</a></div><div class="ttdeci">double ComputeNnetGradient(const Nnet &amp;nnet, const std::vector&lt; NnetExample &gt; &amp;validation_set, int32 batch_size, Nnet *gradient)</div><div class="ttdoc">ComputeNnetGradient is mostly used to compute gradients on validation sets; it divides the example in...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-update_8cc_source.html#l00302">nnet-update.cc:302</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::VectorBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Returns the dimension of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00063">kaldi-vector.h:63</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a04d30a6731c95341c9eef5f6ceffe4c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04d30a6731c95341c9eef5f6ceffe4c5">&#9670;&nbsp;</a></span>ComputeObjfAndGradient() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> kaldi::nnet2::ComputeObjfAndGradient </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>validation_set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>scale_params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>orig_nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>gradient</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="combine-nnet-a_8cc_source.html#l00061">61</a> of file <a class="el" href="combine-nnet-a_8cc_source.html">combine-nnet-a.cc</a>.</p>

<p class="reference">References <a class="el" href="combine-nnet-a_8cc_source.html#l00052">AddDirection()</a>, <a class="el" href="nnet-update_8cc_source.html#l00302">ComputeNnetGradient()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">UpdatableComponent::DotProduct()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00151">Nnet::SetZero()</a>.</p>

<p class="reference">Referenced by <a class="el" href="combine-nnet_8cc_source.html#l00193">CombineNnets()</a>, <a class="el" href="combine-nnet-a_8cc_source.html#l00102">CombineNnetsA()</a>, <a class="el" href="combine-nnet_8cc_source.html#l00124">ComputeObjfAndGradient()</a>, <a class="el" href="combine-nnet-fast_8cc_source.html#l00104">FastNnetCombiner::FastNnetCombiner()</a>, and <a class="el" href="shrink-nnet_8cc_source.html#l00066">ShrinkNnet()</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                              {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  </div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  Vector&lt;BaseFloat&gt; scale_params_float(scale_params);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  Nnet nnet_combined;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#a569b33d168ce7ea3fed7da40ed127f79">AddDirection</a>(orig_nnet, direction, scale_params_float, &amp;nnet_combined);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  </div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  Nnet nnet_gradient(nnet_combined);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordtype">bool</span> is_gradient = <span class="keyword">true</span>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  nnet_gradient.SetZero(is_gradient);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  </div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">// note: &quot;ans&quot; is normalized by the total weight of validation frames.</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  int32 batch_size = 1024;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> ans = <a class="code" href="namespacekaldi_1_1nnet2.html#a4bdd75d853c6cdd4107d89f91e5f4a4c">ComputeNnetGradient</a>(nnet_combined,</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                                      validation_set,</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                      batch_size,</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                      &amp;nnet_gradient);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> tot_count = validation_set.size();</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <span class="comment">// index into scale_params.</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; nnet_combined.NumComponents(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keyword">const</span> UpdatableComponent *uc_direction =</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(&amp;(direction.GetComponent(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>))),</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        *uc_gradient =</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(&amp;(nnet_gradient.GetComponent(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>)));</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (uc_direction != NULL) {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> dotprod = uc_direction-&gt;DotProduct(*uc_gradient) / tot_count;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      (*gradient)(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) = dotprod; </div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      i++;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(i == scale_params.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>());</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a569b33d168ce7ea3fed7da40ed127f79"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a569b33d168ce7ea3fed7da40ed127f79">kaldi::nnet2::AddDirection</a></div><div class="ttdeci">static void AddDirection(const Nnet &amp;orig_nnet, const Nnet &amp;direction, const VectorBase&lt; BaseFloat &gt; &amp;scales, Nnet *dest)</div><div class="ttdoc">Sets &quot;dest&quot; to orig_nnet plus &quot;direction&quot;, with each updatable component of &quot;direction&quot; first scaled ...</div><div class="ttdef"><b>Definition:</b> <a href="combine-nnet-a_8cc_source.html#l00052">combine-nnet-a.cc:52</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a4bdd75d853c6cdd4107d89f91e5f4a4c"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a4bdd75d853c6cdd4107d89f91e5f4a4c">kaldi::nnet2::ComputeNnetGradient</a></div><div class="ttdeci">double ComputeNnetGradient(const Nnet &amp;nnet, const std::vector&lt; NnetExample &gt; &amp;validation_set, int32 batch_size, Nnet *gradient)</div><div class="ttdoc">ComputeNnetGradient is mostly used to compute gradients on validation sets; it divides the example in...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-update_8cc_source.html#l00302">nnet-update.cc:302</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::VectorBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Returns the dimension of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00063">kaldi-vector.h:63</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7288d7be65892fb998c9ee5a6d10ea7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7288d7be65892fb998c9ee5a6d10ea7c">&#9670;&nbsp;</a></span>ComputeObjfAndGradient() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double kaldi::nnet2::ComputeObjfAndGradient </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>validation_set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>scale_params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>nnets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>debug</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>gradient</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="combine-nnet_8cc_source.html#l00124">124</a> of file <a class="el" href="combine-nnet_8cc_source.html">combine-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="combine-nnet_8cc_source.html#l00028">CombineNnets()</a>, <a class="el" href="nnet-update_8cc_source.html#l00302">ComputeNnetGradient()</a>, <a class="el" href="combine-nnet-a_8cc_source.html#l00061">ComputeObjfAndGradient()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">UpdatableComponent::DotProduct()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00151">Nnet::SetZero()</a>.</p>
<div class="fragment"><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                              {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  Vector&lt;BaseFloat&gt; scale_params_float(scale_params);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  </div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  Nnet nnet_combined;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#a5c0d6a9ebb01f8cf3e31496c52956ae4">CombineNnets</a>(scale_params_float, nnets, &amp;nnet_combined);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  </div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  Nnet nnet_gradient(nnet_combined);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordtype">bool</span> is_gradient = <span class="keyword">true</span>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  nnet_gradient.SetZero(is_gradient);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  </div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// note: &quot;ans&quot; is normalized by the total weight of validation frames.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  int32 batch_size = 1024;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordtype">double</span> ans = <a class="code" href="namespacekaldi_1_1nnet2.html#a4bdd75d853c6cdd4107d89f91e5f4a4c">ComputeNnetGradient</a>(nnet_combined,</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                   validation_set,</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                                   batch_size,</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                                   &amp;nnet_gradient);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordtype">double</span> tot_frames = validation_set.size();</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">if</span> (gradient != NULL) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <span class="comment">// index into scale_params.  </span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; n &lt; static_cast&lt;int32&gt;(nnets.size()); <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; nnet_combined.NumComponents(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keyword">const</span> UpdatableComponent *uc =</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(&amp;(nnets[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>].GetComponent(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>))),</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            *uc_gradient =</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>UpdatableComponent*<span class="keyword">&gt;</span>(&amp;(nnet_gradient.GetComponent(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>)));</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">if</span> (uc != NULL) {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;          <span class="keywordtype">double</span> dotprod = uc-&gt;DotProduct(*uc_gradient) / tot_frames;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;          (*gradient)(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) = dotprod; </div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;          i++;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(i == scale_params.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>());</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordflow">if</span> (debug) {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Double-checking gradient computation&quot;</span>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    </div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    Vector&lt;BaseFloat&gt; manual_gradient(scale_params.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>());</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">for</span> (int32 i = 0; i &lt; scale_params.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>(); i++) {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <span class="keywordtype">double</span> delta = 1.0e-04, fg = fabs((*gradient)(i));</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="keywordflow">if</span> (fg &lt; 1.0e-07) fg = 1.0e-07;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="keywordflow">if</span> (fg * delta &lt; 1.0e-05)</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        delta = 1.0e-05 / fg;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      </div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      Vector&lt;double&gt; scale_params_temp(scale_params);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      scale_params_temp(i) += delta;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordtype">double</span> new_ans = <a class="code" href="namespacekaldi_1_1nnet2.html#a7288d7be65892fb998c9ee5a6d10ea7c">ComputeObjfAndGradient</a>(validation_set,</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                              scale_params_temp,</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                                              nnets,</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                              <span class="keyword">false</span>,</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                              NULL);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      manual_gradient(i) = (new_ans - ans) / delta;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Manually computed gradient is &quot;</span> &lt;&lt; manual_gradient;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Gradient we computed is &quot;</span> &lt;&lt; *gradient;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  </div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a4bdd75d853c6cdd4107d89f91e5f4a4c"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a4bdd75d853c6cdd4107d89f91e5f4a4c">kaldi::nnet2::ComputeNnetGradient</a></div><div class="ttdeci">double ComputeNnetGradient(const Nnet &amp;nnet, const std::vector&lt; NnetExample &gt; &amp;validation_set, int32 batch_size, Nnet *gradient)</div><div class="ttdoc">ComputeNnetGradient is mostly used to compute gradients on validation sets; it divides the example in...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-update_8cc_source.html#l00302">nnet-update.cc:302</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::VectorBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Returns the dimension of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00063">kaldi-vector.h:63</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a7288d7be65892fb998c9ee5a6d10ea7c"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a7288d7be65892fb998c9ee5a6d10ea7c">kaldi::nnet2::ComputeObjfAndGradient</a></div><div class="ttdeci">static double ComputeObjfAndGradient(const std::vector&lt; NnetExample &gt; &amp;validation_set, const Vector&lt; double &gt; &amp;scale_params, const std::vector&lt; Nnet &gt; &amp;nnets, bool debug, Vector&lt; double &gt; *gradient)</div><div class="ttdef"><b>Definition:</b> <a href="combine-nnet_8cc_source.html#l00124">combine-nnet.cc:124</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a5c0d6a9ebb01f8cf3e31496c52956ae4"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a5c0d6a9ebb01f8cf3e31496c52956ae4">kaldi::nnet2::CombineNnets</a></div><div class="ttdeci">void CombineNnets(const NnetCombineConfig &amp;combine_config, const std::vector&lt; NnetExample &gt; &amp;validation_set, const std::vector&lt; Nnet &gt; &amp;nnets, Nnet *nnet_out)</div><div class="ttdef"><b>Definition:</b> <a href="combine-nnet_8cc_source.html#l00193">combine-nnet.cc:193</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acc8d23d090fac8b744294c4a452a5928"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc8d23d090fac8b744294c4a452a5928">&#9670;&nbsp;</a></span>DoBackprop() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double DoBackprop </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>examples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet_to_update</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>tot_accuracy</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function computes the objective function and either updates the model or adds to parameter gradients. </p>
<p>Returns the cross-entropy objective function summed over all samples (normalize this by dividing by TotalNnetTrainingWeight(examples)). It is mostly a wrapper for a class <a class="el" href="classkaldi_1_1nnet2_1_1NnetUpdater.html">NnetUpdater</a> that's defined in <a class="el" href="nnet-update_8cc.html">nnet-update.cc</a>, but we don't want to expose that complexity at this level. All these examples will be treated as one minibatch. If tot_accuracy != NULL, it outputs to that pointer the total (weighted) accuracy. </p>

<p class="definition">Definition at line <a class="el" href="nnet-update_8cc_source.html#l00265">265</a> of file <a class="el" href="nnet-update_8cc_source.html">nnet-update.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-update_8cc_source.html#l00046">NnetUpdater::ComputeForMinibatch()</a>, <a class="el" href="nnet-update_8cc_source.html#l00258">ComputeNnetObjf()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00257">Nnet::Info()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-update_8cc_source.html#l00302">ComputeNnetGradient()</a>, <a class="el" href="nnet-update-parallel_8cc_source.html#l00202">DoBackpropSingleThreaded()</a>, <a class="el" href="combine-nnet-fast_8cc_source.html#l00049">FisherComputationClass::operator()()</a>, <a class="el" href="nnet-update-parallel_8cc_source.html#l00079">DoBackpropParallelClass::operator()()</a>, and <a class="el" href="train-nnet_8cc_source.html#l00147">TrainNnetSimple()</a>.</p>
<div class="fragment"><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                                        {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">if</span> (nnet_to_update == NULL)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacekaldi_1_1nnet2.html#a6643f605d627f98200da75dea1f23ad7">ComputeNnetObjf</a>(nnet, examples, tot_accuracy);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordflow">try</span> {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    NnetUpdater updater(nnet, nnet_to_update);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">return</span> updater.ComputeForMinibatch(examples, tot_accuracy);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  } <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Error doing backprop, nnet info is: &quot;</span> &lt;&lt; nnet.Info();</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_a6643f605d627f98200da75dea1f23ad7"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a6643f605d627f98200da75dea1f23ad7">kaldi::nnet2::ComputeNnetObjf</a></div><div class="ttdeci">double ComputeNnetObjf(const Nnet &amp;nnet, const std::vector&lt; NnetExample &gt; &amp;validation_set, int32 batch_size, double *tot_accuracy)</div><div class="ttdoc">This version of ComputeNnetObjf breaks up the examples into multiple minibatches to do the computatio...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-update_8cc_source.html#l00329">nnet-update.cc:329</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8165f467036bd51b5447fd785d1a6e6c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8165f467036bd51b5447fd785d1a6e6c">&#9670;&nbsp;</a></span>DoBackprop() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double DoBackprop </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>examples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>examples_formatted</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet_to_update</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>tot_accuracy</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This version of DoBackprop allows you to separately call FormatNnetInput and provide the result to DoBackprop; this can be useful when using GPUs because the call to FormatNnetInput can be in a separate thread from the one that uses the GPU. </p>
<p>"examples_formatted" is really an input, but it's a pointer because internally we call Swap() on it, so we destroy its contents. </p>

<p class="definition">Definition at line <a class="el" href="nnet-update_8cc_source.html#l00281">281</a> of file <a class="el" href="nnet-update_8cc_source.html">nnet-update.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-update_8cc_source.html#l00046">NnetUpdater::ComputeForMinibatch()</a>, <a class="el" href="nnet-update_8cc_source.html#l00258">ComputeNnetObjf()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00257">Nnet::Info()</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, and <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>.</p>
<div class="fragment"><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                                        {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordflow">if</span> (nnet_to_update == NULL) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Was not expecting to reach this code path &quot;</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;(wastefully formatting data twice)&quot;</span>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacekaldi_1_1nnet2.html#a6643f605d627f98200da75dea1f23ad7">ComputeNnetObjf</a>(nnet, examples, tot_accuracy);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; } <span class="keywordflow">try</span> {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    NnetUpdater updater(nnet, nnet_to_update);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">return</span> updater.ComputeForMinibatch(examples,</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                                       examples_formatted,</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                       tot_accuracy);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  } <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Error doing backprop, nnet info is: &quot;</span> &lt;&lt; nnet.Info();</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a6643f605d627f98200da75dea1f23ad7"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a6643f605d627f98200da75dea1f23ad7">kaldi::nnet2::ComputeNnetObjf</a></div><div class="ttdeci">double ComputeNnetObjf(const Nnet &amp;nnet, const std::vector&lt; NnetExample &gt; &amp;validation_set, int32 batch_size, double *tot_accuracy)</div><div class="ttdoc">This version of ComputeNnetObjf breaks up the examples into multiple minibatches to do the computatio...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-update_8cc_source.html#l00329">nnet-update.cc:329</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a61fa49633f88cf2d21b894729c52df59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61fa49633f88cf2d21b894729c52df59">&#9670;&nbsp;</a></span>DoBackpropParallel() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double DoBackpropParallel </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>minibatch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi_1_1nnet2.html#a206084ee5d66f24aeb8828c6bf8cb13d">SequentialNnetExampleReader</a> *&#160;</td>
          <td class="paramname"><em>example_reader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>tot_weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet_to_update</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is similar to "DoBackprop" in <a class="el" href="nnet-update_8h.html" title="This header provides functionality for sample-by-sample stochastic gradient descent and gradient comp...">nnet-update.h</a> This function computes the objective function and either updates the model or computes parameter gradients. </p>
<p>It returns the cross-entropy objective function summed over all samples, weighted, and the total weight of the samples (typically the same as the #frames) into total_weight. It is mostly a wrapper for a class <a class="el" href="classkaldi_1_1nnet2_1_1NnetUpdater.html">NnetUpdater</a> that's defined in <a class="el" href="nnet-update_8cc.html">nnet-update.cc</a>, but we don't want to expose that complexity at this level. Note: this function If &amp;nnet == nnet_to_update, it assumes we're doing SGD and does something like Hogwild; otherwise it assumes we're computing a gradient and it sums up the gradients. The return value is the total log-prob summed over the #frames. It also outputs the #frames into "num_frames". </p>

<p class="definition">Definition at line <a class="el" href="nnet-update-parallel_8cc_source.html#l00147">147</a> of file <a class="el" href="nnet-update-parallel_8cc_source.html">nnet-update-parallel.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet2_2nnet-example_8cc_source.html#l00209">ExamplesRepository::AcceptExamples()</a>, <a class="el" href="nnet-update-parallel_8cc_source.html#l00202">DoBackpropSingleThreaded()</a>, <a class="el" href="kaldi-table-inl_8h_source.html#l00948">SequentialTableReader&lt; Holder &gt;::Done()</a>, <a class="el" href="nnet2_2nnet-example_8cc_source.html#l00218">ExamplesRepository::ExamplesDone()</a>, <a class="el" href="kaldi-thread_8cc_source.html#l00025">kaldi::g_num_threads</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-table-inl_8h_source.html#l00942">SequentialTableReader&lt; Holder &gt;::Next()</a>, and <a class="el" href="kaldi-table-inl_8h_source.html#l00934">SequentialTableReader&lt; Holder &gt;::Value()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-update-parallel_8h_source.html#l00071">ComputeNnetObjfParallel()</a>, <a class="el" href="combine-nnet-fast_8cc_source.html#l00299">FastNnetCombiner::ComputeObjfAndGradient()</a>, and <a class="el" href="nnet-train-parallel_8cc_source.html#l00027">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                                                {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#if HAVE_CUDA == 1</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="comment">// Our GPU code won&#39;t work with multithreading; we do this</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="comment">// to enable it to work with this code in the single-threaded</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">// case.</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordflow">if</span> (CuDevice::Instantiate().Enabled())</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacekaldi_1_1nnet2.html#a643695e030a733b756fedd9ecd81839d">DoBackpropSingleThreaded</a>(nnet, minibatch_size, examples_reader,</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                                    tot_weight, nnet_to_update);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  ExamplesRepository repository; <span class="comment">// handles parallel programming issues regarding</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="comment">// the &quot;examples&quot; of data.</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordtype">double</span> tot_log_prob = 0.0;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  *tot_weight = 0.0;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="comment">// This function assumes you want the exact gradient, if</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="comment">// nnet_to_update != &amp;nnet.</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> store_separate_gradients = (nnet_to_update != &amp;nnet);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  DoBackpropParallelClass c(nnet, &amp;repository, tot_weight,</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                            &amp;tot_log_prob, nnet_to_update,</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                            store_separate_gradients);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">// The initialization of the following class spawns the threads that</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">// process the examples.  They get re-joined in its destructor.</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    MultiThreader&lt;DoBackpropParallelClass&gt; m(<a class="code" href="namespacekaldi.html#a68c81349230513ef8553df7b1f685cee">g_num_threads</a>, c);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    std::vector&lt;NnetExample&gt; examples;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">for</span> (; !examples_reader-&gt;Done(); examples_reader-&gt;Next()) {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      examples.push_back(examples_reader-&gt;Value());</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">if</span> (examples.size() == minibatch_size)</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        repository.AcceptExamples(&amp;examples);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">if</span> (!examples.empty()) <span class="comment">// partial minibatch.</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      repository.AcceptExamples(&amp;examples);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// Here, the destructor of &quot;m&quot; re-joins the threads, and</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">// does the summing of the gradients if we&#39;re doing gradient</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// computation (i.e. &amp;nnet != nnet_to_update).  This gets</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// done in the destructors of the objects of type</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// DoBackpropParallelClass.</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    repository.ExamplesDone();</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Did backprop on &quot;</span> &lt;&lt; *tot_weight &lt;&lt; <span class="stringliteral">&quot; examples, average log-prob &quot;</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;per frame is &quot;</span> &lt;&lt; (tot_log_prob / *tot_weight);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;[this line is to be parsed by a script:] log-prob-per-frame=&quot;</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            &lt;&lt; (tot_log_prob / *tot_weight);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keywordflow">return</span> tot_log_prob;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_a643695e030a733b756fedd9ecd81839d"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a643695e030a733b756fedd9ecd81839d">kaldi::nnet2::DoBackpropSingleThreaded</a></div><div class="ttdeci">double DoBackpropSingleThreaded(const Nnet &amp;nnet, int32 minibatch_size, const std::vector&lt; NnetExample &gt; &amp;egs, double *tot_weight, Nnet *nnet_to_update)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-update-parallel_8cc_source.html#l00202">nnet-update-parallel.cc:202</a></div></div>
<div class="ttc" id="namespacekaldi_html_a68c81349230513ef8553df7b1f685cee"><div class="ttname"><a href="namespacekaldi.html#a68c81349230513ef8553df7b1f685cee">kaldi::g_num_threads</a></div><div class="ttdeci">int32 g_num_threads</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-thread_8cc_source.html#l00025">kaldi-thread.cc:25</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac2fd8126b97e66ed2a8f71bd16a458cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2fd8126b97e66ed2a8f71bd16a458cd">&#9670;&nbsp;</a></span>DoBackpropParallel() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double DoBackpropParallel </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>minibatch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_threads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>examples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>num_frames</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet_to_update</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This version of DoBackpropParallel takes a vector of examples, and will typically be used to compute the exact gradient. </p>

<p class="definition">Definition at line <a class="el" href="nnet-update-parallel_8cc_source.html#l00221">221</a> of file <a class="el" href="nnet-update-parallel_8cc_source.html">nnet-update-parallel.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet2_2nnet-example_8cc_source.html#l00209">ExamplesRepository::AcceptExamples()</a>, <a class="el" href="nnet-update-parallel_8cc_source.html#l00202">DoBackpropSingleThreaded()</a>, <a class="el" href="nnet2_2nnet-example_8cc_source.html#l00218">ExamplesRepository::ExamplesDone()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>.</p>
<div class="fragment"><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                                                {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordflow">if</span> (num_threads == 1) <span class="comment">// support GPUs: special case for 1 thread.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacekaldi_1_1nnet2.html#a643695e030a733b756fedd9ecd81839d">DoBackpropSingleThreaded</a>(nnet, minibatch_size, egs,</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                                    tot_weight, nnet_to_update);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  ExamplesRepository repository; <span class="comment">// handles parallel programming issues regarding</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="comment">// the &quot;examples&quot; of data.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordtype">double</span> tot_log_prob = 0.0;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  *tot_weight = 0;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> store_separate_gradients = (nnet_to_update != &amp;nnet);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  DoBackpropParallelClass c(nnet, &amp;repository, tot_weight,</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                            &amp;tot_log_prob, nnet_to_update,</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                            store_separate_gradients);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">// The initialization of the following class spawns the threads that</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">// process the examples.  They get re-joined in its destructor.</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    MultiThreader&lt;DoBackpropParallelClass&gt; m(num_threads, c);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    int32 num_egs = egs.size();</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">for</span> (int32 offset = 0; offset &lt; num_egs; offset += minibatch_size) {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      int32 this_minibatch_size = std::min(minibatch_size, num_egs - offset);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="comment">// We waste a little time copying the examples here, but it&#39;s very minor.</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      std::vector&lt;NnetExample&gt; examples(egs.begin() + offset,</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                                egs.begin() + offset + this_minibatch_size);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      repository.AcceptExamples(&amp;examples);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">// Here, the destructor of &quot;m&quot; re-joins the threads, and</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// does the summing of the gradients if we&#39;re doing gradient</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// computation (i.e. &amp;nnet != nnet_to_update).  This gets</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">// done in the destructors of the objects of type</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// DoBackpropParallelClass.</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    repository.ExamplesDone();</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(2) &lt;&lt; <span class="stringliteral">&quot;Did backprop on &quot;</span> &lt;&lt; *tot_weight &lt;&lt; <span class="stringliteral">&quot; examples, average log-prob &quot;</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;per frame is &quot;</span> &lt;&lt; (tot_log_prob / *tot_weight);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordflow">return</span> tot_log_prob;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_a643695e030a733b756fedd9ecd81839d"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a643695e030a733b756fedd9ecd81839d">kaldi::nnet2::DoBackpropSingleThreaded</a></div><div class="ttdeci">double DoBackpropSingleThreaded(const Nnet &amp;nnet, int32 minibatch_size, const std::vector&lt; NnetExample &gt; &amp;egs, double *tot_weight, Nnet *nnet_to_update)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-update-parallel_8cc_source.html#l00202">nnet-update-parallel.cc:202</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a643695e030a733b756fedd9ecd81839d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a643695e030a733b756fedd9ecd81839d">&#9670;&nbsp;</a></span>DoBackpropSingleThreaded()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double kaldi::nnet2::DoBackpropSingleThreaded </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>minibatch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>egs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>tot_weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet_to_update</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-update-parallel_8cc_source.html#l00202">202</a> of file <a class="el" href="nnet-update-parallel_8cc_source.html">nnet-update-parallel.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-update_8cc_source.html#l00265">DoBackprop()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="nnet-update_8cc_source.html#l00248">TotalNnetTrainingWeight()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-update-parallel_8cc_source.html#l00147">DoBackpropParallel()</a>.</p>
<div class="fragment"><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                                                      {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordtype">double</span> ans = 0.0;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  *tot_weight = <a class="code" href="namespacekaldi_1_1nnet2.html#a61238a092268dc3deaed1a23e8c3934b">TotalNnetTrainingWeight</a>(egs);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; egs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> += minibatch_size) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    std::vector&lt;NnetExample&gt;::const_iterator end_iter =</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + minibatch_size &gt; egs.size() ? egs.end() :</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;       egs.begin() + <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> + minibatch_size);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    std::vector&lt;NnetExample&gt; this_egs(egs.begin() + <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>,</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                              end_iter);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    ans += <a class="code" href="namespacekaldi_1_1nnet2.html#acc8d23d090fac8b744294c4a452a5928">DoBackprop</a>(nnet, this_egs, nnet_to_update);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_acc8d23d090fac8b744294c4a452a5928"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#acc8d23d090fac8b744294c4a452a5928">kaldi::nnet2::DoBackprop</a></div><div class="ttdeci">double DoBackprop(const Nnet &amp;nnet, const std::vector&lt; NnetExample &gt; &amp;examples, Nnet *nnet_to_update, double *tot_accuracy)</div><div class="ttdoc">This function computes the objective function and either updates the model or adds to parameter gradi...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-update_8cc_source.html#l00265">nnet-update.cc:265</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a61238a092268dc3deaed1a23e8c3934b"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a61238a092268dc3deaed1a23e8c3934b">kaldi::nnet2::TotalNnetTrainingWeight</a></div><div class="ttdeci">BaseFloat TotalNnetTrainingWeight(const std::vector&lt; NnetExample &gt; &amp;egs)</div><div class="ttdoc">Returns the total weight summed over all the examples... </div><div class="ttdef"><b>Definition:</b> <a href="nnet-update_8cc_source.html#l00248">nnet-update.cc:248</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a88d4fabba85290cdc0e10da135458baf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88d4fabba85290cdc0e10da135458baf">&#9670;&nbsp;</a></span>ExampleToPdfPost()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ExampleToPdfPost </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>tmodel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>silence_phones</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>criterion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>drop_frames</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>one_silence_class</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> *&#160;</td>
          <td class="paramname"><em>post</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Given a discriminative training example, this function works out posteriors at the pdf level (note: these are "discriminative-training posteriors" that may be positive or negative. </p>
<p>The denominator lattice "den_lat" in the example "eg" should already have had acoustic-rescoring done so that its acoustic probs are up to date, and any acoustic scaling should already have been applied.</p>
<p>"criterion" may be "mmi" or "mpfe" or "smbr". If criterion is "mmi", "drop_frames" means we don't include derivatives for frames where the numerator pdf is not in the denominator lattice.</p>
<p>if "one_silence_class" is true you can get a newer behavior for MPE/SMBR which will tend to reduce insertions.</p>
<p>"silence_phones" is a list of silence phones (this is only relevant for mpfe or smbr, if we want to treat silence specially). </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-functions_8cc_source.html#l00838">838</a> of file <a class="el" href="nnet-example-functions_8cc_source.html">nnet-example-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="lattice-utils-inl_8h_source.html#l00033">fst::ConvertLattice()</a>, <a class="el" href="posterior_8cc_source.html#l00322">kaldi::ConvertPosteriorToPdfs()</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00148">DiscriminativeNnetExample::den_lat</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="lattice-functions_8cc_source.html#l01415">kaldi::LatticeForwardBackwardMmi()</a>, <a class="el" href="lattice-functions_8cc_source.html#l00794">kaldi::LatticeForwardBackwardMpeVariants()</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00143">DiscriminativeNnetExample::num_ali</a>, <a class="el" href="posterior_8cc_source.html#l00218">kaldi::ScalePosterior()</a>, and <a class="el" href="nnet2_2nnet-example_8h_source.html#l00140">DiscriminativeNnetExample::weight</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-example-functions_8h_source.html#l00133">SplitExampleStats::SplitExampleStats()</a>, and <a class="el" href="nnet-example-functions_8cc_source.html#l00786">UpdateHash()</a>.</p>
<div class="fragment"><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                     {</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(criterion == <span class="stringliteral">&quot;mpfe&quot;</span> || criterion == <span class="stringliteral">&quot;smbr&quot;</span> || criterion == <span class="stringliteral">&quot;mmi&quot;</span>);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  </div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <a class="code" href="namespacekaldi.html#a4c9e4132556649881ca6f29dd13e2742">Lattice</a> lat;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <a class="code" href="namespacefst.html#abb292eda61ae2a04c5336c88b49ef832">ConvertLattice</a>(eg.den_lat, &amp;lat);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  TopSort(&amp;lat);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordflow">if</span> (criterion == <span class="stringliteral">&quot;mpfe&quot;</span> || criterion == <span class="stringliteral">&quot;smbr&quot;</span>) {</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <a class="code" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> tid_post;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="namespacekaldi.html#a72980b120b53459736cf674bf44444bb">LatticeForwardBackwardMpeVariants</a>(tmodel, silence_phones, lat, eg.num_ali,</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                                      criterion, one_silence_class, &amp;tid_post);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    </div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <a class="code" href="group__posterior__group.html#gac11fc3c8d382ca43c364622e2305eb82">ConvertPosteriorToPdfs</a>(tmodel, tid_post, post);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordtype">bool</span> convert_to_pdf_ids = <span class="keyword">true</span>, cancel = <span class="keyword">true</span>;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <a class="code" href="namespacekaldi.html#a693a9e1878f0341abdc4616da90e92b0">LatticeForwardBackwardMmi</a>(tmodel, lat, eg.num_ali,</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                              drop_frames, convert_to_pdf_ids, cancel,</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                              post);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  }</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <a class="code" href="group__posterior__group.html#ga6fc6689ac2f9cb9e12f14aa1c10687c5">ScalePosterior</a>(eg.weight, post);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;}</div><div class="ttc" id="group__posterior__group_html_ga5c99e6141a5a3b3c5d424e99ffbd1ac6"><div class="ttname"><a href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">kaldi::Posterior</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::pair&lt; int32, BaseFloat &gt; &gt; &gt; Posterior</div><div class="ttdoc">Posterior is a typedef for storing acoustic-state (actually, transition-id) posteriors over an uttera...</div><div class="ttdef"><b>Definition:</b> <a href="posterior_8h_source.html#l00043">posterior.h:43</a></div></div>
<div class="ttc" id="namespacekaldi_html_a693a9e1878f0341abdc4616da90e92b0"><div class="ttname"><a href="namespacekaldi.html#a693a9e1878f0341abdc4616da90e92b0">kaldi::LatticeForwardBackwardMmi</a></div><div class="ttdeci">BaseFloat LatticeForwardBackwardMmi(const TransitionModel &amp;tmodel, const Lattice &amp;lat, const std::vector&lt; int32 &gt; &amp;num_ali, bool drop_frames, bool convert_to_pdf_ids, bool cancel, Posterior *post)</div><div class="ttdoc">This function can be used to compute posteriors for MMI, with a positive contribution for the numerat...</div><div class="ttdef"><b>Definition:</b> <a href="lattice-functions_8cc_source.html#l01415">lattice-functions.cc:1415</a></div></div>
<div class="ttc" id="namespacefst_html_abb292eda61ae2a04c5336c88b49ef832"><div class="ttname"><a href="namespacefst.html#abb292eda61ae2a04c5336c88b49ef832">fst::ConvertLattice</a></div><div class="ttdeci">void ConvertLattice(const ExpandedFst&lt; ArcTpl&lt; Weight &gt; &gt; &amp;ifst, MutableFst&lt; ArcTpl&lt; CompactLatticeWeightTpl&lt; Weight, Int &gt; &gt; &gt; *ofst, bool invert)</div><div class="ttdoc">Convert lattice from a normal FST to a CompactLattice FST. </div><div class="ttdef"><b>Definition:</b> <a href="lattice-utils-inl_8h_source.html#l00033">lattice-utils-inl.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_a4c9e4132556649881ca6f29dd13e2742"><div class="ttname"><a href="namespacekaldi.html#a4c9e4132556649881ca6f29dd13e2742">kaldi::Lattice</a></div><div class="ttdeci">fst::VectorFst&lt; LatticeArc &gt; Lattice</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-lattice_8h_source.html#l00044">kaldi-lattice.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_html_a72980b120b53459736cf674bf44444bb"><div class="ttname"><a href="namespacekaldi.html#a72980b120b53459736cf674bf44444bb">kaldi::LatticeForwardBackwardMpeVariants</a></div><div class="ttdeci">BaseFloat LatticeForwardBackwardMpeVariants(const TransitionModel &amp;trans, const std::vector&lt; int32 &gt; &amp;silence_phones, const Lattice &amp;lat, const std::vector&lt; int32 &gt; &amp;num_ali, std::string criterion, bool one_silence_class, Posterior *post)</div><div class="ttdoc">This function implements either the MPFE (minimum phone frame error) or SMBR (state-level minimum bay...</div><div class="ttdef"><b>Definition:</b> <a href="lattice-functions_8cc_source.html#l00794">lattice-functions.cc:794</a></div></div>
<div class="ttc" id="group__posterior__group_html_ga6fc6689ac2f9cb9e12f14aa1c10687c5"><div class="ttname"><a href="group__posterior__group.html#ga6fc6689ac2f9cb9e12f14aa1c10687c5">kaldi::ScalePosterior</a></div><div class="ttdeci">void ScalePosterior(BaseFloat scale, Posterior *post)</div><div class="ttdoc">Scales the BaseFloat (weight) element in the posterior entries. </div><div class="ttdef"><b>Definition:</b> <a href="posterior_8cc_source.html#l00218">posterior.cc:218</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__posterior__group_html_gac11fc3c8d382ca43c364622e2305eb82"><div class="ttname"><a href="group__posterior__group.html#gac11fc3c8d382ca43c364622e2305eb82">kaldi::ConvertPosteriorToPdfs</a></div><div class="ttdeci">void ConvertPosteriorToPdfs(const TransitionModel &amp;tmodel, const Posterior &amp;post_in, Posterior *post_out)</div><div class="ttdoc">Converts a posterior over transition-ids to be a posterior over pdf-ids. </div><div class="ttdef"><b>Definition:</b> <a href="posterior_8cc_source.html#l00322">posterior.cc:322</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2e0593085a277bbdc9522aaacd9d07bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e0593085a277bbdc9522aaacd9d07bb">&#9670;&nbsp;</a></span>ExciseDiscriminativeExample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ExciseDiscriminativeExample </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1SplitDiscriminativeExampleConfig.html">SplitDiscriminativeExampleConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>tmodel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; *&#160;</td>
          <td class="paramname"><em>egs_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet2_1_1SplitExampleStats.html">SplitExampleStats</a> *&#160;</td>
          <td class="paramname"><em>stats_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove unnecessary frames from discriminative training example. </p>
<p>The output egs_out will be of size zero or one (usually one) after being called. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-functions_8cc_source.html#l00775">775</a> of file <a class="el" href="nnet-example-functions_8cc_source.html">nnet-example-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-example-functions_8cc_source.html#l00109">DiscriminativeExampleSplitter::Excise()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-get-egs-discriminative_8cc_source.html#l00027">main()</a>, and <a class="el" href="nnet-example-functions_8h_source.html#l00133">SplitExampleStats::SplitExampleStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                                  {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  DiscriminativeExampleSplitter splitter(config, tmodel, eg, egs_out);</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  splitter.Excise(stats_out);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a0c661e4a6e94e5d0abaa2bdf325172bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c661e4a6e94e5d0abaa2bdf325172bc">&#9670;&nbsp;</a></span>ExpectOneOrTwoTokens()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet2::ExpectOneOrTwoTokens </td>
          <td>(</td>
          <td class="paramtype">std::istream &amp;&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>binary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>token1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>token2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component_8cc_source.html#l00135">135</a> of file <a class="el" href="_2nnet-component_8cc_source.html">nnet-component.cc</a>.</p>

<p class="reference">References <a class="el" href="io-funcs_8cc_source.html#l00194">kaldi::ExpectToken()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="io-funcs_8cc_source.html#l00154">kaldi::ReadToken()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component_8cc_source.html#l00374">NonlinearComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l00464">MaxoutComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l04355">MaxpoolingComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l00536">PnormComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l00741">PowerComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l00886">ScaleComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l01199">AffineComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l01360">AffineComponentPreconditioned::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l01608">AffineComponentPreconditionedOnline::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02768">SpliceComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02955">SpliceMaxComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02116">BlockAffineComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02206">BlockAffineComponentPreconditioned::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02404">SumGroupComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02303">PermuteComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03147">DctComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03239">FixedLinearComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03328">FixedAffineComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03401">FixedScaleComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03470">FixedBiasComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03501">DropoutComponent::Read()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03597">AdditiveNoiseComponent::Read()</a>, and <a class="el" href="_2nnet-component_8cc_source.html#l04059">Convolutional1dComponent::Read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                                                          {</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(token1 != token2);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  std::string temp;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <a class="code" href="group__io__funcs__basic.html#gacbf9367cd910befefa0bc98055979bea">ReadToken</a>(is, binary, &amp;temp);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">if</span> (temp == token1) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="group__io__funcs__basic.html#ga4c7a80f758e878578e78b667f62463a5">ExpectToken</a>(is, binary, token2);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">if</span> (temp != token2) {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Expecting token &quot;</span> &lt;&lt; token1 &lt;&lt; <span class="stringliteral">&quot; or &quot;</span> &lt;&lt; token2</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; but got &quot;</span> &lt;&lt; temp;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div><div class="ttc" id="group__io__funcs__basic_html_gacbf9367cd910befefa0bc98055979bea"><div class="ttname"><a href="group__io__funcs__basic.html#gacbf9367cd910befefa0bc98055979bea">kaldi::ReadToken</a></div><div class="ttdeci">void ReadToken(std::istream &amp;is, bool binary, std::string *str)</div><div class="ttdoc">ReadToken gets the next token and puts it in str (exception on failure). </div><div class="ttdef"><b>Definition:</b> <a href="io-funcs_8cc_source.html#l00154">io-funcs.cc:154</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga4c7a80f758e878578e78b667f62463a5"><div class="ttname"><a href="group__io__funcs__basic.html#ga4c7a80f758e878578e78b667f62463a5">kaldi::ExpectToken</a></div><div class="ttdeci">void ExpectToken(std::istream &amp;is, bool binary, const char *token)</div><div class="ttdoc">ExpectToken tries to read in the given token, and throws an exception on failure. ...</div><div class="ttdef"><b>Definition:</b> <a href="io-funcs_8cc_source.html#l00194">io-funcs.cc:194</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa77340a2c9a6f9eaacd47049ea5dea4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa77340a2c9a6f9eaacd47049ea5dea4e">&#9670;&nbsp;</a></span>FixNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FixNnet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetFixConfig.html">NnetFixConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-fix_8cc_source.html#l00031">31</a> of file <a class="el" href="nnet-fix_8cc_source.html">nnet-fix.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8h_source.html#l00903">AffineComponent::BiasParams()</a>, <a class="el" href="arpa-file-parser-test_8cc_source.html#l00066">count</a>, <a class="el" href="_2nnet-component_8h_source.html#l00379">NonlinearComponent::Count()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00064">rnnlm::d</a>, <a class="el" href="_2nnet-component_8h_source.html#l00378">NonlinearComponent::DerivSum()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-component_8h_source.html#l00359">NonlinearComponent::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="_2nnet-component_8h_source.html#l00904">AffineComponent::LinearParams()</a>, <a class="el" href="nnet-fix_8h_source.html#l00046">NnetFixConfig::max_average_deriv</a>, <a class="el" href="nnet-fix_8h_source.html#l00043">NnetFixConfig::min_average_deriv</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>, <a class="el" href="nnet-fix_8h_source.html#l00048">NnetFixConfig::parameter_factor</a>, <a class="el" href="nnet-fix_8h_source.html#l00050">NnetFixConfig::relu_bias_change</a>, and <a class="el" href="_2nnet-component_8cc_source.html#l01046">AffineComponent::SetParams()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-am-fix_8cc_source.html#l00027">main()</a>, and <a class="el" href="nnet-fix_8h_source.html#l00054">NnetFixConfig::Register()</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                                                      {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c + 1 &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    AffineComponent *ac = <span class="keyword">dynamic_cast&lt;</span>AffineComponent*<span class="keyword">&gt;</span>(</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        &amp;(nnet-&gt;GetComponent(c)));</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    NonlinearComponent *nc = <span class="keyword">dynamic_cast&lt;</span>NonlinearComponent*<span class="keyword">&gt;</span>(</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        &amp;(nnet-&gt;GetComponent(c + 1)));</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordflow">if</span> (ac == NULL || nc == NULL) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// We only want to process this if it&#39;s of type SigmoidComponent</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// or TanhComponent.</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> max_deriv; <span class="comment">// The maximum derivative of this nonlinearity.</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordtype">bool</span> is_relu = <span class="keyword">false</span>;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    {</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      SigmoidComponent *sc = <span class="keyword">dynamic_cast&lt;</span>SigmoidComponent*<span class="keyword">&gt;</span>(nc);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      TanhComponent *tc = <span class="keyword">dynamic_cast&lt;</span>TanhComponent*<span class="keyword">&gt;</span>(nc);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      RectifiedLinearComponent *rc = <span class="keyword">dynamic_cast&lt;</span>RectifiedLinearComponent*<span class="keyword">&gt;</span>(nc);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      <span class="keywordflow">if</span> (sc != NULL) max_deriv = 0.25;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tc != NULL) max_deriv = 1.0;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc != NULL) { max_deriv = 1.0; is_relu = <span class="keyword">true</span>; }</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">continue</span>; <span class="comment">// E.g. SoftmaxComponent; we don&#39;t handle this.</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a> = nc-&gt;Count();</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    Vector&lt;double&gt; deriv_sum (nc-&gt;DerivSum());</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">if</span> (count == 0.0 || deriv_sum.Dim() == 0) {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Cannot fix neural net because no statistics are stored.&quot;</span>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    Vector&lt;BaseFloat&gt; bias_params(ac-&gt;BiasParams());</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    Matrix&lt;BaseFloat&gt; linear_params(ac-&gt;LinearParams());</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    int32 dim = nc-&gt;InputDim(), num_small_deriv = 0, num_large_deriv = 0;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = 0; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> &lt; dim; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>++) {</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <span class="comment">// deriv ratio is the ratio of the computed average derivative to the</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <span class="comment">// maximum derivative of that nonlinear function.</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> deriv_ratio = deriv_sum(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>) / (count * max_deriv);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(deriv_ratio &gt;= 0.0 &amp;&amp; deriv_ratio &lt; 1.01); <span class="comment">// Or there is an</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                                                              <span class="comment">// error in the</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <span class="comment">// math.</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <span class="keywordflow">if</span> (deriv_ratio &lt; config.min_average_deriv) {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="comment">// derivative is too small, meaning we&#39;ve gone off into the &quot;flat part&quot;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="comment">// of the sigmoid (or for ReLU, we&#39;re always-off).</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">if</span> (is_relu) {</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;          bias_params(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>) += config.relu_bias_change;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;          <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> parameter_factor = std::min(config.min_average_deriv /</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                                                deriv_ratio,</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                                                config.parameter_factor);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;          <span class="comment">// we need to reduce the parameters, so multiply by 1/parameter factor.</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;          bias_params(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>) *= 1.0 / parameter_factor;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;          linear_params.Row(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>).Scale(1.0 / parameter_factor);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        num_small_deriv++;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv_ratio &gt; config.max_average_deriv) {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="comment">// derivative is too large, meaning we&#39;re only in the linear part of the</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="comment">// sigmoid, in the middle.  (or for ReLU, we&#39;re always-on.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">if</span> (is_relu) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;          bias_params(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>) -= config.relu_bias_change;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;          <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> parameter_factor = std::min(deriv_ratio / config.max_average_deriv,</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                                                config.parameter_factor);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;          <span class="comment">// we need to increase the factors, so multiply by parameter_factor.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;          bias_params(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>) *= parameter_factor;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;          linear_params.Row(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>).Scale(parameter_factor);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        num_large_deriv++;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      }</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">if</span> (is_relu) {</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;For layer &quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot; (ReLU units), increased bias for &quot;</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                &lt;&lt; num_small_deriv &lt;&lt; <span class="stringliteral">&quot; indexes and decreased it for &quot;</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                &lt;&lt; num_large_deriv &lt;&lt; <span class="stringliteral">&quot;, out of a total of &quot;</span> &lt;&lt; dim;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;For layer &quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;, decreased parameters for &quot;</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                &lt;&lt; num_small_deriv &lt;&lt; <span class="stringliteral">&quot; indexes, and increased them for &quot;</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                &lt;&lt; num_large_deriv &lt;&lt; <span class="stringliteral">&quot; out of a total of &quot;</span> &lt;&lt; dim;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    ac-&gt;SetParams(bias_params, linear_params);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div><div class="ttc" id="arpa-file-parser-test_8cc_html_a951345011b75d2e8d9bfc18ca63510d2"><div class="ttname"><a href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a></div><div class="ttdeci">const size_t count</div><div class="ttdef"><b>Definition:</b> <a href="arpa-file-parser-test_8cc_source.html#l00066">arpa-file-parser-test.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacernnlm_html_a873684cefeb665f3d5e6b495de57fc0d"><div class="ttname"><a href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">rnnlm::d</a></div><div class="ttdeci">double d</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00064">mikolov-rnnlm-lib.cc:64</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a748e54923cf54a322ea122b53bdf3850"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a748e54923cf54a322ea122b53bdf3850">&#9670;&nbsp;</a></span>FormatNnetInput()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FormatNnetInput </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Takes the input to the nnet for a minibatch of examples, and formats as a single matrix. </p>
<p>data.size() must be &gt; 0. Note: you will probably want to copy this to <a class="el" href="classkaldi_1_1CuMatrix.html" title="This class represents a matrix that&#39;s stored on the GPU if we have one, and in memory if not...">CuMatrix</a> after you call this function. The num-rows of the output will, at exit, equal (1 + nnet.LeftContext() + nnet.RightContext()) * data.size(). The nnet is only needed so we can call LeftContext(), RightContext() and InputDim() on it. </p>

<p class="definition">Definition at line <a class="el" href="nnet-update_8cc_source.html#l00207">207</a> of file <a class="el" href="nnet-update_8cc_source.html">nnet-update.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-matrix_8cc_source.html#l00861">MatrixBase&lt; Real &gt;::CopyFromMat()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00996">MatrixBase&lt; Real &gt;::CopyRowsFromVec()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00036">Nnet::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00042">Nnet::LeftContext()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00818">Matrix&lt; Real &gt;::Resize()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00056">Nnet::RightContext()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-update_8cc_source.html#l00035">NnetUpdater::FormatInput()</a>, and <a class="el" href="train-nnet_8cc_source.html#l00049">NnetExampleBackgroundReader::ReadExamples()</a>.</p>
<div class="fragment"><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                                                   {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(data.size() &gt; 0);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  int32 num_splice = 1 + nnet.RightContext() + nnet.LeftContext();</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(data[0].input_frames.NumRows() &gt;= num_splice);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  </div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  int32 feat_dim = data[0].input_frames.NumCols(),</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;         spk_dim = data[0].spk_info.Dim(),</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;         tot_dim = feat_dim + spk_dim; <span class="comment">// we append these at the neural net</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                                       <span class="comment">// input... note, spk_dim might be 0.</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(tot_dim == nnet.InputDim());</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(data[0].left_context &gt;= nnet.LeftContext());</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  int32 ignore_frames = data[0].left_context - nnet.LeftContext(); <span class="comment">// If</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">// the NnetExample has more left-context than we need, ignore some.</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">// this may happen in settings where we increase the amount of context during</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">// training, e.g. by adding layers that require more context.  </span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  int32 num_chunks = data.size();</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  </div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  input_mat-&gt;Resize(num_splice * num_chunks,</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                    tot_dim, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  </div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordflow">for</span> (int32 chunk = 0; chunk &lt; num_chunks; chunk++) {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    SubMatrix&lt;BaseFloat&gt; dest(*input_mat,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                              chunk * num_splice, num_splice,</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                              0, feat_dim);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    Matrix&lt;BaseFloat&gt; full_src(data[chunk].input_frames);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    SubMatrix&lt;BaseFloat&gt; src(full_src, ignore_frames, num_splice, 0, feat_dim);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                             </div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    dest.CopyFromMat(src);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> (spk_dim != 0) {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      SubMatrix&lt;BaseFloat&gt; spk_dest(*input_mat,</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                                    chunk * num_splice, num_splice,</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                                    feat_dim, spk_dim);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      spk_dest.CopyRowsFromVec(data[chunk].spk_info);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a07117e22b53a7ee4fe7262df208bc70d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07117e22b53a7ee4fe7262df208bc70d">&#9670;&nbsp;</a></span>GenRandomNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> * GenRandomNnet </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>input_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>output_dim</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function generates a random neural net, for testing purposes. </p>
<p>It will contain a random number of <a class="el" href="classkaldi_1_1nnet2_1_1SigmoidComponent.html">SigmoidComponent</a>, <a class="el" href="classkaldi_1_1nnet2_1_1AffineComponent.html">AffineComponent</a> and <a class="el" href="classkaldi_1_1nnet2_1_1SpliceComponent.html" title="Splices a context window of frames together [over time]. ">SpliceComponent</a>, followed by a final <a class="el" href="classkaldi_1_1nnet2_1_1AffineComponent.html">AffineComponent</a> and <a class="el" href="classkaldi_1_1nnet2_1_1SoftmaxComponent.html">SoftmaxComponent</a>. The parameters will all be randomly initialized. </p>

<p class="definition">Definition at line <a class="el" href="_2nnet-nnet_8cc_source.html#l00772">772</a> of file <a class="el" href="_2nnet-nnet_8cc_source.html">nnet-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00281">Nnet::Init()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l01096">AffineComponent::Init()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02475">SpliceComponent::Init()</a>, and <a class="el" href="_2nnet-nnet_8h_source.html#l00203">Nnet::Nnet()</a>.</p>

<p class="reference">Referenced by <a class="el" href="am-nnet-test_8cc_source.html#l00029">UnitTestAmNnet()</a>, <a class="el" href="nnet2_2nnet-nnet-test_8cc_source.html#l00026">UnitTestNnet()</a>, <a class="el" href="nnet2_2nnet-compute-test_8cc_source.html#l00029">UnitTestNnetCompute()</a>, <a class="el" href="nnet2_2nnet-compute-test_8cc_source.html#l00084">UnitTestNnetComputeChunked()</a>, and <a class="el" href="online-nnet2-decodable-test_8cc_source.html#l00031">UnitTestNnetDecodable()</a>.</p>
<div class="fragment"><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                                      {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  std::vector&lt;Component*&gt; components;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  int32 cur_dim = input_dim;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="comment">// have up to 10 layers before the final one.</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 10; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">if</span> (rand() % 2 == 0) {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="comment">// add an affine component.</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      int32 next_dim = 50 + rand() % 100;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> learning_rate = 0.0001, param_stddev = 0.001,</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;          bias_stddev = 0.1;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      AffineComponent *component = <span class="keyword">new</span> AffineComponent();</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      component-&gt;Init(learning_rate, cur_dim, next_dim,</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                      param_stddev, bias_stddev);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      components.push_back(component);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      cur_dim = next_dim;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rand() % 2 == 0) {</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      components.push_back(<span class="keyword">new</span> SigmoidComponent(cur_dim));</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rand() % 2 == 0 &amp;&amp; cur_dim &lt; 200) {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      SpliceComponent *component = <span class="keyword">new</span> SpliceComponent();</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      std::vector&lt;int32&gt; context;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        context.clear();</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = -3; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= 3; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;          <span class="keywordflow">if</span> (rand() % 3 == 0)</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            context.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="keywordflow">if</span> (!context.empty() &amp;&amp; context.front() &lt;= 0 &amp;&amp;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            context.back() &gt;= 0)</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      }</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      component-&gt;Init(cur_dim, context);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      components.push_back(component);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      cur_dim = cur_dim * context.size();</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    }</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  }</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    AffineComponent *component = <span class="keyword">new</span> AffineComponent();</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> learning_rate = 0.0001, param_stddev = 0.001,</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        bias_stddev = 0.1;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    component-&gt;Init(learning_rate, cur_dim, output_dim,</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                    param_stddev, bias_stddev);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    components.push_back(component);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    cur_dim = output_dim;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  }</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  components.push_back(<span class="keyword">new</span> SoftmaxComponent(cur_dim));</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  Nnet *ans = <span class="keyword">new</span> Nnet();</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  ans-&gt;Init(&amp;components);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abcaa21a4f5d88c32a8f3066fa74d0343"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcaa21a4f5d88c32a8f3066fa74d0343">&#9670;&nbsp;</a></span>GetCount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 GetCount </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>expected_count</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-copy-egs-discriminative_8cc_source.html#l00031">31</a> of file <a class="el" href="nnet-copy-egs-discriminative_8cc_source.html">nnet-copy-egs-discriminative.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="kaldi-math_8cc_source.html#l00071">kaldi::WithProb()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-copy-egs-discriminative_8cc_source.html#l00065">main()</a>, and <a class="el" href="nnet-get-weighted-egs_8cc_source.html#l00045">ProcessFile()</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                                      {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(expected_count &gt;= 0.0);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  int32 ans = 0;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">while</span> (expected_count &gt; 1.0) {</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    ans++;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    expected_count--;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  }</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a418c782c2df97dc179125ae5ad950338">WithProb</a>(expected_count))</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    ans++;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a418c782c2df97dc179125ae5ad950338"><div class="ttname"><a href="namespacekaldi.html#a418c782c2df97dc179125ae5ad950338">kaldi::WithProb</a></div><div class="ttdeci">bool WithProb(BaseFloat prob, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00071">kaldi-math.cc:71</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a83c0e9b3cc3644b1c7027de9f29daafd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83c0e9b3cc3644b1c7027de9f29daafd">&#9670;&nbsp;</a></span>GetInitialModel()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int32 kaldi::nnet2::GetInitialModel </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>validation_set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>nnets</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns an integer saying which model to use: either 0 ... </p>
<p>num-models - 1 for the best individual model, or (#models) for the average of all of them. </p>

<p class="definition">Definition at line <a class="el" href="combine-nnet_8cc_source.html#l00049">49</a> of file <a class="el" href="combine-nnet_8cc_source.html">combine-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="combine-nnet_8cc_source.html#l00028">CombineNnets()</a>, <a class="el" href="nnet-update_8cc_source.html#l00258">ComputeNnetObjf()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00336">VectorBase&lt; Real &gt;::Set()</a>.</p>

<p class="reference">Referenced by <a class="el" href="combine-nnet-fast_8cc_source.html#l00104">FastNnetCombiner::FastNnetCombiner()</a>, <a class="el" href="combine-nnet-fast_8cc_source.html#l00268">FastNnetCombiner::GetInitialParams()</a>, and <a class="el" href="combine-nnet_8cc_source.html#l00091">GetInitialScaleParams()</a>.</p>
<div class="fragment"><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                                  {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  int32 minibatch_size = 1024;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  int32 num_nnets = <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(nnets.size());</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!nnets.empty());</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> tot_frames = validation_set.size();</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  int32 best_n = -1;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> best_objf = -std::numeric_limits&lt;BaseFloat&gt;::infinity();</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  Vector&lt;BaseFloat&gt; objfs(nnets.size());</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; num_nnets; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> objf = <a class="code" href="namespacekaldi_1_1nnet2.html#af1e4c84069b238f969a6104126d08d62">ComputeNnetObjf</a>(nnets[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>], validation_set,</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                                     minibatch_size) / tot_frames;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    </div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> == 0 || objf &gt; best_objf) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      best_objf = objf;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      best_n = <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    }</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    objfs(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>) = objf;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Objective functions for the source neural nets are &quot;</span> &lt;&lt; objfs;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  int32 num_uc = nnets[0].NumUpdatableComponents();</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  { <span class="comment">// Now try a version where all the neural nets have the same weight.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    Vector&lt;BaseFloat&gt; scale_params(num_uc * num_nnets);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    scale_params.Set(1.0 / num_nnets);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    Nnet average_nnet;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#a5c0d6a9ebb01f8cf3e31496c52956ae4">CombineNnets</a>(scale_params, nnets, &amp;average_nnet);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> objf = <a class="code" href="namespacekaldi_1_1nnet2.html#af1e4c84069b238f969a6104126d08d62">ComputeNnetObjf</a>(average_nnet, validation_set,</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                                     minibatch_size) / tot_frames;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Objf with all neural nets averaged is &quot;</span> &lt;&lt; objf;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">if</span> (objf &gt; best_objf) {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      <span class="keywordflow">return</span> num_nnets;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      <span class="keywordflow">return</span> best_n;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_af1e4c84069b238f969a6104126d08d62"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#af1e4c84069b238f969a6104126d08d62">kaldi::nnet2::ComputeNnetObjf</a></div><div class="ttdeci">double ComputeNnetObjf(const Nnet &amp;nnet, const std::vector&lt; NnetExample &gt; &amp;examples, double *tot_accuracy)</div><div class="ttdoc">Computes objective function over a minibatch. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-update_8cc_source.html#l00258">nnet-update.cc:258</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a5c0d6a9ebb01f8cf3e31496c52956ae4"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a5c0d6a9ebb01f8cf3e31496c52956ae4">kaldi::nnet2::CombineNnets</a></div><div class="ttdeci">void CombineNnets(const NnetCombineConfig &amp;combine_config, const std::vector&lt; NnetExample &gt; &amp;validation_set, const std::vector&lt; Nnet &gt; &amp;nnets, Nnet *nnet_out)</div><div class="ttdef"><b>Definition:</b> <a href="combine-nnet_8cc_source.html#l00193">combine-nnet.cc:193</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a103073fe3eed1a67996f168cae60f73d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a103073fe3eed1a67996f168cae60f73d">&#9670;&nbsp;</a></span>GetInitialScaleParams()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet2::GetInitialScaleParams </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetCombineConfig.html">NnetCombineConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>combine_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>validation_set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>nnets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>scale_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="combine-nnet_8cc_source.html#l00091">91</a> of file <a class="el" href="combine-nnet_8cc_source.html">combine-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="combine-nnet_8cc_source.html#l00049">GetInitialModel()</a>, <a class="el" href="combine-nnet_8h_source.html#l00036">NnetCombineConfig::initial_model</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00190">Vector&lt; Real &gt;::Resize()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00336">VectorBase&lt; Real &gt;::Set()</a>.</p>

<p class="reference">Referenced by <a class="el" href="combine-nnet_8cc_source.html#l00193">CombineNnets()</a>.</p>
<div class="fragment"><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                                  {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  int32 initial_model = combine_config.initial_model,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      num_nnets = <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(nnets.size());</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordflow">if</span> (initial_model &lt; 0 || initial_model &gt; num_nnets)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    initial_model = <a class="code" href="namespacekaldi_1_1nnet2.html#a83c0e9b3cc3644b1c7027de9f29daafd">GetInitialModel</a>(validation_set, nnets);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  </div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(initial_model &gt;= 0 &amp;&amp; initial_model &lt;= num_nnets);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  int32 num_uc = nnets[0].NumUpdatableComponents();</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  scale_params-&gt;<a class="code" href="classkaldi_1_1Vector.html#ae98e624cca1982e866ff195131ed4427">Resize</a>(num_uc * num_nnets);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">if</span> (initial_model &lt; num_nnets) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Initializing with neural net with index &quot;</span> &lt;&lt; initial_model;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">// At this point we&#39;re using the best of the individual neural nets.</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    scale_params-&gt;<a class="code" href="classkaldi_1_1VectorBase.html#aa1d7a0407ceca79233c702b0666a905a">Set</a>(0.0);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    </div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// Set the block of parameters corresponding to the &quot;best&quot; of the</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// source neural nets to</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    SubVector&lt;double&gt; best_block(*scale_params, num_uc * initial_model, num_uc);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    best_block.Set(1.0);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  } <span class="keywordflow">else</span> { <span class="comment">// initial_model == num_nnets</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Initializing with all neural nets averaged.&quot;</span>;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    scale_params-&gt;<a class="code" href="classkaldi_1_1VectorBase.html#aa1d7a0407ceca79233c702b0666a905a">Set</a>(1.0 / num_nnets);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_a83c0e9b3cc3644b1c7027de9f29daafd"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a83c0e9b3cc3644b1c7027de9f29daafd">kaldi::nnet2::GetInitialModel</a></div><div class="ttdeci">static int32 GetInitialModel(const std::vector&lt; NnetExample &gt; &amp;validation_set, const std::vector&lt; Nnet &gt; &amp;nnets)</div><div class="ttdoc">Returns an integer saying which model to use: either 0 ... </div><div class="ttdef"><b>Definition:</b> <a href="combine-nnet_8cc_source.html#l00049">combine-nnet.cc:49</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html_ae98e624cca1982e866ff195131ed4427"><div class="ttname"><a href="classkaldi_1_1Vector.html#ae98e624cca1982e866ff195131ed4427">kaldi::Vector::Resize</a></div><div class="ttdeci">void Resize(MatrixIndexT length, MatrixResizeType resize_type=kSetZero)</div><div class="ttdoc">Set vector to a specified size (can be zero). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00190">kaldi-vector.cc:190</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_aa1d7a0407ceca79233c702b0666a905a"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#aa1d7a0407ceca79233c702b0666a905a">kaldi::VectorBase::Set</a></div><div class="ttdeci">void Set(Real f)</div><div class="ttdoc">Set all members of a vector to a specified value. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00336">kaldi-vector.cc:336</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af25faf523f3c6bf1c1297e49f6d4cd4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af25faf523f3c6bf1c1297e49f6d4cd4b">&#9670;&nbsp;</a></span>GetNnetStats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetNnetStats </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetStatsConfig.html">NnetStatsConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1NnetStats.html">NnetStats</a> &gt; *&#160;</td>
          <td class="paramname"><em>stats</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-stats_8cc_source.html#l00099">99</a> of file <a class="el" href="nnet-stats_8cc_source.html">nnet-stats.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-stats_8h_source.html#l00035">NnetStatsConfig::bucket_width</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet-stats_8h_source.html#l00046">NnetStats::NnetStats()</a>, and <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>.</p>
<div class="fragment"><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                                               {</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(stats-&gt;size() == 0);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c + 1 &lt; nnet.NumComponents(); c++) {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keyword">const</span> AffineComponent *ac = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>AffineComponent*<span class="keyword">&gt;</span>(</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        &amp;(nnet.GetComponent(c)));</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span> (ac == NULL) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keyword">const</span> NonlinearComponent *nc = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>NonlinearComponent*<span class="keyword">&gt;</span>(</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        &amp;(nnet.GetComponent(c + 1)));</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">if</span> (nc == NULL) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// exclude softmax.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keyword">const</span> SoftmaxComponent *sc = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>SoftmaxComponent*<span class="keyword">&gt;</span>(</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        &amp;(nnet.GetComponent(c + 1)));</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">if</span> (sc != NULL) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    stats-&gt;push_back(NnetStats(c, config.bucket_width));</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    stats-&gt;back().AddStatsFromNnet(nnet);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  }</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aff85e4bd1e5f472b2869f9cdfa71c93a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff85e4bd1e5f472b2869f9cdfa71c93a">&#9670;&nbsp;</a></span>GetUpdateDirection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet2::GetUpdateDirection </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>nnets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>direction</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="combine-nnet-a_8cc_source.html#l00031">31</a> of file <a class="el" href="combine-nnet-a_8cc_source.html">combine-nnet-a.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00576">Nnet::AddNnet()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-utils_8cc_source.html#l00413">kaldi::nnet3::NumUpdatableComponents()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00421">Nnet::ScaleComponents()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00336">VectorBase&lt; Real &gt;::Set()</a>.</p>

<p class="reference">Referenced by <a class="el" href="combine-nnet-a_8cc_source.html#l00102">CombineNnetsA()</a>.</p>
<div class="fragment"><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                                                {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(nnets.size() &gt; 1);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  int32 num_new_nnets = nnets.size() - 1;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  Vector&lt;BaseFloat&gt; scales(nnets[0].<a class="code" href="namespacekaldi_1_1nnet3.html#a25df665b8f7a712a34469e53fc875851">NumUpdatableComponents</a>());</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  scales.Set(1.0 / num_new_nnets);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  </div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  *direction = nnets[1];</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  direction-&gt;ScaleComponents(scales); <span class="comment">// first of the new nnets.</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 2; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; 1 + num_new_nnets; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++)</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    direction-&gt;AddNnet(scales, nnets[<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>]);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="comment">// now &quot;direction&quot; is the average of the new nnets.  Subtract</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="comment">// the old nnet&#39;s parameters.</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  scales.Set(-1.0);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  direction-&gt;AddNnet(scales, nnets[0]);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a25df665b8f7a712a34469e53fc875851"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a25df665b8f7a712a34469e53fc875851">kaldi::nnet3::NumUpdatableComponents</a></div><div class="ttdeci">int32 NumUpdatableComponents(const Nnet &amp;dest)</div><div class="ttdoc">Returns the number of updatable components in the nnet. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-utils_8cc_source.html#l00413">nnet-utils.cc:413</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af53b1dc301e038dffa347e0e40268811"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af53b1dc301e038dffa347e0e40268811">&#9670;&nbsp;</a></span>GiveNnetCorrectTopology()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet2::GiveNnetCorrectTopology </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1AffineComponent.html">AffineComponent</a> **&#160;</td>
          <td class="paramname"><em>affine_component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1SoftmaxComponent.html">SoftmaxComponent</a> **&#160;</td>
          <td class="paramname"><em>softmax_component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html">SumGroupComponent</a> **&#160;</td>
          <td class="paramname"><em>sum_group_component</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function makes sure the neural net ends with a <a class="el" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html">SumGroupComponent</a>. </p>
<p>If it doesn't, it adds one (with a single mixture/matrix corresponding to each output element.) [Before doing so, it makes sure that the last layer is a SoftmaxLayer, which is what we expect. You can remove this check if there is some use-case that makes sense where the type of the previous layer is different. </p>

<p class="definition">Definition at line <a class="el" href="mixup-nnet_8cc_source.html#l00037">37</a> of file <a class="el" href="mixup-nnet_8cc_source.html">mixup-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00643">Nnet::Append()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>, <a class="el" href="classkaldi_1_1nnet2_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">Component::OutputDim()</a>, and <a class="el" href="classkaldi_1_1nnet2_1_1Component.html#ab6b6147feb5e0688469b735a6546c222">Component::Type()</a>.</p>

<p class="reference">Referenced by <a class="el" href="mixup-nnet_8cc_source.html#l00086">MixupNnet()</a>.</p>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                                                                             {</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  int32 nc = nnet-&gt;NumComponents();</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(nc &gt; 0);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  Component* component = &amp;(nnet-&gt;GetComponent(nc - 1));</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordflow">if</span> ((*sum_group_component =</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;       dynamic_cast&lt;SumGroupComponent*&gt;(component)) == NULL) {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Adding SumGroupComponent to neural net.&quot;</span>;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    int32 dim = component-&gt;OutputDim();</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// Give it the same learning rate as the first updatable layer we have.</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    std::vector&lt;int32&gt; sizes(dim, 1); <span class="comment">// a vector of all ones, of dimension &quot;dim&quot;.</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  </div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    *sum_group_component = <span class="keyword">new</span> SumGroupComponent();</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    (*sum_group_component)-&gt;Init(sizes);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    nnet-&gt;Append(*sum_group_component);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    nc++;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  }</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  component = &amp;(nnet-&gt;GetComponent(nc - 2));    </div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">if</span> ((*softmax_component = dynamic_cast&lt;SoftmaxComponent*&gt;(component)) == NULL)</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Neural net has wrong topology: expected second-to-last &quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;component to be SoftmaxComponent, type is &quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;              &lt;&lt; component-&gt;Type();</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  component = &amp;(nnet-&gt;GetComponent(nc - 3));</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordflow">if</span> ((*affine_component = dynamic_cast&lt;AffineComponent*&gt;(component)) == NULL)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Neural net has wrong topology: expected third-to-last &quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;component to be AffineComponent, type is &quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;              &lt;&lt; component-&gt;Type();</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;}</div><div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0ec833548abe8d9297fc97688121cc4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ec833548abe8d9297fc97688121cc4b">&#9670;&nbsp;</a></span>HasSimpleLabels()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> kaldi::nnet2::HasSimpleLabels </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>simple_labels</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-example_8cc_source.html#l00032">32</a> of file <a class="el" href="nnet2_2nnet-example_8cc_source.html">nnet-example.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet2_2nnet-example_8h_source.html#l00043">NnetExample::labels</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet2_2nnet-example_8cc_source.html#l00046">NnetExample::Write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                                     {</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordtype">size_t</span> num_frames = eg.labels.size();</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordflow">for</span> (int32 t = 0; t &lt; num_frames; t++)</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordflow">if</span> (eg.labels[t].size() != 1 || eg.labels[t][0].second != 1.0)</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  simple_labels-&gt;resize(num_frames);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">for</span> (int32 t = 0; t &lt; num_frames; t++)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    (*simple_labels)[t] = eg.labels[t][0].first;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="aab0e83dcfbed9677c5715a4175dcdcf6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab0e83dcfbed9677c5715a4175dcdcf6">&#9670;&nbsp;</a></span>IndexOfSoftmaxLayer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32 IndexOfSoftmaxLayer </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If "nnet" has exactly one softmax layer, this function will return its index; otherwise it will return -1. </p>

<p class="definition">Definition at line <a class="el" href="nnet-functions_8cc_source.html#l00027">27</a> of file <a class="el" href="nnet-functions_8cc_source.html">nnet-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, and <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-insert_8cc_source.html#l00027">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                                            {</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  int32 index = -1, nc = nnet.NumComponents();</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nc; c++) {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">const</span> Component *component = &amp;(nnet.GetComponent(c));</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">if</span> (dynamic_cast&lt;const SoftmaxComponent*&gt;(component) != NULL) {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;      <span class="keywordflow">if</span> (index != -1) <span class="keywordflow">return</span> -1; <span class="comment">// &gt;1 softmax components.</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;      <span class="keywordflow">else</span> index = c;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    }</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  }</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordflow">return</span> index;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ae3f065d6fa293976c2276045cf713841"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3f065d6fa293976c2276045cf713841">&#9670;&nbsp;</a></span>InsertComponents()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InsertComponents </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>src_nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>dest_nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inserts the components of one neural network into a particular place in the other one. </p>
<p>This is useful for adding hidden layers to a neural net. Inserts the components of "src_nnet" before component index c of "dest_nnet". </p>

<p class="definition">Definition at line <a class="el" href="nnet-functions_8cc_source.html#l00039">39</a> of file <a class="el" href="nnet-functions_8cc_source.html">nnet-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="classkaldi_1_1nnet2_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Component::Copy()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00281">Nnet::Init()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-insert_8cc_source.html#l00027">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                                       {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(c_to_insert &gt;= 0 &amp;&amp; c_to_insert &lt;= dest_nnet-&gt;NumComponents());</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  int32 c_tot = dest_nnet-&gt;NumComponents() + src_nnet.NumComponents();</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  std::vector&lt;Component*&gt; components(c_tot);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; c_to_insert; c++)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    components[c] = dest_nnet-&gt;GetComponent(c).Copy();</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; src_nnet.NumComponents(); c++)</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    components[c + c_to_insert] = src_nnet.GetComponent(c).Copy();</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordflow">for</span> (int32 c = c_to_insert; c &lt; dest_nnet-&gt;NumComponents(); c++)</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    components[c + src_nnet.NumComponents()] = dest_nnet-&gt;GetComponent(c).Copy();</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="comment">// Re-initialize &quot;dest_nnet&quot; from the resulting list of components.</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">// The Init method will take ownership of the pointers in the vector:</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  dest_nnet-&gt;Init(&amp;components);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6efb3388f9385fddcae0b3087be5d5e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6efb3388f9385fddcae0b3087be5d5e4">&#9670;&nbsp;</a></span>KlDivergence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> kaldi::nnet2::KlDivergence </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-adjust-priors_8cc_source.html#l00031">31</a> of file <a class="el" href="nnet-adjust-priors_8cc_source.html">nnet-adjust-priors.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="kaldi-math_8h_source.html#l00100">kaldi::Log()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00693">VectorBase&lt; Real &gt;::Sum()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-adjust-priors_8cc_source.html#l00048">PrintPriorDiagnostics()</a>.</p>
<div class="fragment"><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                                                   {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> sum_p = p.<a class="code" href="classkaldi_1_1VectorBase.html#ae7089fd656218302336300dc42ae55c1">Sum</a>(), sum_q = q.<a class="code" href="classkaldi_1_1VectorBase.html#ae7089fd656218302336300dc42ae55c1">Sum</a>();</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">if</span> (fabs(sum_p - 1.0) &gt; 0.01 || fabs(sum_q - 1.0) &gt; 0.01) {</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;KlDivergence: vectors are not close to being normalized &quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;               &lt;&lt; sum_p &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; sum_q;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  }</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(p.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>() == q.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>());</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keywordtype">double</span> ans = 0.0;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; p.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> p_prob = p(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) / sum_p, q_prob = q(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) / sum_q;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    ans += p_prob * <a class="code" href="namespacekaldi.html#af75c4606b108091c348102660de63180">Log</a>(p_prob / q_prob);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  }</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_af75c4606b108091c348102660de63180"><div class="ttname"><a href="namespacekaldi.html#af75c4606b108091c348102660de63180">kaldi::Log</a></div><div class="ttdeci">double Log(double x)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00100">kaldi-math.h:100</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::VectorBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Returns the dimension of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00063">kaldi-vector.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_ae7089fd656218302336300dc42ae55c1"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#ae7089fd656218302336300dc42ae55c1">kaldi::VectorBase::Sum</a></div><div class="ttdeci">Real Sum() const</div><div class="ttdoc">Returns sum of the elements. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00693">kaldi-vector.cc:693</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab4e03e0116acc5d26e9f3741a31302c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4e03e0116acc5d26e9f3741a31302c7">&#9670;&nbsp;</a></span>LatticeToDiscriminativeExample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> LatticeToDiscriminativeExample </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>alignment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>feats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacekaldi.html#aeba2c05d999bd2f794db8919ac816bb3">CompactLattice</a> &amp;&#160;</td>
          <td class="paramname"><em>clat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>left_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>right_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> *&#160;</td>
          <td class="paramname"><em>eg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts lattice to discriminative training example. </p>
<p>returns true on success, false on failure such as mismatched input (will also warn in this case). </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-functions_8cc_source.html#l00027">27</a> of file <a class="el" href="nnet-example-functions_8cc_source.html">nnet-example-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet2_2nnet-example_8cc_source.html#l00295">DiscriminativeNnetExample::Check()</a>, <a class="el" href="lattice-functions_8cc_source.html#l00111">kaldi::CompactLatticeStateTimes()</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00148">DiscriminativeNnetExample::den_lat</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00159">DiscriminativeNnetExample::input_frames</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00164">DiscriminativeNnetExample::left_context</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00143">DiscriminativeNnetExample::num_ali</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00199">MatrixBase&lt; Real &gt;::Range()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00818">Matrix&lt; Real &gt;::Resize()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>, and <a class="el" href="nnet2_2nnet-example_8h_source.html#l00140">DiscriminativeNnetExample::weight</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-get-egs-discriminative_8cc_source.html#l00027">main()</a>, and <a class="el" href="nnet-example-functions_8h_source.html#l00133">SplitExampleStats::SplitExampleStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                                   {</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(left_context &gt;= 0 &amp;&amp; right_context &gt;= 0);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  int32 num_frames = alignment.size();</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordflow">if</span> (num_frames == 0) {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Empty alignment&quot;</span>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  }</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">if</span> (num_frames != feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>()) {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Dimension mismatch: alignment &quot;</span> &lt;&lt; num_frames</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; versus feats &quot;</span> &lt;&lt; feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>();</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  }</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  std::vector&lt;int32&gt; times;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  int32 num_frames_clat = <a class="code" href="namespacekaldi.html#af1f4900deddf6047ebc683838997b264">CompactLatticeStateTimes</a>(clat, &amp;times);  </div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">if</span> (num_frames_clat != num_frames) {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Numerator/frames versus denlat frames mismatch: &quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;               &lt;&lt; num_frames &lt;&lt; <span class="stringliteral">&quot; versus &quot;</span> &lt;&lt; num_frames_clat;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  }</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  eg-&gt;weight = weight;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  eg-&gt;num_ali = alignment;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  eg-&gt;den_lat = clat;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  int32 feat_dim = feats.<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>();</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  eg-&gt;input_frames.Resize(left_context + num_frames + right_context,</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                          feat_dim);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  eg-&gt;input_frames.Range(left_context, num_frames,</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                         0, feat_dim).CopyFromMat(feats);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">// Duplicate the first and last frames.</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">for</span> (int32 t = 0; t &lt; left_context; t++)</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    eg-&gt;input_frames.Row(t).CopyFromVec(feats.<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(0));</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordflow">for</span> (int32 t = 0; t &lt; right_context; t++)</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    eg-&gt;input_frames.Row(left_context + num_frames + t).CopyFromVec(</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        feats.<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(num_frames - 1));</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  eg-&gt;left_context = left_context;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  eg-&gt;Check();</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div><div class="ttc" id="classkaldi_1_1MatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::MatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdoc">Returns number of columns (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00064">kaldi-matrix.h:64</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_afb93e5db62adee40ee68bbec3751443f"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">kaldi::MatrixBase::Row</a></div><div class="ttdeci">const SubVector&lt; Real &gt; Row(MatrixIndexT i) const</div><div class="ttdoc">Return specific row of matrix [const]. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00185">kaldi-matrix.h:185</a></div></div>
<div class="ttc" id="namespacekaldi_html_af1f4900deddf6047ebc683838997b264"><div class="ttname"><a href="namespacekaldi.html#af1f4900deddf6047ebc683838997b264">kaldi::CompactLatticeStateTimes</a></div><div class="ttdeci">int32 CompactLatticeStateTimes(const CompactLattice &amp;lat, vector&lt; int32 &gt; *times)</div><div class="ttdoc">As LatticeStateTimes, but in the CompactLattice format. </div><div class="ttdef"><b>Definition:</b> <a href="lattice-functions_8cc_source.html#l00111">lattice-functions.cc:111</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::MatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Returns number of rows (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00061">kaldi-matrix.h:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a071dd91b80c074ef845397ff96472663"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a071dd91b80c074ef845397ff96472663">&#9670;&nbsp;</a></span>LimitRankParallel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void LimitRankParallel </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetLimitRankOpts.html">NnetLimitRankOpts</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function limits the rank of each affine transform in the neural net, by zeroing out the smallest singular values. </p>
<p>The number of singular values to zero out is determined on a layer by layer basis, using "parameter_proportion" to set the proportion of parameters to remove. </p>

<p class="definition">Definition at line <a class="el" href="nnet-limit-rank_8cc_source.html#l00099">99</a> of file <a class="el" href="nnet-limit-rank_8cc_source.html">nnet-limit-rank.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, <a class="el" href="nnet-limit-rank_8h_source.html#l00033">NnetLimitRankOpts::num_threads</a>, <a class="el" href="kaldi-thread_8h_source.html#l00156">TaskSequencerConfig::num_threads</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>, and <a class="el" href="kaldi-thread_8h_source.html#l00189">TaskSequencer&lt; C &gt;::Run()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-limit-rank_8h_source.html#l00038">NnetLimitRankOpts::Register()</a>.</p>
<div class="fragment"><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                                        {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  TaskSequencerConfig task_config;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  task_config.num_threads = opts.num_threads;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  TaskSequencer&lt;LimitRankClass&gt; tc(task_config);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;NumComponents(); c++) {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">if</span> (dynamic_cast&lt;AffineComponent*&gt;(&amp;(nnet-&gt;GetComponent(c))) != NULL)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      tc.Run(<span class="keyword">new</span> LimitRankClass(opts, c, nnet));</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a573bbaf2d11e8ffa24babe6da86a9c89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a573bbaf2d11e8ffa24babe6da86a9c89">&#9670;&nbsp;</a></span>MakePair()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="structInt32Pair.html">Int32Pair</a> kaldi::nnet2::MakePair </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>first</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>second</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="train-nnet-ensemble_8cc_source.html#l00027">27</a> of file <a class="el" href="train-nnet-ensemble_8cc_source.html">train-nnet-ensemble.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrixdim_8h_source.html#l00085">Int32Pair::first</a>, and <a class="el" href="cu-matrixdim_8h_source.html#l00086">Int32Pair::second</a>.</p>

<p class="reference">Referenced by <a class="el" href="train-nnet-ensemble_8cc_source.html#l00050">NnetEnsembleTrainer::TrainOneMinibatch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                                                            {</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="structInt32Pair.html">Int32Pair</a> ans;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  ans.<a class="code" href="structInt32Pair.html#a9b288b26b67b6a87162a9e1ab5b35dbf">first</a> = first;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  ans.<a class="code" href="structInt32Pair.html#a03a67f151bb1afcfcafab8870b75acff">second</a> = second;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;}</div><div class="ttc" id="structInt32Pair_html"><div class="ttname"><a href="structInt32Pair.html">Int32Pair</a></div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00084">cu-matrixdim.h:84</a></div></div>
<div class="ttc" id="structInt32Pair_html_a03a67f151bb1afcfcafab8870b75acff"><div class="ttname"><a href="structInt32Pair.html#a03a67f151bb1afcfcafab8870b75acff">Int32Pair::second</a></div><div class="ttdeci">int32_cuda second</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00086">cu-matrixdim.h:86</a></div></div>
<div class="ttc" id="structInt32Pair_html_a9b288b26b67b6a87162a9e1ab5b35dbf"><div class="ttname"><a href="structInt32Pair.html#a9b288b26b67b6a87162a9e1ab5b35dbf">Int32Pair::first</a></div><div class="ttdeci">int32_cuda first</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00085">cu-matrixdim.h:85</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac4aeed69b647fd9b2f223551a5bc5865"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4aeed69b647fd9b2f223551a5bc5865">&#9670;&nbsp;</a></span>MixupNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MixupNnet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetMixupConfig.html">NnetMixupConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>mixup_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function works as follows. </p>
<p>This function does something similar to Gaussian mixture splitting for GMMs, except applied to the output layer of the neural network.</p>
<p>We first make sure the neural net has the correct topology, so its last component is a <a class="el" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html">SumGroupComponent</a>.</p>
<p>We then get the counts for each matrix in the <a class="el" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html">SumGroupComponent</a> (these will either correspond to leaves in the decision tree, or level-1 leaves, if we have a 2-level-tree system). We work out the total count for each of these matrices, by getting the count from the <a class="el" href="classkaldi_1_1nnet2_1_1SoftmaxComponent.html">SoftmaxComponent</a>.</p>
<p>We then increase, if necessary, the dimensions that the <a class="el" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html">SumGroupComponent</a> sums over increase the dimension of the <a class="el" href="classkaldi_1_1nnet2_1_1SoftmaxComponent.html">SoftmaxComponent</a> if necessary, and duplicate and then perturb the relevant rows of the <a class="el" href="classkaldi_1_1nnet2_1_1AffineComponent.html">AffineComponent</a>.</p>
<p>We create additional outputs, which will be summed over using a <a class="el" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html">SumGroupComponent</a>. </p>

<p class="definition">Definition at line <a class="el" href="mixup-nnet_8cc_source.html#l00086">86</a> of file <a class="el" href="mixup-nnet_8cc_source.html">mixup-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00271">Nnet::Check()</a>, <a class="el" href="mixup-nnet_8cc_source.html#l00037">GiveNnetCorrectTopology()</a>, <a class="el" href="mixup-nnet_8h_source.html#l00032">NnetMixupConfig::min_count</a>, <a class="el" href="mixup-nnet_8cc_source.html#l00107">SoftmaxComponent::MixUp()</a>, <a class="el" href="mixup-nnet_8h_source.html#l00033">NnetMixupConfig::num_mixtures</a>, <a class="el" href="mixup-nnet_8h_source.html#l00034">NnetMixupConfig::perturb_stddev</a>, and <a class="el" href="mixup-nnet_8h_source.html#l00031">NnetMixupConfig::power</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-am-mixup_8cc_source.html#l00027">main()</a>, and <a class="el" href="mixup-nnet_8h_source.html#l00040">NnetMixupConfig::Register()</a>.</p>
<div class="fragment"><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                           {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  AffineComponent *affine_component = NULL;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  SoftmaxComponent *softmax_component = NULL;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  SumGroupComponent *sum_group_component = NULL;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#af53b1dc301e038dffa347e0e40268811">GiveNnetCorrectTopology</a>(nnet,</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                          &amp;affine_component,</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                          &amp;softmax_component,</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                          &amp;sum_group_component); <span class="comment">// Adds a SumGroupComponent if needed.</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  </div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  softmax_component-&gt;MixUp(mixup_config.num_mixtures,</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                           mixup_config.power,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                           mixup_config.min_count,</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                           mixup_config.perturb_stddev,</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                           affine_component,</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                           sum_group_component);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  nnet-&gt;Check(); <span class="comment">// Checks that dimensions all match up.</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_af53b1dc301e038dffa347e0e40268811"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#af53b1dc301e038dffa347e0e40268811">kaldi::nnet2::GiveNnetCorrectTopology</a></div><div class="ttdeci">static void GiveNnetCorrectTopology(Nnet *nnet, AffineComponent **affine_component, SoftmaxComponent **softmax_component, SumGroupComponent **sum_group_component)</div><div class="ttdoc">This function makes sure the neural net ends with a SumGroupComponent. </div><div class="ttdef"><b>Definition:</b> <a href="mixup-nnet_8cc_source.html#l00037">mixup-nnet.cc:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeff1c1ada8948d90166bccf6ff83cf3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeff1c1ada8948d90166bccf6ff83cf3e">&#9670;&nbsp;</a></span>NnetComputation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NnetComputation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>pad_input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Does the basic neural net computation, on a sequence of data (e.g. </p>
<p>an utterance). If pad_input==true we'll pad the input with enough frames of context, and the output will be a matrix of #frames by the output-dim of the network, typically representing state-level posteriors. If pad_input==false we won't do this and the output will have a lower #frames than the input; we lose nnet.LeftContext() at the left and nnet.RightContext() at the output. </p>

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00160">160</a> of file <a class="el" href="nnet2_2nnet-compute_8cc_source.html">nnet-compute.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrix_8cc_source.html#l00339">CuMatrixBase&lt; Real &gt;::CopyFromMat()</a>, <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00054">NnetComputer::GetOutput()</a>, and <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00095">NnetComputer::Propagate()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-computation_8h_source.html#l00507">NnetComputation::Clear()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00741">CachingOptimizingCompiler::CompileNoShortcut()</a>, <a class="el" href="nnet-optimize_8cc_source.html#l00808">CachingOptimizingCompiler::CompileViaShortcut()</a>, <a class="el" href="decodable-am-nnet_8h_source.html#l00118">DecodableAmNnetParallel::Compute()</a>, <a class="el" href="online-nnet2-decodable_8cc_source.html#l00081">DecodableNnet2Online::ComputeForFrame()</a>, <a class="el" href="decodable-am-nnet_8h_source.html#l00039">DecodableAmNnet::DecodableAmNnet()</a>, <a class="el" href="nnet2bin_2nnet-compute_8cc_source.html#l00027">main()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l05018">ComputationCache::Read()</a>, <a class="el" href="nnet2_2nnet-compute-test_8cc_source.html#l00029">UnitTestNnetCompute()</a>, and <a class="el" href="nnet2_2nnet-compute-test_8cc_source.html#l00084">UnitTestNnetComputeChunked()</a>.</p>
<div class="fragment"><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                                                      {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  NnetComputer nnet_computer(nnet, input, pad_input, NULL);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  nnet_computer.Propagate();</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  output-&gt;CopyFromMat(nnet_computer.GetOutput());</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a532f607f0ac5014ef8d4c9ff116a22b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a532f607f0ac5014ef8d4c9ff116a22b8">&#9670;&nbsp;</a></span>NnetComputationChunked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NnetComputationChunked </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>chunk_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>output</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Does the basic neural net computation, on a sequence of data (e.g. </p>
<p>an utterance). This variant of NnetComputation chunks the input according to chunk_size and does the posterior computation chunk by chunk. This allows the computation to be performed on the GPU when the input matrix is very large. <a class="el" href="classkaldi_1_1Input.html">Input</a> is padded with enough frames of context so that the output will be a matrix with input.NumRows(). </p>

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00169">169</a> of file <a class="el" href="nnet2_2nnet-compute_8cc_source.html">nnet-compute.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-matrix_8cc_source.html#l00861">MatrixBase&lt; Real &gt;::CopyFromMat()</a>, <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00054">NnetComputer::GetOutput()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00042">Nnet::LeftContext()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00095">NnetComputer::Propagate()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00199">MatrixBase&lt; Real &gt;::Range()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00818">Matrix&lt; Real &gt;::Resize()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00056">Nnet::RightContext()</a>, and <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-am-compute_8cc_source.html#l00030">main()</a>, and <a class="el" href="nnet2_2nnet-compute-test_8cc_source.html#l00084">UnitTestNnetComputeChunked()</a>.</p>
<div class="fragment"><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                                {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  int32 num_rows,</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;       num_chunks = ceil((<a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>)input.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() / chunk_size),</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;       dim = input.<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>(),</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;       left_context = nnet.LeftContext(),</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;       right_context = nnet.RightContext();</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  Matrix&lt;BaseFloat&gt; full_input;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  num_rows = left_context + input.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() + right_context;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  full_input.Resize(num_rows, dim);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  full_input.Range(left_context, input.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>(),</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            0, dim).CopyFromMat(input);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; left_context; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    full_input.Row(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>).CopyFromVec(input.<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(0));</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  int32 last_row = input.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() - 1;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; right_context; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    full_input.Row(num_rows - <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1).CopyFromVec(input.<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(last_row));</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_chunks; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    int32 index = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> * chunk_size,</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;          offset = std::min(num_rows - chunk_size * <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, </div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                            left_context + chunk_size + right_context);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    SubMatrix&lt;BaseFloat&gt; chunk_input(full_input, index, offset, 0, dim);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    CuMatrix&lt;BaseFloat&gt; cu_chunk_input(chunk_input);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">// Note: we have already accounted for input padding, so we pass</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// pad_input==false to the NnetComputer.</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    NnetComputer nnet_computer(nnet, cu_chunk_input, <span class="keyword">false</span>, NULL);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    nnet_computer.Propagate();</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    CuMatrix&lt;BaseFloat&gt; cu_chunk_output(nnet_computer.GetOutput());</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    SubMatrix&lt;BaseFloat&gt; chunk_out(*output, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> * chunk_size, </div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                           cu_chunk_output.NumRows(), 0, </div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                           cu_chunk_output.NumCols());</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    chunk_out.CopyFromMat(cu_chunk_output);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="ttc" id="classkaldi_1_1MatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::MatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdoc">Returns number of columns (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00064">kaldi-matrix.h:64</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_afb93e5db62adee40ee68bbec3751443f"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">kaldi::MatrixBase::Row</a></div><div class="ttdeci">const SubVector&lt; Real &gt; Row(MatrixIndexT i) const</div><div class="ttdoc">Return specific row of matrix [const]. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00185">kaldi-matrix.h:185</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::MatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Returns number of rows (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00061">kaldi-matrix.h:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afcc64cd1d4a814c4da3dd1a2e9a560d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcc64cd1d4a814c4da3dd1a2e9a560d7">&#9670;&nbsp;</a></span>NnetDiscriminativeUpdate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NnetDiscriminativeUpdate </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1AmNnet.html">AmNnet</a> &amp;&#160;</td>
          <td class="paramname"><em>am_nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>tmodel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetDiscriminativeUpdateOptions.html">NnetDiscriminativeUpdateOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet_to_update</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet2_1_1NnetDiscriminativeStats.html">NnetDiscriminativeStats</a> *&#160;</td>
          <td class="paramname"><em>stats</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Does the neural net computation, lattice forward-backward, and backprop, for either the MMI, MPFE or SMBR objective functions. </p>
<p>If nnet_to_update == &amp;(am_nnet.GetNnet()), then this does stochastic gradient descent, otherwise (assuming you have called SetZero(true) on *nnet_to_update) it will compute the gradient on this data. If nnet_to_update_ == NULL, no backpropagation is done.</p>
<p>Note: we ignore any existing acoustic score in the lattice of "eg".</p>
<p>For display purposes you should normalize the sum of this return value by dividing by the sum over the examples, of the number of frames (num_ali.size()) times the weight.</p>
<p>Something you need to be careful with is that the occupation counts and the derivative are, following tradition, missing a factor equal to the acoustic scale. So you need to multiply them by that scale if you plan to do something like L-BFGS in which you look at both the derivatives and function values. </p>

<p class="definition">Definition at line <a class="el" href="nnet-compute-discriminative_8cc_source.html#l00365">365</a> of file <a class="el" href="nnet-compute-discriminative_8cc_source.html">nnet-compute-discriminative.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compute-discriminative_8cc_source.html#l00042">NnetDiscriminativeUpdater::Update()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-train-discriminative-simple_8cc_source.html#l00027">main()</a>, <a class="el" href="nnet-compute-discriminative_8h_source.html#l00080">NnetDiscriminativeStats::NnetDiscriminativeStats()</a>, and <a class="el" href="nnet-compute-discriminative-parallel_8cc_source.html#l00148">DiscTrainParallelClass::operator()()</a>.</p>
<div class="fragment"><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                                                              {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  NnetDiscriminativeUpdater updater(am_nnet, tmodel, opts, eg,</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                                    nnet_to_update, stats);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  updater.Update();</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ac16225f341eee2b74a810b87f774d265"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac16225f341eee2b74a810b87f774d265">&#9670;&nbsp;</a></span>NnetDiscriminativeUpdateParallel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void NnetDiscriminativeUpdateParallel </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1AmNnet.html">AmNnet</a> &amp;&#160;</td>
          <td class="paramname"><em>am_nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>tmodel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetDiscriminativeUpdateOptions.html">NnetDiscriminativeUpdateOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_threads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi_1_1nnet2.html#a19617e2d7fdd519e551f8228e1041dac">SequentialDiscriminativeNnetExampleReader</a> *&#160;</td>
          <td class="paramname"><em>example_reader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet_to_update</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet2_1_1NnetDiscriminativeStats.html">NnetDiscriminativeStats</a> *&#160;</td>
          <td class="paramname"><em>stats</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-compute-discriminative-parallel_8cc_source.html#l00189">189</a> of file <a class="el" href="nnet-compute-discriminative-parallel_8cc_source.html">nnet-compute-discriminative-parallel.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-compute-discriminative-parallel_8cc_source.html#l00064">DiscriminativeExamplesRepository::AcceptExample()</a>, <a class="el" href="nnet-compute-discriminative_8h_source.html#l00036">NnetDiscriminativeUpdateOptions::criterion</a>, <a class="el" href="kaldi-table-inl_8h_source.html#l00948">SequentialTableReader&lt; Holder &gt;::Done()</a>, <a class="el" href="nnet-compute-discriminative-parallel_8cc_source.html#l00073">DiscriminativeExamplesRepository::ExamplesDone()</a>, <a class="el" href="am-nnet_8h_source.html#l00061">AmNnet::GetNnet()</a>, <a class="el" href="kaldi-table-inl_8h_source.html#l00942">SequentialTableReader&lt; Holder &gt;::Next()</a>, <a class="el" href="nnet-compute-discriminative_8cc_source.html#l00384">NnetDiscriminativeStats::Print()</a>, and <a class="el" href="kaldi-table-inl_8h_source.html#l00934">SequentialTableReader&lt; Holder &gt;::Value()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-train-discriminative-parallel_8cc_source.html#l00027">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                    {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  DiscriminativeExamplesRepository repository;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> store_separate_gradients = (nnet_to_update != &amp;(am_nnet.GetNnet()));</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  DiscTrainParallelClass c(am_nnet, tmodel, opts,</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                           store_separate_gradients,</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                           &amp;repository, nnet_to_update, stats);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// The initialization of the following class spawns the threads that</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// process the examples.  They get re-joined in its destructor.</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    MultiThreader&lt;DiscTrainParallelClass&gt; m(num_threads, c);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">for</span> (; !example_reader-&gt;Done(); example_reader-&gt;Next()) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      repository.AcceptExample(example_reader-&gt;Value());</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    repository.ExamplesDone();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  stats-&gt;Print(opts.criterion);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a31bfa0c64c303a78039d017e47d4b25e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31bfa0c64c303a78039d017e47d4b25e">&#9670;&nbsp;</a></span>NnetGradientComputation() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> kaldi::nnet2::NnetGradientComputation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>pad_input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>utterance_weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>labels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet_to_update</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Does the neural net computation and backprop, given input and labels. </p>
<p>Note: if pad_input==true the number of rows of input should be the same as the number of labels, and if false, you should omit nnet.LeftContext() labels on the left and nnet.RightContext() on the right. If nnet_to_update == &amp;nnet, then this does stochastic gradient descent, otherwise (assuming you have called SetZero(true) on *nnet_to_update) it will compute the gradient on this data. Returns the total objective function summed over the frames, times the utterance weight. </p>

</div>
</div>
<a id="a3d529cdc30870c6a7802f80c8518fa0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d529cdc30870c6a7802f80c8518fa0c">&#9670;&nbsp;</a></span>NnetGradientComputation() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> kaldi::nnet2::NnetGradientComputation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>pad_input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> &amp;&#160;</td>
          <td class="paramname"><em>pdf_post</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet_to_update</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00208">208</a> of file <a class="el" href="nnet2_2nnet-compute_8cc_source.html">nnet-compute.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00141">NnetComputer::Backprop()</a>, <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00111">NnetComputer::ComputeLastLayerDeriv()</a>, and <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00095">NnetComputer::Propagate()</a>.</p>
<div class="fragment"><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                                                        {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  NnetComputer nnet_computer(nnet, input, pad_input, nnet_to_update);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  nnet_computer.Propagate();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  CuMatrix&lt;BaseFloat&gt; deriv;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> ans;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  ans = nnet_computer.ComputeLastLayerDeriv(pdf_post, &amp;deriv);  </div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  nnet_computer.Backprop(&amp;deriv);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0e18825b4c5b0834e638296b2f5bb35a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e18825b4c5b0834e638296b2f5bb35a">&#9670;&nbsp;</a></span>ParseFromString() <span class="overload">[1/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ParseFromString </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Functions used in Init routines. </p>
<p>Suppose name=="foo", if "string" has a field like foo=12, this function will set "param" to 12 and remove that element from "string". It returns true if the parameter was read. </p>

<p class="definition">Definition at line <a class="el" href="_2nnet-component_8cc_source.html#l00153">153</a> of file <a class="el" href="_2nnet-component_8cc_source.html">nnet-component.cc</a>.</p>

<p class="reference">References <a class="el" href="text-utils_8h_source.html#l00118">kaldi::ConvertStringToInteger()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="text-utils_8cc_source.html#l00063">kaldi::SplitStringToVector()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component_8cc_source.html#l00409">NonlinearComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l00428">MaxoutComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l04269">MaxpoolingComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l00498">PnormComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l00698">PowerComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l00866">ScaleComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l01122">AffineComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l01390">AffineComponentPreconditioned::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l01648">AffineComponentPreconditionedOnline::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02488">SpliceComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02823">SpliceMaxComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02093">BlockAffineComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02174">BlockAffineComponentPreconditioned::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02384">SumGroupComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02323">PermuteComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03011">DctComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03175">FixedLinearComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03254">FixedAffineComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03342">FixedScaleComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03412">FixedBiasComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03487">DropoutComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03584">AdditiveNoiseComponent::InitFromString()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03761">Convolutional1dComponent::InitFromString()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00696">UnitTestParsing()</a>.</p>
<div class="fragment"><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                                   {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  std::vector&lt;std::string&gt; split_string;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <a class="code" href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">SplitStringToVector</a>(*<span class="keywordtype">string</span>, <span class="stringliteral">&quot; \t&quot;</span>, <span class="keyword">true</span>,</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                      &amp;split_string);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  std::string name_equals = name + <span class="stringliteral">&quot;=&quot;</span>; <span class="comment">// the name and then the equals sign.</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordtype">size_t</span> len = name_equals.length();</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span> (split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].compare(0, len, name_equals) == 0) {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">ConvertStringToInteger</a>(split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].substr(len), param))</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad option &quot;</span> &lt;&lt; split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      *<span class="keywordtype">string</span> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="comment">// Set &quot;string&quot; to all the pieces but the one we used.</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> != <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;          <span class="keywordflow">if</span> (!string-&gt;empty()) *<span class="keywordtype">string</span> += <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;          *<span class="keywordtype">string</span> += split_string[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a39eb3f7ce5fab6dbbcb396b3f8e196f4"><div class="ttname"><a href="namespacekaldi.html#a39eb3f7ce5fab6dbbcb396b3f8e196f4">kaldi::ConvertStringToInteger</a></div><div class="ttdeci">bool ConvertStringToInteger(const std::string &amp;str, Int *out)</div><div class="ttdoc">Converts a string into an integer via strtoll and returns false if there was any kind of problem (i...</div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8h_source.html#l00118">text-utils.h:118</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_ac332ce23fcf74c011cfa83276cd08477"><div class="ttname"><a href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">kaldi::SplitStringToVector</a></div><div class="ttdeci">void SplitStringToVector(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; std::string &gt; *out)</div><div class="ttdoc">Split a string using any of the single character delimiters. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00063">text-utils.cc:63</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a06c170854db9a3b5bb3915dfb52380c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06c170854db9a3b5bb3915dfb52380c2">&#9670;&nbsp;</a></span>ParseFromString() <span class="overload">[2/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ParseFromString </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a> *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This version is for parameters of type bool, which can appear as any string beginning with f, F, t or T. </p>

<p class="definition">Definition at line <a class="el" href="_2nnet-component_8cc_source.html#l00179">179</a> of file <a class="el" href="_2nnet-component_8cc_source.html">nnet-component.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="text-utils_8cc_source.html#l00063">kaldi::SplitStringToVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                                  {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  std::vector&lt;std::string&gt; split_string;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <a class="code" href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">SplitStringToVector</a>(*<span class="keywordtype">string</span>, <span class="stringliteral">&quot; \t&quot;</span>, <span class="keyword">true</span>,</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                      &amp;split_string);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  std::string name_equals = name + <span class="stringliteral">&quot;=&quot;</span>; <span class="comment">// the name and then the equals sign.</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordtype">size_t</span> len = name_equals.length();</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">if</span> (split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].compare(0, len, name_equals) == 0) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      std::string b = split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].substr(len);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordflow">if</span> (b.empty())</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad option &quot;</span> &lt;&lt; split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordflow">if</span> (b[0] == <span class="charliteral">&#39;f&#39;</span> || b[0] == <span class="charliteral">&#39;F&#39;</span>) *param = <span class="keyword">false</span>;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (b[0] == <span class="charliteral">&#39;t&#39;</span> || b[0] == <span class="charliteral">&#39;T&#39;</span>) *param = <span class="keyword">true</span>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad option &quot;</span> &lt;&lt; split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      *<span class="keywordtype">string</span> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="comment">// Set &quot;string&quot; to all the pieces but the one we used.</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> != <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;          <span class="keywordflow">if</span> (!string-&gt;empty()) *<span class="keywordtype">string</span> += <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;          *<span class="keywordtype">string</span> += split_string[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      }</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  }</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_ac332ce23fcf74c011cfa83276cd08477"><div class="ttname"><a href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">kaldi::SplitStringToVector</a></div><div class="ttdeci">void SplitStringToVector(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; std::string &gt; *out)</div><div class="ttdoc">Split a string using any of the single character delimiters. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00063">text-utils.cc:63</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7eac951c4af19775f3ba550efa12f385"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7eac951c4af19775f3ba550efa12f385">&#9670;&nbsp;</a></span>ParseFromString() <span class="overload">[3/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ParseFromString </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This version is for parameters of type BaseFloat. </p>

<p class="definition">Definition at line <a class="el" href="_2nnet-component_8cc_source.html#l00210">210</a> of file <a class="el" href="_2nnet-component_8cc_source.html">nnet-component.cc</a>.</p>

<p class="reference">References <a class="el" href="text-utils_8cc_source.html#l00238">kaldi::ConvertStringToReal()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, and <a class="el" href="text-utils_8cc_source.html#l00063">kaldi::SplitStringToVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                       {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  std::vector&lt;std::string&gt; split_string;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <a class="code" href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">SplitStringToVector</a>(*<span class="keywordtype">string</span>, <span class="stringliteral">&quot; \t&quot;</span>, <span class="keyword">true</span>,</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                      &amp;split_string);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  std::string name_equals = name + <span class="stringliteral">&quot;=&quot;</span>; <span class="comment">// the name and then the equals sign.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordtype">size_t</span> len = name_equals.length();</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span> (split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].compare(0, len, name_equals) == 0) {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#aa624cc5f189fcc01469558a0865c1f3c">ConvertStringToReal</a>(split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].substr(len), param))</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad option &quot;</span> &lt;&lt; split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      *<span class="keywordtype">string</span> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="comment">// Set &quot;string&quot; to all the pieces but the one we used.</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> != <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;          <span class="keywordflow">if</span> (!string-&gt;empty()) *<span class="keywordtype">string</span> += <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;          *<span class="keywordtype">string</span> += split_string[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_ac332ce23fcf74c011cfa83276cd08477"><div class="ttname"><a href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">kaldi::SplitStringToVector</a></div><div class="ttdeci">void SplitStringToVector(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; std::string &gt; *out)</div><div class="ttdoc">Split a string using any of the single character delimiters. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00063">text-utils.cc:63</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa624cc5f189fcc01469558a0865c1f3c"><div class="ttname"><a href="namespacekaldi.html#aa624cc5f189fcc01469558a0865c1f3c">kaldi::ConvertStringToReal</a></div><div class="ttdeci">bool ConvertStringToReal(const std::string &amp;str, T *out)</div><div class="ttdoc">ConvertStringToReal converts a string into either float or double and returns false if there was any ...</div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00238">text-utils.cc:238</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac5e10df5a302978244f7c6d78cefe0ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5e10df5a302978244f7c6d78cefe0ca">&#9670;&nbsp;</a></span>ParseFromString() <span class="overload">[4/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> kaldi::nnet2::ParseFromString </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component_8cc_source.html#l00236">236</a> of file <a class="el" href="_2nnet-component_8cc_source.html">nnet-component.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, and <a class="el" href="text-utils_8cc_source.html#l00063">kaldi::SplitStringToVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                                       {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  std::vector&lt;std::string&gt; split_string;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <a class="code" href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">SplitStringToVector</a>(*<span class="keywordtype">string</span>, <span class="stringliteral">&quot; \t&quot;</span>, <span class="keyword">true</span>,</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                      &amp;split_string);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  std::string name_equals = name + <span class="stringliteral">&quot;=&quot;</span>; <span class="comment">// the name and then the equals sign.</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordtype">size_t</span> len = name_equals.length();</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">if</span> (split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].compare(0, len, name_equals) == 0) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      *param = split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].substr(len);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="comment">// Set &quot;string&quot; to all the pieces but the one we used.</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      *<span class="keywordtype">string</span> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> != <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;          <span class="keywordflow">if</span> (!string-&gt;empty()) *<span class="keywordtype">string</span> += <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;          *<span class="keywordtype">string</span> += split_string[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_ac332ce23fcf74c011cfa83276cd08477"><div class="ttname"><a href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">kaldi::SplitStringToVector</a></div><div class="ttdeci">void SplitStringToVector(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; std::string &gt; *out)</div><div class="ttdoc">Split a string using any of the single character delimiters. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00063">text-utils.cc:63</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7f7f50f1457000af31efe2ecd53f983a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f7f50f1457000af31efe2ecd53f983a">&#9670;&nbsp;</a></span>ParseFromString() <span class="overload">[5/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> ParseFromString </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This version is for parameters of type std::vector&lt;int32&gt;; it expects them as a colon-separated list, without spaces. </p>

<p class="definition">Definition at line <a class="el" href="_2nnet-component_8cc_source.html#l00262">262</a> of file <a class="el" href="_2nnet-component_8cc_source.html">nnet-component.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="text-utils_8h_source.html#l00068">kaldi::SplitStringToIntegers()</a>, and <a class="el" href="text-utils_8cc_source.html#l00063">kaldi::SplitStringToVector()</a>.</p>
<div class="fragment"><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                                              {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  std::vector&lt;std::string&gt; split_string;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <a class="code" href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">SplitStringToVector</a>(*<span class="keywordtype">string</span>, <span class="stringliteral">&quot; \t&quot;</span>, <span class="keyword">true</span>,</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                      &amp;split_string);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  std::string name_equals = name + <span class="stringliteral">&quot;=&quot;</span>; <span class="comment">// the name and then the equals sign.</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">size_t</span> len = name_equals.length();</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordflow">if</span> (split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].compare(0, len, name_equals) == 0) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#ae95740f87fc2fb79419753e21396c647">SplitStringToIntegers</a>(split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].substr(len), <span class="stringliteral">&quot;:&quot;</span>,</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                 <span class="keyword">false</span>, param))</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad option &quot;</span> &lt;&lt; split_string[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      *<span class="keywordtype">string</span> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="comment">// Set &quot;string&quot; to all the pieces but the one we used.</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; split_string.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> != <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;          <span class="keywordflow">if</span> (!string-&gt;empty()) *<span class="keywordtype">string</span> += <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          *<span class="keywordtype">string</span> += split_string[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_ae95740f87fc2fb79419753e21396c647"><div class="ttname"><a href="namespacekaldi.html#ae95740f87fc2fb79419753e21396c647">kaldi::SplitStringToIntegers</a></div><div class="ttdeci">bool SplitStringToIntegers(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; I &gt; *out)</div><div class="ttdoc">Split a string (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8h_source.html#l00068">text-utils.h:68</a></div></div>
<div class="ttc" id="namespacekaldi_html_ac332ce23fcf74c011cfa83276cd08477"><div class="ttname"><a href="namespacekaldi.html#ac332ce23fcf74c011cfa83276cd08477">kaldi::SplitStringToVector</a></div><div class="ttdeci">void SplitStringToVector(const std::string &amp;full, const char *delim, bool omit_empty_strings, std::vector&lt; std::string &gt; *out)</div><div class="ttdoc">Split a string using any of the single character delimiters. </div><div class="ttdef"><b>Definition:</b> <a href="text-utils_8cc_source.html#l00063">text-utils.cc:63</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af25337b8d10c63cb5a7dfb06cb732f17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af25337b8d10c63cb5a7dfb06cb732f17">&#9670;&nbsp;</a></span>PreconditionDirections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PreconditionDirections </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lambda</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>P</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>See below for comment. </p>
<p>The function PreconditionDirections views the input R as a set of directions or gradients, each row r_i being one of the directions.</p>
<p>For each i it constructs a preconditioning matrix G_i formed from the *other* i's, using the formula:</p>
<p>G_i = ( I + (1/(N-1)) {j  i} r_j r_j^T)^{-1},</p>
<p>where N is the number of rows in R. This can be seen as a kind of estimated Fisher matrix that has been smoothed with the identity to make it invertible. We recommend that you set  using:  = /(N D) trace(R^T, R) for some small  such as  = 0.1. However, we leave this to the caller because there are reasons relating to unbiased-ness of the resulting stochastic gradient descent, why you might want to set  using "other" data, e.g. a previous minibatch.</p>
<p>The output of this function is a matrix P, each row p_i of which is related to r_i by: p_i = G_i r_i Here, p_i is preconditioned by an estimated Fisher matrix in such a way that it's suitable to be used as an update direction. </p>

<p class="definition">Definition at line <a class="el" href="nnet-precondition_8cc_source.html#l00026">26</a> of file <a class="el" href="nnet-precondition_8cc_source.html">nnet-precondition.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-vector_8cc_source.html#l00583">CuVectorBase&lt; Real &gt;::AddDiagMatMat()</a>, <a class="el" href="cu-matrix_8cc_source.html#l01278">CuMatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00570">CuMatrixBase&lt; Real &gt;::AddToDiag()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00339">CuMatrixBase&lt; Real &gt;::CopyFromMat()</a>, <a class="el" href="cu-matrix_8cc_source.html#l02936">CuMatrixBase&lt; Real &gt;::CopyLowerToUpper()</a>, <a class="el" href="kaldi-error_8h_source.html#l00057">kaldi::GetVerboseLevel()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00050">kaldi::kTakeLower</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="cu-matrix_8cc_source.html#l00779">CuMatrixBase&lt; Real &gt;::MulRowsVec()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="sp-matrix_8h_source.html#l00203">SpMatrix&lt; Real &gt;::PrintEigs()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l01065">kaldi::SameDim()</a>, <a class="el" href="cu-vector_8cc_source.html#l01181">CuVectorBase&lt; Real &gt;::Scale()</a>, <a class="el" href="cu-matrix_8cc_source.html#l01340">CuMatrixBase&lt; Real &gt;::SymAddMat2()</a>, <a class="el" href="cu-matrix_8cc_source.html#l02094">CuMatrixBase&lt; Real &gt;::SymInvertPosDef()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00037">kaldi::VecVec()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition_8cc_source.html#l00114">PreconditionDirectionsAlpha()</a>, <a class="el" href="nnet-precondition_8cc_source.html#l00138">PreconditionDirectionsAlphaRescaled()</a>, and <a class="el" href="nnet-precondition-test_8cc_source.html#l00026">UnitTestPreconditionDirections()</a>.</p>
<div class="fragment"><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                                                        {</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  </div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  int32 N = R.NumRows(), D = R.NumCols();</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">SameDim</a>(R, *P) &amp;&amp; N &gt; 0);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordflow">if</span> (N == 1) {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Trying to precondition set of only one frames: returning &quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;unchanged.  Ignore this warning if infrequent.&quot;</span>;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    P-&gt;CopyFromMat(R);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  }</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  CuMatrixBase&lt;BaseFloat&gt; &amp;Q = *P;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  </div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">if</span> (N &gt;= D) {</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="comment">// Compute G = (\lambda I + 1/(N-1) R^T R)^{-1} by direct inversion.</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// G &lt;-- lambda I.</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    CuMatrix&lt;BaseFloat&gt; G(D, D);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    G.AddToDiag(lambda);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// G += 1.0/(N-1) * R^T R.</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    G.SymAddMat2(1.0 / (N-1), R, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 1.0);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    G.CopyLowerToUpper();</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 5 &amp;&amp; <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20 == 0) {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      CuSpMatrix&lt;BaseFloat&gt; tmp(G, <a class="code" href="namespacekaldi.html#a1e7deac168cc2b1002cc25ab544d0f90ab23bc41c203345e3a080b4f011f7aa40">kTakeLower</a>);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      SpMatrix&lt;BaseFloat&gt; G_cpu(tmp);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      G_cpu.PrintEigs(<span class="stringliteral">&quot;G&quot;</span>);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    }</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    G.SymInvertPosDef();</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// Q &lt;-- R G^T (we just make it transposed as we think</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// it will be slightly faster; it&#39;s symmetric).</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    Q.AddMatMat(1.0, R, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, G, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// Through a lot of rearrangements, it turns out that</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// if we let  S = (\lambda I + 1/(N-1) R R^T)^{-1}</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// then what we need is</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// Q &lt;-- S R.</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// It is curious and (to me) unexpected that the actual code is basically</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// the same when transposed.</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    CuMatrix&lt;BaseFloat&gt; S(N, N);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// S &lt;-- lambda I.</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    S.AddToDiag(lambda);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// S += (N-1) R R^T.</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// the following function only updates the lower triangle.</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    S.SymAddMat2(1.0 / (N-1), R, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 1.0);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    S.CopyLowerToUpper();</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// invert S, so now S = (\lambda I + (N-1) R R^T)^{-1}.</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 5 &amp;&amp; <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20 == 0) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      CuSpMatrix&lt;BaseFloat&gt; tmp(S, <a class="code" href="namespacekaldi.html#a1e7deac168cc2b1002cc25ab544d0f90ab23bc41c203345e3a080b4f011f7aa40">kTakeLower</a>);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      SpMatrix&lt;BaseFloat&gt; S_cpu(tmp);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      S_cpu.PrintEigs(<span class="stringliteral">&quot;S&quot;</span>);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    }</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    S.SymInvertPosDef();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    Q.AddMatMat(1.0, S, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, R, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#if 0  // Old code before it was optimized for CUDA:</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; N; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    CuSubVector&lt;BaseFloat&gt; r(R, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>), q(Q, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> gamma = <a class="code" href="group__matrix__funcs__scalar.html#ga4750cd6f7a02a013435779588056b153">VecVec</a>(r, q), <span class="comment">// gamma_n = r_n^T q_n.</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;               beta = 1 + gamma / (N - 1 - gamma);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">if</span> (!(gamma &gt;= 0.0 &amp;&amp; beta &gt; 0.0)) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad values encountered in preconditioning: gamma = &quot;</span> &lt;&lt; gamma</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;, beta = &quot;</span> &lt;&lt; beta;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">// Q and P share the same memory.  The result of the</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// scaling below will be output as P.</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    q.Scale(beta);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  CuVector&lt;BaseFloat&gt; gamma(N);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  gamma.AddDiagMatMat(1.0, R, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, Q, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// at this point, gamma(i) equals the i&#39;th row of R dotted with</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">// the i&#39;th row of Q.</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  Vector&lt;BaseFloat&gt; cpu_gamma(gamma), cpu_beta(N, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; N; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> this_gamma = cpu_gamma(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>),</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        this_beta = 1.0 + this_gamma / (N - 1 - this_gamma);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">if</span> (!(this_gamma &gt;= 0.0 &amp;&amp; this_beta &gt; 0.0))</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Bad values encountered in preconditioning: gamma = &quot;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                &lt;&lt; this_gamma &lt;&lt; <span class="stringliteral">&quot;, beta = &quot;</span> &lt;&lt; this_beta;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    cpu_beta(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>) = this_beta;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  CuVector&lt;BaseFloat&gt; beta(cpu_beta);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  P-&gt;MulRowsVec(beta);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="group__error__group_html_gae77f5cf98f18f8cbe207690e49da166e"><div class="ttname"><a href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">kaldi::GetVerboseLevel</a></div><div class="ttdeci">int32 GetVerboseLevel()</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00057">kaldi-error.h:57</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="group__matrix__funcs__io_html_ga07b147212efb08775c252cd4cc7453fe"><div class="ttname"><a href="group__matrix__funcs__io.html#ga07b147212efb08775c252cd4cc7453fe">kaldi::SameDim</a></div><div class="ttdeci">bool SameDim(const MatrixBase&lt; Real &gt; &amp;M, const MatrixBase&lt; Real &gt; &amp;N)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l01065">kaldi-matrix.h:1065</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a1e7deac168cc2b1002cc25ab544d0f90ab23bc41c203345e3a080b4f011f7aa40"><div class="ttname"><a href="namespacekaldi.html#a1e7deac168cc2b1002cc25ab544d0f90ab23bc41c203345e3a080b4f011f7aa40">kaldi::kTakeLower</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00050">matrix-common.h:50</a></div></div>
<div class="ttc" id="group__matrix__funcs__scalar_html_ga4750cd6f7a02a013435779588056b153"><div class="ttname"><a href="group__matrix__funcs__scalar.html#ga4750cd6f7a02a013435779588056b153">kaldi::VecVec</a></div><div class="ttdeci">Real VecVec(const VectorBase&lt; Real &gt; &amp;a, const VectorBase&lt; Real &gt; &amp;b)</div><div class="ttdoc">Returns dot product between v1 and v2. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00037">kaldi-vector.cc:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4a199b32ed158301df174b4b4a52edb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a199b32ed158301df174b4b4a52edb2">&#9670;&nbsp;</a></span>PreconditionDirectionsAlpha()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PreconditionDirectionsAlpha </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>P</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This wrapper for PreconditionDirections computes lambda using  = /(N D) trace(R^T, R), and calls PreconditionDirections. </p>

<p class="definition">Definition at line <a class="el" href="nnet-precondition_8cc_source.html#l00114">114</a> of file <a class="el" href="nnet-precondition_8cc_source.html">nnet-precondition.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="nnet-precondition_8cc_source.html#l00026">PreconditionDirections()</a>, and <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>.</p>
<div class="fragment"><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                                {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(alpha &gt; 0.0);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="comment">// probably does not really make sense.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordtype">double</span> t = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(R, R, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>), floor = 1.0e-20;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordflow">if</span> (t &lt; floor) {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Flooring trace from &quot;</span> &lt;&lt; t</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; floor;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    t = floor;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordtype">double</span> lambda = t * alpha / R.NumRows() / R.NumCols();</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="comment">// see the extended comment below for an explanation of this.</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordflow">if</span> (lambda &lt;= 0.0) {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// This should never really happen, it would probably indicate a bug</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// in the calling code.</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Zero or negative lambda in PreconditionDirectionsAlpha.&quot;</span>;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    lambda = 1.0e-10;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#af25337b8d10c63cb5a7dfb06cb732f17">PreconditionDirections</a>(R, lambda, P);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_af25337b8d10c63cb5a7dfb06cb732f17"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#af25337b8d10c63cb5a7dfb06cb732f17">kaldi::nnet2::PreconditionDirections</a></div><div class="ttdeci">void PreconditionDirections(const CuMatrixBase&lt; BaseFloat &gt; &amp;R, double lambda, CuMatrixBase&lt; BaseFloat &gt; *P)</div><div class="ttdoc">See below for comment. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition_8cc_source.html#l00026">nnet-precondition.cc:26</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8d1d9b8171ab8e9a3c26bf3160f774fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d1d9b8171ab8e9a3c26bf3160f774fc">&#9670;&nbsp;</a></span>PreconditionDirectionsAlphaRescaled()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PreconditionDirectionsAlphaRescaled </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>P</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This wrapper for PreconditionDirections computes lambda using  = /(N D) trace(R^T, R), and calls PreconditionDirections. </p>
<p>It then rescales *P so that its 2-norm is the same as that of R. </p>

<p class="definition">Definition at line <a class="el" href="nnet-precondition_8cc_source.html#l00138">138</a> of file <a class="el" href="nnet-precondition_8cc_source.html">nnet-precondition.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrix_8cc_source.html#l00339">CuMatrixBase&lt; Real &gt;::CopyFromMat()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="nnet-precondition_8cc_source.html#l00026">PreconditionDirections()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00610">CuMatrixBase&lt; Real &gt;::Scale()</a>, and <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component_8cc_source.html#l01544">AffineComponentPreconditioned::Update()</a>, and <a class="el" href="_2nnet-component_8cc_source.html#l02253">BlockAffineComponentPreconditioned::Update()</a>.</p>
<div class="fragment"><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                                {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(alpha &gt; 0.0); <span class="comment">// alpha &gt; 1.0</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">// probably does not really make sense.</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordtype">double</span> t = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(R, R, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>), floor = 1.0e-20;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">if</span> (t == 0.0) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    P-&gt;CopyFromMat(R);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordflow">if</span> (t &lt; floor) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Flooring trace from &quot;</span> &lt;&lt; t</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; floor;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    t = floor;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordtype">double</span> lambda = t * alpha / R.NumRows() / R.NumCols();</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">// see the extended comment below for an explanation of this.</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(lambda != 0.0);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#af25337b8d10c63cb5a7dfb06cb732f17">PreconditionDirections</a>(R, lambda, P);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordtype">double</span> p_trace = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(*P, *P, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>),</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      rescale = sqrt(t / p_trace);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(p_trace != 0.0);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  P-&gt;Scale(rescale);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_af25337b8d10c63cb5a7dfb06cb732f17"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#af25337b8d10c63cb5a7dfb06cb732f17">kaldi::nnet2::PreconditionDirections</a></div><div class="ttdeci">void PreconditionDirections(const CuMatrixBase&lt; BaseFloat &gt; &amp;R, double lambda, CuMatrixBase&lt; BaseFloat &gt; *P)</div><div class="ttdoc">See below for comment. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition_8cc_source.html#l00026">nnet-precondition.cc:26</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a880911e40d95a819b4d844364ce8efbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a880911e40d95a819b4d844364ce8efbb">&#9670;&nbsp;</a></span>PrintPriorDiagnostics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::PrintPriorDiagnostics </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>old_priors</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>new_priors</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-adjust-priors_8cc_source.html#l00048">48</a> of file <a class="el" href="nnet-adjust-priors_8cc_source.html">nnet-adjust-priors.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8cc_source.html#l01043">VectorBase&lt; Real &gt;::AddVec()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00812">VectorBase&lt; Real &gt;::ApplyAbs()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="nnet-adjust-priors_8cc_source.html#l00031">KlDivergence()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00579">VectorBase&lt; Real &gt;::Max()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-adjust-priors_8cc_source.html#l00070">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                                                {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">if</span> (old_priors.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>() == 0) {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Model did not previously have priors attached.&quot;</span>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> diff_prior(new_priors);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    diff_prior.AddVec(-1.0, old_priors);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    diff_prior.ApplyAbs();</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    int32 max_index;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    diff_prior.Max(&amp;max_index);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Adjusting priors: largest absolute difference was for &quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;pdf &quot;</span> &lt;&lt; max_index &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; old_priors(max_index)</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; new_priors(max_index);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Adjusting priors: K-L divergence from old to new is &quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;              &lt;&lt; <a class="code" href="namespacekaldi_1_1nnet2.html#a6efb3388f9385fddcae0b3087be5d5e4">KlDivergence</a>(old_priors, new_priors);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  }</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_a6efb3388f9385fddcae0b3087be5d5e4"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a6efb3388f9385fddcae0b3087be5d5e4">kaldi::nnet2::KlDivergence</a></div><div class="ttdeci">BaseFloat KlDivergence(const Vector&lt; BaseFloat &gt; &amp;p, const Vector&lt; BaseFloat &gt; &amp;q)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-adjust-priors_8cc_source.html#l00031">nnet-adjust-priors.cc:31</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::VectorBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Returns the dimension of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00063">kaldi-vector.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a861f24cf478a9cb02c1e0b1c39ea65be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a861f24cf478a9cb02c1e0b1c39ea65be">&#9670;&nbsp;</a></span>ProcessFile() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet2::ProcessFile </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>feats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> &amp;&#160;</td>
          <td class="paramname"><em>pdf_post</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>utt_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>left_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>right_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_frames</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>const_feat_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64 *&#160;</td>
          <td class="paramname"><em>num_frames_written</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64 *&#160;</td>
          <td class="paramname"><em>num_egs_written</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi_1_1nnet2.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a> *&#160;</td>
          <td class="paramname"><em>example_writer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-get-egs_8cc_source.html#l00032">32</a> of file <a class="el" href="nnet-get-egs_8cc_source.html">nnet-get-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet2_2nnet-example_8h_source.html#l00049">NnetExample::input_frames</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00043">NnetExample::labels</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00053">NnetExample::left_context</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00058">NnetExample::spk_info</a>, and <a class="el" href="kaldi-table-inl_8h_source.html#l01511">TableWriter&lt; Holder &gt;::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-get-egs_8cc_source.html#l00094">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                                                           {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() == <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(pdf_post.size()));</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  int32 feat_dim = feats.<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>();</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(const_feat_dim &lt; feat_dim);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_frames &gt; 0);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  int32 basic_feat_dim = feat_dim - const_feat_dim;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">for</span> (int32 t = 0; t &lt; feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>(); t += num_frames) {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    int32 this_num_frames = std::min(num_frames,</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                                     feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() - t);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    int32 tot_frames = left_context + this_num_frames + right_context;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> eg;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> input_frames(tot_frames, basic_feat_dim);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    eg.<a class="code" href="structkaldi_1_1nnet2_1_1NnetExample.html#a9e87cd6f9e107e7ba9235a3acd722fe1">left_context</a> = left_context;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    eg.<a class="code" href="structkaldi_1_1nnet2_1_1NnetExample.html#ad870f332576dd0b02de55b901f64de52">spk_info</a>.Resize(const_feat_dim);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// Set up &quot;input_frames&quot;.</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = -left_context; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; this_num_frames + right_context; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      int32 t2 = <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> + t;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <span class="keywordflow">if</span> (t2 &lt; 0) t2 = 0;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <span class="keywordflow">if</span> (t2 &gt;= feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>()) t2 = feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() - 1;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> src(feats.<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(t2), 0, basic_feat_dim),</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;          dest(input_frames, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> + left_context);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      dest.CopyFromVec(src);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <span class="keywordflow">if</span> (const_feat_dim &gt; 0) {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> src(feats.<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(t2), basic_feat_dim, const_feat_dim);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="comment">// set eg.spk_info to the average of the corresponding dimensions of</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="comment">// the input, taken over the frames whose features we store in the eg.</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        eg.<a class="code" href="structkaldi_1_1nnet2_1_1NnetExample.html#ad870f332576dd0b02de55b901f64de52">spk_info</a>.AddVec(1.0 / tot_frames, src);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    eg.<a class="code" href="structkaldi_1_1nnet2_1_1NnetExample.html#a5ddc6331da8c33eab557d7742682463c">labels</a>.resize(this_num_frames);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; this_num_frames; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      eg.<a class="code" href="structkaldi_1_1nnet2_1_1NnetExample.html#a5ddc6331da8c33eab557d7742682463c">labels</a>[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = pdf_post[t + <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    eg.<a class="code" href="structkaldi_1_1nnet2_1_1NnetExample.html#a0e6b48833bfe348d6cdc6473c94fdbae">input_frames</a> = input_frames;  <span class="comment">// Copy to CompressedMatrix.</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    </div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    std::ostringstream os;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    os &lt;&lt; utt_id &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; t;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    std::string key = os.str(); <span class="comment">// key is &lt;utt_id&gt;-&lt;frame_id&gt;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    *num_frames_written += this_num_frames;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    *num_egs_written += 1;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    example_writer-&gt;<a class="code" href="group__table__impl__types.html#ga383075d0a2cc01259054d4fde207f637">Write</a>(key, eg);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet2_1_1NnetExample_html_a0e6b48833bfe348d6cdc6473c94fdbae"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1NnetExample.html#a0e6b48833bfe348d6cdc6473c94fdbae">kaldi::nnet2::NnetExample::input_frames</a></div><div class="ttdeci">CompressedMatrix input_frames</div><div class="ttdoc">The input data, with NumRows() &gt;= labels.size() + left_context; it includes features to the left and ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-example_8h_source.html#l00049">nnet-example.h:49</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1NnetExample_html"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1NnetExample.html">kaldi::nnet2::NnetExample</a></div><div class="ttdoc">NnetExample is the input data and corresponding label (or labels) for one or more frames of input...</div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-example_8h_source.html#l00036">nnet-example.h:36</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::MatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdoc">Returns number of columns (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00064">kaldi-matrix.h:64</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1NnetExample_html_a9e87cd6f9e107e7ba9235a3acd722fe1"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1NnetExample.html#a9e87cd6f9e107e7ba9235a3acd722fe1">kaldi::nnet2::NnetExample::left_context</a></div><div class="ttdeci">int32 left_context</div><div class="ttdoc">The number of frames of left context (we can work out the #frames of right context from input_frames...</div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-example_8h_source.html#l00053">nnet-example.h:53</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="group__table__impl__types_html_ga383075d0a2cc01259054d4fde207f637"><div class="ttname"><a href="group__table__impl__types.html#ga383075d0a2cc01259054d4fde207f637">kaldi::TableWriter::Write</a></div><div class="ttdeci">void Write(const std::string &amp;key, const T &amp;value) const</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-table-inl_8h_source.html#l01511">kaldi-table-inl.h:1511</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_afb93e5db62adee40ee68bbec3751443f"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">kaldi::MatrixBase::Row</a></div><div class="ttdeci">const SubVector&lt; Real &gt; Row(MatrixIndexT i) const</div><div class="ttdoc">Return specific row of matrix [const]. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00185">kaldi-matrix.h:185</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::MatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Returns number of rows (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00061">kaldi-matrix.h:61</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1NnetExample_html_a5ddc6331da8c33eab557d7742682463c"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1NnetExample.html#a5ddc6331da8c33eab557d7742682463c">kaldi::nnet2::NnetExample::labels</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::pair&lt; int32, BaseFloat &gt; &gt; &gt; labels</div><div class="ttdoc">The label(s) for each frame in a sequence of frames; in the normal case, this will be just [ [ (pdf-i...</div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-example_8h_source.html#l00043">nnet-example.h:43</a></div></div>
<div class="ttc" id="classkaldi_1_1SubVector_html"><div class="ttname"><a href="classkaldi_1_1SubVector.html">kaldi::SubVector</a></div><div class="ttdoc">Represents a non-allocating general vector which can be defined as a sub-vector of higher-level vecto...</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00485">kaldi-vector.h:485</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1NnetExample_html_ad870f332576dd0b02de55b901f64de52"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1NnetExample.html#ad870f332576dd0b02de55b901f64de52">kaldi::nnet2::NnetExample::spk_info</a></div><div class="ttdeci">Vector&lt; BaseFloat &gt; spk_info</div><div class="ttdoc">The speaker-specific input, if any, or an empty vector if we&amp;#39;re not using this features. </div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-example_8h_source.html#l00058">nnet-example.h:58</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aed36521b08bfc3cf9f850e9fdc963976"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed36521b08bfc3cf9f850e9fdc963976">&#9670;&nbsp;</a></span>ProcessFile() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kaldi::nnet2::ProcessFile </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>feats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> &amp;&#160;</td>
          <td class="paramname"><em>pdf_post</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>utt_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>weights</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>left_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>right_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>const_feat_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>keep_proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>weight_threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>use_frame_selection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>use_frame_weights</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64 *&#160;</td>
          <td class="paramname"><em>num_frames_written</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64 *&#160;</td>
          <td class="paramname"><em>num_frames_skipped</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi_1_1nnet2.html#af2246cc04a2596de3c09fad3c3513671">NnetExampleWriter</a> *&#160;</td>
          <td class="paramname"><em>example_writer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-get-weighted-egs_8cc_source.html#l00045">45</a> of file <a class="el" href="nnet-get-weighted-egs_8cc_source.html">nnet-get-weighted-egs.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8cc_source.html#l00228">VectorBase&lt; Real &gt;::CopyFromVec()</a>, <a class="el" href="arpa-file-parser-test_8cc_source.html#l00066">count</a>, <a class="el" href="nnet-copy-egs-discriminative_8cc_source.html#l00031">GetCount()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00049">NnetExample::input_frames</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00043">NnetExample::labels</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00053">NnetExample::left_context</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00058">NnetExample::spk_info</a>, and <a class="el" href="kaldi-table-inl_8h_source.html#l01511">TableWriter&lt; Holder &gt;::Write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                                                           {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() == <span class="keyword">static_cast&lt;</span>int32<span class="keyword">&gt;</span>(pdf_post.size()));</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  int32 feat_dim = feats.<a class="code" href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">NumCols</a>();</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(const_feat_dim &lt; feat_dim);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  int32 basic_feat_dim = feat_dim - const_feat_dim;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <a class="code" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> eg;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> input_frames(left_context + 1 + right_context,</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                                 basic_feat_dim);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  eg.<a class="code" href="structkaldi_1_1nnet2_1_1NnetExample.html#a9e87cd6f9e107e7ba9235a3acd722fe1">left_context</a> = left_context;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">// TODO: modify this code, and this binary itself, to support the --num-frames</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">// option to allow multiple frames per eg.</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    int32 <a class="code" href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a> = <a class="code" href="namespacekaldi_1_1nnet2.html#abcaa21a4f5d88c32a8f3066fa74d0343">GetCount</a>(keep_proportion); <span class="comment">// number of times</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// we&#39;ll write this out (1 by default).</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">if</span> (count &gt; 0) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="comment">// Set up &quot;input_frames&quot;.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = -left_context; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;= right_context; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        int32 j2 = <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> + <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">if</span> (j2 &lt; 0) j2 = 0;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keywordflow">if</span> (j2 &gt;= feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>()) j2 = feats.<a class="code" href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() - 1;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> src(feats, j2), dest(input_frames,</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                                                  <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> + left_context);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        dest.CopyFromVec(src);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      }</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      eg.<a class="code" href="structkaldi_1_1nnet2_1_1NnetExample.html#a5ddc6331da8c33eab557d7742682463c">labels</a>.push_back(pdf_post[i]);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      eg.<a class="code" href="structkaldi_1_1nnet2_1_1NnetExample.html#a0e6b48833bfe348d6cdc6473c94fdbae">input_frames</a> = input_frames;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      <span class="keywordflow">if</span> (const_feat_dim &gt; 0) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="comment">// we&#39;ll normally reach here if we&#39;re using online-estimated iVectors.</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> const_part(feats.<a class="code" href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">Row</a>(i),</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                                        basic_feat_dim, const_feat_dim);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        eg.<a class="code" href="structkaldi_1_1nnet2_1_1NnetExample.html#ad870f332576dd0b02de55b901f64de52">spk_info</a>.CopyFromVec(const_part);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="keywordflow">if</span> (use_frame_selection) {</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">if</span> (weights(i) &lt; weight_threshold) {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;          (*num_frames_skipped)++;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        }</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      std::ostringstream os;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      os &lt;&lt; utt_id &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      std::string key = os.str(); <span class="comment">// key in the archive is the number of the example</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="keywordflow">for</span> (int32 c = 0; c &lt; <a class="code" href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a>; c++)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        example_writer-&gt;<a class="code" href="group__table__impl__types.html#ga383075d0a2cc01259054d4fde207f637">Write</a>(key, eg);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;}</div><div class="ttc" id="structkaldi_1_1nnet2_1_1NnetExample_html_a0e6b48833bfe348d6cdc6473c94fdbae"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1NnetExample.html#a0e6b48833bfe348d6cdc6473c94fdbae">kaldi::nnet2::NnetExample::input_frames</a></div><div class="ttdeci">CompressedMatrix input_frames</div><div class="ttdoc">The input data, with NumRows() &gt;= labels.size() + left_context; it includes features to the left and ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-example_8h_source.html#l00049">nnet-example.h:49</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1NnetExample_html"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1NnetExample.html">kaldi::nnet2::NnetExample</a></div><div class="ttdoc">NnetExample is the input data and corresponding label (or labels) for one or more frames of input...</div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-example_8h_source.html#l00036">nnet-example.h:36</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_acd4c9f53536602585f5aff9e8005299a"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#acd4c9f53536602585f5aff9e8005299a">kaldi::MatrixBase::NumCols</a></div><div class="ttdeci">MatrixIndexT NumCols() const</div><div class="ttdoc">Returns number of columns (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00064">kaldi-matrix.h:64</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1NnetExample_html_a9e87cd6f9e107e7ba9235a3acd722fe1"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1NnetExample.html#a9e87cd6f9e107e7ba9235a3acd722fe1">kaldi::nnet2::NnetExample::left_context</a></div><div class="ttdeci">int32 left_context</div><div class="ttdoc">The number of frames of left context (we can work out the #frames of right context from input_frames...</div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-example_8h_source.html#l00053">nnet-example.h:53</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="group__table__impl__types_html_ga383075d0a2cc01259054d4fde207f637"><div class="ttname"><a href="group__table__impl__types.html#ga383075d0a2cc01259054d4fde207f637">kaldi::TableWriter::Write</a></div><div class="ttdeci">void Write(const std::string &amp;key, const T &amp;value) const</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-table-inl_8h_source.html#l01511">kaldi-table-inl.h:1511</a></div></div>
<div class="ttc" id="arpa-file-parser-test_8cc_html_a951345011b75d2e8d9bfc18ca63510d2"><div class="ttname"><a href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a></div><div class="ttdeci">const size_t count</div><div class="ttdef"><b>Definition:</b> <a href="arpa-file-parser-test_8cc_source.html#l00066">arpa-file-parser-test.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_afb93e5db62adee40ee68bbec3751443f"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#afb93e5db62adee40ee68bbec3751443f">kaldi::MatrixBase::Row</a></div><div class="ttdeci">const SubVector&lt; Real &gt; Row(MatrixIndexT i) const</div><div class="ttdoc">Return specific row of matrix [const]. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00185">kaldi-matrix.h:185</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1MatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1MatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::MatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Returns number of rows (or zero for emtpy matrix). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8h_source.html#l00061">kaldi-matrix.h:61</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1NnetExample_html_a5ddc6331da8c33eab557d7742682463c"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1NnetExample.html#a5ddc6331da8c33eab557d7742682463c">kaldi::nnet2::NnetExample::labels</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::pair&lt; int32, BaseFloat &gt; &gt; &gt; labels</div><div class="ttdoc">The label(s) for each frame in a sequence of frames; in the normal case, this will be just [ [ (pdf-i...</div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-example_8h_source.html#l00043">nnet-example.h:43</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_abcaa21a4f5d88c32a8f3066fa74d0343"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#abcaa21a4f5d88c32a8f3066fa74d0343">kaldi::nnet2::GetCount</a></div><div class="ttdeci">int32 GetCount(double expected_count)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-copy-egs-discriminative_8cc_source.html#l00031">nnet-copy-egs-discriminative.cc:31</a></div></div>
<div class="ttc" id="classkaldi_1_1SubVector_html"><div class="ttname"><a href="classkaldi_1_1SubVector.html">kaldi::SubVector</a></div><div class="ttdoc">Represents a non-allocating general vector which can be defined as a sub-vector of higher-level vecto...</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00485">kaldi-vector.h:485</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1NnetExample_html_ad870f332576dd0b02de55b901f64de52"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1NnetExample.html#ad870f332576dd0b02de55b901f64de52">kaldi::nnet2::NnetExample::spk_info</a></div><div class="ttdeci">Vector&lt; BaseFloat &gt; spk_info</div><div class="ttdoc">The speaker-specific input, if any, or an empty vector if we&amp;#39;re not using this features. </div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-example_8h_source.html#l00058">nnet-example.h:58</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a343d868474474434765c0d85d62c27ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a343d868474474434765c0d85d62c27ad">&#9670;&nbsp;</a></span>ReplaceLastComponents()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ReplaceLastComponents </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>src_nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_to_remove</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>dest_nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Removes the last "num_to_remove" components and adds the components from "src_nnet". </p>

<p class="definition">Definition at line <a class="el" href="nnet-functions_8cc_source.html#l00058">58</a> of file <a class="el" href="nnet-functions_8cc_source.html">nnet-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="classkaldi_1_1nnet2_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Component::Copy()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00281">Nnet::Init()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-replace-last-layers_8cc_source.html#l00027">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                                            {</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_to_remove &gt;= 0 &amp;&amp; num_to_remove &lt;= dest_nnet-&gt;NumComponents());</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  int32 c_orig = dest_nnet-&gt;NumComponents() - num_to_remove;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  std::vector&lt;Component*&gt; components;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; c_orig; c++)</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    components.push_back(dest_nnet-&gt;GetComponent(c).Copy());</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; src_nnet.NumComponents(); c++)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    components.push_back(src_nnet.GetComponent(c).Copy());</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">// Re-initialize &quot;dest_nnet&quot; from the resulting list of components.</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">// The Init method will take ownership of the pointers in the vector:</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  dest_nnet-&gt;Init(&amp;components);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adea380e52ef5a0a021e422f976716ab9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adea380e52ef5a0a021e422f976716ab9">&#9670;&nbsp;</a></span>RescaleNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RescaleNnet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetRescaleConfig.html">NnetRescaleConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>rescale_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>examples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="rescale-nnet_8cc_source.html#l00218">218</a> of file <a class="el" href="rescale-nnet_8cc_source.html">rescale-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="rescale-nnet_8cc_source.html#l00200">NnetRescaler::Rescale()</a>.</p>

<p class="reference">Referenced by <a class="el" href="rescale-nnet_8h_source.html#l00057">NnetRescaleConfig::Register()</a>.</p>
<div class="fragment"><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                             {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  NnetRescaler rescaler(rescale_config, examples, nnet);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  rescaler.Rescale();</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a4799af744c68a53e61dbb825cb7a0426"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4799af744c68a53e61dbb825cb7a0426">&#9670;&nbsp;</a></span>SetMaxChange()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::SetMaxChange </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>max_change</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-modify-learning-rates_8cc_source.html#l00029">29</a> of file <a class="el" href="nnet-modify-learning-rates_8cc_source.html">nnet-modify-learning-rates.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>, and <a class="el" href="_2nnet-component_8h_source.html#l00965">AffineComponentPreconditioned::SetMaxChange()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-modify-learning-rates_8cc_source.html#l00041">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                                                    {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#a15b5336b4413124b1fd4531f57781182">NumComponents</a>(); c++) {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1Component.html">Component</a> *component = &amp;(nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#a2ca49ace44ae43cfe343c090ea8b224f">GetComponent</a>(c));</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html">AffineComponentPreconditioned</a> *ac =</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html">AffineComponentPreconditioned</a>*<span class="keyword">&gt;</span>(component);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">if</span> (ac != NULL)</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;      ac-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html#ae7c390eb6ad357d73403c1f139dac757">SetMaxChange</a>(max_change);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  }</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html_a2ca49ace44ae43cfe343c090ea8b224f"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html#a2ca49ace44ae43cfe343c090ea8b224f">kaldi::nnet2::Nnet::GetComponent</a></div><div class="ttdeci">const Component &amp; GetComponent(int32 c) const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00141">nnet-nnet.cc:141</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html">kaldi::nnet2::AffineComponentPreconditioned</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00948">nnet-component.h:948</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Component_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Component.html">kaldi::nnet2::Component</a></div><div class="ttdoc">Abstract class, basic element of the network, it is a box with defined inputs, outputs, and tranformation functions interface. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00157">nnet-component.h:157</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html_a15b5336b4413124b1fd4531f57781182"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html#a15b5336b4413124b1fd4531f57781182">kaldi::nnet2::Nnet::NumComponents</a></div><div class="ttdeci">int32 NumComponents() const</div><div class="ttdoc">Returns number of components think of this as similar to # of layers, but e.g. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00069">nnet-nnet.h:69</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned_html_ae7c390eb6ad357d73403c1f139dac757"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html#ae7c390eb6ad357d73403c1f139dac757">kaldi::nnet2::AffineComponentPreconditioned::SetMaxChange</a></div><div class="ttdeci">void SetMaxChange(BaseFloat max_change)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00965">nnet-component.h:965</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aacf76cbfac182afbc1e1cf03166f1401"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacf76cbfac182afbc1e1cf03166f1401">&#9670;&nbsp;</a></span>SetPriors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::SetPriors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>tmodel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>transition_accs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>prior_floor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1AmNnet.html">AmNnet</a> *&#160;</td>
          <td class="paramname"><em>am_nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-train-transitions_8cc_source.html#l00028">28</a> of file <a class="el" href="nnet-train-transitions_8cc_source.html">nnet-train-transitions.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="am-nnet_8h_source.html#l00055">AmNnet::NumPdfs()</a>, <a class="el" href="transition-model_8h_source.html#l00185">TransitionModel::NumPdfs()</a>, <a class="el" href="am-nnet_8cc_source.html#l00044">AmNnet::SetPriors()</a>, and <a class="el" href="transition-model_8h_source.html#l00324">TransitionModel::TransitionIdToPdf()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-train-transitions_8cc_source.html#l00053">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                                {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(tmodel.<a class="code" href="classkaldi_1_1TransitionModel.html#ae13f7c74eb93b128c78b90e2131a8e70">NumPdfs</a>() == am_nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1AmNnet.html#ae13f7c74eb93b128c78b90e2131a8e70">NumPdfs</a>());</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> pdf_counts(tmodel.<a class="code" href="classkaldi_1_1TransitionModel.html#ae13f7c74eb93b128c78b90e2131a8e70">NumPdfs</a>());</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(transition_accs(0) == 0.0); <span class="comment">// There is</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="comment">// no zero transition-id.</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordflow">for</span> (int32 tid = 1; tid &lt; transition_accs.<a class="code" href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">Dim</a>(); tid++) {</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    int32 pdf = tmodel.<a class="code" href="group__hmm__group.html#ga53ec248f5bb23021e89d571c7063b108">TransitionIdToPdf</a>(tid);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    pdf_counts(pdf) += transition_accs(tid);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  }</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> sum = pdf_counts.Sum();</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(sum != 0.0);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(prior_floor &gt; 0.0 &amp;&amp; prior_floor &lt; 1.0);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  pdf_counts.Scale(1.0 / sum);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  pdf_counts.ApplyFloor(prior_floor);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  pdf_counts.Scale(1.0 / pdf_counts.Sum()); <span class="comment">// normalize again.</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  am_nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1AmNnet.html#a9ab18efc13ed11baec71f29801c3addb">SetPriors</a>(pdf_counts);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}               </div><div class="ttc" id="group__hmm__group_html_ga53ec248f5bb23021e89d571c7063b108"><div class="ttname"><a href="group__hmm__group.html#ga53ec248f5bb23021e89d571c7063b108">kaldi::TransitionModel::TransitionIdToPdf</a></div><div class="ttdeci">int32 TransitionIdToPdf(int32 trans_id) const</div><div class="ttdef"><b>Definition:</b> <a href="transition-model_8h_source.html#l00324">transition-model.h:324</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1VectorBase_html_af3d58f15749a15d89b0ec5819dd7b7f2"><div class="ttname"><a href="classkaldi_1_1VectorBase.html#af3d58f15749a15d89b0ec5819dd7b7f2">kaldi::VectorBase::Dim</a></div><div class="ttdeci">MatrixIndexT Dim() const</div><div class="ttdoc">Returns the dimension of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00063">kaldi-vector.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AmNnet_html_ae13f7c74eb93b128c78b90e2131a8e70"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AmNnet.html#ae13f7c74eb93b128c78b90e2131a8e70">kaldi::nnet2::AmNnet::NumPdfs</a></div><div class="ttdeci">int32 NumPdfs() const</div><div class="ttdef"><b>Definition:</b> <a href="am-nnet_8h_source.html#l00055">am-nnet.h:55</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AmNnet_html_a9ab18efc13ed11baec71f29801c3addb"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AmNnet.html#a9ab18efc13ed11baec71f29801c3addb">kaldi::nnet2::AmNnet::SetPriors</a></div><div class="ttdeci">void SetPriors(const VectorBase&lt; BaseFloat &gt; &amp;priors)</div><div class="ttdef"><b>Definition:</b> <a href="am-nnet_8cc_source.html#l00044">am-nnet.cc:44</a></div></div>
<div class="ttc" id="classkaldi_1_1TransitionModel_html_ae13f7c74eb93b128c78b90e2131a8e70"><div class="ttname"><a href="classkaldi_1_1TransitionModel.html#ae13f7c74eb93b128c78b90e2131a8e70">kaldi::TransitionModel::NumPdfs</a></div><div class="ttdeci">int32 NumPdfs() const</div><div class="ttdef"><b>Definition:</b> <a href="transition-model_8h_source.html#l00185">transition-model.h:185</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7e858446644e4e4190b19ff73ce568d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e858446644e4e4190b19ff73ce568d7">&#9670;&nbsp;</a></span>ShrinkNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ShrinkNnet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetShrinkConfig.html">NnetShrinkConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>shrink_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>validation_set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="shrink-nnet_8cc_source.html#l00066">66</a> of file <a class="el" href="shrink-nnet_8cc_source.html">shrink-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8cc_source.html#l00805">VectorBase&lt; Real &gt;::ApplyExp()</a>, <a class="el" href="combine-nnet-a_8cc_source.html#l00061">ComputeObjfAndGradient()</a>, <a class="el" href="optimization_8cc_source.html#l00383">OptimizeLbfgs&lt; Real &gt;::DoStep()</a>, <a class="el" href="optimization_8h_source.html#l00090">LbfgsOptions::first_step_length</a>, <a class="el" href="optimization_8h_source.html#l00134">OptimizeLbfgs&lt; Real &gt;::GetProposedValue()</a>, <a class="el" href="optimization_8cc_source.html#l00416">OptimizeLbfgs&lt; Real &gt;::GetValue()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="shrink-nnet_8h_source.html#l00039">NnetShrinkConfig::initial_step</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>, <a class="el" href="optimization_8h_source.html#l00086">LbfgsOptions::m</a>, <a class="el" href="optimization_8h_source.html#l00085">LbfgsOptions::minimize</a>, <a class="el" href="shrink-nnet_8h_source.html#l00034">NnetShrinkConfig::num_bfgs_iters</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00413">Nnet::NumUpdatableComponents()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00421">Nnet::ScaleComponents()</a>.</p>

<p class="reference">Referenced by <a class="el" href="shrink-nnet_8h_source.html#l00042">NnetShrinkConfig::Register()</a>.</p>
<div class="fragment"><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                            {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  int32 dim = nnet-&gt;NumUpdatableComponents();</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(dim &gt; 0);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  Vector&lt;double&gt; log_scale(dim), gradient(dim); <span class="comment">// will be zero.</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  </div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="comment">// Get initial gradient.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordtype">double</span> objf, initial_objf;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  LbfgsOptions lbfgs_options;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  lbfgs_options.minimize = <span class="keyword">false</span>; <span class="comment">// We&#39;re maximizing.</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  lbfgs_options.m = dim; <span class="comment">// Store the same number of vectors as the dimension</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">// itself, so this is BFGS.</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  lbfgs_options.first_step_length = shrink_config.initial_step;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  </div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  OptimizeLbfgs&lt;double&gt; lbfgs(log_scale,</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                              lbfgs_options);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  </div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; shrink_config.num_bfgs_iters; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    log_scale.CopyFromVec(lbfgs.GetProposedValue());</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    objf = <a class="code" href="namespacekaldi_1_1nnet2.html#ac44c6079a65265ad03f7e7d03a598b9f">ComputeObjfAndGradient</a>(validation_set, log_scale,</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                                  *nnet,</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                                  &amp;gradient);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(2) &lt;&lt; <span class="stringliteral">&quot;log-scale = &quot;</span> &lt;&lt; log_scale &lt;&lt; <span class="stringliteral">&quot;, objf = &quot;</span> &lt;&lt; objf</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;, gradient = &quot;</span> &lt;&lt; gradient;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) initial_objf = objf;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    lbfgs.DoStep(objf, gradient);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  log_scale.CopyFromVec(lbfgs.GetValue(&amp;objf));</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  Vector&lt;BaseFloat&gt; scale(log_scale);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  scale.ApplyExp();</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Shrinking nnet, validation objf per frame changed from &quot;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            &lt;&lt; initial_objf &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; objf &lt;&lt; <span class="stringliteral">&quot;, scale factors per layer are &quot;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            &lt;&lt; scale;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  nnet-&gt;ScaleComponents(scale);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_ac44c6079a65265ad03f7e7d03a598b9f"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac44c6079a65265ad03f7e7d03a598b9f">kaldi::nnet2::ComputeObjfAndGradient</a></div><div class="ttdeci">static BaseFloat ComputeObjfAndGradient(const std::vector&lt; NnetExample &gt; &amp;validation_set, const Vector&lt; double &gt; &amp;log_scale_params, const Nnet &amp;nnet, Vector&lt; double &gt; *gradient)</div><div class="ttdef"><b>Definition:</b> <a href="shrink-nnet_8cc_source.html#l00025">shrink-nnet.cc:25</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6dbcd705d1a304dd958607aedb503f72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6dbcd705d1a304dd958607aedb503f72">&#9670;&nbsp;</a></span>SolvePackingProblem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SolvePackingProblem </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>max_cost</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>costs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; <a class="el" href="classsize__t.html">size_t</a> &gt; &gt; *&#160;</td>
          <td class="paramname"><em>groups</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function solves the "packing problem" using the "first fit" algorithm. </p>
<p>It groups together the indices 0 through sizes.size() - 1, such that the sum of cost within each group does not exceed max_lcost. [However, if there are single examples that exceed max_cost, it puts them in their own bin]. The algorithm is not particularly efficient&ndash; it's more n^2 than n log(n) which it should be. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-functions_8cc_source.html#l00867">867</a> of file <a class="el" href="nnet-example-functions_8cc_source.html">nnet-example-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-example-functions_8cc_source.html#l00970">CombineDiscriminativeExamples()</a>, <a class="el" href="nnet-example-functions_8h_source.html#l00133">SplitExampleStats::SplitExampleStats()</a>, and <a class="el" href="nnet-example-functions-test_8cc_source.html#l00029">UnitTestSolvePackingProblem()</a>.</p>
<div class="fragment"><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                                                                {</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  groups-&gt;clear();</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  std::vector&lt;BaseFloat&gt; group_costs;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; costs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordtype">bool</span> found_group = <span class="keyword">false</span>;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> this_cost = costs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; groups-&gt;size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      <span class="keywordflow">if</span> (group_costs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] + this_cost &lt;= max_cost) {</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        (*groups)[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        group_costs[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] += this_cost;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        found_group = <span class="keyword">true</span>;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      }</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    }</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">if</span> (!found_group) { <span class="comment">// Put this object in a newly created group.</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      groups-&gt;resize(groups-&gt;size() + 1);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      groups-&gt;back().push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      group_costs.push_back(this_cost);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    }</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  }</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8510e0db1a30077f74f88fbf26bc4c95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8510e0db1a30077f74f88fbf26bc4c95">&#9670;&nbsp;</a></span>SplitDiscriminativeExample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SplitDiscriminativeExample </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1SplitDiscriminativeExampleConfig.html">SplitDiscriminativeExampleConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>tmodel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &gt; *&#160;</td>
          <td class="paramname"><em>egs_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet2_1_1SplitExampleStats.html">SplitExampleStats</a> *&#160;</td>
          <td class="paramname"><em>stats_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Split a "discriminative example" into multiple pieces, splitting where the lattice has "pinch points". </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-functions_8cc_source.html#l00764">764</a> of file <a class="el" href="nnet-example-functions_8cc_source.html">nnet-example-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-example-functions_8cc_source.html#l00121">DiscriminativeExampleSplitter::Split()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-get-egs-discriminative_8cc_source.html#l00027">main()</a>, and <a class="el" href="nnet-example-functions_8h_source.html#l00133">SplitExampleStats::SplitExampleStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                                  {</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  DiscriminativeExampleSplitter splitter(config, tmodel, eg, egs_out);</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  splitter.Split(stats_out);</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a61238a092268dc3deaed1a23e8c3934b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61238a092268dc3deaed1a23e8c3934b">&#9670;&nbsp;</a></span>TotalNnetTrainingWeight()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> TotalNnetTrainingWeight </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structkaldi_1_1nnet2_1_1NnetExample.html">NnetExample</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>egs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the total weight summed over all the examples... </p>
<p>just a simple utility function. </p>

<p class="definition">Definition at line <a class="el" href="nnet-update_8cc_source.html#l00248">248</a> of file <a class="el" href="nnet-update_8cc_source.html">nnet-update.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-update-parallel_8cc_source.html#l00202">DoBackpropSingleThreaded()</a>, <a class="el" href="nnet-compute-prob_8cc_source.html#l00027">main()</a>, <a class="el" href="nnet-update-parallel_8cc_source.html#l00079">DoBackpropParallelClass::operator()()</a>, and <a class="el" href="train-nnet_8cc_source.html#l00049">NnetExampleBackgroundReader::ReadExamples()</a>.</p>
<div class="fragment"><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                                                                     {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordtype">double</span> ans = 0.0;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; egs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; egs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].labels.size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) <span class="comment">// for each labeled frame</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> k = 0; k &lt; egs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].labels[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].size(); k++)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        ans += egs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].labels[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>][k].second;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8b65957690de074074ed5c356e932e63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b65957690de074074ed5c356e932e63">&#9670;&nbsp;</a></span>TrainNnetSimple()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64 TrainNnetSimple </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetSimpleTrainerConfig.html">NnetSimpleTrainerConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi_1_1nnet2.html#a206084ee5d66f24aeb8828c6bf8cb13d">SequentialNnetExampleReader</a> *&#160;</td>
          <td class="paramname"><em>reader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>tot_weight</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>tot_logprob</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Train on all the examples it can read from the reader. </p>
<p>This does training in a single thread, but it uses a separate thread to read in the examples and format the input data on the CPU; this saves us time when using GPUs. Returns the number of examples processed. Outputs to tot_weight and tot_logprob_per_frame, if non-NULL, the total weight of the examples (typically equal to the number of examples) and the total logprob objective function. </p>

<p class="definition">Definition at line <a class="el" href="train-nnet_8cc_source.html#l00147">147</a> of file <a class="el" href="train-nnet_8cc_source.html">train-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-update_8cc_source.html#l00265">DoBackprop()</a>, <a class="el" href="train-nnet_8cc_source.html#l00104">NnetExampleBackgroundReader::GetNextMinibatch()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="train-nnet_8h_source.html#l00032">NnetSimpleTrainerConfig::minibatch_size</a>, and <a class="el" href="train-nnet_8h_source.html#l00033">NnetSimpleTrainerConfig::minibatches_per_phase</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-train-simple_8cc_source.html#l00027">main()</a>, and <a class="el" href="train-nnet_8h_source.html#l00038">NnetSimpleTrainerConfig::Register()</a>.</p>
<div class="fragment"><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                                               {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  int64 num_egs_processed = 0;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordtype">double</span> tot_weight = 0.0, tot_logprob = 0.0;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  NnetExampleBackgroundReader background_reader(config.minibatch_size,</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                                                nnet, reader);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(config.minibatches_per_phase &gt; 0);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// Iterate over phases.  A phase of training is just a certain number of</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// minibatches, and its only significance is that it&#39;s the periodicity with</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// which we print diagnostics.</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordtype">double</span> tot_weight_this_phase = 0.0, tot_logprob_this_phase = 0.0;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; config.minibatches_per_phase; i++) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      std::vector&lt;NnetExample&gt; examples;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      Matrix&lt;BaseFloat&gt; examples_formatted;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="keywordtype">double</span> minibatch_total_weight;  <span class="comment">// this will normally equal minibatch size.</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keywordflow">if</span> (!background_reader.GetNextMinibatch(&amp;examples, &amp;examples_formatted,</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                                              &amp;minibatch_total_weight))</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      tot_logprob_this_phase += <a class="code" href="namespacekaldi_1_1nnet2.html#acc8d23d090fac8b744294c4a452a5928">DoBackprop</a>(*nnet, examples, &amp;examples_formatted,</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                           nnet, NULL);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      tot_weight_this_phase += minibatch_total_weight;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      num_egs_processed += examples.size();</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">if</span> (i != 0) {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Training objective function (this phase) is &quot;</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                &lt;&lt; (tot_logprob_this_phase / tot_weight_this_phase) &lt;&lt; <span class="stringliteral">&quot; over &quot;</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                &lt;&lt; tot_weight_this_phase &lt;&lt; <span class="stringliteral">&quot; frames.&quot;</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    tot_weight += tot_weight_this_phase;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    tot_logprob += tot_logprob_this_phase;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">if</span> (i != config.minibatches_per_phase) {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="comment">// did not get all the minibatches we wanted because no more input.</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <span class="comment">// this is true if and only if we did &quot;break&quot; in the loop over i above.</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordflow">if</span> (tot_weight == 0.0) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;No data seen.&quot;</span>;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Did backprop on &quot;</span> &lt;&lt; tot_weight</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; examples, average log-prob per frame is &quot;</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;              &lt;&lt; (tot_logprob / tot_weight);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;[this line is to be parsed by a script:] log-prob-per-frame=&quot;</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;              &lt;&lt; (tot_logprob / tot_weight);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keywordflow">if</span> (tot_weight_ptr) *tot_weight_ptr = tot_weight;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordflow">if</span> (tot_logprob_ptr) *tot_logprob_ptr = tot_logprob;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">return</span> num_egs_processed;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_acc8d23d090fac8b744294c4a452a5928"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#acc8d23d090fac8b744294c4a452a5928">kaldi::nnet2::DoBackprop</a></div><div class="ttdeci">double DoBackprop(const Nnet &amp;nnet, const std::vector&lt; NnetExample &gt; &amp;examples, Nnet *nnet_to_update, double *tot_accuracy)</div><div class="ttdoc">This function computes the objective function and either updates the model or adds to parameter gradi...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-update_8cc_source.html#l00265">nnet-update.cc:265</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a16c7add606af3409cf96193aeaf4ff90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16c7add606af3409cf96193aeaf4ff90">&#9670;&nbsp;</a></span>UnitTestAdditiveNoiseComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestAdditiveNoiseComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00434">434</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03584">AdditiveNoiseComponent::InitFromString()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                                      {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="comment">// We&#39;re testing that the gradients are computed correctly:</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="comment">// the input gradients and the model gradients.</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  int32 num_fail = 0, num_tries = 4;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_tries; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 50;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <a class="code" href="classkaldi_1_1nnet2_1_1AdditiveNoiseComponent.html">AdditiveNoiseComponent</a> additive_noise_component(input_dim, 0.1);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(additive_noise_component);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <a class="code" href="classkaldi_1_1nnet2_1_1AdditiveNoiseComponent.html">AdditiveNoiseComponent</a> additive_noise_component;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        additive_noise_component.<a class="code" href="classkaldi_1_1nnet2_1_1AdditiveNoiseComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(<span class="stringliteral">&quot;dim=15 stddev=0.2&quot;</span>);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(additive_noise_component);</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      }</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    } <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring failure in AdditiveNoiseComponent test&quot;</span>;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      num_fail++;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    }</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  }</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordflow">if</span> (num_fail &gt;= num_tries/2) {</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Too many test failures.&quot;</span>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  }</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1AdditiveNoiseComponent_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AdditiveNoiseComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::AdditiveNoiseComponent::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l03584">nnet-component.cc:3584</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AdditiveNoiseComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AdditiveNoiseComponent.html">kaldi::nnet2::AdditiveNoiseComponent</a></div><div class="ttdoc">This is a bit similar to dropout but adding (not multiplying) Gaussian noise with a given standard de...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01635">nnet-component.h:1635</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a403d536b850a10805602371bd5d72bde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a403d536b850a10805602371bd5d72bde">&#9670;&nbsp;</a></span>UnitTestAffineComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestAffineComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00337">337</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l01096">AffineComponent::Init()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l01122">AffineComponent::InitFromString()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01208">MatrixBase&lt; Real &gt;::Scale()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01354">MatrixBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-utils_8cc_source.html#l00045">kaldi::Sleep()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>, and <a class="el" href="kaldi-io_8h_source.html#l00257">kaldi::WriteKaldiObject()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                               {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> learning_rate = 0.01,</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      param_stddev = 0.1, bias_stddev = 1.0;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  int32 input_dim = 5 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10, output_dim = 5 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1AffineComponent.html">AffineComponent</a> component;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0) {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      component.<a class="code" href="classkaldi_1_1nnet2_1_1AffineComponent.html#a61677683aaa534dc880a91c7f3aa5db6">Init</a>(learning_rate, input_dim, output_dim,</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                     param_stddev, bias_stddev);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> mat(output_dim + 1, input_dim);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      mat.SetRandn();</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      mat.Scale(param_stddev);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <a class="code" href="group__io__group.html#gae54d5d193d4f5ba50d7bc85e2bfd7f66">WriteKaldiObject</a>(mat, <span class="stringliteral">&quot;tmpf&quot;</span>, <span class="keyword">true</span>);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <a class="code" href="namespacekaldi.html#a6197729d508080eaa4a807ccea4a12f0">Sleep</a>(0.5);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      component.<a class="code" href="classkaldi_1_1nnet2_1_1AffineComponent.html#a61677683aaa534dc880a91c7f3aa5db6">Init</a>(learning_rate, <span class="stringliteral">&quot;tmpf&quot;</span>);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      unlink(<span class="stringliteral">&quot;tmpf&quot;</span>);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  }</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;learning-rate=0.01 input-dim=10 output-dim=15 param-stddev=0.1&quot;</span>;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1AffineComponent.html">AffineComponent</a> component;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1AffineComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1AffineComponent_html_a61677683aaa534dc880a91c7f3aa5db6"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AffineComponent.html#a61677683aaa534dc880a91c7f3aa5db6">kaldi::nnet2::AffineComponent::Init</a></div><div class="ttdeci">void Init(BaseFloat learning_rate, int32 input_dim, int32 output_dim, BaseFloat param_stddev, BaseFloat bias_stddev)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l01096">nnet-component.cc:1096</a></div></div>
<div class="ttc" id="namespacekaldi_html_a6197729d508080eaa4a807ccea4a12f0"><div class="ttname"><a href="namespacekaldi.html#a6197729d508080eaa4a807ccea4a12f0">kaldi::Sleep</a></div><div class="ttdeci">void Sleep(float seconds)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-utils_8cc_source.html#l00045">kaldi-utils.cc:45</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AffineComponent_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AffineComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::AffineComponent::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l01122">nnet-component.cc:1122</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AffineComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AffineComponent.html">kaldi::nnet2::AffineComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00843">nnet-component.h:843</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
<div class="ttc" id="group__io__group_html_gae54d5d193d4f5ba50d7bc85e2bfd7f66"><div class="ttname"><a href="group__io__group.html#gae54d5d193d4f5ba50d7bc85e2bfd7f66">kaldi::WriteKaldiObject</a></div><div class="ttdeci">void WriteKaldiObject(const C &amp;c, const std::string &amp;filename, bool binary)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-io_8h_source.html#l00257">kaldi-io.h:257</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afe21d513126bdd1228b3592bfc86734a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe21d513126bdd1228b3592bfc86734a">&#9670;&nbsp;</a></span>UnitTestAffineComponentPreconditioned()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestAffineComponentPreconditioned </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00478">478</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l01442">AffineComponentPreconditioned::Init()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l01390">AffineComponentPreconditioned::InitFromString()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01208">MatrixBase&lt; Real &gt;::Scale()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01354">MatrixBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-utils_8cc_source.html#l00045">kaldi::Sleep()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>, and <a class="el" href="kaldi-io_8h_source.html#l00257">kaldi::WriteKaldiObject()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                                             {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> learning_rate = 0.01,</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      param_stddev = 0.1, bias_stddev = 1.0, alpha = 0.01,</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      max_change = 100.0;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  int32 input_dim = 5 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10, output_dim = 5 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html">AffineComponentPreconditioned</a> component;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0) {</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      component.<a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html#a81ec34d75350b720365aff5d4d7e7ebe">Init</a>(learning_rate, input_dim, output_dim,</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                     param_stddev, bias_stddev,</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                     alpha, max_change);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> mat(output_dim + 1, input_dim);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      mat.SetRandn();</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      mat.Scale(param_stddev);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <a class="code" href="group__io__group.html#gae54d5d193d4f5ba50d7bc85e2bfd7f66">WriteKaldiObject</a>(mat, <span class="stringliteral">&quot;tmpf&quot;</span>, <span class="keyword">true</span>);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <a class="code" href="namespacekaldi.html#a6197729d508080eaa4a807ccea4a12f0">Sleep</a>(0.5);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      component.<a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html#a81ec34d75350b720365aff5d4d7e7ebe">Init</a>(learning_rate, alpha, max_change, <span class="stringliteral">&quot;tmpf&quot;</span>);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      unlink(<span class="stringliteral">&quot;tmpf&quot;</span>);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;learning-rate=0.01 input-dim=16 output-dim=15 param-stddev=0.1 alpha=0.01&quot;</span>;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html">AffineComponentPreconditioned</a> component;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html">kaldi::nnet2::AffineComponentPreconditioned</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00948">nnet-component.h:948</a></div></div>
<div class="ttc" id="namespacekaldi_html_a6197729d508080eaa4a807ccea4a12f0"><div class="ttname"><a href="namespacekaldi.html#a6197729d508080eaa4a807ccea4a12f0">kaldi::Sleep</a></div><div class="ttdeci">void Sleep(float seconds)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-utils_8cc_source.html#l00045">kaldi-utils.cc:45</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
<div class="ttc" id="group__io__group_html_gae54d5d193d4f5ba50d7bc85e2bfd7f66"><div class="ttname"><a href="group__io__group.html#gae54d5d193d4f5ba50d7bc85e2bfd7f66">kaldi::WriteKaldiObject</a></div><div class="ttdeci">void WriteKaldiObject(const C &amp;c, const std::string &amp;filename, bool binary)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-io_8h_source.html#l00257">kaldi-io.h:257</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned_html_a81ec34d75350b720365aff5d4d7e7ebe"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html#a81ec34d75350b720365aff5d4d7e7ebe">kaldi::nnet2::AffineComponentPreconditioned::Init</a></div><div class="ttdeci">void Init(BaseFloat learning_rate, int32 input_dim, int32 output_dim, BaseFloat param_stddev, BaseFloat bias_stddev, BaseFloat alpha, BaseFloat max_change)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l01442">nnet-component.cc:1442</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AffineComponentPreconditioned.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::AffineComponentPreconditioned::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l01390">nnet-component.cc:1390</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7be00dbe5b62ee5d4d16a92beb52c6fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7be00dbe5b62ee5d4d16a92beb52c6fb">&#9670;&nbsp;</a></span>UnitTestAffineComponentPreconditionedOnline()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestAffineComponentPreconditionedOnline </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00509">509</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l01745">AffineComponentPreconditionedOnline::Init()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l01648">AffineComponentPreconditionedOnline::InitFromString()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01208">MatrixBase&lt; Real &gt;::Scale()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01354">MatrixBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-utils_8cc_source.html#l00045">kaldi::Sleep()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>, and <a class="el" href="kaldi-io_8h_source.html#l00257">kaldi::WriteKaldiObject()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                                                   {</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> learning_rate = 0.01,</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      param_stddev = 0.1, bias_stddev = 1.0, num_samples_history = 2000.0, alpha = 4.0,</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      max_change_per_sample = 0.1, update_period = 1;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  int32 input_dim = 5 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10, output_dim = 5 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10,</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      rank_in = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 5, rank_out = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 5;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  {</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline.html">AffineComponentPreconditionedOnline</a> component;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0) {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      component.<a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline.html#ae16ac80309140044cf041a31bad2eda5">Init</a>(learning_rate, input_dim, output_dim,</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                     param_stddev, bias_stddev,</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                     rank_in, rank_out, update_period,</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                     num_samples_history, alpha,</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                     max_change_per_sample);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> mat(output_dim + 1, input_dim);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      mat.SetRandn();</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      mat.Scale(param_stddev);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <a class="code" href="group__io__group.html#gae54d5d193d4f5ba50d7bc85e2bfd7f66">WriteKaldiObject</a>(mat, <span class="stringliteral">&quot;tmpf&quot;</span>, <span class="keyword">true</span>);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <a class="code" href="namespacekaldi.html#a6197729d508080eaa4a807ccea4a12f0">Sleep</a>(0.5);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      component.<a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline.html#ae16ac80309140044cf041a31bad2eda5">Init</a>(learning_rate, rank_in, rank_out,</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                     update_period, num_samples_history, alpha,</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                     max_change_per_sample, <span class="stringliteral">&quot;tmpf&quot;</span>);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      unlink(<span class="stringliteral">&quot;tmpf&quot;</span>);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;learning-rate=0.01 input-dim=16 output-dim=15 param-stddev=0.1 num-samples-history=3000 alpha=2.0 update-period=1 rank-in=5 rank-out=6&quot;</span>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline.html">AffineComponentPreconditionedOnline</a> component;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a6197729d508080eaa4a807ccea4a12f0"><div class="ttname"><a href="namespacekaldi.html#a6197729d508080eaa4a807ccea4a12f0">kaldi::Sleep</a></div><div class="ttdeci">void Sleep(float seconds)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-utils_8cc_source.html#l00045">kaldi-utils.cc:45</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline_html_ae16ac80309140044cf041a31bad2eda5"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline.html#ae16ac80309140044cf041a31bad2eda5">kaldi::nnet2::AffineComponentPreconditionedOnline::Init</a></div><div class="ttdeci">void Init(BaseFloat learning_rate, int32 input_dim, int32 output_dim, BaseFloat param_stddev, BaseFloat bias_stddev, int32 rank_in, int32 rank_out, int32 update_period, BaseFloat num_samples_history, BaseFloat alpha, BaseFloat max_change_per_sample)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l01745">nnet-component.cc:1745</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::AffineComponentPreconditionedOnline::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l01648">nnet-component.cc:1648</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AffineComponentPreconditionedOnline.html">kaldi::nnet2::AffineComponentPreconditionedOnline</a></div><div class="ttdoc">Keywords: natural gradient descent, NG-SGD, naturalgradient. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00997">nnet-component.h:997</a></div></div>
<div class="ttc" id="group__io__group_html_gae54d5d193d4f5ba50d7bc85e2bfd7f66"><div class="ttname"><a href="group__io__group.html#gae54d5d193d4f5ba50d7bc85e2bfd7f66">kaldi::WriteKaldiObject</a></div><div class="ttdeci">void WriteKaldiObject(const C &amp;c, const std::string &amp;filename, bool binary)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-io_8h_source.html#l00257">kaldi-io.h:257</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a97ed7c24ff06882cc480c5744ab8edb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97ed7c24ff06882cc480c5744ab8edb3">&#9670;&nbsp;</a></span>UnitTestAmNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestAmNnet </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="am-nnet-test_8cc_source.html#l00029">29</a> of file <a class="el" href="am-nnet-test_8cc_source.html">am-nnet-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8cc_source.html#l00805">VectorBase&lt; Real &gt;::ApplyExp()</a>, <a class="el" href="context-dep_8cc_source.html#l00097">kaldi::GenRandContextDependencyLarge()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00772">GenRandomNnet()</a>, <a class="el" href="hmm-test-utils_8cc_source.html#l00050">kaldi::GetDefaultTopology()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="transition-model_8h_source.html#l00185">TransitionModel::NumPdfs()</a>, <a class="el" href="am-nnet_8cc_source.html#l00039">AmNnet::Read()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00962">VectorBase&lt; Real &gt;::Scale()</a>, <a class="el" href="am-nnet_8cc_source.html#l00044">AmNnet::SetPriors()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00301">VectorBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00693">VectorBase&lt; Real &gt;::Sum()</a>, and <a class="el" href="am-nnet_8cc_source.html#l00031">AmNnet::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="am-nnet-test_8cc_source.html#l00081">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                      {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  std::vector&lt;int32&gt; phones;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  phones.push_back(1);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 2; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 20; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordflow">if</span> (rand() % 2 == 0)</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;      phones.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  int32 N = 2 + rand() % 2, <span class="comment">// context-size N is 2 or 3.</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      P = rand() % N;  <span class="comment">// Central-phone is random on [0, N)</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  std::vector&lt;int32&gt; num_pdf_classes;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="classkaldi_1_1ContextDependency.html">ContextDependency</a> *ctx_dep =</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      <a class="code" href="namespacekaldi.html#a0bcd0ad4d591146319cff710173bbe8f">GenRandContextDependencyLarge</a>(phones, N, P,</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                                    <span class="keyword">true</span>, &amp;num_pdf_classes);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <a class="code" href="classkaldi_1_1HmmTopology.html">HmmTopology</a> topo = <a class="code" href="namespacekaldi.html#a67073fc972047fa58fac23aecf5205e6">GetDefaultTopology</a>(phones);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> trans_model(*ctx_dep, topo);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keyword">delete</span> ctx_dep; <span class="comment">// We won&#39;t need this further.</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  ctx_dep = NULL;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  int32 input_dim = 40, output_dim = trans_model.<a class="code" href="classkaldi_1_1ContextDependency.html#a83fc89696d0ba4d96262cf9438100154">NumPdfs</a>();</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet = <a class="code" href="namespacekaldi_1_1nnet2.html#a07117e22b53a7ee4fe7262df208bc70d">GenRandomNnet</a>(input_dim, output_dim);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1AmNnet.html">AmNnet</a> am_nnet(*nnet);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keyword">delete</span> nnet;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  nnet = NULL;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> priors(output_dim);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  priors.SetRandn();</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  priors.ApplyExp();</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  priors.Scale(1.0 / priors.Sum());</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  am_nnet.SetPriors(priors);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordtype">bool</span> binary = (rand() % 2 == 0);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  am_nnet.Write(os, binary);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1AmNnet.html">AmNnet</a> am_nnet2;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  std::istringstream is(os.str());</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  am_nnet2.<a class="code" href="classkaldi_1_1nnet2_1_1AmNnet.html#a8e7d2790fc7e94fe9780ccc937de1270">Read</a>(is, binary);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  std::ostringstream os2;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  am_nnet2.<a class="code" href="classkaldi_1_1nnet2_1_1AmNnet.html#a68f354fd5f096134162f01719096e6fc">Write</a>(os2, binary);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(os2.str() == os.str());</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a67073fc972047fa58fac23aecf5205e6"><div class="ttname"><a href="namespacekaldi.html#a67073fc972047fa58fac23aecf5205e6">kaldi::GetDefaultTopology</a></div><div class="ttdeci">HmmTopology GetDefaultTopology(const std::vector&lt; int32 &gt; &amp;phones_in)</div><div class="ttdoc">This function returns a HmmTopology object giving a normal 3-state topology, covering all phones in t...</div><div class="ttdef"><b>Definition:</b> <a href="hmm-test-utils_8cc_source.html#l00050">hmm-test-utils.cc:50</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0bcd0ad4d591146319cff710173bbe8f"><div class="ttname"><a href="namespacekaldi.html#a0bcd0ad4d591146319cff710173bbe8f">kaldi::GenRandContextDependencyLarge</a></div><div class="ttdeci">ContextDependency * GenRandContextDependencyLarge(const std::vector&lt; int32 &gt; &amp;phone_ids, int N, int P, bool ensure_all_covered, std::vector&lt; int32 &gt; *hmm_lengths)</div><div class="ttdoc">GenRandContextDependencyLarge is like GenRandContextDependency but generates a larger tree with speci...</div><div class="ttdef"><b>Definition:</b> <a href="context-dep_8cc_source.html#l00097">context-dep.cc:97</a></div></div>
<div class="ttc" id="classkaldi_1_1HmmTopology_html"><div class="ttname"><a href="classkaldi_1_1HmmTopology.html">kaldi::HmmTopology</a></div><div class="ttdoc">A class for storing topology information for phones. </div><div class="ttdef"><b>Definition:</b> <a href="hmm-topology_8h_source.html#l00094">hmm-topology.h:94</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AmNnet_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AmNnet.html">kaldi::nnet2::AmNnet</a></div><div class="ttdef"><b>Definition:</b> <a href="am-nnet_8h_source.html#l00038">am-nnet.h:38</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a07117e22b53a7ee4fe7262df208bc70d"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a07117e22b53a7ee4fe7262df208bc70d">kaldi::nnet2::GenRandomNnet</a></div><div class="ttdeci">Nnet * GenRandomNnet(int32 input_dim, int32 output_dim)</div><div class="ttdoc">This function generates a random neural net, for testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00772">nnet-nnet.cc:772</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AmNnet_html_a8e7d2790fc7e94fe9780ccc937de1270"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AmNnet.html#a8e7d2790fc7e94fe9780ccc937de1270">kaldi::nnet2::AmNnet::Read</a></div><div class="ttdeci">void Read(std::istream &amp;is, bool binary)</div><div class="ttdef"><b>Definition:</b> <a href="am-nnet_8cc_source.html#l00039">am-nnet.cc:39</a></div></div>
<div class="ttc" id="classkaldi_1_1ContextDependency_html"><div class="ttname"><a href="classkaldi_1_1ContextDependency.html">kaldi::ContextDependency</a></div><div class="ttdef"><b>Definition:</b> <a href="context-dep_8h_source.html#l00059">context-dep.h:59</a></div></div>
<div class="ttc" id="classkaldi_1_1TransitionModel_html"><div class="ttname"><a href="classkaldi_1_1TransitionModel.html">kaldi::TransitionModel</a></div><div class="ttdef"><b>Definition:</b> <a href="transition-model_8h_source.html#l00122">transition-model.h:122</a></div></div>
<div class="ttc" id="classkaldi_1_1ContextDependency_html_a83fc89696d0ba4d96262cf9438100154"><div class="ttname"><a href="classkaldi_1_1ContextDependency.html#a83fc89696d0ba4d96262cf9438100154">kaldi::ContextDependency::NumPdfs</a></div><div class="ttdeci">virtual int32 NumPdfs() const</div><div class="ttdoc">NumPdfs() returns the number of acoustic pdfs (they are numbered 0.. NumPdfs()-1). </div><div class="ttdef"><b>Definition:</b> <a href="context-dep_8h_source.html#l00071">context-dep.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AmNnet_html_a68f354fd5f096134162f01719096e6fc"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AmNnet.html#a68f354fd5f096134162f01719096e6fc">kaldi::nnet2::AmNnet::Write</a></div><div class="ttdeci">void Write(std::ostream &amp;os, bool binary) const</div><div class="ttdef"><b>Definition:</b> <a href="am-nnet_8cc_source.html#l00031">am-nnet.cc:31</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html">kaldi::nnet2::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00063">nnet-nnet.h:63</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a636f0cfcf362f3fd112ab2fdf7b165d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a636f0cfcf362f3fd112ab2fdf7b165d1">&#9670;&nbsp;</a></span>UnitTestBlockAffineComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestBlockAffineComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00544">544</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l02074">BlockAffineComponent::Init()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02093">BlockAffineComponent::InitFromString()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                                    {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> learning_rate = 0.01,</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      param_stddev = 0.1, bias_stddev = 0.1;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  int32 num_blocks = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3,</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;         input_dim = num_blocks * (2 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4),</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        output_dim = num_blocks * (2 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1BlockAffineComponent.html">BlockAffineComponent</a> component;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1BlockAffineComponent.html#a4083361e5e239f1d646ae58afeab900b">Init</a>(learning_rate, input_dim, output_dim,</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                   param_stddev, bias_stddev, num_blocks);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  }</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;learning-rate=0.01 input-dim=10 output-dim=15 param-stddev=0.1 num-blocks=5&quot;</span>;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1BlockAffineComponent.html">BlockAffineComponent</a> component;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1BlockAffineComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1BlockAffineComponent_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1BlockAffineComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::BlockAffineComponent::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l02093">nnet-component.cc:2093</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1BlockAffineComponent_html_a4083361e5e239f1d646ae58afeab900b"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1BlockAffineComponent.html#a4083361e5e239f1d646ae58afeab900b">kaldi::nnet2::BlockAffineComponent::Init</a></div><div class="ttdeci">void Init(BaseFloat learning_rate, int32 input_dim, int32 output_dim, BaseFloat param_stddev, BaseFloat bias_stddev, int32 num_blocks)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l02074">nnet-component.cc:2074</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1BlockAffineComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1BlockAffineComponent.html">kaldi::nnet2::BlockAffineComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01171">nnet-component.h:1171</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7cea1bbd66e10c9f11a2fb11c43e2014"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cea1bbd66e10c9f11a2fb11c43e2014">&#9670;&nbsp;</a></span>UnitTestBlockAffineComponentPreconditioned()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestBlockAffineComponentPreconditioned </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00565">565</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l02161">BlockAffineComponentPreconditioned::Init()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02174">BlockAffineComponentPreconditioned::InitFromString()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                                                  {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> learning_rate = 0.01,</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      param_stddev = 0.1, bias_stddev = 1.0, alpha = 3.0;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  int32 num_blocks = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3,</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;         input_dim = num_blocks * (2 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4),</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        output_dim = num_blocks * (2 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  {</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1BlockAffineComponentPreconditioned.html">BlockAffineComponentPreconditioned</a> component;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1BlockAffineComponentPreconditioned.html#aabbf428655ffaeacc69afb60dbe530c7">Init</a>(learning_rate, input_dim, output_dim,</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                   param_stddev, bias_stddev, num_blocks, alpha);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  }</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;learning-rate=0.01 input-dim=10 output-dim=15 param-stddev=0.1 num-blocks=5 alpha=3.0&quot;</span>;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1BlockAffineComponentPreconditioned.html">BlockAffineComponentPreconditioned</a> component;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1BlockAffineComponentPreconditioned.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1BlockAffineComponentPreconditioned_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1BlockAffineComponentPreconditioned.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::BlockAffineComponentPreconditioned::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l02174">nnet-component.cc:2174</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1BlockAffineComponentPreconditioned_html_aabbf428655ffaeacc69afb60dbe530c7"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1BlockAffineComponentPreconditioned.html#aabbf428655ffaeacc69afb60dbe530c7">kaldi::nnet2::BlockAffineComponentPreconditioned::Init</a></div><div class="ttdeci">void Init(BaseFloat learning_rate, int32 input_dim, int32 output_dim, BaseFloat param_stddev, BaseFloat bias_stddev, int32 num_blocks, BaseFloat alpha)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l02161">nnet-component.cc:2161</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1BlockAffineComponentPreconditioned_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1BlockAffineComponentPreconditioned.html">kaldi::nnet2::BlockAffineComponentPreconditioned</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01242">nnet-component.h:1242</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7b28af76b095019161d365895f18a60a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b28af76b095019161d365895f18a60a">&#9670;&nbsp;</a></span>UnitTestConvolutional1dComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestConvolutional1dComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00365">365</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l03669">Convolutional1dComponent::Init()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03761">Convolutional1dComponent::InitFromString()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01208">MatrixBase&lt; Real &gt;::Scale()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01354">MatrixBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-utils_8cc_source.html#l00045">kaldi::Sleep()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>, and <a class="el" href="kaldi-io_8h_source.html#l00257">kaldi::WriteKaldiObject()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                                        {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> learning_rate = 0.01,</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            param_stddev = 0.1, bias_stddev = 1.0;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  int32 patch_stride = 10, patch_step = 1, patch_dim = 4;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  int32 num_patches = 1 + (patch_stride - patch_dim) / patch_step;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  int32 num_splice = 5 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10, num_filters = 5 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  int32 input_dim = patch_stride * num_splice;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  int32 filter_dim = patch_dim * num_splice;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  int32 output_dim = num_patches * num_filters;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html">Convolutional1dComponent</a> component;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      component.<a class="code" href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html#abce3fb3191b6b175e3e76f743549e891">Init</a>(learning_rate, input_dim, output_dim,</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                     patch_dim, patch_step, patch_stride,</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                     param_stddev, bias_stddev, <span class="keyword">true</span>);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> mat(num_filters, filter_dim + 1);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      mat.SetRandn();</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      mat.Scale(param_stddev);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <a class="code" href="group__io__group.html#gae54d5d193d4f5ba50d7bc85e2bfd7f66">WriteKaldiObject</a>(mat, <span class="stringliteral">&quot;tmpf&quot;</span>, <span class="keyword">true</span>);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <a class="code" href="namespacekaldi.html#a6197729d508080eaa4a807ccea4a12f0">Sleep</a>(0.5);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      component.<a class="code" href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html#abce3fb3191b6b175e3e76f743549e891">Init</a>(learning_rate, patch_dim,</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                     patch_step, patch_stride, <span class="stringliteral">&quot;tmpf&quot;</span>, <span class="keyword">false</span>);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      unlink(<span class="stringliteral">&quot;tmpf&quot;</span>);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="comment">// appended-conv is false by default</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;learning-rate=0.01 input-dim=100 output-dim=70 param-stddev=0.1 patch-dim=4 patch-step=1 patch-stride=10&quot;</span>;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html">Convolutional1dComponent</a> component;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;learning-rate=0.01 input-dim=100 output-dim=70 param-stddev=0.1 patch-dim=4 patch-step=1 patch-stride=10 appended-conv=true&quot;</span>;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html">Convolutional1dComponent</a> component;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a6197729d508080eaa4a807ccea4a12f0"><div class="ttname"><a href="namespacekaldi.html#a6197729d508080eaa4a807ccea4a12f0">kaldi::Sleep</a></div><div class="ttdeci">void Sleep(float seconds)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-utils_8cc_source.html#l00045">kaldi-utils.cc:45</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Convolutional1dComponent_html_abce3fb3191b6b175e3e76f743549e891"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html#abce3fb3191b6b175e3e76f743549e891">kaldi::nnet2::Convolutional1dComponent::Init</a></div><div class="ttdeci">void Init(BaseFloat learning_rate, int32 input_dim, int32 output_dim, int32 patch_dim, int32 patch_step, int32 patch_stride, BaseFloat param_stddev, BaseFloat bias_stddev, bool appended_conv)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l03669">nnet-component.cc:3669</a></div></div>
<div class="ttc" id="group__io__group_html_gae54d5d193d4f5ba50d7bc85e2bfd7f66"><div class="ttname"><a href="group__io__group.html#gae54d5d193d4f5ba50d7bc85e2bfd7f66">kaldi::WriteKaldiObject</a></div><div class="ttdeci">void WriteKaldiObject(const C &amp;c, const std::string &amp;filename, bool binary)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-io_8h_source.html#l00257">kaldi-io.h:257</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Convolutional1dComponent_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::Convolutional1dComponent::InitFromString</a></div><div class="ttdeci">void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l03761">nnet-component.cc:3761</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Convolutional1dComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Convolutional1dComponent.html">kaldi::nnet2::Convolutional1dComponent</a></div><div class="ttdoc">Convolutional1dComponent implements convolution over frequency axis. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01718">nnet-component.h:1718</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae7802a35ba6ea5aee400f6fff59ecf0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7802a35ba6ea5aee400f6fff59ecf0a">&#9670;&nbsp;</a></span>UnitTestDctComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestDctComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00607">607</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l02995">DctComponent::Init()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03011">DctComponent::InitFromString()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                            {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  int32 m = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4,</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  dct_dim = m, dim = m * <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="keywordtype">bool</span> reorder = (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1DctComponent.html">DctComponent</a> component;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1DctComponent.html#a39ade064c3850ba2e1294f2fec97db63">Init</a>(dim, dct_dim, reorder);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  }</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;dim=10 dct-dim=5 reorder=true&quot;</span>;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1DctComponent.html">DctComponent</a> component;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1DctComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  }</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  {</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;dim=10 dct-dim=5 reorder=true dct-keep-dim=1&quot;</span>;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1DctComponent.html">DctComponent</a> component;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1DctComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  }</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;dim=10 dct-dim=5 reorder=true dct-keep-dim=2&quot;</span>;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1DctComponent.html">DctComponent</a> component;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1DctComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;dim=10 dct-dim=5 reorder=true dct-keep-dim=3&quot;</span>;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1DctComponent.html">DctComponent</a> component;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1DctComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;dim=10 dct-dim=5 reorder=true dct-keep-dim=4&quot;</span>;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1DctComponent.html">DctComponent</a> component;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1DctComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  }</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1DctComponent_html_a39ade064c3850ba2e1294f2fec97db63"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1DctComponent.html#a39ade064c3850ba2e1294f2fec97db63">kaldi::nnet2::DctComponent::Init</a></div><div class="ttdeci">void Init(int32 dim, int32 dct_dim, bool reorder, int32 keep_dct_dim=0)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l02995">nnet-component.cc:2995</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1DctComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1DctComponent.html">kaldi::nnet2::DctComponent</a></div><div class="ttdoc">Discrete cosine transform. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01361">nnet-component.h:1361</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1DctComponent_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1DctComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::DctComponent::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l03011">nnet-component.cc:3011</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a79621579ccc2522fa6886a1d65494710"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79621579ccc2522fa6886a1d65494710">&#9670;&nbsp;</a></span>UnitTestDropoutComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestDropoutComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00407">407</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-component_8cc_source.html#l03487">DropoutComponent::InitFromString()</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="comment">// We&#39;re testing that the gradients are computed correctly:</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="comment">// the input gradients and the model gradients.</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  int32 num_fail = 0, num_tries = 4;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_tries; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 50;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <a class="code" href="classkaldi_1_1nnet2_1_1DropoutComponent.html">DropoutComponent</a> dropout_component(input_dim, 0.5, 0.3);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(dropout_component);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <a class="code" href="classkaldi_1_1nnet2_1_1DropoutComponent.html">DropoutComponent</a> dropout_component;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        dropout_component.<a class="code" href="classkaldi_1_1nnet2_1_1DropoutComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(<span class="stringliteral">&quot;dim=15 dropout-proportion=0.6 dropout-scale=0.1&quot;</span>);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(dropout_component);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    } <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring test failure in UnitTestDropoutComponent().&quot;</span>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      num_fail++;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    }</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  }</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordflow">if</span> (num_fail &gt;= num_tries/2) {</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Too many test failures.&quot;</span>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1DropoutComponent_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1DropoutComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::DropoutComponent::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l03487">nnet-component.cc:3487</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1DropoutComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1DropoutComponent.html">kaldi::nnet2::DropoutComponent</a></div><div class="ttdoc">This Component, if present, randomly zeroes half of the inputs and multiplies the other half by two...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01584">nnet-component.h:1584</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a45daf90607644621a0b6385aa596ef54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45daf90607644621a0b6385aa596ef54">&#9670;&nbsp;</a></span>UnitTestFixedAffineComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestFixedAffineComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00661">661</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l03245">FixedAffineComponent::Init()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                                    {</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  int32 m = 15 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 15 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  {</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> mat(m, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    mat.SetRandn();</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1FixedAffineComponent.html">FixedAffineComponent</a> component;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1FixedAffineComponent.html#a8fc47c145504a25341fdc0e5b6471a75">Init</a>(mat);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  }</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1FixedAffineComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1FixedAffineComponent.html">kaldi::nnet2::FixedAffineComponent</a></div><div class="ttdoc">FixedAffineComponent is an affine transform that is supplied at network initialization time and is no...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01454">nnet-component.h:1454</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1FixedAffineComponent_html_a8fc47c145504a25341fdc0e5b6471a75"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1FixedAffineComponent.html#a8fc47c145504a25341fdc0e5b6471a75">kaldi::nnet2::FixedAffineComponent::Init</a></div><div class="ttdeci">void Init(const CuMatrixBase&lt; BaseFloat &gt; &amp;matrix)</div><div class="ttdoc">matrix should be of size input-dim+1 to output-dim, last col is offset </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l03245">nnet-component.cc:3245</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a37650aea3e79156eff23744e83684ce6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37650aea3e79156eff23744e83684ce6">&#9670;&nbsp;</a></span>UnitTestFixedBiasComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestFixedBiasComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00683">683</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l03407">FixedBiasComponent::Init()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="cu-vector_8cc_source.html#l00275">CuVectorBase&lt; Real &gt;::SetRandn()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                                  {</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  int32 m = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> vec(m);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    vec.SetRandn();</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1FixedBiasComponent.html">FixedBiasComponent</a> component;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1FixedBiasComponent.html#accbac0bb82e99c3989de38b2c36f8741">Init</a>(vec);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  }</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;}</div><div class="ttc" id="classkaldi_1_1CuVector_html"><div class="ttname"><a href="classkaldi_1_1CuVector.html">kaldi::CuVector</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00074">matrix-common.h:74</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1FixedBiasComponent_html_accbac0bb82e99c3989de38b2c36f8741"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1FixedBiasComponent.html#accbac0bb82e99c3989de38b2c36f8741">kaldi::nnet2::FixedBiasComponent::Init</a></div><div class="ttdeci">void Init(const CuVectorBase&lt; BaseFloat &gt; &amp;scales)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l03407">nnet-component.cc:3407</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1FixedBiasComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1FixedBiasComponent.html">kaldi::nnet2::FixedBiasComponent</a></div><div class="ttdoc">FixedBiasComponent applies a fixed per-element bias; it&amp;#39;s similar to the AddShift component in the nn...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01542">nnet-component.h:1542</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1045b7fdf9b165bb8b23cf9d7d7e1f34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1045b7fdf9b165bb8b23cf9d7d7e1f34">&#9670;&nbsp;</a></span>UnitTestFixedLinearComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestFixedLinearComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00649">649</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8h_source.html#l01419">FixedLinearComponent::Init()</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                                    {</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  int32 m = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 4;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  {</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> mat(m, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    mat.SetRandn();</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1FixedLinearComponent.html">FixedLinearComponent</a> component;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1FixedLinearComponent.html#a8fc47c145504a25341fdc0e5b6471a75">Init</a>(mat);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1FixedLinearComponent_html_a8fc47c145504a25341fdc0e5b6471a75"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1FixedLinearComponent.html#a8fc47c145504a25341fdc0e5b6471a75">kaldi::nnet2::FixedLinearComponent::Init</a></div><div class="ttdeci">void Init(const CuMatrixBase&lt; BaseFloat &gt; &amp;matrix)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01419">nnet-component.h:1419</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1FixedLinearComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1FixedLinearComponent.html">kaldi::nnet2::FixedLinearComponent</a></div><div class="ttdoc">FixedLinearComponent is a linear transform that is supplied at network initialization time and is not...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01413">nnet-component.h:1413</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2ef7ee2222ce1bc44d63182f0bf5524f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ef7ee2222ce1bc44d63182f0bf5524f">&#9670;&nbsp;</a></span>UnitTestFixedScaleComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestFixedScaleComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00672">672</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l03337">FixedScaleComponent::Init()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="cu-vector_8cc_source.html#l00275">CuVectorBase&lt; Real &gt;::SetRandn()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                                   {</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  int32 m = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  {</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> vec(m);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    vec.SetRandn();</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1FixedScaleComponent.html">FixedScaleComponent</a> component;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1FixedScaleComponent.html#accbac0bb82e99c3989de38b2c36f8741">Init</a>(vec);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;}</div><div class="ttc" id="classkaldi_1_1CuVector_html"><div class="ttname"><a href="classkaldi_1_1CuVector.html">kaldi::CuVector</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00074">matrix-common.h:74</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1FixedScaleComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1FixedScaleComponent.html">kaldi::nnet2::FixedScaleComponent</a></div><div class="ttdoc">FixedScaleComponent applies a fixed per-element scale; it&amp;#39;s similar to the Rescale component in the n...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01501">nnet-component.h:1501</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1FixedScaleComponent_html_accbac0bb82e99c3989de38b2c36f8741"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1FixedScaleComponent.html#accbac0bb82e99c3989de38b2c36f8741">kaldi::nnet2::FixedScaleComponent::Init</a></div><div class="ttdeci">void Init(const CuVectorBase&lt; BaseFloat &gt; &amp;scales)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l03337">nnet-component.cc:3337</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6078b00a82b51e13d84339f447ce1e7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6078b00a82b51e13d84339f447ce1e7c">&#9670;&nbsp;</a></span>UnitTestGenericComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestGenericComponent </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>extra_str</em> = <code>&quot;&quot;</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00244">244</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>
<div class="fragment"><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                                                        {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">// works if it has an initializer from int,</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="comment">// e.g. tanh, sigmoid.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="comment">// We&#39;re testing that the gradients are computed correctly:</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="comment">// the input gradients and the model gradients.</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 50;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    T component(input_dim);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    T component;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    component.InitFromString(static_cast&lt;std::string&gt;(<span class="stringliteral">&quot;dim=15 &quot;</span>) + extra_str);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad4c4fdf15dc5a6dde37ef0ac0598f04e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4c4fdf15dc5a6dde37ef0ac0598f04e">&#9670;&nbsp;</a></span>UnitTestGenericComponentInternal() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestGenericComponentInternal </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Component.html">Component</a> &amp;&#160;</td>
          <td class="paramname"><em>component</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a>&#160;</td>
          <td class="paramname"><em>in_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a>&#160;</td>
          <td class="paramname"><em>out_info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">28</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-vector_8cc_source.html#l00478">CuVectorBase&lt; Real &gt;::AddMatVec()</a>, <a class="el" href="classkaldi_1_1nnet2_1_1Component.html#a8b9e039df3b5ac8240511af69e3456d7">Component::Backprop()</a>, <a class="el" href="_2nnet-component_8h_source.html#l00235">Component::BackpropNeedsInput()</a>, <a class="el" href="_2nnet-component_8h_source.html#l00237">Component::BackpropNeedsOutput()</a>, <a class="el" href="classkaldi_1_1nnet2_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Component::Copy()</a>, <a class="el" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">UpdatableComponent::DotProduct()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="_2nnet-component_8h_source.html#l00126">ChunkInfo::NumCols()</a>, <a class="el" href="_2nnet-component_8h_source.html#l00121">ChunkInfo::NumRows()</a>, <a class="el" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html#af8524a3f9d683293269f46e3cc54b285">UpdatableComponent::PerturbParams()</a>, <a class="el" href="classkaldi_1_1nnet2_1_1Component.html#a0df7b94c48568e7f42916c6898f48f67">Component::Propagate()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l00037">Component::ReadNew()</a>, <a class="el" href="_2nnet-component_8h_source.html#l01086">RandomComponent::ResetGenerator()</a>, <a class="el" href="cu-matrix_8h_source.html#l00613">CuMatrixBase&lt; Real &gt;::Row()</a>, <a class="el" href="cu-vector_8cc_source.html#l00275">CuVectorBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-io_8cc_source.html#l00701">Output::Stream()</a>, <a class="el" href="kaldi-io_8cc_source.html#l00826">Input::Stream()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>, and <a class="el" href="classkaldi_1_1nnet2_1_1Component.html#a852bc7306aaa45b284f662f1ddb1a3d5">Component::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00434">UnitTestAdditiveNoiseComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00337">UnitTestAffineComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00478">UnitTestAffineComponentPreconditioned()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00509">UnitTestAffineComponentPreconditionedOnline()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00544">UnitTestBlockAffineComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00565">UnitTestBlockAffineComponentPreconditioned()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00365">UnitTestConvolutional1dComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00607">UnitTestDctComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00407">UnitTestDropoutComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00661">UnitTestFixedAffineComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00683">UnitTestFixedBiasComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00649">UnitTestFixedLinearComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00672">UnitTestFixedScaleComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00244">UnitTestGenericComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00210">UnitTestGenericComponentInternal()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00263">UnitTestMaxoutComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00310">UnitTestMaxpoolingComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00286">UnitTestPnormComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00461">UnitTestScaleComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00227">UnitTestSigmoidComponent()</a>, <a class="el" href="_2nnet-component-test_8cc_source.html#l00747">UnitTestSpliceComponent()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00587">UnitTestSumGroupComponent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                                                                 {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input(in_info.<a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html#a71edb351e40c1a3ac61d7100223cd600">NumRows</a>(), in_info.<a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html#a1bd6dac3d6ead1cc1808f6afa8724d4c">NumCols</a>()),</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;      output(1, out_info.<a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html#a71edb351e40c1a3ac61d7100223cd600">NumRows</a>() * out_info.<a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html#a1bd6dac3d6ead1cc1808f6afa8724d4c">NumCols</a>());</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  input.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">SetRandn</a>();</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> objf_vec(out_info.<a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html#a1bd6dac3d6ead1cc1808f6afa8724d4c">NumCols</a>()); <span class="comment">// objective function is linear function of output.</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  objf_vec.<a class="code" href="classkaldi_1_1CuVectorBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">SetRandn</a>(); <span class="comment">// set to Gaussian noise.</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  int32 rand_seed = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>();</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a> *rand_component =</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      <span class="keyword">const_cast&lt;</span><a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a>*<span class="keyword">&gt;</span>(<span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a>*<span class="keyword">&gt;</span>(&amp;component));</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordflow">if</span> (rand_component != NULL) {</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    srand(rand_seed);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    rand_component-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html#abb608877dc715ca117536e8ea8b0a111">ResetGenerator</a>();</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  }</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  component.<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#a0df7b94c48568e7f42916c6898f48f67">Propagate</a>(in_info, out_info, input, &amp;output);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordtype">bool</span> binary = (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="classkaldi_1_1Output.html">Output</a> ko(<span class="stringliteral">&quot;tmpf&quot;</span>, binary);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#a852bc7306aaa45b284f662f1ddb1a3d5">Write</a>(ko.Stream(), binary);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  }</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1Component.html">Component</a> *component_copy;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordtype">bool</span> binary_in;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="classkaldi_1_1Input.html">Input</a> ki(<span class="stringliteral">&quot;tmpf&quot;</span>, &amp;binary_in);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    component_copy = Component::ReadNew(ki.Stream(), binary_in);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  unlink(<span class="stringliteral">&quot;tmpf&quot;</span>);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  { <span class="comment">// Test backward derivative is correct.</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> output_objfs(out_info.<a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html#a71edb351e40c1a3ac61d7100223cd600">NumRows</a>());</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    output_objfs.<a class="code" href="classkaldi_1_1CuVectorBase.html#a3141b546ba3d59086af084d563c9dd58">AddMatVec</a>(1.0, output, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, objf_vec, 0.0);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> objf = output_objfs.Sum();</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output_deriv(output.NumRows(), output.NumCols());</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; output_deriv.NumRows(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      output_deriv.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a2063a15b24ba24887ffaa92f44e1d4bf">Row</a>(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>).CopyFromVec(objf_vec);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input_deriv(input.NumRows(), input.NumCols());</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> empty_mat;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> &amp;input_ref =</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        (component_copy-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#a6665547e73d07ffc21cd10e55220e6e5">BackpropNeedsInput</a>() ? input : empty_mat),</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        &amp;output_ref =</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        (component_copy-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#aa2d5e0212c323009090023155511ab04">BackpropNeedsOutput</a>() ? output : empty_mat);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    component_copy-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#a8b9e039df3b5ac8240511af69e3456d7">Backprop</a>(in_info, out_info, input_ref, output_ref,</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                             output_deriv, NULL, &amp;input_deriv);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    int32 num_ok = 0, num_bad = 0, num_tries = 10;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Comparing feature gradients &quot;</span> &lt;&lt; num_tries &lt;&lt; <span class="stringliteral">&quot; times.&quot;</span>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_tries; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> perturbed_input(input.NumRows(), input.NumCols());</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a> *rand_component =</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="keyword">const_cast&lt;</span><a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a>*<span class="keyword">&gt;</span>(<span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a>*<span class="keyword">&gt;</span>(&amp;component));</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">if</span> (rand_component != NULL) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;          srand(rand_seed);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;          rand_component-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html#abb608877dc715ca117536e8ea8b0a111">ResetGenerator</a>();</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      perturbed_input.SetRandn();</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      perturbed_input.Scale(1.0e-04); <span class="comment">// scale by a small amount so it&#39;s like a delta.</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> predicted_difference = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(perturbed_input,</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                                                   input_deriv, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      perturbed_input.AddMat(1.0, input); <span class="comment">// now it&#39;s the input + a delta.</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      { <span class="comment">// Compute objf with perturbed input and make sure it matches</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="comment">// prediction.</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> perturbed_output(output.NumRows(), output.NumCols());</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        {</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;          <a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a> *rand_component =</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;              <span class="keyword">const_cast&lt;</span><a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a>*<span class="keyword">&gt;</span>(<span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a>*<span class="keyword">&gt;</span>(&amp;component));</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;          <span class="keywordflow">if</span> (rand_component != NULL) {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            srand(rand_seed);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            rand_component-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html#abb608877dc715ca117536e8ea8b0a111">ResetGenerator</a>();</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;          }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        component.<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#a0df7b94c48568e7f42916c6898f48f67">Propagate</a>(in_info, out_info, perturbed_input, &amp;perturbed_output);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> perturbed_output_objfs(out_info.<a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html#a71edb351e40c1a3ac61d7100223cd600">NumRows</a>());</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        perturbed_output_objfs.<a class="code" href="classkaldi_1_1CuVectorBase.html#a3141b546ba3d59086af084d563c9dd58">AddMatVec</a>(1.0, perturbed_output, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>,</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                         objf_vec, 0.0);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> perturbed_objf = perturbed_output_objfs.Sum(),</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;             observed_difference = perturbed_objf - objf;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Input gradients: comparing &quot;</span> &lt;&lt; predicted_difference</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; observed_difference;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keywordflow">if</span> (fabs(predicted_difference - observed_difference) &gt;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            0.15 * fabs((predicted_difference + observed_difference)/2) &amp;&amp;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            fabs(predicted_difference - observed_difference) &gt; 1.0e-06) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;          <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Bad difference!&quot;</span>;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;          num_bad++;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;          num_ok++;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Succeeded for &quot;</span> &lt;&lt; num_ok &lt;&lt; <span class="stringliteral">&quot; out of &quot;</span> &lt;&lt; num_tries</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; tries.&quot;</span>;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">if</span> (num_ok &lt;= num_bad) {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="keyword">delete</span> component_copy;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Feature-derivative check failed&quot;</span>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html">UpdatableComponent</a> *ucomponent =</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html">UpdatableComponent</a>*<span class="keyword">&gt;</span>(component_copy);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">if</span> (ucomponent != NULL) { <span class="comment">// Test parameter derivative is correct.</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    int32 num_ok = 0, num_bad = 0, num_tries = 10;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Comparing model gradients &quot;</span> &lt;&lt; num_tries &lt;&lt; <span class="stringliteral">&quot; times.&quot;</span>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_tries; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <a class="code" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html">UpdatableComponent</a> *perturbed_ucomponent =</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;          <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html">UpdatableComponent</a>*<span class="keyword">&gt;</span>(ucomponent-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Copy</a>()),</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;          *gradient_ucomponent =</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;          dynamic_cast&lt;UpdatableComponent*&gt;(ucomponent-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">Copy</a>());</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(perturbed_ucomponent != NULL);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      gradient_ucomponent-&gt;SetZero(<span class="keyword">true</span>); <span class="comment">// set params to zero and treat as gradient.</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> perturb_stddev = 5.0e-04;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      perturbed_ucomponent-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html#af8524a3f9d683293269f46e3cc54b285">PerturbParams</a>(perturb_stddev);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> output_objfs(out_info.<a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html#a71edb351e40c1a3ac61d7100223cd600">NumRows</a>());</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      output_objfs.<a class="code" href="classkaldi_1_1CuVectorBase.html#a3141b546ba3d59086af084d563c9dd58">AddMatVec</a>(1.0, output, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, objf_vec, 0.0);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> objf = output_objfs.Sum();</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output_deriv(output.NumRows(), output.NumCols());</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; output_deriv.NumRows(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        output_deriv.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a2063a15b24ba24887ffaa92f44e1d4bf">Row</a>(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>).CopyFromVec(objf_vec);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input_deriv; <span class="comment">// (input.NumRows(), input.NumCols());</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="comment">// This will compute the parameter gradient.</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      ucomponent-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#a8b9e039df3b5ac8240511af69e3456d7">Backprop</a>(in_info, out_info, input, output, output_deriv,</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                           gradient_ucomponent, &amp;input_deriv);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="comment">// Now compute the perturbed objf.</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> objf_perturbed;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output_perturbed; <span class="comment">// (num_egs, output_dim);</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;          <a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a> *rand_component =</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;              <span class="keyword">const_cast&lt;</span><a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a>*<span class="keyword">&gt;</span>(<span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html">RandomComponent</a>*<span class="keyword">&gt;</span>(&amp;component));</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;          <span class="keywordflow">if</span> (rand_component != NULL) {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            srand(rand_seed);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            rand_component-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1RandomComponent.html#abb608877dc715ca117536e8ea8b0a111">ResetGenerator</a>();</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;          }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        perturbed_ucomponent-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#a0df7b94c48568e7f42916c6898f48f67">Propagate</a>(in_info, out_info, input, &amp;output_perturbed);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> output_objfs_perturbed(out_info.<a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html#a71edb351e40c1a3ac61d7100223cd600">NumRows</a>());</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        output_objfs_perturbed.<a class="code" href="classkaldi_1_1CuVectorBase.html#a3141b546ba3d59086af084d563c9dd58">AddMatVec</a>(1.0, output_perturbed,</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                         <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, objf_vec, 0.0);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        objf_perturbed = output_objfs_perturbed.Sum();</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> delta_objf_observed = objf_perturbed - objf,</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          delta_objf_predicted = (perturbed_ucomponent-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">DotProduct</a>(*gradient_ucomponent) -</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                  ucomponent-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">DotProduct</a>(*gradient_ucomponent));</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Model gradients: comparing &quot;</span> &lt;&lt; delta_objf_observed</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; delta_objf_predicted;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordflow">if</span> (fabs(delta_objf_predicted - delta_objf_observed) &gt;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;          0.05 * (fabs(delta_objf_predicted + delta_objf_observed)/2) &amp;&amp;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          fabs(delta_objf_predicted - delta_objf_observed) &gt; 1.0e-06) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Bad difference!&quot;</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        num_bad++;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        num_ok++;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keyword">delete</span> perturbed_ucomponent;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keyword">delete</span> gradient_ucomponent;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">if</span> (num_ok &lt; num_bad) {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keyword">delete</span> component_copy;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;model-derivative check failed&quot;</span>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  }</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keyword">delete</span> component_copy; <span class="comment">// No longer needed.</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div><div class="ttc" id="classkaldi_1_1Input_html"><div class="ttname"><a href="classkaldi_1_1Input.html">kaldi::Input</a></div><div class="ttdef"><b>Definition:</b> <a href="kaldi-io_8h_source.html#l00190">kaldi-io.h:190</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1RandomComponent_html_abb608877dc715ca117536e8ea8b0a111"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1RandomComponent.html#abb608877dc715ca117536e8ea8b0a111">kaldi::nnet2::RandomComponent::ResetGenerator</a></div><div class="ttdeci">void ResetGenerator()</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01086">nnet-component.h:1086</a></div></div>
<div class="ttc" id="classkaldi_1_1CuVector_html"><div class="ttname"><a href="classkaldi_1_1CuVector.html">kaldi::CuVector</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00074">matrix-common.h:74</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a2063a15b24ba24887ffaa92f44e1d4bf"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a2063a15b24ba24887ffaa92f44e1d4bf">kaldi::CuMatrixBase::Row</a></div><div class="ttdeci">const CuSubVector&lt; Real &gt; Row(MatrixIndexT i) const</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8h_source.html#l00613">cu-matrix.h:613</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Component_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Component.html">kaldi::nnet2::Component</a></div><div class="ttdoc">Abstract class, basic element of the network, it is a box with defined inputs, outputs, and tranformation functions interface. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00157">nnet-component.h:157</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Component_html_a6665547e73d07ffc21cd10e55220e6e5"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Component.html#a6665547e73d07ffc21cd10e55220e6e5">kaldi::nnet2::Component::BackpropNeedsInput</a></div><div class="ttdeci">virtual bool BackpropNeedsInput() const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00235">nnet-component.h:235</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a40c5a82d6d015bdcc0079b535b1e9a23"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">kaldi::CuMatrixBase::SetRandn</a></div><div class="ttdeci">void SetRandn()</div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8cc_source.html#l03099">cu-matrix.cc:3099</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Component_html_aa46d9c7de00be8203e16a6e55af0afef"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Component.html#aa46d9c7de00be8203e16a6e55af0afef">kaldi::nnet2::Component::Copy</a></div><div class="ttdeci">virtual Component * Copy() const =0</div><div class="ttdoc">Copy component (deep copy). </div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1CuVectorBase_html_a3141b546ba3d59086af084d563c9dd58"><div class="ttname"><a href="classkaldi_1_1CuVectorBase.html#a3141b546ba3d59086af084d563c9dd58">kaldi::CuVectorBase::AddMatVec</a></div><div class="ttdeci">void AddMatVec(const Real alpha, const CuMatrixBase&lt; Real &gt; &amp;M, MatrixTransposeType trans, const CuVectorBase&lt; Real &gt; &amp;v, const Real beta)</div><div class="ttdef"><b>Definition:</b> <a href="cu-vector_8cc_source.html#l00478">cu-vector.cc:478</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1UpdatableComponent_html_ac0697192d76083f84fc989f67fbee5e9"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1UpdatableComponent.html#ac0697192d76083f84fc989f67fbee5e9">kaldi::nnet2::UpdatableComponent::DotProduct</a></div><div class="ttdeci">virtual BaseFloat DotProduct(const UpdatableComponent &amp;other) const =0</div><div class="ttdoc">Here, &quot;other&quot; is a component of the same specific type. </div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Component_html_a8b9e039df3b5ac8240511af69e3456d7"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Component.html#a8b9e039df3b5ac8240511af69e3456d7">kaldi::nnet2::Component::Backprop</a></div><div class="ttdeci">virtual void Backprop(const ChunkInfo &amp;in_info, const ChunkInfo &amp;out_info, const CuMatrixBase&lt; BaseFloat &gt; &amp;in_value, const CuMatrixBase&lt; BaseFloat &gt; &amp;out_value, const CuMatrixBase&lt; BaseFloat &gt; &amp;out_deriv, Component *to_update, CuMatrix&lt; BaseFloat &gt; *in_deriv) const =0</div><div class="ttdoc">Perform backward pass propagation of the derivative, and also either update the model (if to_update =...</div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1RandomComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1RandomComponent.html">kaldi::nnet2::RandomComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01080">nnet-component.h:1080</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1ChunkInfo_html_a71edb351e40c1a3ac61d7100223cd600"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1ChunkInfo.html#a71edb351e40c1a3ac61d7100223cd600">kaldi::nnet2::ChunkInfo::NumRows</a></div><div class="ttdeci">int32 NumRows() const</div><div class="ttdoc">Returns the number of rows that we expect the feature matrix to have. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00121">nnet-component.h:121</a></div></div>
<div class="ttc" id="classkaldi_1_1CuVectorBase_html_a40c5a82d6d015bdcc0079b535b1e9a23"><div class="ttname"><a href="classkaldi_1_1CuVectorBase.html#a40c5a82d6d015bdcc0079b535b1e9a23">kaldi::CuVectorBase::SetRandn</a></div><div class="ttdeci">void SetRandn()</div><div class="ttdef"><b>Definition:</b> <a href="cu-vector_8cc_source.html#l00275">cu-vector.cc:275</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1UpdatableComponent_html_af8524a3f9d683293269f46e3cc54b285"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1UpdatableComponent.html#af8524a3f9d683293269f46e3cc54b285">kaldi::nnet2::UpdatableComponent::PerturbParams</a></div><div class="ttdeci">virtual void PerturbParams(BaseFloat stddev)=0</div><div class="ttdoc">We introduce a new virtual function that only applies to class UpdatableComponent. </div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Component_html_a0df7b94c48568e7f42916c6898f48f67"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Component.html#a0df7b94c48568e7f42916c6898f48f67">kaldi::nnet2::Component::Propagate</a></div><div class="ttdeci">virtual void Propagate(const ChunkInfo &amp;in_info, const ChunkInfo &amp;out_info, const CuMatrixBase&lt; BaseFloat &gt; &amp;in, CuMatrixBase&lt; BaseFloat &gt; *out) const =0</div><div class="ttdoc">Perform forward pass propagation Input-&gt;Output. </div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1Output_html"><div class="ttname"><a href="classkaldi_1_1Output.html">kaldi::Output</a></div><div class="ttdef"><b>Definition:</b> <a href="kaldi-io_8h_source.html#l00124">kaldi-io.h:124</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Component_html_a852bc7306aaa45b284f662f1ddb1a3d5"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Component.html#a852bc7306aaa45b284f662f1ddb1a3d5">kaldi::nnet2::Component::Write</a></div><div class="ttdeci">virtual void Write(std::ostream &amp;os, bool binary) const =0</div><div class="ttdoc">Write component to stream. </div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Component_html_aa2d5e0212c323009090023155511ab04"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Component.html#aa2d5e0212c323009090023155511ab04">kaldi::nnet2::Component::BackpropNeedsOutput</a></div><div class="ttdeci">virtual bool BackpropNeedsOutput() const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00237">nnet-component.h:237</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1ChunkInfo_html_a1bd6dac3d6ead1cc1808f6afa8724d4c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1ChunkInfo.html#a1bd6dac3d6ead1cc1808f6afa8724d4c">kaldi::nnet2::ChunkInfo::NumCols</a></div><div class="ttdeci">int32 NumCols() const</div><div class="ttdoc">Returns the number of columns that we expect the feature matrix to have. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00126">nnet-component.h:126</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1UpdatableComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1UpdatableComponent.html">kaldi::nnet2::UpdatableComponent</a></div><div class="ttdoc">Class UpdatableComponent is a Component which has trainable parameters and contains some global param...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00279">nnet-component.h:279</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac68689fc81582215989c6b2c40e95cf5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac68689fc81582215989c6b2c40e95cf5">&#9670;&nbsp;</a></span>UnitTestGenericComponentInternal() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestGenericComponentInternal </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1Component.html">Component</a> &amp;&#160;</td>
          <td class="paramname"><em>component</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00210">210</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l00305">Component::Info()</a>, <a class="el" href="classkaldi_1_1nnet2_1_1Component.html#a7f37d871d35c43a03324502cea308635">Component::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="classkaldi_1_1nnet2_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">Component::OutputDim()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>
<div class="fragment"><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                                                  {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  int32 input_dim = component.<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#a7f37d871d35c43a03324502cea308635">InputDim</a>(),</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      output_dim = component.<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">OutputDim</a>();</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; component.<a class="code" href="classkaldi_1_1nnet2_1_1Component.html#a245d65d566725422b859c99bff7623f8">Info</a>();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  int32 num_egs = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 5;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  int32 num_chunks = 1,</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        first_offset = 0,</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        last_offset = num_egs-1;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a> in_info(input_dim, num_chunks, first_offset, last_offset);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a> out_info(output_dim, num_chunks, first_offset, last_offset);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component, in_info, out_info);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1Component_html_a7f37d871d35c43a03324502cea308635"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Component.html#a7f37d871d35c43a03324502cea308635">kaldi::nnet2::Component::InputDim</a></div><div class="ttdeci">virtual int32 InputDim() const =0</div><div class="ttdoc">Get size of input vectors. </div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Component_html_ac0f2f034a884363d4e0694c62ea8a764"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Component.html#ac0f2f034a884363d4e0694c62ea8a764">kaldi::nnet2::Component::OutputDim</a></div><div class="ttdeci">virtual int32 OutputDim() const =0</div><div class="ttdoc">Get size of output vectors. </div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1ChunkInfo_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1ChunkInfo.html">kaldi::nnet2::ChunkInfo</a></div><div class="ttdoc">ChunkInfo is a class whose purpose is to describe the structure of matrices holding features...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00072">nnet-component.h:72</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Component_html_a245d65d566725422b859c99bff7623f8"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Component.html#a245d65d566725422b859c99bff7623f8">kaldi::nnet2::Component::Info</a></div><div class="ttdeci">virtual std::string Info() const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l00305">nnet-component.cc:305</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2c0449c6e01b874d26ac39ad77f2ddea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c0449c6e01b874d26ac39ad77f2ddea">&#9670;&nbsp;</a></span>UnitTestMaxoutComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestMaxoutComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00263">263</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-component_8cc_source.html#l00428">MaxoutComponent::InitFromString()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                               {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="comment">// works if it has an initializer from int,</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="comment">// e.g. tanh, sigmoid.</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">// We&#39;re testing that the gradients are computed correctly:</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">// the input gradients and the model gradients.</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 5; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    int32 output_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        group_size = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10,</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        input_dim = output_dim * group_size;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1MaxoutComponent.html">MaxoutComponent</a> component(input_dim, output_dim);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1MaxoutComponent.html">MaxoutComponent</a> component;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1MaxoutComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(<span class="stringliteral">&quot;input-dim=15 output-dim=5&quot;</span>);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1MaxoutComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1MaxoutComponent.html">kaldi::nnet2::MaxoutComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00411">nnet-component.h:411</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1MaxoutComponent_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1MaxoutComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::MaxoutComponent::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l00428">nnet-component.cc:428</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7d1b9a108cc620a52a9ed9de184cc5a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d1b9a108cc620a52a9ed9de184cc5a1">&#9670;&nbsp;</a></span>UnitTestMaxpoolingComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestMaxpoolingComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00310">310</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-component_8cc_source.html#l04269">MaxpoolingComponent::InitFromString()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                                   {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="comment">// works if it has an initializer from int,</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">// e.g. tanh, sigmoid.</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="comment">// We&#39;re testing that the gradients are computed correctly:</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="comment">// the input gradients and the model gradients.</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 5; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    int32 pool_stride = 5 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10,</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;          pool_size = 2 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3,</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;          num_pools = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    int32 output_dim = num_pools * pool_stride;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    int32 num_patches = num_pools * pool_size;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    int32 input_dim = pool_stride * num_patches;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1MaxpoolingComponent.html">MaxpoolingComponent</a> component(input_dim, output_dim,</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                  pool_size, pool_stride);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1MaxpoolingComponent.html">MaxpoolingComponent</a> component;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1MaxpoolingComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(<span class="stringliteral">&quot;input-dim=192 output-dim=64 pool-size=3 pool-stride=16&quot;</span>);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1MaxpoolingComponent_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1MaxpoolingComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::MaxpoolingComponent::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l04269">nnet-component.cc:4269</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1MaxpoolingComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1MaxpoolingComponent.html">kaldi::nnet2::MaxpoolingComponent</a></div><div class="ttdoc">MaxPoolingComponent : Maxpooling component was firstly used in ConvNet for selecting an representativ...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00468">nnet-component.h:468</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2fb99b022cdfb98d97d51ebb36752dcc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2fb99b022cdfb98d97d51ebb36752dcc">&#9670;&nbsp;</a></span>UnitTestNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestNnet </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-nnet-test_8cc_source.html#l00026">26</a> of file <a class="el" href="nnet2_2nnet-nnet-test_8cc_source.html">nnet-nnet-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-nnet_8cc_source.html#l00772">GenRandomNnet()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00175">Nnet::Read()</a>, and <a class="el" href="_2nnet-nnet_8cc_source.html#l00160">Nnet::Write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet2_2nnet-nnet-test_8cc_source.html#l00050">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                    {</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  int32 input_dim = 40, output_dim = 500;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet = <a class="code" href="namespacekaldi_1_1nnet2.html#a07117e22b53a7ee4fe7262df208bc70d">GenRandomNnet</a>(input_dim, output_dim);</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordtype">bool</span> binary = (rand() % 2 == 0);</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  std::ostringstream os;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#a68f354fd5f096134162f01719096e6fc">Write</a>(os, binary);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> nnet2;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  std::istringstream is(os.str());</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  nnet2.<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#a8e7d2790fc7e94fe9780ccc937de1270">Read</a>(is, binary);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  std::ostringstream os2;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  nnet2.<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#a68f354fd5f096134162f01719096e6fc">Write</a>(os2, binary);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(os2.str() == os.str());</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keyword">delete</span> nnet;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html_a8e7d2790fc7e94fe9780ccc937de1270"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html#a8e7d2790fc7e94fe9780ccc937de1270">kaldi::nnet2::Nnet::Read</a></div><div class="ttdeci">void Read(std::istream &amp;is, bool binary)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00175">nnet-nnet.cc:175</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a07117e22b53a7ee4fe7262df208bc70d"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a07117e22b53a7ee4fe7262df208bc70d">kaldi::nnet2::GenRandomNnet</a></div><div class="ttdeci">Nnet * GenRandomNnet(int32 input_dim, int32 output_dim)</div><div class="ttdoc">This function generates a random neural net, for testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00772">nnet-nnet.cc:772</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html_a68f354fd5f096134162f01719096e6fc"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html#a68f354fd5f096134162f01719096e6fc">kaldi::nnet2::Nnet::Write</a></div><div class="ttdeci">void Write(std::ostream &amp;os, bool binary) const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00160">nnet-nnet.cc:160</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html">kaldi::nnet2::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00063">nnet-nnet.h:63</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa0da3631bf3928fbe3e69301cab4b042"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0da3631bf3928fbe3e69301cab4b042">&#9670;&nbsp;</a></span>UnitTestNnetCompute()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestNnetCompute </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-compute-test_8cc_source.html#l00029">29</a> of file <a class="el" href="nnet2_2nnet-compute-test_8cc_source.html">nnet-compute-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00275">kaldi::AssertEqual()</a>, <a class="el" href="nnet-compute-online_8cc_source.html#l00035">NnetOnlineComputer::Compute()</a>, <a class="el" href="nnet-compute-online_8cc_source.html#l00120">NnetOnlineComputer::Flush()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00772">GenRandomNnet()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00257">Nnet::Info()</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00042">Nnet::LeftContext()</a>, <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00160">NnetComputation()</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00056">Nnet::RightContext()</a>, and <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet2_2nnet-compute-test_8cc_source.html#l00125">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                           {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  int32 input_dim = 10 + rand() % 40, output_dim = 100 + rand() % 500;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordtype">bool</span> pad_input = (rand() % 2 == 0);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  </div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet = <a class="code" href="namespacekaldi_1_1nnet2.html#a07117e22b53a7ee4fe7262df208bc70d">GenRandomNnet</a>(input_dim, output_dim);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Left context = &quot;</span> &lt;&lt; nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#a16225aee5779372a30243f79b8746155">LeftContext</a>() &lt;&lt; <span class="stringliteral">&quot;, right context = &quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;            &lt;&lt; nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#ad9cb72009cfc56c1cb0e214210f06a71">RightContext</a>() &lt;&lt; <span class="stringliteral">&quot;, pad-input = &quot;</span> &lt;&lt; pad_input;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;NNet info is &quot;</span> &lt;&lt; nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#a245d65d566725422b859c99bff7623f8">Info</a>();</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  int32 num_feats = 5 + rand() % 1000;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input(num_feats, input_dim);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  input.SetRandn();</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  int32 num_output_rows = num_feats -</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      (pad_input ? 0 : nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#a16225aee5779372a30243f79b8746155">LeftContext</a>() + nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#ad9cb72009cfc56c1cb0e214210f06a71">RightContext</a>());</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordflow">if</span> (num_output_rows &lt;= 0)</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output1(num_output_rows, output_dim);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#aeff1c1ada8948d90166bccf6ff83cf3e">NnetComputation</a>(*nnet, input, pad_input, &amp;output1);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output2(output1.NumRows(), output1.NumCols());</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  int32 cur_input_pos = 0, cur_output_pos = 0;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1NnetOnlineComputer.html">NnetOnlineComputer</a> computer(*nnet, pad_input);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keywordflow">while</span> (cur_input_pos &lt;= num_feats) {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    int32 feats_left = num_feats - cur_input_pos;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> output_part;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">if</span> (feats_left &gt; 0) {</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      int32 chunk_size = std::min&lt;int32&gt;(1 + rand() % 10, feats_left);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <a class="code" href="classkaldi_1_1CuSubMatrix.html">CuSubMatrix&lt;BaseFloat&gt;</a> input_part(input, cur_input_pos, chunk_size,</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                                        0, input_dim);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      computer.Compute(input_part, &amp;output_part);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      cur_input_pos += chunk_size;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      computer.Flush(&amp;output_part);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      cur_input_pos++; <span class="comment">// will terminate the loop.</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">if</span> (output_part.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>() != 0) {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      output2.Range(cur_output_pos, output_part.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>(),</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                    0, output_dim).CopyFromMat(output_part);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      cur_output_pos += output_part.<a class="code" href="classkaldi_1_1CuMatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">NumRows</a>();</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  }  </div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(output1, output2);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; output1.NumRows(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// just double-check that the frames near the end are right, in case</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// the test above somehow passed despite that.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 10 || output1.NumRows() - <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 10) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <a class="code" href="classkaldi_1_1CuSubVector.html">CuSubVector&lt;BaseFloat&gt;</a> vec1(output1, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>), vec2(output2, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(vec1, vec2);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;OK&quot;</span>;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keyword">delete</span> nnet;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html_a16225aee5779372a30243f79b8746155"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html#a16225aee5779372a30243f79b8746155">kaldi::nnet2::Nnet::LeftContext</a></div><div class="ttdeci">int32 LeftContext() const</div><div class="ttdoc">Returns the left-context summed over all the Components... </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00042">nnet-nnet.cc:42</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a07117e22b53a7ee4fe7262df208bc70d"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a07117e22b53a7ee4fe7262df208bc70d">kaldi::nnet2::GenRandomNnet</a></div><div class="ttdeci">Nnet * GenRandomNnet(int32 input_dim, int32 output_dim)</div><div class="ttdoc">This function generates a random neural net, for testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00772">nnet-nnet.cc:772</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1NnetOnlineComputer_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1NnetOnlineComputer.html">kaldi::nnet2::NnetOnlineComputer</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-compute-online_8h_source.html#l00041">nnet-compute-online.h:41</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_aeff1c1ada8948d90166bccf6ff83cf3e"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#aeff1c1ada8948d90166bccf6ff83cf3e">kaldi::nnet2::NnetComputation</a></div><div class="ttdeci">void NnetComputation(const Nnet &amp;nnet, const CuMatrixBase&lt; BaseFloat &gt; &amp;input, bool pad_input, CuMatrixBase&lt; BaseFloat &gt; *output)</div><div class="ttdoc">Does the basic neural net computation, on a sequence of data (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-compute_8cc_source.html#l00160">nnet-compute.cc:160</a></div></div>
<div class="ttc" id="classkaldi_1_1CuSubVector_html"><div class="ttname"><a href="classkaldi_1_1CuSubVector.html">kaldi::CuSubVector</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00073">matrix-common.h:73</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html_ad9cb72009cfc56c1cb0e214210f06a71"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html#ad9cb72009cfc56c1cb0e214210f06a71">kaldi::nnet2::Nnet::RightContext</a></div><div class="ttdeci">int32 RightContext() const</div><div class="ttdoc">Returns the right-context summed over all the Components... </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00056">nnet-nnet.cc:56</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html">kaldi::nnet2::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00063">nnet-nnet.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html_a245d65d566725422b859c99bff7623f8"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html#a245d65d566725422b859c99bff7623f8">kaldi::nnet2::Nnet::Info</a></div><div class="ttdeci">std::string Info() const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00257">nnet-nnet.cc:257</a></div></div>
<div class="ttc" id="classkaldi_1_1CuSubMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuSubMatrix.html">kaldi::CuSubMatrix</a></div><div class="ttdoc">This class is used for a piece of a CuMatrix. </div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00070">matrix-common.h:70</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_aeb6ba6085493e3f15358e49751342177"><div class="ttname"><a href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">kaldi::AssertEqual</a></div><div class="ttdeci">static void AssertEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">assert abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)) </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00275">kaldi-math.h:275</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrixBase_html_a01cf7fccddf8deddc75b34408144ded1"><div class="ttname"><a href="classkaldi_1_1CuMatrixBase.html#a01cf7fccddf8deddc75b34408144ded1">kaldi::CuMatrixBase::NumRows</a></div><div class="ttdeci">MatrixIndexT NumRows() const</div><div class="ttdoc">Dimensions. </div><div class="ttdef"><b>Definition:</b> <a href="cu-matrix_8h_source.html#l00214">cu-matrix.h:214</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a327c0e20b1d09d390e3ca08e396803dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a327c0e20b1d09d390e3ca08e396803dd">&#9670;&nbsp;</a></span>UnitTestNnetComputeChunked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestNnetComputeChunked </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-compute-test_8cc_source.html#l00084">84</a> of file <a class="el" href="nnet2_2nnet-compute-test_8cc_source.html">nnet-compute-test.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00275">kaldi::AssertEqual()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00772">GenRandomNnet()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00257">Nnet::Info()</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00042">Nnet::LeftContext()</a>, <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00160">NnetComputation()</a>, <a class="el" href="nnet2_2nnet-compute_8cc_source.html#l00169">NnetComputationChunked()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00056">Nnet::RightContext()</a>, and <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet2_2nnet-compute-test_8cc_source.html#l00125">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                                  {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  int32 input_dim = 10 + rand() % 40, output_dim = 100 + rand() % 500;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordtype">bool</span> pad_input = <span class="keyword">true</span>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  </div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet = <a class="code" href="namespacekaldi_1_1nnet2.html#a07117e22b53a7ee4fe7262df208bc70d">GenRandomNnet</a>(input_dim, output_dim);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  int32 num_feats = 100 + rand() % 500;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  int32 chunk_size = num_feats / (2 + rand() % 10);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> input(num_feats, input_dim);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  input.SetRandn();</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Left context = &quot;</span> &lt;&lt; nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#a16225aee5779372a30243f79b8746155">LeftContext</a>() </div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, right context = &quot;</span> &lt;&lt; nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#ad9cb72009cfc56c1cb0e214210f06a71">RightContext</a>() </div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;, chunk size = &quot;</span> &lt;&lt; chunk_size;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;NNet info is &quot;</span> &lt;&lt; nnet-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html#a245d65d566725422b859c99bff7623f8">Info</a>();</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  int32 num_output_rows = num_feats;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> cu_output1(num_output_rows, output_dim);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> output2(num_output_rows, output_dim);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#aeff1c1ada8948d90166bccf6ff83cf3e">NnetComputation</a>(*nnet, input, pad_input, &amp;cu_output1);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#a532f607f0ac5014ef8d4c9ff116a22b8">NnetComputationChunked</a>(*nnet, <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a>(input), chunk_size, </div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                         &amp;output2);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> output1(cu_output1);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(output1, output2);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; output1.NumRows(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">// just double-check that the frames near the end are right, in case</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// the test above somehow passed despite that.</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 10 || output1.NumRows() - <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 10) {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <a class="code" href="classkaldi_1_1SubVector.html">SubVector&lt;BaseFloat&gt;</a> vec1(output1, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>), vec2(output2, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(vec1, vec2);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;OK&quot;</span>;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keyword">delete</span> nnet;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html_a16225aee5779372a30243f79b8746155"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html#a16225aee5779372a30243f79b8746155">kaldi::nnet2::Nnet::LeftContext</a></div><div class="ttdeci">int32 LeftContext() const</div><div class="ttdoc">Returns the left-context summed over all the Components... </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00042">nnet-nnet.cc:42</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a07117e22b53a7ee4fe7262df208bc70d"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a07117e22b53a7ee4fe7262df208bc70d">kaldi::nnet2::GenRandomNnet</a></div><div class="ttdeci">Nnet * GenRandomNnet(int32 input_dim, int32 output_dim)</div><div class="ttdoc">This function generates a random neural net, for testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00772">nnet-nnet.cc:772</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_aeff1c1ada8948d90166bccf6ff83cf3e"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#aeff1c1ada8948d90166bccf6ff83cf3e">kaldi::nnet2::NnetComputation</a></div><div class="ttdeci">void NnetComputation(const Nnet &amp;nnet, const CuMatrixBase&lt; BaseFloat &gt; &amp;input, bool pad_input, CuMatrixBase&lt; BaseFloat &gt; *output)</div><div class="ttdoc">Does the basic neural net computation, on a sequence of data (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-compute_8cc_source.html#l00160">nnet-compute.cc:160</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a532f607f0ac5014ef8d4c9ff116a22b8"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a532f607f0ac5014ef8d4c9ff116a22b8">kaldi::nnet2::NnetComputationChunked</a></div><div class="ttdeci">void NnetComputationChunked(const Nnet &amp;nnet, const Matrix&lt; BaseFloat &gt; &amp;input, int32 chunk_size, Matrix&lt; BaseFloat &gt; *output)</div><div class="ttdoc">Does the basic neural net computation, on a sequence of data (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-compute_8cc_source.html#l00169">nnet-compute.cc:169</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html_ad9cb72009cfc56c1cb0e214210f06a71"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html#ad9cb72009cfc56c1cb0e214210f06a71">kaldi::nnet2::Nnet::RightContext</a></div><div class="ttdeci">int32 RightContext() const</div><div class="ttdoc">Returns the right-context summed over all the Components... </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00056">nnet-nnet.cc:56</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html">kaldi::nnet2::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00063">nnet-nnet.h:63</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html_a245d65d566725422b859c99bff7623f8"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html#a245d65d566725422b859c99bff7623f8">kaldi::nnet2::Nnet::Info</a></div><div class="ttdeci">std::string Info() const</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00257">nnet-nnet.cc:257</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_aeb6ba6085493e3f15358e49751342177"><div class="ttname"><a href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">kaldi::AssertEqual</a></div><div class="ttdeci">static void AssertEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">assert abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)) </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00275">kaldi-math.h:275</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="classkaldi_1_1SubVector_html"><div class="ttname"><a href="classkaldi_1_1SubVector.html">kaldi::SubVector</a></div><div class="ttdoc">Represents a non-allocating general vector which can be defined as a sub-vector of higher-level vecto...</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00485">kaldi-vector.h:485</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7a7990555e9bc1055173eb2628e2b540"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a7990555e9bc1055173eb2628e2b540">&#9670;&nbsp;</a></span>UnitTestNnetDecodable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestNnetDecodable </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="online-nnet2-decodable-test_8cc_source.html#l00031">31</a> of file <a class="el" href="online-nnet2-decodable-test_8cc_source.html">online-nnet2-decodable-test.cc</a>.</p>

<p class="reference">References <a class="el" href="online-nnet2-decodable_8h_source.html#l00038">DecodableNnet2OnlineOptions::acoustic_scale</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00805">VectorBase&lt; Real &gt;::ApplyExp()</a>, <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="context-dep_8cc_source.html#l00097">kaldi::GenRandContextDependencyLarge()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00772">GenRandomNnet()</a>, <a class="el" href="hmm-test-utils_8cc_source.html#l00050">kaldi::GetDefaultTopology()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="online-nnet2-decodable_8cc_source.html#l00049">DecodableNnet2Online::LogLikelihood()</a>, <a class="el" href="decodable-am-nnet_8h_source.html#l00077">DecodableAmNnet::LogLikelihood()</a>, <a class="el" href="online-nnet2-decodable_8h_source.html#l00040">DecodableNnet2OnlineOptions::max_nnet_batch_size</a>, <a class="el" href="online-nnet2-decodable_8cc_source.html#l00066">DecodableNnet2Online::NumFramesReady()</a>, <a class="el" href="decodable-am-nnet_8h_source.html#l00082">DecodableAmNnet::NumFramesReady()</a>, <a class="el" href="transition-model_8h_source.html#l00185">TransitionModel::NumPdfs()</a>, <a class="el" href="transition-model_8h_source.html#l00170">TransitionModel::NumTransitionIds()</a>, <a class="el" href="online-nnet2-decodable_8h_source.html#l00039">DecodableNnet2OnlineOptions::pad_input</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00962">VectorBase&lt; Real &gt;::Scale()</a>, <a class="el" href="am-nnet_8cc_source.html#l00044">AmNnet::SetPriors()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00301">VectorBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01354">MatrixBase&lt; Real &gt;::SetRandn()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00693">VectorBase&lt; Real &gt;::Sum()</a>.</p>

<p class="reference">Referenced by <a class="el" href="online-nnet2-decodable-test_8cc_source.html#l00104">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                             {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  std::vector&lt;int32&gt; phones;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  phones.push_back(1);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 2; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 20; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">if</span> (rand() % 2 == 0)</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      phones.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  int32 N = 2 + rand() % 2, <span class="comment">// context-size N is 2 or 3.</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      P = rand() % N;  <span class="comment">// Central-phone is random on [0, N)</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  std::vector&lt;int32&gt; num_pdf_classes;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="code" href="classkaldi_1_1ContextDependency.html">ContextDependency</a> *ctx_dep =</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      <a class="code" href="namespacekaldi.html#a0bcd0ad4d591146319cff710173bbe8f">GenRandContextDependencyLarge</a>(phones, N, P,</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                                    <span class="keyword">true</span>, &amp;num_pdf_classes);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="classkaldi_1_1HmmTopology.html">HmmTopology</a> topo = <a class="code" href="namespacekaldi.html#a67073fc972047fa58fac23aecf5205e6">GetDefaultTopology</a>(phones);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> trans_model(*ctx_dep, topo);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keyword">delete</span> ctx_dep; <span class="comment">// We won&#39;t need this further.</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  ctx_dep = NULL;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  int32 input_dim = 40, output_dim = trans_model.<a class="code" href="classkaldi_1_1ContextDependency.html#a83fc89696d0ba4d96262cf9438100154">NumPdfs</a>();</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *nnet = <a class="code" href="namespacekaldi_1_1nnet2.html#a07117e22b53a7ee4fe7262df208bc70d">GenRandomNnet</a>(input_dim, output_dim);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1AmNnet.html">AmNnet</a> am_nnet(*nnet);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keyword">delete</span> nnet;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  nnet = NULL;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> priors(output_dim);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  priors.SetRandn();</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  priors.ApplyExp();</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  priors.Scale(1.0 / priors.Sum());</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  am_nnet.SetPriors(priors);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <a class="code" href="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions.html">DecodableNnet2OnlineOptions</a> opts;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  opts.<a class="code" href="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions.html#adce279d46c793958fb23fc4ae9c16e0a">max_nnet_batch_size</a> = 20;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  opts.<a class="code" href="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions.html#adf28936259c04ff2a4c4d1af293ffea9">acoustic_scale</a> = 0.1;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  opts.<a class="code" href="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions.html#ac04ac653cf4e459f64f1adb0c52ba2da">pad_input</a> = (rand() % 2 == 0);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  int32 num_input_frames = 400;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> input_feats(num_input_frames, input_dim);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  input_feats.SetRandn();</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="classkaldi_1_1OnlineMatrixFeature.html">OnlineMatrixFeature</a> matrix_feature(input_feats);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1DecodableNnet2Online.html">DecodableNnet2Online</a> online_decodable(am_nnet, trans_model,</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                                        opts, &amp;matrix_feature);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1DecodableAmNnet.html">DecodableAmNnet</a> offline_decodable(trans_model, am_nnet,</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a>(input_feats),</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                                    opts.<a class="code" href="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions.html#ac04ac653cf4e459f64f1adb0c52ba2da">pad_input</a>,</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                                    opts.<a class="code" href="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions.html#adf28936259c04ff2a4c4d1af293ffea9">acoustic_scale</a>);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(online_decodable.NumFramesReady() ==</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;               offline_decodable.NumFramesReady());</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  int32 num_frames = online_decodable.NumFramesReady(),</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      num_tids = trans_model.NumTransitionIds();</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 50; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    int32 t = rand() % num_frames, tid = 1 + rand() % num_tids;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> l1 = online_decodable.LogLikelihood(t, tid),</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        l2 = offline_decodable.LogLikelihood(t, tid);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(l1, l2));</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;}</div><div class="ttc" id="classkaldi_1_1OnlineMatrixFeature_html"><div class="ttname"><a href="classkaldi_1_1OnlineMatrixFeature.html">kaldi::OnlineMatrixFeature</a></div><div class="ttdoc">This class takes a Matrix&lt;BaseFloat&gt; and wraps it as an OnlineFeatureInterface: this can be useful wh...</div><div class="ttdef"><b>Definition:</b> <a href="online-feature_8h_source.html#l00138">online-feature.h:138</a></div></div>
<div class="ttc" id="namespacekaldi_html_a67073fc972047fa58fac23aecf5205e6"><div class="ttname"><a href="namespacekaldi.html#a67073fc972047fa58fac23aecf5205e6">kaldi::GetDefaultTopology</a></div><div class="ttdeci">HmmTopology GetDefaultTopology(const std::vector&lt; int32 &gt; &amp;phones_in)</div><div class="ttdoc">This function returns a HmmTopology object giving a normal 3-state topology, covering all phones in t...</div><div class="ttdef"><b>Definition:</b> <a href="hmm-test-utils_8cc_source.html#l00050">hmm-test-utils.cc:50</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0bcd0ad4d591146319cff710173bbe8f"><div class="ttname"><a href="namespacekaldi.html#a0bcd0ad4d591146319cff710173bbe8f">kaldi::GenRandContextDependencyLarge</a></div><div class="ttdeci">ContextDependency * GenRandContextDependencyLarge(const std::vector&lt; int32 &gt; &amp;phone_ids, int N, int P, bool ensure_all_covered, std::vector&lt; int32 &gt; *hmm_lengths)</div><div class="ttdoc">GenRandContextDependencyLarge is like GenRandContextDependency but generates a larger tree with speci...</div><div class="ttdef"><b>Definition:</b> <a href="context-dep_8cc_source.html#l00097">context-dep.cc:97</a></div></div>
<div class="ttc" id="classkaldi_1_1HmmTopology_html"><div class="ttname"><a href="classkaldi_1_1HmmTopology.html">kaldi::HmmTopology</a></div><div class="ttdoc">A class for storing topology information for phones. </div><div class="ttdef"><b>Definition:</b> <a href="hmm-topology_8h_source.html#l00094">hmm-topology.h:94</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1AmNnet_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1AmNnet.html">kaldi::nnet2::AmNnet</a></div><div class="ttdef"><b>Definition:</b> <a href="am-nnet_8h_source.html#l00038">am-nnet.h:38</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a07117e22b53a7ee4fe7262df208bc70d"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a07117e22b53a7ee4fe7262df208bc70d">kaldi::nnet2::GenRandomNnet</a></div><div class="ttdeci">Nnet * GenRandomNnet(int32 input_dim, int32 output_dim)</div><div class="ttdoc">This function generates a random neural net, for testing purposes. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00772">nnet-nnet.cc:772</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions_html_ac04ac653cf4e459f64f1adb0c52ba2da"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions.html#ac04ac653cf4e459f64f1adb0c52ba2da">kaldi::nnet2::DecodableNnet2OnlineOptions::pad_input</a></div><div class="ttdeci">bool pad_input</div><div class="ttdef"><b>Definition:</b> <a href="online-nnet2-decodable_8h_source.html#l00039">online-nnet2-decodable.h:39</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1ContextDependency_html"><div class="ttname"><a href="classkaldi_1_1ContextDependency.html">kaldi::ContextDependency</a></div><div class="ttdef"><b>Definition:</b> <a href="context-dep_8h_source.html#l00059">context-dep.h:59</a></div></div>
<div class="ttc" id="classkaldi_1_1TransitionModel_html"><div class="ttname"><a href="classkaldi_1_1TransitionModel.html">kaldi::TransitionModel</a></div><div class="ttdef"><b>Definition:</b> <a href="transition-model_8h_source.html#l00122">transition-model.h:122</a></div></div>
<div class="ttc" id="classkaldi_1_1ContextDependency_html_a83fc89696d0ba4d96262cf9438100154"><div class="ttname"><a href="classkaldi_1_1ContextDependency.html#a83fc89696d0ba4d96262cf9438100154">kaldi::ContextDependency::NumPdfs</a></div><div class="ttdeci">virtual int32 NumPdfs() const</div><div class="ttdoc">NumPdfs() returns the number of acoustic pdfs (they are numbered 0.. NumPdfs()-1). </div><div class="ttdef"><b>Definition:</b> <a href="context-dep_8h_source.html#l00071">context-dep.h:71</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1Nnet.html">kaldi::nnet2::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00063">nnet-nnet.h:63</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions.html">kaldi::nnet2::DecodableNnet2OnlineOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="online-nnet2-decodable_8h_source.html#l00037">online-nnet2-decodable.h:37</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1DecodableNnet2Online_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1DecodableNnet2Online.html">kaldi::nnet2::DecodableNnet2Online</a></div><div class="ttdoc">This Decodable object for class nnet2::AmNnet takes feature input from class OnlineFeatureInterface, unlike, say, class DecodableAmNnet which takes feature input from a matrix. </div><div class="ttdef"><b>Definition:</b> <a href="online-nnet2-decodable_8h_source.html#l00068">online-nnet2-decodable.h:68</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1DecodableAmNnet_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1DecodableAmNnet.html">kaldi::nnet2::DecodableAmNnet</a></div><div class="ttdoc">DecodableAmNnet is a decodable object that decodes with a neural net acoustic model of type AmNnet...</div><div class="ttdef"><b>Definition:</b> <a href="decodable-am-nnet_8h_source.html#l00037">decodable-am-nnet.h:37</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions_html_adf28936259c04ff2a4c4d1af293ffea9"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions.html#adf28936259c04ff2a4c4d1af293ffea9">kaldi::nnet2::DecodableNnet2OnlineOptions::acoustic_scale</a></div><div class="ttdeci">BaseFloat acoustic_scale</div><div class="ttdef"><b>Definition:</b> <a href="online-nnet2-decodable_8h_source.html#l00038">online-nnet2-decodable.h:38</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions_html_adce279d46c793958fb23fc4ae9c16e0a"><div class="ttname"><a href="structkaldi_1_1nnet2_1_1DecodableNnet2OnlineOptions.html#adce279d46c793958fb23fc4ae9c16e0a">kaldi::nnet2::DecodableNnet2OnlineOptions::max_nnet_batch_size</a></div><div class="ttdeci">int32 max_nnet_batch_size</div><div class="ttdef"><b>Definition:</b> <a href="online-nnet2-decodable_8h_source.html#l00040">online-nnet2-decodable.h:40</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aaca439d5f248e1204633705a2ff0ab22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaca439d5f248e1204633705a2ff0ab22">&#9670;&nbsp;</a></span>UnitTestParsing()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestParsing </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00696">696</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="_2nnet-component_8cc_source.html#l00153">ParseFromString()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                       {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> f;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keywordtype">bool</span> b;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  std::vector&lt;int32&gt; v;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  std::string s = <span class="stringliteral">&quot;x=y&quot;</span>;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a>(<span class="stringliteral">&quot;foo&quot;</span>, &amp;s, &amp;i) == <span class="keyword">false</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;               &amp;&amp; s == <span class="stringliteral">&quot;x=y&quot;</span>);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a>(<span class="stringliteral">&quot;foo&quot;</span>, &amp;s, &amp;f) == <span class="keyword">false</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;               &amp;&amp; s == <span class="stringliteral">&quot;x=y&quot;</span>);</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a>(<span class="stringliteral">&quot;foo&quot;</span>, &amp;s, &amp;v) == <span class="keyword">false</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;               &amp;&amp; s == <span class="stringliteral">&quot;x=y&quot;</span>);</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a>(<span class="stringliteral">&quot;foo&quot;</span>, &amp;s, &amp;b) == <span class="keyword">false</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;               &amp;&amp; s == <span class="stringliteral">&quot;x=y&quot;</span>);</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  {</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    std::string s = <span class="stringliteral">&quot;x=1&quot;</span>;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a>(<span class="stringliteral">&quot;x&quot;</span>, &amp;s, &amp;i) == <span class="keyword">true</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                 &amp;&amp; i == 1 &amp;&amp; s == <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    s = <span class="stringliteral">&quot;a=b x=1&quot;</span>;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a>(<span class="stringliteral">&quot;x&quot;</span>, &amp;s, &amp;i) == <span class="keyword">true</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                 &amp;&amp; i == 1 &amp;&amp; s == <span class="stringliteral">&quot;a=b&quot;</span>);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  }</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  {</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    std::string s = <span class="stringliteral">&quot;foo=false&quot;</span>;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a>(<span class="stringliteral">&quot;foo&quot;</span>, &amp;s, &amp;b) == <span class="keyword">true</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                 &amp;&amp; b == <span class="keyword">false</span> &amp;&amp; s == <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    s = <span class="stringliteral">&quot;x=y foo=true a=b&quot;</span>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a>(<span class="stringliteral">&quot;foo&quot;</span>, &amp;s, &amp;b) == <span class="keyword">true</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                 &amp;&amp; b == <span class="keyword">true</span> &amp;&amp; s == <span class="stringliteral">&quot;x=y a=b&quot;</span>);</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  }</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  {</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    std::string s = <span class="stringliteral">&quot;foobar x=1&quot;</span>;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a>(<span class="stringliteral">&quot;x&quot;</span>, &amp;s, &amp;f) == <span class="keyword">true</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                 &amp;&amp; f == 1.0 &amp;&amp; s == <span class="stringliteral">&quot;foobar&quot;</span>);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    s = <span class="stringliteral">&quot;a=b x=1 bxy&quot;</span>;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a>(<span class="stringliteral">&quot;x&quot;</span>, &amp;s, &amp;f) == <span class="keyword">true</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                 &amp;&amp; f == 1.0 &amp;&amp; s == <span class="stringliteral">&quot;a=b bxy&quot;</span>);</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  }</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  {</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    std::string s = <span class="stringliteral">&quot;x=1:2:3&quot;</span>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a>(<span class="stringliteral">&quot;x&quot;</span>, &amp;s, &amp;v) == <span class="keyword">true</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                 &amp;&amp; v.size() == 3 &amp;&amp; v[0] == 1 &amp;&amp; v[1] == 2 &amp;&amp; v[2] == 3</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                 &amp;&amp; s == <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    s = <span class="stringliteral">&quot;a=b x=1:2:3 c=d&quot;</span>;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">ParseFromString</a>(<span class="stringliteral">&quot;x&quot;</span>, &amp;s, &amp;v) == <span class="keyword">true</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                 &amp;&amp; f == 1.0 &amp;&amp; s == <span class="stringliteral">&quot;a=b c=d&quot;</span>);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;}</div><div class="ttc" id="namespacekaldi_1_1nnet2_html_a0e18825b4c5b0834e638296b2f5bb35a"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a0e18825b4c5b0834e638296b2f5bb35a">kaldi::nnet2::ParseFromString</a></div><div class="ttdeci">bool ParseFromString(const std::string &amp;name, std::string *string, int32 *param)</div><div class="ttdoc">Functions used in Init routines. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l00153">nnet-component.cc:153</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae348b18eedab6f65394f3d9d3de311ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae348b18eedab6f65394f3d9d3de311ad">&#9670;&nbsp;</a></span>UnitTestPnormComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestPnormComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00286">286</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                              {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">// We&#39;re testing that the gradients are computed correctly:</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">// the input gradients and the model gradients.</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  int32 num_fail = 0, num_tries = 4;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_tries; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      int32 output_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20,</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;          group_size = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10,</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;          input_dim = output_dim * group_size;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> p = 1.0 + 0.1 * (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <a class="code" href="classkaldi_1_1nnet2_1_1PnormComponent.html">PnormComponent</a> component(input_dim, output_dim, p);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    } <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring test failure in UnitTestPnormComponent().&quot;</span>;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      num_fail++;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    }</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">if</span> (num_fail &gt;= num_tries/2) {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Too many test failures.&quot;</span>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1PnormComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1PnormComponent.html">kaldi::nnet2::PnormComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00514">nnet-component.h:514</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a761b9716989ec9bc47f55a6cf2445540"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a761b9716989ec9bc47f55a6cf2445540">&#9670;&nbsp;</a></span>UnitTestPreconditionDirections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestPreconditionDirections </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-test_8cc_source.html#l00026">26</a> of file <a class="el" href="nnet-precondition-test_8cc_source.html">nnet-precondition-test.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-sp-matrix_8cc_source.html#l00130">CuSpMatrix&lt; Real &gt;::AddMat2()</a>, <a class="el" href="cu-vector_8cc_source.html#l00507">CuVectorBase&lt; Real &gt;::AddSpVec()</a>, <a class="el" href="cu-sp-matrix_8cc_source.html#l00108">CuSpMatrix&lt; Real &gt;::AddVec2()</a>, <a class="el" href="cu-vector_8cc_source.html#l00555">CuVectorBase&lt; Real &gt;::ApproxEqual()</a>, <a class="el" href="cu-sp-matrix_8cc_source.html#l00093">CuSpMatrix&lt; Real &gt;::Invert()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="nnet-precondition_8cc_source.html#l00026">PreconditionDirections()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="cu-packed-matrix_8cc_source.html#l00312">CuPackedMatrix&lt; Real &gt;::ScaleDiag()</a>, <a class="el" href="cu-matrix_8cc_source.html#l03099">CuMatrixBase&lt; Real &gt;::SetRandn()</a>, and <a class="el" href="cu-packed-matrix_8cc_source.html#l00366">CuPackedMatrix&lt; Real &gt;::SetUnit()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-test_8cc_source.html#l00062">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                                      {</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> N = 2 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 30,</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;               D = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> lambda = 0.1;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> R(N, D), P(N, D);</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  R.SetRandn();</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  P.SetRandn(); <span class="comment">// contents should be overwritten.</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#af25337b8d10c63cb5a7dfb06cb732f17">PreconditionDirections</a>(R, lambda, &amp;P);</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="comment">// The rest of this function will do the computation the function is doing in</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="comment">// a different, less efficient way and compare with the function call.</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  </div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="classkaldi_1_1CuSpMatrix.html">CuSpMatrix&lt;BaseFloat&gt;</a> G(D);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  G.SetUnit();</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  G.ScaleDiag(lambda);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="comment">// G += R^T R.</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  G.AddMat2(1.0/(N-1), R, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 1.0);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  </div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; N; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="classkaldi_1_1CuSubVector.html">CuSubVector&lt;BaseFloat&gt;</a> rn(R, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="classkaldi_1_1CuSpMatrix.html">CuSpMatrix&lt;BaseFloat&gt;</a> Gn(G);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    Gn.AddVec2(-1.0/(N-1), rn); <span class="comment">// subtract the</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// outer product of &quot;this&quot; vector.</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    Gn.Invert();</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="classkaldi_1_1CuSubVector.html">CuSubVector&lt;BaseFloat&gt;</a> pn(P, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> pn_compare(D);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    pn_compare.AddSpVec(1.0, Gn, rn, 0.0);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(pn.ApproxEqual(pn_compare, 0.1));</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  }</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div><div class="ttc" id="classkaldi_1_1CuVector_html"><div class="ttname"><a href="classkaldi_1_1CuVector.html">kaldi::CuVector</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00074">matrix-common.h:74</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_af25337b8d10c63cb5a7dfb06cb732f17"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#af25337b8d10c63cb5a7dfb06cb732f17">kaldi::nnet2::PreconditionDirections</a></div><div class="ttdeci">void PreconditionDirections(const CuMatrixBase&lt; BaseFloat &gt; &amp;R, double lambda, CuMatrixBase&lt; BaseFloat &gt; *P)</div><div class="ttdoc">See below for comment. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition_8cc_source.html#l00026">nnet-precondition.cc:26</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1CuSpMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuSpMatrix.html">kaldi::CuSpMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00076">matrix-common.h:76</a></div></div>
<div class="ttc" id="classkaldi_1_1CuSubVector_html"><div class="ttname"><a href="classkaldi_1_1CuSubVector.html">kaldi::CuSubVector</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00073">matrix-common.h:73</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_aac2c220416519a2b0a7ad822ee2ef972"><div class="ttname"><a href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">kaldi::MatrixIndexT</a></div><div class="ttdeci">int32 MatrixIndexT</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00098">matrix-common.h:98</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a57b7c946a7595e2060af3518bc3db512"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57b7c946a7595e2060af3518bc3db512">&#9670;&nbsp;</a></span>UnitTestPreconditionDirectionsOnline()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestPreconditionDirectionsOnline </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online-test_8cc_source.html#l00262">262</a> of file <a class="el" href="nnet-precondition-online-test_8cc_source.html">nnet-precondition-online-test.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-vector_8cc_source.html#l00583">CuVectorBase&lt; Real &gt;::AddDiagMatMat()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00128">MatrixBase&lt; Real &gt;::AddVecVec()</a>, <a class="el" href="kaldi-math_8h_source.html#l00275">kaldi::AssertEqual()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="nnet-precondition-online-test_8cc_source.html#l00067">OnlinePreconditionerSimple::PreconditionDirections()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00145">OnlinePreconditioner::PreconditionDirections()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00962">VectorBase&lt; Real &gt;::Scale()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01338">MatrixBase&lt; Real &gt;::Set()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00301">VectorBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01354">MatrixBase&lt; Real &gt;::SetRandn()</a>, <a class="el" href="nnet-precondition-online-test_8cc_source.html#l00033">OnlinePreconditionerSimple::SetRank()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00621">OnlinePreconditioner::SetRank()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00422">OnlinePreconditioner::TurnOnDebug()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online-test_8cc_source.html#l00327">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                                            {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> R = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 30,  <span class="comment">// rank of correction</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      N = (2 * R) + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 30,  <span class="comment">// batch size</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      D = R + 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20; <span class="comment">// problem dimension.  Must be &gt; R.</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">// Test sometimes with features that are all-zero or all-one; this will</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">// help to make sure low-rank or zero input doesn&#39;t crash the code.</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordtype">bool</span> zero = <span class="keyword">false</span>;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordtype">bool</span> one = <span class="keyword">false</span>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3 == 0) zero = <span class="keyword">true</span>;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">//else if (Rand() % 2 == 0) one = true;</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> row_prod1(N), row_prod2(N);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> gamma1, gamma2;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> big_eig_factor = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 20);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  big_eig_factor = big_eig_factor * big_eig_factor;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> big_eig_vector(D);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  big_eig_vector.SetRandn();</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  big_eig_vector.Scale(big_eig_factor);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditionerSimple.html">OnlinePreconditionerSimple</a> preconditioner1;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html">OnlinePreconditioner</a> preconditioner2;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  preconditioner1.<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditionerSimple.html#afb9bffca178027f3e5d52ec73a1ee0fe">SetRank</a>(R);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  preconditioner2.<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#afb9bffca178027f3e5d52ec73a1ee0fe">SetRank</a>(R);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  preconditioner2.<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a35086953bbc759bd2ac9cb660d87d83f">TurnOnDebug</a>();</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  int32 num_iters = 100;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordflow">for</span> (int32 iter = 0; iter &lt; num_iters; iter++) {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="classkaldi_1_1Matrix.html">Matrix&lt;BaseFloat&gt;</a> M_cpu(N, D);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span> (one) M_cpu.Set(1.0);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!zero) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      M_cpu.SetRandn();</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <a class="code" href="classkaldi_1_1Vector.html">Vector&lt;BaseFloat&gt;</a> rand_vec(N);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      rand_vec.SetRandn();</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      M_cpu.AddVecVec(1.0, rand_vec, big_eig_vector);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> M(M_cpu);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <a class="code" href="classkaldi_1_1CuMatrix.html">CuMatrix&lt;BaseFloat&gt;</a> Mcopy1(M), Mcopy2(M);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    preconditioner1.<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditionerSimple.html#a40de84aa34756dd2c783f5f8a131670a">PreconditionDirections</a>(&amp;Mcopy1, &amp;row_prod1, &amp;gamma1);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    preconditioner2.<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a40de84aa34756dd2c783f5f8a131670a">PreconditionDirections</a>(&amp;Mcopy2, &amp;row_prod2, &amp;gamma2);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> trace1 = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(M, M, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>),</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        trace2 = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(Mcopy1, Mcopy1, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(trace1, trace2 * gamma2 * gamma2, 1.0e-02);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(Mcopy1, Mcopy2);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    AssertEqual&lt;BaseFloat&gt;(row_prod1, row_prod2, 1.0e-02);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(gamma1, gamma2, 1.0e-02);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">// make sure positive definite</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="classkaldi_1_1CuVector.html">CuVector&lt;BaseFloat&gt;</a> inner_prods(M.NumRows());</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    inner_prods.<a class="code" href="classkaldi_1_1CuVectorBase.html#a46c4e5094335a6e257a08cb9ae0e7ff0">AddDiagMatMat</a>(1.0, M, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, Mcopy1, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(inner_prods.Min() &gt;= 0.0);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;}</div><div class="ttc" id="classkaldi_1_1CuVector_html"><div class="ttname"><a href="classkaldi_1_1CuVector.html">kaldi::CuVector</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00074">matrix-common.h:74</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_afb9bffca178027f3e5d52ec73a1ee0fe"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#afb9bffca178027f3e5d52ec73a1ee0fe">kaldi::nnet2::OnlinePreconditioner::SetRank</a></div><div class="ttdeci">void SetRank(int32 rank)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00621">nnet-precondition-online.cc:621</a></div></div>
<div class="ttc" id="classkaldi_1_1Matrix_html"><div class="ttname"><a href="classkaldi_1_1Matrix.html">kaldi::Matrix&lt; BaseFloat &gt;</a></div></div>
<div class="ttc" id="classkaldi_1_1CuMatrix_html"><div class="ttname"><a href="classkaldi_1_1CuMatrix.html">kaldi::CuMatrix</a></div><div class="ttdoc">This class represents a matrix that&amp;#39;s stored on the GPU if we have one, and in memory if not...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00071">matrix-common.h:71</a></div></div>
<div class="ttc" id="classkaldi_1_1CuVectorBase_html_a46c4e5094335a6e257a08cb9ae0e7ff0"><div class="ttname"><a href="classkaldi_1_1CuVectorBase.html#a46c4e5094335a6e257a08cb9ae0e7ff0">kaldi::CuVectorBase::AddDiagMatMat</a></div><div class="ttdeci">void AddDiagMatMat(Real alpha, const CuMatrixBase&lt; Real &gt; &amp;M, MatrixTransposeType transM, const CuMatrixBase&lt; Real &gt; &amp;N, MatrixTransposeType transN, Real beta=1.0)</div><div class="ttdoc">Add the diagonal of a matrix product: *this = diag(M N), assuming the &quot;trans&quot; arguments are both kNoT...</div><div class="ttdef"><b>Definition:</b> <a href="cu-vector_8cc_source.html#l00583">cu-vector.cc:583</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a40de84aa34756dd2c783f5f8a131670a"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a40de84aa34756dd2c783f5f8a131670a">kaldi::nnet2::OnlinePreconditioner::PreconditionDirections</a></div><div class="ttdeci">void PreconditionDirections(CuMatrixBase&lt; BaseFloat &gt; *R, CuVectorBase&lt; BaseFloat &gt; *row_prod, BaseFloat *scale)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00145">nnet-precondition-online.cc:145</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_aac2c220416519a2b0a7ad822ee2ef972"><div class="ttname"><a href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">kaldi::MatrixIndexT</a></div><div class="ttdeci">int32 MatrixIndexT</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00098">matrix-common.h:98</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a35086953bbc759bd2ac9cb660d87d83f"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a35086953bbc759bd2ac9cb660d87d83f">kaldi::nnet2::OnlinePreconditioner::TurnOnDebug</a></div><div class="ttdeci">void TurnOnDebug()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00422">nnet-precondition-online.h:422</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditionerSimple_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditionerSimple.html">kaldi::nnet2::OnlinePreconditionerSimple</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online-test_8cc_source.html#l00028">nnet-precondition-online-test.cc:28</a></div></div>
<div class="ttc" id="classkaldi_1_1Vector_html"><div class="ttname"><a href="classkaldi_1_1Vector.html">kaldi::Vector</a></div><div class="ttdoc">A class representing a vector. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8h_source.html#l00390">kaldi-vector.h:390</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditionerSimple_html_a40de84aa34756dd2c783f5f8a131670a"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditionerSimple.html#a40de84aa34756dd2c783f5f8a131670a">kaldi::nnet2::OnlinePreconditionerSimple::PreconditionDirections</a></div><div class="ttdeci">void PreconditionDirections(CuMatrixBase&lt; BaseFloat &gt; *R, CuVectorBase&lt; BaseFloat &gt; *row_prod, BaseFloat *scale)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online-test_8cc_source.html#l00067">nnet-precondition-online-test.cc:67</a></div></div>
<div class="ttc" id="namespacekaldi_html_aeb6ba6085493e3f15358e49751342177"><div class="ttname"><a href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">kaldi::AssertEqual</a></div><div class="ttdeci">static void AssertEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">assert abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)) </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00275">kaldi-math.h:275</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditionerSimple_html_afb9bffca178027f3e5d52ec73a1ee0fe"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditionerSimple.html#afb9bffca178027f3e5d52ec73a1ee0fe">kaldi::nnet2::OnlinePreconditionerSimple::SetRank</a></div><div class="ttdeci">void SetRank(int32 rank)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online-test_8cc_source.html#l00033">nnet-precondition-online-test.cc:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html">kaldi::nnet2::OnlinePreconditioner</a></div><div class="ttdoc">Keywords for search: natural gradient, naturalgradient, NG-SGD. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00413">nnet-precondition-online.h:413</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acb391e7c6c191be6fef596cf0e7a3b98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb391e7c6c191be6fef596cf0e7a3b98">&#9670;&nbsp;</a></span>UnitTestScaleComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestScaleComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00461">461</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l00859">ScaleComponent::Init()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l00866">ScaleComponent::InitFromString()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                              {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  int32 dim = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 10;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scale = 0.1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 3;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1ScaleComponent.html">ScaleComponent</a> component;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 2 == 0) {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      component.<a class="code" href="classkaldi_1_1nnet2_1_1ScaleComponent.html#a5e487b24fe6a084ed39b1e3101657688">Init</a>(dim, scale);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      std::ostringstream str;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      str &lt;&lt; <span class="stringliteral">&quot;dim=&quot;</span> &lt;&lt; dim &lt;&lt; <span class="stringliteral">&quot; scale=&quot;</span> &lt;&lt; scale;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      component.<a class="code" href="classkaldi_1_1nnet2_1_1ScaleComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str.str());</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1ScaleComponent_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1ScaleComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::ScaleComponent::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l00866">nnet-component.cc:866</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1ScaleComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1ScaleComponent.html">kaldi::nnet2::ScaleComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00730">nnet-component.h:730</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1ScaleComponent_html_a5e487b24fe6a084ed39b1e3101657688"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1ScaleComponent.html#a5e487b24fe6a084ed39b1e3101657688">kaldi::nnet2::ScaleComponent::Init</a></div><div class="ttdeci">void Init(int32 dim, BaseFloat scale)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l00859">nnet-component.cc:859</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9ba048e4d06760178b1299c153327b6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ba048e4d06760178b1299c153327b6b">&#9670;&nbsp;</a></span>UnitTestSigmoidComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestSigmoidComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00227">227</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="_2nnet-component_8cc_source.html#l00409">NonlinearComponent::InitFromString()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">// We&#39;re testing that the gradients are computed correctly:</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="comment">// the input gradients and the model gradients.</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  int32 input_dim = 10 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 50;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1SigmoidComponent.html">SigmoidComponent</a> sigmoid_component(input_dim);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(sigmoid_component);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1SigmoidComponent.html">SigmoidComponent</a> sigmoid_component;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    sigmoid_component.<a class="code" href="classkaldi_1_1nnet2_1_1NonlinearComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(<span class="stringliteral">&quot;dim=15&quot;</span>);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(sigmoid_component);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1NonlinearComponent_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1NonlinearComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::NonlinearComponent::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">We implement InitFromString at this level. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l00409">nnet-component.cc:409</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1SigmoidComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1SigmoidComponent.html">kaldi::nnet2::SigmoidComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00585">nnet-component.h:585</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad2690f0a09f0e254c3308e6ac08ec23c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2690f0a09f0e254c3308e6ac08ec23c">&#9670;&nbsp;</a></span>UnitTestSolvePackingProblem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestSolvePackingProblem </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-example-functions-test_8cc_source.html#l00029">29</a> of file <a class="el" href="nnet-example-functions-test_8cc_source.html">nnet-example-functions-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, <a class="el" href="nnet-example-functions_8cc_source.html#l00867">SolvePackingProblem()</a>, and <a class="el" href="stl-utils_8h_source.html#l00039">kaldi::SortAndUniq()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-example-functions-test_8cc_source.html#l00062">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                                   {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordtype">size_t</span> size = <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 20;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  std::vector&lt;BaseFloat&gt; item_costs;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    item_costs.push_back(0.5 * (<a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 15));</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  }</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> max_cost = 0.66 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 5;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  std::vector&lt;std::vector&lt;size_t&gt; &gt; groups;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#a6dbcd705d1a304dd958607aedb503f72">SolvePackingProblem</a>(max_cost, item_costs, &amp;groups);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  </div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  std::vector&lt;size_t&gt; all_indices;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; groups.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> this_group_cost = 0.0;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; groups[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      <span class="keywordtype">size_t</span> index = groups[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      all_indices.push_back(index);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      this_group_cost += item_costs[index];</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    }</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!groups[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].empty());</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(groups[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size() == 1 || this_group_cost &lt;= max_cost);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;all_indices);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(all_indices.size() == size);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span> (!all_indices.empty())</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(all_indices.back() + 1 == size);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&amp;#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00039">stl-utils.h:39</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a6dbcd705d1a304dd958607aedb503f72"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a6dbcd705d1a304dd958607aedb503f72">kaldi::nnet2::SolvePackingProblem</a></div><div class="ttdeci">void SolvePackingProblem(BaseFloat max_cost, const std::vector&lt; BaseFloat &gt; &amp;costs, std::vector&lt; std::vector&lt; size_t &gt; &gt; *groups)</div><div class="ttdoc">This function solves the &quot;packing problem&quot; using the &quot;first fit&quot; algorithm. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-functions_8cc_source.html#l00867">nnet-example-functions.cc:867</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac47787f606d21f80ac21b663103b8ef9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac47787f606d21f80ac21b663103b8ef9">&#9670;&nbsp;</a></span>UnitTestSpliceComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestSpliceComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00747">747</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02475">SpliceComponent::Init()</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-math_8cc_source.html#l00094">kaldi::RandInt()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                               {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  int32 feat_dim = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 20),</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      const_dim =  <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 10),</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      left_context = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(-5, 0),</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      right_context = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, 5),</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      num_chunks = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(1, 20);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="comment">// multiple chunks are required as splice component</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="comment">// has separate index computation logic for more than one chunks</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot; Feat_dim :&quot;</span> &lt;&lt; feat_dim &lt;&lt; <span class="stringliteral">&quot; const_dim: &quot;</span> &lt;&lt; const_dim  ;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  std::vector&lt;bool&gt; contiguous(2);</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  contiguous[0] = <span class="keyword">true</span>;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  contiguous[1] = <span class="keyword">false</span>;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; contiguous.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    std::vector&lt;int32&gt; splice_indexes;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">if</span> (contiguous[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]) {</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="comment">// create contiguous set of splice indexes in the range</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      <span class="comment">// (-left_context, right_context)</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Testing contiguous splice component&quot;</span>;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      splice_indexes.reserve(right_context - left_context + 1);</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordflow">for</span> (int32 i = left_context; i &lt;= right_context; i++)</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        splice_indexes.push_back(i);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    } <span class="keywordflow">else</span>  {</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      <span class="comment">// generate random splice indexes in range (-left_context, right_context)</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Testing non-contiguous splice component&quot;</span>;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      int32 num_left_splice_indexes = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, -left_context) + 1;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      int32 num_right_splice_indexes = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, right_context);</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      splice_indexes.reserve(num_left_splice_indexes + num_right_splice_indexes);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="keywordflow">while</span> (splice_indexes.size() &lt; num_left_splice_indexes)  {</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        int32 new_index = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(left_context, 0);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="comment">// check if the index already exists in the vector</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keywordflow">if</span> (std::find(splice_indexes.begin(), splice_indexes.end(), new_index)</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            == splice_indexes.end())  {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;          splice_indexes.push_back(new_index);</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        }</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      }</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="keywordflow">while</span> (splice_indexes.size() &lt; num_left_splice_indexes + num_right_splice_indexes)  {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        int32 new_index = <a class="code" href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">RandInt</a>(0, right_context);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="comment">// check if the index already exists in the vector</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="keywordflow">if</span> (std::find(splice_indexes.begin(), splice_indexes.end(), new_index)</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            == splice_indexes.end())  {</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;          splice_indexes.push_back(new_index);</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        }</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      }</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      sort(splice_indexes.begin(), splice_indexes.end());</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="keywordflow">if</span> (splice_indexes.back() &lt; 0) <span class="comment">// will fail assertion in init of component</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        splice_indexes.push_back(0);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    std::vector&lt;int32&gt; input_offsets;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">for</span> (int32 i = 0; i &lt; splice_indexes.size(); i++) {</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      input_offsets.push_back(splice_indexes[i] - splice_indexes.front());</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; splice_indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; input_offsets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] ;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    int32 output_offset = -splice_indexes.front();</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1SpliceComponent.html">SpliceComponent</a> *component = <span class="keyword">new</span> <a class="code" href="classkaldi_1_1nnet2_1_1SpliceComponent.html">SpliceComponent</a>();</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    component-&gt;<a class="code" href="classkaldi_1_1nnet2_1_1SpliceComponent.html#a77fc56d9547c32c9ea81fdb616bff315">Init</a>(feat_dim + const_dim, splice_indexes, const_dim);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a> in_info = <a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a>(feat_dim + const_dim, num_chunks,</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                                  input_offsets),</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;              out_info = <a class="code" href="classkaldi_1_1nnet2_1_1ChunkInfo.html">ChunkInfo</a>(feat_dim * splice_indexes.size() + const_dim,</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                                   num_chunks, output_offset, output_offset);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(*component, in_info, out_info);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keyword">delete</span> component;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  }</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1SpliceComponent_html_a77fc56d9547c32c9ea81fdb616bff315"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1SpliceComponent.html#a77fc56d9547c32c9ea81fdb616bff315">kaldi::nnet2::SpliceComponent::Init</a></div><div class="ttdeci">void Init(int32 input_dim, std::vector&lt; int32 &gt; context, int32 const_component_dim=0)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l02475">nnet-component.cc:2475</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1ChunkInfo_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1ChunkInfo.html">kaldi::nnet2::ChunkInfo</a></div><div class="ttdoc">ChunkInfo is a class whose purpose is to describe the structure of matrices holding features...</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l00072">nnet-component.h:72</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1SpliceComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1SpliceComponent.html">kaldi::nnet2::SpliceComponent</a></div><div class="ttdoc">Splices a context window of frames together [over time]. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01092">nnet-component.h:1092</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="namespacekaldi_html_a0361eab3c5ebb78e6be060e6fa78e1a1"><div class="ttname"><a href="namespacekaldi.html#a0361eab3c5ebb78e6be060e6fa78e1a1">kaldi::RandInt</a></div><div class="ttdeci">int32 RandInt(int32 min_val, int32 max_val, struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00094">kaldi-math.cc:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab0d7c891bd2fa39a24d2b650d07ffb6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0d7c891bd2fa39a24d2b650d07ffb6e">&#9670;&nbsp;</a></span>UnitTestSumGroupComponent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::nnet2::UnitTestSumGroupComponent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_2nnet-component-test_8cc_source.html#l00587">587</a> of file <a class="el" href="_2nnet-component-test_8cc_source.html">nnet-component-test.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02365">SumGroupComponent::Init()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l02384">SumGroupComponent::InitFromString()</a>, <a class="el" href="kaldi-math_8cc_source.html#l00044">kaldi::Rand()</a>, and <a class="el" href="_2nnet-component-test_8cc_source.html#l00028">UnitTestGenericComponentInternal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component-test_8cc_source.html#l00855">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                                 {</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  std::vector&lt;int32&gt; sizes;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  int32 num_sizes = 1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 5;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_sizes; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    sizes.push_back(1 + <a class="code" href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">Rand</a>() % 5);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html">SumGroupComponent</a> component;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html#a4be1dee25302fce78724541a50d612d6">Init</a>(sizes);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  }</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *str = <span class="stringliteral">&quot;sizes=3:4:5&quot;</span>;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html">SumGroupComponent</a> component;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    component.<a class="code" href="classkaldi_1_1nnet2_1_1SumGroupComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">InitFromString</a>(str);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">UnitTestGenericComponentInternal</a>(component);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  }</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1SumGroupComponent_html"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1SumGroupComponent.html">kaldi::nnet2::SumGroupComponent</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8h_source.html#l01274">nnet-component.h:1274</a></div></div>
<div class="ttc" id="namespacekaldi_html_a70777edd81d4056098f79b9cd3bffb8b"><div class="ttname"><a href="namespacekaldi.html#a70777edd81d4056098f79b9cd3bffb8b">kaldi::Rand</a></div><div class="ttdeci">int Rand(struct RandomState *state)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8cc_source.html#l00044">kaldi-math.cc:44</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1SumGroupComponent_html_a93cbd3cf93a0fed1d868a35ad4a32b24"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1SumGroupComponent.html#a93cbd3cf93a0fed1d868a35ad4a32b24">kaldi::nnet2::SumGroupComponent::InitFromString</a></div><div class="ttdeci">virtual void InitFromString(std::string args)</div><div class="ttdoc">Initialize, typically from a line of a config file. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l02384">nnet-component.cc:2384</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_ac68689fc81582215989c6b2c40e95cf5"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#ac68689fc81582215989c6b2c40e95cf5">kaldi::nnet2::UnitTestGenericComponentInternal</a></div><div class="ttdeci">void UnitTestGenericComponentInternal(const Component &amp;component)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component-test_8cc_source.html#l00210">nnet-component-test.cc:210</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1SumGroupComponent_html_a4be1dee25302fce78724541a50d612d6"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1SumGroupComponent.html#a4be1dee25302fce78724541a50d612d6">kaldi::nnet2::SumGroupComponent::Init</a></div><div class="ttdeci">void Init(const std::vector&lt; int32 &gt; &amp;sizes)</div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-component_8cc_source.html#l02365">nnet-component.cc:2365</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad559d485323ab12842e3992b42bc94f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad559d485323ab12842e3992b42bc94f8">&#9670;&nbsp;</a></span>UpdateHash()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpdateHash </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> &amp;&#160;</td>
          <td class="paramname"><em>tmodel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1DiscriminativeNnetExample.html">DiscriminativeNnetExample</a> &amp;&#160;</td>
          <td class="paramname"><em>eg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>criterion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>drop_frames</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>one_silence_class</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>num_weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>den_weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>tot_t</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is used in code that tests the functionality that we provide here, about splitting and excising nnet examples. </p>
<p>It adds to a "hash
function" that is a function of a set of examples; the hash function is of dimension (number of pdf-ids x features dimension). The hash function consists of the (denominator - numerator) posteriors over pdf-ids, times the average over the context-window (left-context on the left, right-context on the right), of the features. This is useful because the various manipulations we do are supposed to preserve this, and if there is a bug it will most likely cause the hash function to change.</p>
<p>This function will resize the matrix if it is empty.</p>
<p>Any acoustic scaling of the lattice should be done before you call this function.</p>
<p>'criterion' should be 'mmi', 'mpfe', or 'smbr'.</p>
<p>You should set drop_frames to true if you are doing MMI with drop-frames == true. Then it will not compute the hash for frames where the numerator pdf-id is not in the denominator lattice.</p>
<p>You can set one_silence_class to true for a newer optional behavior that will reduce insertions in the trained model (or false for the traditional behavior).</p>
<p>The function will also accumulate the total numerator and denominator weights used as num_weight and den_weight, for an additional diagnostic, and the total number of frames, as tot_t. </p>

<p class="definition">Definition at line <a class="el" href="nnet-example-functions_8cc_source.html#l00786">786</a> of file <a class="el" href="nnet-example-functions_8cc_source.html">nnet-example-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8cc_source.html#l00719">VectorBase&lt; Real &gt;::AddRowSumMat()</a>, <a class="el" href="nnet-example-functions_8cc_source.html#l00838">ExampleToPdfPost()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00159">DiscriminativeNnetExample::input_frames</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00164">DiscriminativeNnetExample::left_context</a>, <a class="el" href="nnet2_2nnet-example_8h_source.html#l00143">DiscriminativeNnetExample::num_ali</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="transition-model_8h_source.html#l00185">TransitionModel::NumPdfs()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00818">Matrix&lt; Real &gt;::Resize()</a>, and <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-compare-hash-discriminative_8cc_source.html#l00025">main()</a>, and <a class="el" href="nnet-example-functions_8h_source.html#l00133">SplitExampleStats::SplitExampleStats()</a>.</p>
<div class="fragment"><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                   {</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  int32 feat_dim = eg.input_frames.NumCols(),</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      left_context = eg.left_context,</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      num_frames = eg.num_ali.size(),</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      right_context = eg.input_frames.NumRows() - num_frames - left_context,</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      context_width = left_context + 1 + right_context;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  *tot_t += num_frames;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(right_context &gt;= 0);</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(hash != NULL);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordflow">if</span> (hash-&gt;NumRows() == 0) {</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    hash-&gt;Resize(tmodel.NumPdfs(), feat_dim);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(hash-&gt;NumRows() == tmodel.NumPdfs() &amp;&amp;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                 hash-&gt;NumCols() == feat_dim);</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  }</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <a class="code" href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">Posterior</a> post;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  std::vector&lt;int32&gt; silence_phones; <span class="comment">// we don&#39;t let the user specify this</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                                     <span class="comment">// because it&#39;s not necessary for testing</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                                     <span class="comment">// purposes -&gt; leave it empty</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet2.html#a88d4fabba85290cdc0e10da135458baf">ExampleToPdfPost</a>(tmodel, silence_phones, criterion, drop_frames,</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                   one_silence_class, eg, &amp;post);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  Vector&lt;BaseFloat&gt; avg_feat(feat_dim);</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  </div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="keywordflow">for</span> (int32 t = 0; t &lt; num_frames; t++) {</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    SubMatrix&lt;BaseFloat&gt; context_window(eg.input_frames,</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                                        t, context_width,</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                                        0, feat_dim);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="comment">// set avg_feat to average over the context-window for this frame.</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    avg_feat.AddRowSumMat(1.0 / context_width, context_window, 0.0);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    Vector&lt;double&gt; avg_feat_dbl(avg_feat);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; post[t].size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      int32 pdf_id = post[t][<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> weight = post[t][<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      hash-&gt;Row(pdf_id).AddVec(weight, avg_feat_dbl);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="keywordflow">if</span> (weight &gt; 0.0) *num_weight += weight;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <span class="keywordflow">else</span> *den_weight += -weight;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    }</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  }</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__posterior__group_html_ga5c99e6141a5a3b3c5d424e99ffbd1ac6"><div class="ttname"><a href="group__posterior__group.html#ga5c99e6141a5a3b3c5d424e99ffbd1ac6">kaldi::Posterior</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::pair&lt; int32, BaseFloat &gt; &gt; &gt; Posterior</div><div class="ttdoc">Posterior is a typedef for storing acoustic-state (actually, transition-id) posteriors over an uttera...</div><div class="ttdef"><b>Definition:</b> <a href="posterior_8h_source.html#l00043">posterior.h:43</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a88d4fabba85290cdc0e10da135458baf"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a88d4fabba85290cdc0e10da135458baf">kaldi::nnet2::ExampleToPdfPost</a></div><div class="ttdeci">void ExampleToPdfPost(const TransitionModel &amp;tmodel, const std::vector&lt; int32 &gt; &amp;silence_phones, std::string criterion, bool drop_frames, bool one_silence_class, const DiscriminativeNnetExample &amp;eg, Posterior *post)</div><div class="ttdoc">Given a discriminative training example, this function works out posteriors at the pdf level (note: t...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-example-functions_8cc_source.html#l00838">nnet-example-functions.cc:838</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6a8109623bc5211ffc3b6f0594aaad24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a8109623bc5211ffc3b6f0594aaad24">&#9670;&nbsp;</a></span>WidenNnet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void WidenNnet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet2_1_1NnetWidenConfig.html">NnetWidenConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>widen_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1nnet2_1_1Nnet.html">Nnet</a> *&#160;</td>
          <td class="paramname"><em>nnet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function widens a neural network by increasing the hidden-layer dimensions to the target. </p>

<p class="definition">Definition at line <a class="el" href="widen-nnet_8cc_source.html#l00062">62</a> of file <a class="el" href="widen-nnet_8cc_source.html">widen-nnet.cc</a>.</p>

<p class="reference">References <a class="el" href="widen-nnet_8h_source.html#l00036">NnetWidenConfig::bias_stddev</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00271">Nnet::Check()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00141">Nnet::GetComponent()</a>, <a class="el" href="widen-nnet_8h_source.html#l00034">NnetWidenConfig::hidden_layer_dim</a>, <a class="el" href="_2nnet-component_8h_source.html#l00852">AffineComponent::InputDim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="_2nnet-nnet_8h_source.html#l00069">Nnet::NumComponents()</a>, <a class="el" href="_2nnet-component_8h_source.html#l00853">AffineComponent::OutputDim()</a>, <a class="el" href="widen-nnet_8h_source.html#l00035">NnetWidenConfig::param_stddev_factor</a>, and <a class="el" href="widen-nnet_8cc_source.html#l00028">AffineComponent::Widen()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-am-widen_8cc_source.html#l00027">main()</a>, and <a class="el" href="widen-nnet_8h_source.html#l00042">NnetWidenConfig::Register()</a>.</p>
<div class="fragment"><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                           {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  int32 C = nnet-&gt;NumComponents();</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  int32 num_widened = 0;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">for</span> (int32 c = 0; c &lt; C - 3; c++) {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    AffineComponent *c1 = <span class="keyword">dynamic_cast&lt;</span>AffineComponent*<span class="keyword">&gt;</span>(&amp;(nnet-&gt;GetComponent(c)));</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">if</span> (c1 == NULL) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    std::vector&lt;NonlinearComponent*&gt; c2; <span class="comment">// normally just one element, but allow two right now.</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    c2.push_back(dynamic_cast&lt;NonlinearComponent*&gt;(&amp;(nnet-&gt;GetComponent(c+1))));</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">if</span> (c2.back() == NULL) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    c2.push_back(dynamic_cast&lt;NonlinearComponent*&gt;(&amp;(nnet-&gt;GetComponent(c+2))));</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    AffineComponent *c3;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">if</span> (c2.back() == NULL) {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      c2.pop_back();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      c3 = <span class="keyword">dynamic_cast&lt;</span>AffineComponent*<span class="keyword">&gt;</span>(&amp;(nnet-&gt;GetComponent(c+2)));</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="keywordflow">if</span> (c + 3 &gt;= C) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      c3 = <span class="keyword">dynamic_cast&lt;</span>AffineComponent*<span class="keyword">&gt;</span>(&amp;(nnet-&gt;GetComponent(c+3)));</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    }</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">if</span> (c3 == NULL) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> param_stddev = widen_config.param_stddev_factor /</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        sqrt(1.0 * c1-&gt;InputDim());</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Widening component &quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot; from &quot;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;              &lt;&lt; c1-&gt;OutputDim() &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; widen_config.hidden_layer_dim;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    </div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    c1-&gt;Widen(widen_config.hidden_layer_dim,</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;              param_stddev, widen_config.bias_stddev,</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;              c2, c3);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    num_widened++;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  nnet-&gt;Check();</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Widened &quot;</span> &lt;&lt; num_widened &lt;&lt; <span class="stringliteral">&quot; components.&quot;</span>;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}  </div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a61aa1571f96bd1f5bcbc3741d4adb26f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61aa1571f96bd1f5bcbc3741d4adb26f">&#9670;&nbsp;</a></span>nnet_example_warned_left</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> nnet_example_warned_left = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-example_8cc_source.html#l00156">156</a> of file <a class="el" href="nnet2_2nnet-example_8cc_source.html">nnet-example.cc</a>.</p>

</div>
</div>
<a id="a16676aa9ae521c698fec8fd0f60d383e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16676aa9ae521c698fec8fd0f60d383e">&#9670;&nbsp;</a></span>nnet_example_warned_right</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> nnet_example_warned_right = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet2_2nnet-example_8cc_source.html#l00156">156</a> of file <a class="el" href="nnet2_2nnet-example_8cc_source.html">nnet-example.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet2_2nnet-example_8cc_source.html#l00159">NnetExample::NnetExample()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacekaldi.html">kaldi</a></li><li class="navelem"><a class="el" href="namespacekaldi_1_1nnet2.html">nnet2</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
