<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: Miscellaneous matrix/vector library functions and classes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__matrix__funcs__misc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Miscellaneous matrix/vector library functions and classes<div class="ingroups"><a class="el" href="group__matrix__group.html">%Matrix and vector classes</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Miscellaneous matrix/vector library functions and classes:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__matrix__funcs__misc.png" border="0" alt="" usemap="#group____matrix____funcs____misc"/>
<map name="group____matrix____funcs____misc" id="group____matrix____funcs____misc">
</map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1SolverOptions.html">SolverOptions</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class describes the options for maximizing various quadratic objective functions.  <a href="structkaldi_1_1SolverOptions.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1SplitRadixComplexFft.html">SplitRadixComplexFft&lt; Real &gt;</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1SplitRadixRealFft.html">SplitRadixRealFft&lt; Real &gt;</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga4318e745ace6367bd00b2911089e9e79"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:ga4318e745ace6367bd00b2911089e9e79"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#ga4318e745ace6367bd00b2911089e9e79">SortSvd</a> (<a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; *s, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *U, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *Vt=NULL, <a class="el" href="classbool.html">bool</a> sort_on_absolute_value=true)</td></tr>
<tr class="memdesc:ga4318e745ace6367bd00b2911089e9e79"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to ensure that SVD is sorted.  <a href="group__matrix__funcs__misc.html#ga4318e745ace6367bd00b2911089e9e79">More...</a><br /></td></tr>
<tr class="separator:ga4318e745ace6367bd00b2911089e9e79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadb59908c0ecdcc2b3ba2e32b729877a5"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:gadb59908c0ecdcc2b3ba2e32b729877a5"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#gadb59908c0ecdcc2b3ba2e32b729877a5">CreateEigenvalueMatrix</a> (const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;real, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;imag, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *D)</td></tr>
<tr class="memdesc:gadb59908c0ecdcc2b3ba2e32b729877a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates the eigenvalue matrix D that is part of the decomposition used <a class="el" href="classkaldi_1_1MatrixBase.html#a84cb50046244e13aea743984d012467f" title="Eigenvalue Decomposition of a square NxN matrix into the form (*this) = P D P^{-1}. ">Matrix::Eig</a>.  <a href="group__matrix__funcs__misc.html#gadb59908c0ecdcc2b3ba2e32b729877a5">More...</a><br /></td></tr>
<tr class="separator:gadb59908c0ecdcc2b3ba2e32b729877a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga60ae3be7ddb17c33df1129b43d712a87"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:ga60ae3be7ddb17c33df1129b43d712a87"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#ga60ae3be7ddb17c33df1129b43d712a87">AttemptComplexPower</a> (Real *x_re, Real *x_im, Real power)</td></tr>
<tr class="memdesc:ga60ae3be7ddb17c33df1129b43d712a87"><td class="mdescLeft">&#160;</td><td class="mdescRight">The following function is used in <a class="el" href="classkaldi_1_1MatrixBase.html#a4d470d03aa302b6af9b8254ff918e0ee" title="The Power method attempts to take the matrix to a power using a method that works in general for frac...">Matrix::Power</a>, and separately tested, so we declare it here mainly for the testing code to see.  <a href="group__matrix__funcs__misc.html#ga60ae3be7ddb17c33df1129b43d712a87">More...</a><br /></td></tr>
<tr class="separator:ga60ae3be7ddb17c33df1129b43d712a87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1b6e4e6a2a0f85eb3dd4833fcb3151c9"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:ga1b6e4e6a2a0f85eb3dd4833fcb3151c9"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#ga1b6e4e6a2a0f85eb3dd4833fcb3151c9">ComplexFft</a> (<a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; *v, <a class="el" href="classbool.html">bool</a> forward, <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; Real &gt; *tmp_work=NULL)</td></tr>
<tr class="memdesc:ga1b6e4e6a2a0f85eb3dd4833fcb3151c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">The function ComplexFft does an Fft on the vector argument v.  <a href="group__matrix__funcs__misc.html#ga1b6e4e6a2a0f85eb3dd4833fcb3151c9">More...</a><br /></td></tr>
<tr class="separator:ga1b6e4e6a2a0f85eb3dd4833fcb3151c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9a7751d719e4366383f522974fbe5893"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:ga9a7751d719e4366383f522974fbe5893"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#ga9a7751d719e4366383f522974fbe5893">ComplexFt</a> (const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;in, <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; *out, <a class="el" href="classbool.html">bool</a> forward)</td></tr>
<tr class="memdesc:ga9a7751d719e4366383f522974fbe5893"><td class="mdescLeft">&#160;</td><td class="mdescRight">ComplexFt is the same as ComplexFft but it implements the Fourier transform in an inefficient way.  <a href="group__matrix__funcs__misc.html#ga9a7751d719e4366383f522974fbe5893">More...</a><br /></td></tr>
<tr class="separator:ga9a7751d719e4366383f522974fbe5893"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga614b44b294e1f0b555531020ceb85f2f"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:ga614b44b294e1f0b555531020ceb85f2f"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#ga614b44b294e1f0b555531020ceb85f2f">RealFft</a> (<a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; *v, <a class="el" href="classbool.html">bool</a> forward)</td></tr>
<tr class="memdesc:ga614b44b294e1f0b555531020ceb85f2f"><td class="mdescLeft">&#160;</td><td class="mdescRight">RealFft is a fourier transform of real inputs.  <a href="group__matrix__funcs__misc.html#ga614b44b294e1f0b555531020ceb85f2f">More...</a><br /></td></tr>
<tr class="separator:ga614b44b294e1f0b555531020ceb85f2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6c0f5032ff57c3b1da8cdb80782ca70f"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:ga6c0f5032ff57c3b1da8cdb80782ca70f"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#ga6c0f5032ff57c3b1da8cdb80782ca70f">RealFftInefficient</a> (<a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; *v, <a class="el" href="classbool.html">bool</a> forward)</td></tr>
<tr class="memdesc:ga6c0f5032ff57c3b1da8cdb80782ca70f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inefficient version of Fourier transform, for testing purposes.  <a href="group__matrix__funcs__misc.html#ga6c0f5032ff57c3b1da8cdb80782ca70f">More...</a><br /></td></tr>
<tr class="separator:ga6c0f5032ff57c3b1da8cdb80782ca70f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga828e48b951501d3d2a2e91956a42d24f"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:ga828e48b951501d3d2a2e91956a42d24f"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#ga828e48b951501d3d2a2e91956a42d24f">ComputeDctMatrix</a> (<a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; Real &gt; *M)</td></tr>
<tr class="memdesc:ga828e48b951501d3d2a2e91956a42d24f"><td class="mdescLeft">&#160;</td><td class="mdescRight">ComputeDctMatrix computes a matrix corresponding to the DCT, such that M * v equals the DCT of vector v.  <a href="group__matrix__funcs__misc.html#ga828e48b951501d3d2a2e91956a42d24f">More...</a><br /></td></tr>
<tr class="separator:ga828e48b951501d3d2a2e91956a42d24f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadf1aeb4e8fa162e8875ba335316ab1e2"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:gadf1aeb4e8fa162e8875ba335316ab1e2"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#gadf1aeb4e8fa162e8875ba335316ab1e2">ComplexMul</a> (const Real &amp;a_re, const Real &amp;a_im, Real *b_re, Real *b_im)</td></tr>
<tr class="memdesc:gadf1aeb4e8fa162e8875ba335316ab1e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">ComplexMul implements, inline, the complex multiplication b *= a.  <a href="group__matrix__funcs__misc.html#gadf1aeb4e8fa162e8875ba335316ab1e2">More...</a><br /></td></tr>
<tr class="separator:gadf1aeb4e8fa162e8875ba335316ab1e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae200169bea97409ead26f83f9298ad5d"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:gae200169bea97409ead26f83f9298ad5d"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#gae200169bea97409ead26f83f9298ad5d">ComplexAddProduct</a> (const Real &amp;a_re, const Real &amp;a_im, const Real &amp;b_re, const Real &amp;b_im, Real *c_re, Real *c_im)</td></tr>
<tr class="memdesc:gae200169bea97409ead26f83f9298ad5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">ComplexMul implements, inline, the complex operation c += (a * b).  <a href="group__matrix__funcs__misc.html#gae200169bea97409ead26f83f9298ad5d">More...</a><br /></td></tr>
<tr class="separator:gae200169bea97409ead26f83f9298ad5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadd96550b67adf801f58c824febf9c6ec"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:gadd96550b67adf801f58c824febf9c6ec"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#gadd96550b67adf801f58c824febf9c6ec">ComplexImExp</a> (Real x, Real *a_re, Real *a_im)</td></tr>
<tr class="memdesc:gadd96550b67adf801f58c824febf9c6ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">ComplexImExp implements a &lt;&ndash; exp(i x), inline.  <a href="group__matrix__funcs__misc.html#gadd96550b67adf801f58c824febf9c6ec">More...</a><br /></td></tr>
<tr class="separator:gadd96550b67adf801f58c824febf9c6ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga386cdedb7491d1545750472c231b3546"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:ga386cdedb7491d1545750472c231b3546"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#ga386cdedb7491d1545750472c231b3546">ComputePca</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;X, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *U, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *A, <a class="el" href="classbool.html">bool</a> print_eigs=false, <a class="el" href="classbool.html">bool</a> exact=true)</td></tr>
<tr class="memdesc:ga386cdedb7491d1545750472c231b3546"><td class="mdescLeft">&#160;</td><td class="mdescRight">ComputePCA does a PCA computation, using either outer products or inner products, whichever is more efficient.  <a href="group__matrix__funcs__misc.html#ga386cdedb7491d1545750472c231b3546">More...</a><br /></td></tr>
<tr class="separator:ga386cdedb7491d1545750472c231b3546"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga722be1ab836698230006ffb55593f248"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:ga722be1ab836698230006ffb55593f248"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#ga722be1ab836698230006ffb55593f248">AddOuterProductPlusMinus</a> (Real alpha, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;a, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;b, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *plus, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *minus)</td></tr>
<tr class="separator:ga722be1ab836698230006ffb55593f248"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf46068db276783011ee64d53974c3e31"><td class="memTemplParams" colspan="2">template&lt;typename Real1 , typename Real2 &gt; </td></tr>
<tr class="memitem:gaf46068db276783011ee64d53974c3e31"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#gaf46068db276783011ee64d53974c3e31">AssertSameDim</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real1 &gt; &amp;mat1, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real2 &gt; &amp;mat2)</td></tr>
<tr class="separator:gaf46068db276783011ee64d53974c3e31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf957f3398e0409677329fece304de0b9"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:gaf957f3398e0409677329fece304de0b9"><td class="memTemplItemLeft" align="right" valign="top">Real&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#gaf957f3398e0409677329fece304de0b9">SolveQuadraticProblem</a> (const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;H, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;g, const <a class="el" href="structkaldi_1_1SolverOptions.html">SolverOptions</a> &amp;opts, <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; *x)</td></tr>
<tr class="memdesc:gaf957f3398e0409677329fece304de0b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximizes the auxiliary function </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Q(x) = x.g - 0.5 x^T H x \]" src="form_105.png"/>
</p>
<p> using a numerically stable method.  <a href="group__matrix__funcs__misc.html#gaf957f3398e0409677329fece304de0b9">More...</a><br /></td></tr>
<tr class="separator:gaf957f3398e0409677329fece304de0b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae6eded79725fb0ed1307d30476f419ee"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:gae6eded79725fb0ed1307d30476f419ee"><td class="memTemplItemLeft" align="right" valign="top">Real&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#gae6eded79725fb0ed1307d30476f419ee">SolveQuadraticMatrixProblem</a> (const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;Q, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;Y, const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;P, const <a class="el" href="structkaldi_1_1SolverOptions.html">SolverOptions</a> &amp;opts, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *M)</td></tr>
<tr class="memdesc:gae6eded79725fb0ed1307d30476f419ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximizes the auxiliary function : </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Q(x) = tr(M^T P Y) - 0.5 tr(P M Q M^T) \]" src="form_107.png"/>
</p>
<p> Like a numerically stable version of <img class="formulaInl" alt="$ M := Y Q^{-1} $" src="form_108.png"/>.  <a href="group__matrix__funcs__misc.html#gae6eded79725fb0ed1307d30476f419ee">More...</a><br /></td></tr>
<tr class="separator:gae6eded79725fb0ed1307d30476f419ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8e04108cdb733c6c2bc5dbe4708e1f80"><td class="memTemplParams" colspan="2">template&lt;typename Real &gt; </td></tr>
<tr class="memitem:ga8e04108cdb733c6c2bc5dbe4708e1f80"><td class="memTemplItemLeft" align="right" valign="top">Real&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__matrix__funcs__misc.html#ga8e04108cdb733c6c2bc5dbe4708e1f80">SolveDoubleQuadraticMatrixProblem</a> (const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;G, const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;P1, const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;P2, const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;Q1, const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;Q2, const <a class="el" href="structkaldi_1_1SolverOptions.html">SolverOptions</a> &amp;opts, <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *M)</td></tr>
<tr class="memdesc:ga8e04108cdb733c6c2bc5dbe4708e1f80"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximizes the auxiliary function : </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Q(M) = tr(M^T G) -0.5 tr(P_1 M Q_1 M^T) -0.5 tr(P_2 M Q_2 M^T). \]" src="form_109.png"/>
</p>
<p> Encountered in matrix update with a prior.  <a href="group__matrix__funcs__misc.html#ga8e04108cdb733c6c2bc5dbe4708e1f80">More...</a><br /></td></tr>
<tr class="separator:ga8e04108cdb733c6c2bc5dbe4708e1f80"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga722be1ab836698230006ffb55593f248"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga722be1ab836698230006ffb55593f248">&#9670;&nbsp;</a></span>AddOuterProductPlusMinus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AddOuterProductPlusMinus </td>
          <td>(</td>
          <td class="paramtype">Real&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>plus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>minus</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="matrix-functions_8cc_source.html#l00726">726</a> of file <a class="el" href="matrix-functions_8cc_source.html">matrix-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="namespacekaldi.html#a8394f6a00a05c2694c36bef12ed32894">kaldi::AddOuterProductPlusMinus&lt; double &gt;()</a>, <a class="el" href="namespacekaldi.html#aefc95d7d5ff579a460d271f5f09f03cb">kaldi::AddOuterProductPlusMinus&lt; float &gt;()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00069">VectorBase&lt; Real &gt;::Data()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00076">MatrixBase&lt; Real &gt;::Data()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, and <a class="el" href="kaldi-matrix_8h_source.html#l00067">MatrixBase&lt; Real &gt;::Stride()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fmpe_8cc_source.html#l00302">Fmpe::ApplyProjectionReverse()</a>, and <a class="el" href="matrix-lib-test_8cc_source.html#l01136">kaldi::UnitTestAddOuterProductPlusMinus()</a>.</p>
<div class="fragment"><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                                                       {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(a.Dim() == plus-&gt;NumRows() &amp;&amp; b.Dim() == plus-&gt;NumCols()</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;               &amp;&amp; a.Dim() == minus-&gt;NumRows() &amp;&amp; b.Dim() == minus-&gt;NumCols());</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  int32 nrows = a.Dim(), ncols = b.Dim(), pskip = plus-&gt;Stride() - ncols,</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      mskip = minus-&gt;Stride() - ncols;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="keyword">const</span> Real *adata = a.Data(), *bdata = b.Data();</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  Real *plusdata = plus-&gt;Data(), *minusdata = minus-&gt;Data();</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nrows; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keyword">const</span> Real *btmp = bdata;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    Real multiple = alpha * *adata;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">if</span> (multiple &gt; 0.0) {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; ncols; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++, plusdata++, minusdata++, btmp++) {</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="keywordflow">if</span> (*btmp &gt; 0.0) *plusdata += multiple * *btmp;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">else</span> *minusdata -= multiple * *btmp;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      }</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; ncols; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++, plusdata++, minusdata++, btmp++) {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="keywordflow">if</span> (*btmp &lt; 0.0) *plusdata += multiple * *btmp;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">else</span> *minusdata -= multiple * *btmp;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    }</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    plusdata += pskip;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    minusdata += mskip;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    adata++;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gaf46068db276783011ee64d53974c3e31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf46068db276783011ee64d53974c3e31">&#9670;&nbsp;</a></span>AssertSameDim()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::AssertSameDim </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real1 &gt; &amp;&#160;</td>
          <td class="paramname"><em>mat1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real2 &gt; &amp;&#160;</td>
          <td class="paramname"><em>mat2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="matrix-functions_8h_source.html#l00161">161</a> of file <a class="el" href="matrix-functions_8h_source.html">matrix-functions.h</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, and <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>.</p>
<div class="fragment"><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                                                                                        {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(mat1.NumRows() == mat2.NumRows()</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;               &amp;&amp; mat1.NumCols() == mat2.NumCols());</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga60ae3be7ddb17c33df1129b43d712a87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga60ae3be7ddb17c33df1129b43d712a87">&#9670;&nbsp;</a></span>AttemptComplexPower()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> AttemptComplexPower </td>
          <td>(</td>
          <td class="paramtype">Real *&#160;</td>
          <td class="paramname"><em>x_re</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real *&#160;</td>
          <td class="paramname"><em>x_im</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real&#160;</td>
          <td class="paramname"><em>power</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The following function is used in <a class="el" href="classkaldi_1_1MatrixBase.html#a4d470d03aa302b6af9b8254ff918e0ee" title="The Power method attempts to take the matrix to a power using a method that works in general for frac...">Matrix::Power</a>, and separately tested, so we declare it here mainly for the testing code to see. </p>
<p>It takes a complex value to a power using a method that will work for noninteger powers (but will fail if the complex value is real and negative). </p>

<p class="definition">Definition at line <a class="el" href="kaldi-matrix_8cc_source.html#l02613">2613</a> of file <a class="el" href="kaldi-matrix_8cc_source.html">kaldi-matrix.cc</a>.</p>

<p class="reference">References <a class="el" href="namespacekaldi.html#aa66c41734d80852a6084ddb5fb831e9c">kaldi::AttemptComplexPower()</a>.</p>

<p class="reference">Referenced by <a class="el" href="kaldi-matrix_8h_source.html#l00996">kaldi::TraceMat()</a>, and <a class="el" href="matrix-lib-test_8cc_source.html#l03701">kaldi::UnitTestComplexPower()</a>.</p>
<div class="fragment"><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;                                                             {</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;  <span class="comment">// Used in Matrix&lt;Real&gt;::Power().</span></div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;  <span class="comment">// Attempts to take the complex value x to the power &quot;power&quot;,</span></div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;  <span class="comment">// assuming that power is fractional (i.e. we don&#39;t treat integers as a</span></div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;  <span class="comment">// special case).  Returns false if this is not possible, either</span></div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;  <span class="comment">// because x is negative and real (hence there is no obvious answer</span></div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;  <span class="comment">// that is &quot;closest to 1&quot;, and anyway this case does not make sense</span></div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;  <span class="comment">// in the Matrix&lt;Real&gt;::Power() routine);</span></div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;  <span class="comment">// or because power is negative, and x is zero.</span></div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;  <span class="comment">// First solve for r and theta in</span></div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;  <span class="comment">// x_re = r*cos(theta), x_im = r*sin(theta)</span></div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;  <span class="keywordflow">if</span> (*x_re &lt; 0.0 &amp;&amp; *x_im == 0.0) <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// can&#39;t do</span></div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;  <span class="comment">// it for negative real values.</span></div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;  Real r = std::sqrt((*x_re * *x_re) + (*x_im * *x_im));  <span class="comment">// r == radius.</span></div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;  <span class="keywordflow">if</span> (power &lt; 0.0 &amp;&amp; r == 0.0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  Real theta = std::atan2(*x_im, *x_re);</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;  <span class="comment">// Take the power.</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  r = std::pow(r, power);</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;  theta *= power;</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;  *x_re = r * std::cos(theta);</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;  *x_im = r * std::sin(theta);</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="gae200169bea97409ead26f83f9298ad5d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae200169bea97409ead26f83f9298ad5d">&#9670;&nbsp;</a></span>ComplexAddProduct()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComplexAddProduct </td>
          <td>(</td>
          <td class="paramtype">const Real &amp;&#160;</td>
          <td class="paramname"><em>a_re</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real &amp;&#160;</td>
          <td class="paramname"><em>a_im</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real &amp;&#160;</td>
          <td class="paramname"><em>b_re</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real &amp;&#160;</td>
          <td class="paramname"><em>b_im</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real *&#160;</td>
          <td class="paramname"><em>c_re</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real *&#160;</td>
          <td class="paramname"><em>c_im</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>ComplexMul implements, inline, the complex operation c += (a * b). </p>

<p class="definition">Definition at line <a class="el" href="matrix-functions-inl_8h_source.html#l00038">38</a> of file <a class="el" href="matrix-functions-inl_8h_source.html">matrix-functions-inl.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="matrix-functions_8cc_source.html#l00097">kaldi::ComplexFftRecursive()</a>, <a class="el" href="matrix-functions_8cc_source.html#l00029">kaldi::ComplexFt()</a>, <a class="el" href="srfft_8cc_source.html#l00364">SplitRadixRealFft&lt; float &gt;::Compute()</a>, and <a class="el" href="matrix-functions_8cc_source.html#l00391">kaldi::RealFft()</a>.</p>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                                                                           {</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  *c_re += b_re*a_re - b_im*a_im;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  *c_im += b_re*a_im + b_im*a_re;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ga1b6e4e6a2a0f85eb3dd4833fcb3151c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1b6e4e6a2a0f85eb3dd4833fcb3151c9">&#9670;&nbsp;</a></span>ComplexFft()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComplexFft </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>forward</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>tmp_work</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The function ComplexFft does an Fft on the vector argument v. </p>
<p>v is a vector of even dimension, interpreted for both input and output as a vector of complex numbers i.e. </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ v = ( re_0, im_0, re_1, im_1, ... ) \]" src="form_102.png"/>
</p>
<p>If "forward == true" this routine does the Discrete Fourier Transform (DFT), i.e.: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ vout[m] \leftarrow \sum_{n = 0}^{N-1} vin[i] exp( -2pi m n / N ) \]" src="form_103.png"/>
</p>
<p>If "backward" it does the Inverse Discrete Fourier Transform (IDFT) WITHOUT THE FACTOR 1/N*, i.e.: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ vout[m] &lt;-- \sum_{n = 0}^{N-1} vin[i] exp( 2pi m n / N ) \]" src="form_104.png"/>
</p>
<p> [note the sign difference on the 2 pi for the backward one.]</p>
<p>Note that this is the definition of the FT given in most texts, but it differs from the Numerical Recipes version in which the forward and backward algorithms are flipped.</p>
<p>Note that you would have to multiply by 1/N after the IDFT to get back to where you started from. We don't do this because in some contexts, the transform is made symmetric by multiplying by sqrt(N) in both passes. The user can do this by themselves.</p>
<p>See also <a class="el" href="classkaldi_1_1SplitRadixComplexFft.html">SplitRadixComplexFft</a>, declared in <a class="el" href="srfft_8h.html">srfft.h</a>, which is more efficient but only works if the length of the input is a power of 2. </p>

<p class="definition">Definition at line <a class="el" href="matrix-functions_8cc_source.html#l00334">334</a> of file <a class="el" href="matrix-functions_8cc_source.html">matrix-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="matrix-functions_8cc_source.html#l00097">kaldi::ComplexFftRecursive()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00069">VectorBase&lt; Real &gt;::Data()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-math_8h_source.html#l00324">kaldi::Factorize()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>

<p class="reference">Referenced by <a class="el" href="matrix-functions_8cc_source.html#l00391">kaldi::RealFft()</a>, <a class="el" href="matrix-functions_8cc_source.html#l00350">kaldi::RealFftInefficient()</a>, <a class="el" href="matrix-lib-test_8cc_source.html#l03422">kaldi::UnitTestComplexFft()</a>, and <a class="el" href="matrix-lib-test_8cc_source.html#l03559">kaldi::UnitTestComplexFft2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                                                                                                 {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(v != NULL);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordflow">if</span> (v-&gt;Dim()&lt;=1) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(v-&gt;Dim() % 2 == 0);  <span class="comment">// complex input.</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordtype">int</span> N = v-&gt;Dim() / 2;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  std::vector&lt;int&gt; factors;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <a class="code" href="namespacekaldi.html#aabe56e6ca2823e8689942fce2406a282">Factorize</a>(N, &amp;factors);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordtype">int</span> *factor_beg = NULL;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordflow">if</span> (factors.size() &gt; 0)</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    factor_beg = &amp;(factors[0]);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  Vector&lt;Real&gt; tmp;  <span class="comment">// allocated in ComplexFftRecursive.</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <a class="code" href="namespacekaldi.html#a8923fae8db9a116026722d8c62c49522">ComplexFftRecursive</a>(v-&gt;Data(), 1, N, factor_beg, factor_beg+factors.size(), forward, (tmp_in?tmp_in:&amp;tmp));</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a8923fae8db9a116026722d8c62c49522"><div class="ttname"><a href="namespacekaldi.html#a8923fae8db9a116026722d8c62c49522">kaldi::ComplexFftRecursive</a></div><div class="ttdeci">void ComplexFftRecursive(Real *data, int nffts, int N, const int *factor_begin, const int *factor_end, bool forward, Vector&lt; Real &gt; *tmp_vec)</div><div class="ttdoc">ComplexFftRecursive is a recursive function that computes the complex FFT of size N...</div><div class="ttdef"><b>Definition:</b> <a href="matrix-functions_8cc_source.html#l00097">matrix-functions.cc:97</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_aabe56e6ca2823e8689942fce2406a282"><div class="ttname"><a href="namespacekaldi.html#aabe56e6ca2823e8689942fce2406a282">kaldi::Factorize</a></div><div class="ttdeci">void Factorize(I m, std::vector&lt; I &gt; *factors)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00324">kaldi-math.h:324</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga9a7751d719e4366383f522974fbe5893"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9a7751d719e4366383f522974fbe5893">&#9670;&nbsp;</a></span>ComplexFt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComplexFt </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>forward</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ComplexFt is the same as ComplexFft but it implements the Fourier transform in an inefficient way. </p>
<p>It is mainly included for testing purposes. See comment for ComplexFft to describe the input and outputs and what it does. </p>

<p class="definition">Definition at line <a class="el" href="matrix-functions_8cc_source.html#l00029">29</a> of file <a class="el" href="matrix-functions_8cc_source.html">matrix-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="matrix-functions-inl_8h_source.html#l00038">kaldi::ComplexAddProduct()</a>, <a class="el" href="matrix-functions-inl_8h_source.html#l00046">kaldi::ComplexImExp()</a>, <a class="el" href="matrix-functions-inl_8h_source.html#l00031">kaldi::ComplexMul()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00069">VectorBase&lt; Real &gt;::Data()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="kaldi-math_8h_source.html#l00052">M_2PI</a>.</p>

<p class="reference">Referenced by <a class="el" href="matrix-lib-test_8cc_source.html#l03422">kaldi::UnitTestComplexFft()</a>, <a class="el" href="matrix-lib-test_8cc_source.html#l03559">kaldi::UnitTestComplexFft2()</a>, <a class="el" href="matrix-lib-test_8cc_source.html#l03395">kaldi::UnitTestComplexFt()</a>, and <a class="el" href="matrix-lib-test_8cc_source.html#l03453">kaldi::UnitTestSplitRadixComplexFft()</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                                                                          {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordtype">int</span> exp_sign = (forward ? -1 : 1);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(out != NULL);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(in.Dim() == out-&gt;Dim());</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(in.Dim() % 2 == 0);</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordtype">int</span> twoN = in.Dim(), N = twoN / 2;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keyword">const</span> Real *data_in = in.Data();</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  Real *data_out = out-&gt;Data();</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  Real exp1N_re, exp1N_im;  <span class="comment">//  forward -&gt; exp(-2pi / N), backward -&gt; exp(2pi / N).</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  Real fraction = exp_sign * <a class="code" href="kaldi-math_8h.html#a4aa2c43b09c1300c334821f5507d6f71">M_2PI</a> / <span class="keyword">static_cast&lt;</span>Real<span class="keyword">&gt;</span>(N);  <span class="comment">// forward -&gt; -2pi/N, backward-&gt;-2pi/N</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <a class="code" href="group__matrix__funcs__misc.html#gadd96550b67adf801f58c824febf9c6ec">ComplexImExp</a>(fraction, &amp;exp1N_re, &amp;exp1N_im);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  Real expm_re = 1.0, expm_im = 0.0;  <span class="comment">// forward -&gt; exp(-2pi m / N).</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> two_m = 0; two_m &lt; twoN; two_m+=2) {  <span class="comment">// For each output component.</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    Real expmn_re = 1.0, expmn_im = 0.0;  <span class="comment">// forward -&gt; exp(-2pi m n / N).</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    Real sum_re = 0.0, sum_im = 0.0;  <span class="comment">// complex output for index m (the sum expression)</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> two_n = 0; two_n &lt; twoN; two_n+=2) {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      <a class="code" href="group__matrix__funcs__misc.html#gae200169bea97409ead26f83f9298ad5d">ComplexAddProduct</a>(data_in[two_n], data_in[two_n+1],</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                        expmn_re, expmn_im,</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                        &amp;sum_re, &amp;sum_im);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      <a class="code" href="group__matrix__funcs__misc.html#gadf1aeb4e8fa162e8875ba335316ab1e2">ComplexMul</a>(expm_re, expm_im, &amp;expmn_re, &amp;expmn_im);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    }</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    data_out[two_m] = sum_re;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    data_out[two_m + 1] = sum_im;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">if</span> (two_m % 10 == 0) {  <span class="comment">// occasionally renew &quot;expm&quot; from scratch to avoid</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="comment">// loss of precision.</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <span class="keywordtype">int</span> nextm = 1 + two_m/2;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      Real fraction_mult = fraction * nextm;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <a class="code" href="group__matrix__funcs__misc.html#gadd96550b67adf801f58c824febf9c6ec">ComplexImExp</a>(fraction_mult, &amp;expm_re, &amp;expm_im);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <a class="code" href="group__matrix__funcs__misc.html#gadf1aeb4e8fa162e8875ba335316ab1e2">ComplexMul</a>(exp1N_re, exp1N_im, &amp;expm_re, &amp;expm_im);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    }</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  }</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div><div class="ttc" id="group__matrix__funcs__misc_html_gae200169bea97409ead26f83f9298ad5d"><div class="ttname"><a href="group__matrix__funcs__misc.html#gae200169bea97409ead26f83f9298ad5d">kaldi::ComplexAddProduct</a></div><div class="ttdeci">void ComplexAddProduct(const Real &amp;a_re, const Real &amp;a_im, const Real &amp;b_re, const Real &amp;b_im, Real *c_re, Real *c_im)</div><div class="ttdoc">ComplexMul implements, inline, the complex operation c += (a * b). </div><div class="ttdef"><b>Definition:</b> <a href="matrix-functions-inl_8h_source.html#l00038">matrix-functions-inl.h:38</a></div></div>
<div class="ttc" id="group__matrix__funcs__misc_html_gadf1aeb4e8fa162e8875ba335316ab1e2"><div class="ttname"><a href="group__matrix__funcs__misc.html#gadf1aeb4e8fa162e8875ba335316ab1e2">kaldi::ComplexMul</a></div><div class="ttdeci">void ComplexMul(const Real &amp;a_re, const Real &amp;a_im, Real *b_re, Real *b_im)</div><div class="ttdoc">ComplexMul implements, inline, the complex multiplication b *= a. </div><div class="ttdef"><b>Definition:</b> <a href="matrix-functions-inl_8h_source.html#l00031">matrix-functions-inl.h:31</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="kaldi-math_8h_html_a4aa2c43b09c1300c334821f5507d6f71"><div class="ttname"><a href="kaldi-math_8h.html#a4aa2c43b09c1300c334821f5507d6f71">M_2PI</a></div><div class="ttdeci">#define M_2PI</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00052">kaldi-math.h:52</a></div></div>
<div class="ttc" id="group__matrix__funcs__misc_html_gadd96550b67adf801f58c824febf9c6ec"><div class="ttname"><a href="group__matrix__funcs__misc.html#gadd96550b67adf801f58c824febf9c6ec">kaldi::ComplexImExp</a></div><div class="ttdeci">void ComplexImExp(Real x, Real *a_re, Real *a_im)</div><div class="ttdoc">ComplexImExp implements a &lt; exp(i x), inline. </div><div class="ttdef"><b>Definition:</b> <a href="matrix-functions-inl_8h_source.html#l00046">matrix-functions-inl.h:46</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gadd96550b67adf801f58c824febf9c6ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadd96550b67adf801f58c824febf9c6ec">&#9670;&nbsp;</a></span>ComplexImExp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComplexImExp </td>
          <td>(</td>
          <td class="paramtype">Real&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real *&#160;</td>
          <td class="paramname"><em>a_re</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real *&#160;</td>
          <td class="paramname"><em>a_im</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>ComplexImExp implements a &lt;&ndash; exp(i x), inline. </p>

<p class="definition">Definition at line <a class="el" href="matrix-functions-inl_8h_source.html#l00046">46</a> of file <a class="el" href="matrix-functions-inl_8h_source.html">matrix-functions-inl.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="matrix-functions_8cc_source.html#l00097">kaldi::ComplexFftRecursive()</a>, <a class="el" href="matrix-functions_8cc_source.html#l00029">kaldi::ComplexFt()</a>, <a class="el" href="srfft_8cc_source.html#l00364">SplitRadixRealFft&lt; float &gt;::Compute()</a>, and <a class="el" href="matrix-functions_8cc_source.html#l00391">kaldi::RealFft()</a>.</p>
<div class="fragment"><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                                                                                 {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  *a_re = std::cos(x);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  *a_im = std::sin(x);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="gadf1aeb4e8fa162e8875ba335316ab1e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadf1aeb4e8fa162e8875ba335316ab1e2">&#9670;&nbsp;</a></span>ComplexMul()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComplexMul </td>
          <td>(</td>
          <td class="paramtype">const Real &amp;&#160;</td>
          <td class="paramname"><em>a_re</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real &amp;&#160;</td>
          <td class="paramname"><em>a_im</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real *&#160;</td>
          <td class="paramname"><em>b_re</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real *&#160;</td>
          <td class="paramname"><em>b_im</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>ComplexMul implements, inline, the complex multiplication b *= a. </p>

<p class="definition">Definition at line <a class="el" href="matrix-functions-inl_8h_source.html#l00031">31</a> of file <a class="el" href="matrix-functions-inl_8h_source.html">matrix-functions-inl.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="matrix-functions_8cc_source.html#l00097">kaldi::ComplexFftRecursive()</a>, <a class="el" href="matrix-functions_8cc_source.html#l00029">kaldi::ComplexFt()</a>, <a class="el" href="srfft_8cc_source.html#l00364">SplitRadixRealFft&lt; float &gt;::Compute()</a>, <a class="el" href="signal_8cc_source.html#l00026">kaldi::ElementwiseProductOfFft()</a>, and <a class="el" href="matrix-functions_8cc_source.html#l00391">kaldi::RealFft()</a>.</p>
<div class="fragment"><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                                                                    {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  Real tmp_re = (*b_re * a_re) - (*b_im * a_im);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  *b_im = *b_re * a_im + *b_im * a_re;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  *b_re = tmp_re;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ga828e48b951501d3d2a2e91956a42d24f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga828e48b951501d3d2a2e91956a42d24f">&#9670;&nbsp;</a></span>ComputeDctMatrix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeDctMatrix </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1Matrix.html">Matrix</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>M</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ComputeDctMatrix computes a matrix corresponding to the DCT, such that M * v equals the DCT of vector v. </p>
<p>M must be square at input. This is the type = III DCT with normalization, corresponding to the following equations, where x is the signal and X is the DCT: X_0 = 1/sqrt(2*N) {n = 0}^{N-1} x_n X_k = 1/sqrt(N) {n = 0}^{N-1} x_n cos( /N (n + 1/2) k ) This matrix's transpose is its own inverse, so transposing this matrix will give the inverse DCT. Caution: the type III DCT is generally known as the "inverse DCT" (with the type II being the actual DCT), so this function is somewhatd mis-named. It was probably done this way for HTK compatibility. We don't change it because it was this way from the start and changing it would affect the feature generation. </p>

<p class="definition">Definition at line <a class="el" href="matrix-functions_8cc_source.html#l00592">592</a> of file <a class="el" href="matrix-functions_8cc_source.html">matrix-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-math_8h_source.html#l00044">M_PI</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, and <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>.</p>

<p class="reference">Referenced by <a class="el" href="_2nnet-component_8cc_source.html#l02995">DctComponent::Init()</a>, <a class="el" href="feature-mfcc_8cc_source.html#l00082">MfccComputer::MfccComputer()</a>, and <a class="el" href="matrix-lib-test_8cc_source.html#l03409">kaldi::UnitTestDct()</a>.</p>
<div class="fragment"><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                                                               {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <span class="comment">//KALDI_ASSERT(M-&gt;NumRows() == M-&gt;NumCols());</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> K = M-&gt;NumRows();</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> N = M-&gt;NumCols();</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(K &gt; 0);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(N &gt; 0);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  Real normalizer = std::sqrt(1.0 / static_cast&lt;Real&gt;(N));  <span class="comment">// normalizer for</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="comment">// X_0.</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; N; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) (*M)(0, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) = normalizer;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  normalizer = std::sqrt(2.0 / static_cast&lt;Real&gt;(N));  <span class="comment">// normalizer for other</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;   <span class="comment">// elements.</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> k = 1; k &lt; K; k++)</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; N; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++)</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      (*M)(k, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>) = normalizer</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;          * std::cos( static_cast&lt;double&gt;(<a class="code" href="kaldi-math_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>)/N * (<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> + 0.5) * k );</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="kaldi-math_8h_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="kaldi-math_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00044">kaldi-math.h:44</a></div></div>
<div class="ttc" id="namespacekaldi_html_aac2c220416519a2b0a7ad822ee2ef972"><div class="ttname"><a href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">kaldi::MatrixIndexT</a></div><div class="ttdeci">int32 MatrixIndexT</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00098">matrix-common.h:98</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga386cdedb7491d1545750472c231b3546"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga386cdedb7491d1545750472c231b3546">&#9670;&nbsp;</a></span>ComputePca()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ComputePca </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>U</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>print_eigs</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>exact</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ComputePCA does a PCA computation, using either outer products or inner products, whichever is more efficient. </p>
<p>Let D be the dimension of the data points, N be the number of data points, and G be the PCA dimension we want to retain. We assume G &lt;= N and G &lt;= D.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">X</td><td>[in] An N x D matrix. Each row of X is a point x_i. </td></tr>
    <tr><td class="paramname">U</td><td>[out] A G x D matrix. Each row of U is a basis element u_i. </td></tr>
    <tr><td class="paramname">A</td><td>[out] An N x D matrix, or NULL. Each row of A is a set of coefficients in the basis for a point x_i, so A(i, g) is the coefficient of u_i in x_i. </td></tr>
    <tr><td class="paramname">print_eigs</td><td>[in] If true, prints out diagnostic information about the eigenvalues. </td></tr>
    <tr><td class="paramname">exact</td><td>[in] If true, does the exact computation; if false, does a much faster (but almost exact) computation based on the Lanczos method. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="matrix-functions_8cc_source.html#l00616">616</a> of file <a class="el" href="matrix-functions_8cc_source.html">matrix-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="sp-matrix_8cc_source.html#l01110">SpMatrix&lt; Real &gt;::AddMat2()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00170">MatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01780">MatrixBase&lt; Real &gt;::DestructiveSvd()</a>, <a class="el" href="qr_8cc_source.html#l00433">SpMatrix&lt; Real &gt;::Eig()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01947">MatrixBase&lt; Real &gt;::OrthogonalizeRows()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00190">Vector&lt; Real &gt;::Resize()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00818">Matrix&lt; Real &gt;::Resize()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02534">kaldi::SortSvd()</a>, <a class="el" href="qr_8cc_source.html#l00454">SpMatrix&lt; Real &gt;::TopEigs()</a>, and <a class="el" href="kaldi-matrix_8cc_source.html#l02090">Matrix&lt; Real &gt;::Transpose()</a>.</p>

<p class="reference">Referenced by <a class="el" href="matrix-lib-test_8cc_source.html#l03854">kaldi::UnitTestPca()</a>, and <a class="el" href="matrix-lib-test_8cc_source.html#l03901">kaldi::UnitTestPca2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                            {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="comment">// Note that some of these matrices may be transposed w.r.t. the</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="comment">// way it&#39;s most natural to describe them in math... it&#39;s the rows</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="comment">// of X and U that correspond to the (data-points, basis elements).</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> N = X.NumRows(), D = X.NumCols();</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="comment">// N = #points, D = feature dim.</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(U != NULL &amp;&amp; U-&gt;NumCols() == D);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> G = U-&gt;NumRows();  <span class="comment">// # of retained basis elements.</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(A == NULL || (A-&gt;NumRows() == N &amp;&amp; A-&gt;NumCols() == G));</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(G &lt;= N &amp;&amp; G &lt;= D);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keywordflow">if</span> (D &lt; N) {  <span class="comment">// Do conventional PCA.</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    SpMatrix&lt;Real&gt; Msp(D);  <span class="comment">// Matrix of outer products.</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    Msp.AddMat2(1.0, X, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);  <span class="comment">// M &lt;-- X^T X</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    Matrix&lt;Real&gt; Utmp;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    Vector&lt;Real&gt; l;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordflow">if</span> (exact) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      Utmp.Resize(D, D);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      l.Resize(D);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="comment">//Matrix&lt;Real&gt; M(Msp);</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="comment">//M.DestructiveSvd(&amp;l, &amp;Utmp, NULL);</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      Msp.Eig(&amp;l, &amp;Utmp);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      Utmp.Resize(D, G);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      l.Resize(G);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      Msp.TopEigs(&amp;l, &amp;Utmp);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    }</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <a class="code" href="group__matrix__funcs__misc.html#ga4318e745ace6367bd00b2911089e9e79">SortSvd</a>(&amp;l, &amp;Utmp);</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> g = 0; g &lt; G; g++)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      U-&gt;Row(g).CopyColFromMat(Utmp, g);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">if</span> (print_eigs)</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; (exact ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;Retained &quot;</span>)</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;PCA eigenvalues are &quot;</span> &lt;&lt; l;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordflow">if</span> (A != NULL)</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      A-&gt;AddMatMat(1.0, X, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, *U, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  } <span class="keywordflow">else</span> {  <span class="comment">// Do inner-product PCA.</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    SpMatrix&lt;Real&gt; Nsp(N);  <span class="comment">// Matrix of inner products.</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    Nsp.AddMat2(1.0, X, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);  <span class="comment">// M &lt;-- X X^T</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    Matrix&lt;Real&gt; Vtmp;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    Vector&lt;Real&gt; l;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">if</span> (exact) {</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      Vtmp.Resize(N, N);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      l.Resize(N);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      Matrix&lt;Real&gt; Nmat(Nsp);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      Nmat.DestructiveSvd(&amp;l, &amp;Vtmp, NULL);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      Vtmp.Resize(N, G);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      l.Resize(G);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      Nsp.TopEigs(&amp;l, &amp;Vtmp);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> num_zeroed = 0;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> g = 0; g &lt; G; g++) {</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="keywordflow">if</span> (l(g) &lt; 0.0) {</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;In PCA, setting element &quot;</span> &lt;&lt; l(g) &lt;&lt; <span class="stringliteral">&quot; to zero.&quot;</span>;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        l(g) = 0.0;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        num_zeroed++;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      }</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    }</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <a class="code" href="group__matrix__funcs__misc.html#ga4318e745ace6367bd00b2911089e9e79">SortSvd</a>(&amp;l, &amp;Vtmp); <span class="comment">// Make sure zero elements are last, this</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="comment">// is necessary for Orthogonalize() to work properly later.</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    Vtmp.Transpose();  <span class="comment">// So eigenvalues are the rows.</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> g = 0; g &lt; G; g++) {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      Real sqrtlg = sqrt(l(g));</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="keywordflow">if</span> (l(g) != 0.0) {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        U-&gt;Row(g).AddMatVec(1.0 / sqrtlg, X, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, Vtmp.Row(g), 0.0);</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        U-&gt;Row(g).SetZero();</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        (*U)(g, g) = 1.0;  <span class="comment">// arbitrary direction.  Will later orthogonalize.</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      }</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordflow">if</span> (A != NULL)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; N; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++)</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;          (*A)(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>, g) = sqrtlg * Vtmp(g, <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="comment">// Now orthogonalize.  This is mainly useful in</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="comment">// case there were zero eigenvalues, but we do it</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="comment">// for all of them.</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    U-&gt;OrthogonalizeRows();</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">if</span> (print_eigs)</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;(inner-product) PCA eigenvalues are &quot;</span> &lt;&lt; l;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  }</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_aac2c220416519a2b0a7ad822ee2ef972"><div class="ttname"><a href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">kaldi::MatrixIndexT</a></div><div class="ttdeci">int32 MatrixIndexT</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00098">matrix-common.h:98</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
<div class="ttc" id="group__matrix__funcs__misc_html_ga4318e745ace6367bd00b2911089e9e79"><div class="ttname"><a href="group__matrix__funcs__misc.html#ga4318e745ace6367bd00b2911089e9e79">kaldi::SortSvd</a></div><div class="ttdeci">void SortSvd(VectorBase&lt; Real &gt; *s, MatrixBase&lt; Real &gt; *U, MatrixBase&lt; Real &gt; *Vt, bool sort_on_absolute_value)</div><div class="ttdoc">Function to ensure that SVD is sorted. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02534">kaldi-matrix.cc:2534</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gadb59908c0ecdcc2b3ba2e32b729877a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadb59908c0ecdcc2b3ba2e32b729877a5">&#9670;&nbsp;</a></span>CreateEigenvalueMatrix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CreateEigenvalueMatrix </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>real</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>imag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>D</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates the eigenvalue matrix D that is part of the decomposition used <a class="el" href="classkaldi_1_1MatrixBase.html#a84cb50046244e13aea743984d012467f" title="Eigenvalue Decomposition of a square NxN matrix into the form (*this) = P D P^{-1}. ">Matrix::Eig</a>. </p>
<p>D will be block-diagonal with blocks of size 1 (for real eigenvalues) or 2x2 for complex pairs. If a complex pair is lambda +- i*mu, D will have a corresponding 2x2 block [lambda, mu; -mu, lambda]. This function will throw if any complex eigenvalues are not in complex conjugate pairs (or the members of such pairs are not consecutively numbered). </p>
<p>if (im(j) &lt; 0.0) KALDI_WARN &lt;&lt; "Negative first im part of pair"; // TEMP </p>

<p class="definition">Definition at line <a class="el" href="kaldi-matrix_8cc_source.html#l02577">2577</a> of file <a class="el" href="kaldi-matrix_8cc_source.html">kaldi-matrix.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="namespacekaldi.html#ac646d01f3d7db0d2568d33f8778e2603">kaldi::CreateEigenvalueMatrix()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, and <a class="el" href="kaldi-matrix_8cc_source.html#l01329">MatrixBase&lt; Real &gt;::SetZero()</a>.</p>

<p class="reference">Referenced by <a class="el" href="kaldi-matrix_8h_source.html#l00996">kaldi::TraceMat()</a>, and <a class="el" href="matrix-lib-test_8cc_source.html#l01432">kaldi::UnitTestEig()</a>.</p>
<div class="fragment"><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;                                                 {</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = re.Dim();</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(im.Dim() == n &amp;&amp; D-&gt;NumRows() == n &amp;&amp; D-&gt;NumCols() == <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0;</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  D-&gt;SetZero();</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;  <span class="keywordflow">while</span> (j &lt; n) {</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    <span class="keywordflow">if</span> (im(j) == 0) {  <span class="comment">// Real eigenvalue</span></div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;      (*D)(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) = re(j);</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;      j++;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    } <span class="keywordflow">else</span> {  <span class="comment">// First of a complex pair</span></div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(j+1 &lt; n &amp;&amp; <a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(im(j+1), -im(j))</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                   &amp;&amp; <a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(re(j+1), re(j)));</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;      Real lambda = re(j), mu = im(j);</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;      <span class="comment">// create 2x2 block [lambda, mu; -mu, lambda]</span></div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;      (*D)(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) = lambda;</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;      (*D)(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>, j+1) = mu;</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;      (*D)(j+1, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) = -mu;</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;      (*D)(j+1, j+1) = lambda;</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;      j += 2;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;    }</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;  }</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_aac2c220416519a2b0a7ad822ee2ef972"><div class="ttname"><a href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">kaldi::MatrixIndexT</a></div><div class="ttdeci">int32 MatrixIndexT</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00098">matrix-common.h:98</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga614b44b294e1f0b555531020ceb85f2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga614b44b294e1f0b555531020ceb85f2f">&#9670;&nbsp;</a></span>RealFft()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RealFft </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>forward</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>RealFft is a fourier transform of real inputs. </p>
<p>Internally it uses ComplexFft. The input dimension N must be even. If forward == true, it transforms from a sequence of N real points to its complex fourier transform; otherwise it goes in the reverse direction. If you call it in the forward and then reverse direction and multiply by 1.0/N, you will get back the original data. The interpretation of the complex-FFT data is as follows: the array is a sequence of complex numbers C_n of length N/2 with (real, im) format, i.e. [real0, real_{N/2}, real1, im1, real2, im2, real3, im3, ...]. See also <a class="el" href="classkaldi_1_1SplitRadixRealFft.html">SplitRadixRealFft</a>, declared in <a class="el" href="srfft_8h.html">srfft.h</a>, which is more efficient but only works if the length of the input is a power of 2. </p>

<p class="definition">Definition at line <a class="el" href="matrix-functions_8cc_source.html#l00391">391</a> of file <a class="el" href="matrix-functions_8cc_source.html">matrix-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="matrix-functions-inl_8h_source.html#l00038">kaldi::ComplexAddProduct()</a>, <a class="el" href="matrix-functions_8cc_source.html#l00334">kaldi::ComplexFft()</a>, <a class="el" href="matrix-functions-inl_8h_source.html#l00046">kaldi::ComplexImExp()</a>, <a class="el" href="matrix-functions-inl_8h_source.html#l00031">kaldi::ComplexMul()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00069">VectorBase&lt; Real &gt;::Data()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-math_8h_source.html#l00052">M_2PI</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00962">VectorBase&lt; Real &gt;::Scale()</a>.</p>

<p class="reference">Referenced by <a class="el" href="feature-spectrogram_8cc_source.html#l00047">SpectrogramComputer::Compute()</a>, <a class="el" href="feature-mfcc_8cc_source.html#l00028">MfccComputer::Compute()</a>, <a class="el" href="feature-fbank_8cc_source.html#l00072">FbankComputer::Compute()</a>, <a class="el" href="feature-plp_8cc_source.html#l00112">PlpComputer::Compute()</a>, <a class="el" href="feature-mcep_8cc_source.html#l00052">kaldi::PowerSpectrumToRealCepstrum()</a>, <a class="el" href="feature-mcep_8cc_source.html#l00074">kaldi::RealCepstrumToMagnitudeSpectrum()</a>, <a class="el" href="matrix-lib-test_8cc_source.html#l03611">kaldi::UnitTestRealFft()</a>, and <a class="el" href="matrix-lib-speed-test_8cc_source.html#l00038">kaldi::UnitTestRealFftSpeed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                                                                         {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(v != NULL);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> N = v-&gt;Dim(), N2 = N/2;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(N%2 == 0);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">if</span> (N == 0) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">if</span> (forward) <a class="code" href="namespacekaldi.html#ae7fbf1164f4b5c8478afe77cde060d79">ComplexFft</a>(v, <span class="keyword">true</span>);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  Real *data = v-&gt;Data();</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  Real rootN_re, rootN_im;  <span class="comment">// exp(-2pi/N), forward; exp(2pi/N), backward</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordtype">int</span> forward_sign = forward ? -1 : 1;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <a class="code" href="group__matrix__funcs__misc.html#gadd96550b67adf801f58c824febf9c6ec">ComplexImExp</a>(static_cast&lt;Real&gt;(<a class="code" href="kaldi-math_8h.html#a4aa2c43b09c1300c334821f5507d6f71">M_2PI</a>/N *forward_sign), &amp;rootN_re, &amp;rootN_im);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  Real kN_re = -forward_sign, kN_im = 0.0;  <span class="comment">// exp(-2pik/N), forward; exp(-2pik/N), backward</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="comment">// kN starts out as 1.0 for forward algorithm but -1.0 for backward.</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> k = 1; 2*k &lt;= N2; k++) {</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <a class="code" href="group__matrix__funcs__misc.html#gadf1aeb4e8fa162e8875ba335316ab1e2">ComplexMul</a>(rootN_re, rootN_im, &amp;kN_re, &amp;kN_im);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    Real Ck_re, Ck_im, Dk_re, Dk_im;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">// C_k = 1/2 (B_k + B_{N/2 - k}^*) :</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    Ck_re = 0.5 * (data[2*k] + data[N - 2*k]);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    Ck_im = 0.5 * (data[2*k + 1] - data[N - 2*k + 1]);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">// re(D_k)= 1/2 (im(B_k) + im(B_{N/2-k})):</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    Dk_re = 0.5 * (data[2*k + 1] + data[N - 2*k + 1]);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">// im(D_k) = -1/2 (re(B_k) - re(B_{N/2-k}))</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    Dk_im =-0.5 * (data[2*k] - data[N - 2*k]);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="comment">// A_k = C_k + 1^(k/N) D_k:</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    data[2*k] = Ck_re;  <span class="comment">// A_k &lt;-- C_k</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    data[2*k+1] = Ck_im;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="comment">// now A_k += D_k 1^(k/N)</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <a class="code" href="group__matrix__funcs__misc.html#gae200169bea97409ead26f83f9298ad5d">ComplexAddProduct</a>(Dk_re, Dk_im, kN_re, kN_im, &amp;(data[2*k]), &amp;(data[2*k+1]));</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> kdash = N2 - k;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">if</span> (kdash != k) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="comment">// Next we handle the index k&#39; = N/2 - k.  This is necessary</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="comment">// to do now, to avoid invalidating data that we will later need.</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="comment">// The quantities C_{k&#39;} and D_{k&#39;} are just the conjugates of C_k</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="comment">// and D_k, so the equations are simple modifications of the above,</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="comment">// replacing Ck_im and Dk_im with their negatives.</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      data[2*kdash] = Ck_re;  <span class="comment">// A_k&#39; &lt;-- C_k&#39;</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      data[2*kdash+1] = -Ck_im;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="comment">// now A_k&#39; += D_k&#39; 1^(k&#39;/N)</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="comment">// We use 1^(k&#39;/N) = 1^((N/2 - k) / N) = 1^(1/2) 1^(-k/N) = -1 * (1^(k/N))^*</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="comment">// so it&#39;s the same as 1^(k/N) but with the real part negated.</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <a class="code" href="group__matrix__funcs__misc.html#gae200169bea97409ead26f83f9298ad5d">ComplexAddProduct</a>(Dk_re, -Dk_im, -kN_re, kN_im, &amp;(data[2*kdash]), &amp;(data[2*kdash+1]));</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    }</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  }</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  {  <span class="comment">// Now handle k = 0.</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="comment">// In simple terms: after the complex fft, data[0] becomes the sum of real</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">// parts input[0], input[2]... and data[1] becomes the sum of imaginary</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// pats input[1], input[3]...</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">// &quot;zeroth&quot; [A_0] is just the sum of input[0]+input[1]+input[2]..</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="comment">// and &quot;n2th&quot; [A_{N/2}] is input[0]-input[1]+input[2]... .</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    Real zeroth = data[0] + data[1],</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        n2th = data[0] - data[1];</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    data[0] = zeroth;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    data[1] = n2th;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">if</span> (!forward) {</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      data[0] /= 2;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      data[1] /= 2;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    }</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keywordflow">if</span> (!forward) {</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="namespacekaldi.html#ae7fbf1164f4b5c8478afe77cde060d79">ComplexFft</a>(v, <span class="keyword">false</span>);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    v-&gt;Scale(2.0);  <span class="comment">// This is so we get a factor of N increase, rather than N/2 which we would</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">// otherwise get from [ComplexFft, forward] + [ComplexFft, backward] in dimension N/2.</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">// It&#39;s for consistency with our normal FFT convensions.</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ae7fbf1164f4b5c8478afe77cde060d79"><div class="ttname"><a href="namespacekaldi.html#ae7fbf1164f4b5c8478afe77cde060d79">kaldi::ComplexFft</a></div><div class="ttdeci">template void ComplexFft(VectorBase&lt; double &gt; *v, bool forward, Vector&lt; double &gt; *tmp_in)</div></div>
<div class="ttc" id="namespacekaldi_html_aac2c220416519a2b0a7ad822ee2ef972"><div class="ttname"><a href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">kaldi::MatrixIndexT</a></div><div class="ttdeci">int32 MatrixIndexT</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00098">matrix-common.h:98</a></div></div>
<div class="ttc" id="group__matrix__funcs__misc_html_gae200169bea97409ead26f83f9298ad5d"><div class="ttname"><a href="group__matrix__funcs__misc.html#gae200169bea97409ead26f83f9298ad5d">kaldi::ComplexAddProduct</a></div><div class="ttdeci">void ComplexAddProduct(const Real &amp;a_re, const Real &amp;a_im, const Real &amp;b_re, const Real &amp;b_im, Real *c_re, Real *c_im)</div><div class="ttdoc">ComplexMul implements, inline, the complex operation c += (a * b). </div><div class="ttdef"><b>Definition:</b> <a href="matrix-functions-inl_8h_source.html#l00038">matrix-functions-inl.h:38</a></div></div>
<div class="ttc" id="group__matrix__funcs__misc_html_gadf1aeb4e8fa162e8875ba335316ab1e2"><div class="ttname"><a href="group__matrix__funcs__misc.html#gadf1aeb4e8fa162e8875ba335316ab1e2">kaldi::ComplexMul</a></div><div class="ttdeci">void ComplexMul(const Real &amp;a_re, const Real &amp;a_im, Real *b_re, Real *b_im)</div><div class="ttdoc">ComplexMul implements, inline, the complex multiplication b *= a. </div><div class="ttdef"><b>Definition:</b> <a href="matrix-functions-inl_8h_source.html#l00031">matrix-functions-inl.h:31</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="kaldi-math_8h_html_a4aa2c43b09c1300c334821f5507d6f71"><div class="ttname"><a href="kaldi-math_8h.html#a4aa2c43b09c1300c334821f5507d6f71">M_2PI</a></div><div class="ttdeci">#define M_2PI</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00052">kaldi-math.h:52</a></div></div>
<div class="ttc" id="group__matrix__funcs__misc_html_gadd96550b67adf801f58c824febf9c6ec"><div class="ttname"><a href="group__matrix__funcs__misc.html#gadd96550b67adf801f58c824febf9c6ec">kaldi::ComplexImExp</a></div><div class="ttdeci">void ComplexImExp(Real x, Real *a_re, Real *a_im)</div><div class="ttdoc">ComplexImExp implements a &lt; exp(i x), inline. </div><div class="ttdef"><b>Definition:</b> <a href="matrix-functions-inl_8h_source.html#l00046">matrix-functions-inl.h:46</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga6c0f5032ff57c3b1da8cdb80782ca70f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6c0f5032ff57c3b1da8cdb80782ca70f">&#9670;&nbsp;</a></span>RealFftInefficient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RealFftInefficient </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>forward</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inefficient version of Fourier transform, for testing purposes. </p>
<p>RealFt has the same input and output format as RealFft above, but it is an inefficient implementation included for testing purposes.</p>

<p class="definition">Definition at line <a class="el" href="matrix-functions_8cc_source.html#l00350">350</a> of file <a class="el" href="matrix-functions_8cc_source.html">matrix-functions.cc</a>.</p>

<p class="reference">References <a class="el" href="matrix-functions_8cc_source.html#l00334">kaldi::ComplexFft()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00228">VectorBase&lt; Real &gt;::CopyFromVec()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="kaldi-vector_8h_source.html#l00093">VectorBase&lt; Real &gt;::Range()</a>.</p>

<p class="reference">Referenced by <a class="el" href="matrix-lib-test_8cc_source.html#l03611">kaldi::UnitTestRealFft()</a>, and <a class="el" href="matrix-lib-test_8cc_source.html#l03639">kaldi::UnitTestSplitRadixRealFft()</a>.</p>
<div class="fragment"><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                                                                    {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(v != NULL);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> N = v-&gt;Dim();</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(N%2 == 0);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keywordflow">if</span> (N == 0) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  Vector&lt;Real&gt; vtmp(N*2);  <span class="comment">// store as complex.</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">if</span> (forward) {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; N; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)  vtmp(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>*2) = (*v)(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="namespacekaldi.html#ae7fbf1164f4b5c8478afe77cde060d79">ComplexFft</a>(&amp;vtmp, forward);  <span class="comment">// this is already tested so we can use this.</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    v-&gt;CopyFromVec( vtmp.Range(0, N) );</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    (*v)(1) = vtmp(N);  <span class="comment">// Copy the N/2&#39;th fourier component, which is real,</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// to the imaginary part of the 1st complex output.</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">// reverse the transformation above to get the complex spectrum.</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    vtmp(0) = (*v)(0);  <span class="comment">// copy F_0 which is real</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    vtmp(N) = (*v)(1);  <span class="comment">// copy F_{N/2} which is real</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; N/2; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="comment">// Copy i&#39;th to i&#39;th fourier component</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      vtmp(2*<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) = (*v)(2*<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      vtmp(2*<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>+1) = (*v)(2*<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>+1);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="comment">// Copy i&#39;th to N-i&#39;th, conjugated.</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      vtmp(2*(N-<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>)) = (*v)(2*<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      vtmp(2*(N-<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>)+1) = -(*v)(2*<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>+1);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="namespacekaldi.html#ae7fbf1164f4b5c8478afe77cde060d79">ComplexFft</a>(&amp;vtmp, forward);  <span class="comment">// actually backward since forward == false</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment">// Copy back real part.  Complex part should be zero.</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; N; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      (*v)(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) = vtmp(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>*2);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ae7fbf1164f4b5c8478afe77cde060d79"><div class="ttname"><a href="namespacekaldi.html#ae7fbf1164f4b5c8478afe77cde060d79">kaldi::ComplexFft</a></div><div class="ttdeci">template void ComplexFft(VectorBase&lt; double &gt; *v, bool forward, Vector&lt; double &gt; *tmp_in)</div></div>
<div class="ttc" id="namespacekaldi_html_aac2c220416519a2b0a7ad822ee2ef972"><div class="ttname"><a href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">kaldi::MatrixIndexT</a></div><div class="ttdeci">int32 MatrixIndexT</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00098">matrix-common.h:98</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga8e04108cdb733c6c2bc5dbe4708e1f80"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8e04108cdb733c6c2bc5dbe4708e1f80">&#9670;&nbsp;</a></span>SolveDoubleQuadraticMatrixProblem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Real SolveDoubleQuadraticMatrixProblem </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>P1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>P2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>Q1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>Q2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1SolverOptions.html">SolverOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>M</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximizes the auxiliary function : </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Q(M) = tr(M^T G) -0.5 tr(P_1 M Q_1 M^T) -0.5 tr(P_2 M Q_2 M^T). \]" src="form_109.png"/>
</p>
<p> Encountered in matrix update with a prior. </p>
<p>We also apply a limit on the condition but it should be less frequently necessary, and can be set larger. </p>

<p class="definition">Definition at line <a class="el" href="sp-matrix_8cc_source.html#l00827">827</a> of file <a class="el" href="sp-matrix_8cc_source.html">sp-matrix.cc</a>.</p>

<p class="reference">References <a class="el" href="sp-matrix_8cc_source.html#l00982">SpMatrix&lt; Real &gt;::AddMat2Sp()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00170">MatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00092">VectorBase&lt; Real &gt;::AddMatVec()</a>, <a class="el" href="sp-matrix_8h_source.html#l00211">SpMatrix&lt; Real &gt;::AddSp()</a>, <a class="el" href="tp-matrix_8cc_source.html#l00088">TpMatrix&lt; Real &gt;::Cholesky()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00064">rnnlm::d</a>, <a class="el" href="tp-matrix_8cc_source.html#l00031">TpMatrix&lt; Real &gt;::Invert()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00037">MatrixBase&lt; Real &gt;::Invert()</a>, <a class="el" href="sp-matrix_8cc_source.html#l00465">SpMatrix&lt; Real &gt;::IsDiagonal()</a>, <a class="el" href="sp-matrix_8cc_source.html#l00480">SpMatrix&lt; Real &gt;::IsUnit()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a>, <a class="el" href="sp-matrix_8h_source.html#l00446">SolverOptions::name</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="packed-matrix_8h_source.html#l00104">PackedMatrix&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>, <a class="el" href="sp-matrix_8cc_source.html#l00635">kaldi::SolveQuadraticProblem()</a>, <a class="el" href="sp-matrix_8cc_source.html#l00057">SpMatrix&lt; Real &gt;::SymPosSemiDefEig()</a>, <a class="el" href="sp-matrix_8cc_source.html#l00964">kaldi::VecSpVec()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00037">kaldi::VecVec()</a>.</p>

<p class="reference">Referenced by <a class="el" href="estimate-am-sgmm2_8cc_source.html#l01183">MleAmSgmm2Updater::MapUpdateM()</a>, <a class="el" href="sp-matrix_8h_source.html#l00454">SolverOptions::SolverOptions()</a>, <a class="el" href="sp-matrix_8cc_source.html#l01171">kaldi::TraceSpSpLower()</a>, and <a class="el" href="matrix-lib-test_8cc_source.html#l03017">kaldi::UnitTestSolve()</a>.</p>
<div class="fragment"><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                                                            {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(Q1.NumRows() == M-&gt;NumCols() &amp;&amp; P1.NumRows() == M-&gt;NumRows() &amp;&amp;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;               G.NumRows() == M-&gt;NumRows() &amp;&amp; G.NumCols() == M-&gt;NumCols() &amp;&amp;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;               M-&gt;NumCols() != 0 &amp;&amp; Q2.NumRows() == M-&gt;NumCols() &amp;&amp;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;               P2.NumRows() == M-&gt;NumRows());</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> rows = M-&gt;NumRows(), cols = M-&gt;NumCols();</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="comment">// The following check should not fail as we stipulate P1, P2 and one of Q1</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="comment">// or Q2 must be +ve def and other Q1 or Q2 must be +ve semidef.</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  TpMatrix&lt;Real&gt; LInv(rows);</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  LInv.Cholesky(P1);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  LInv.Invert();  <span class="comment">// Will throw exception if fails.</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  SpMatrix&lt;Real&gt; S(rows);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  Matrix&lt;Real&gt; LInvFull(LInv);</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  S.AddMat2Sp(1.0, LInvFull, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, P2, 0.0);  <span class="comment">// S := L^{-1} P_2 L^{-T}</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  Matrix&lt;Real&gt; U(rows, rows);</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  Vector&lt;Real&gt; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>(rows);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  S.SymPosSemiDefEig(&amp;<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>, &amp;U);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  Matrix&lt;Real&gt; T(rows, rows);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  T.AddMatMat(1.0, U, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, LInvFull, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);  <span class="comment">// T := U^T * L^{-1}</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="preprocessor">#ifdef KALDI_PARANOID  // checking mainly for errors in the code or math.</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  {</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    SpMatrix&lt;Real&gt; P1Trans(rows);</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    P1Trans.AddMat2Sp(1.0, T, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, P1, 0.0);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(P1Trans.IsUnit(0.01));</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  }</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    SpMatrix&lt;Real&gt; P2Trans(rows);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    P2Trans.AddMat2Sp(1.0, T, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, P2, 0.0);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(P2Trans.IsDiagonal(0.01));</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  }</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  Matrix&lt;Real&gt; TInv(T);</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  TInv.Invert();</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  Matrix&lt;Real&gt; Gdash(rows, cols);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  Gdash.AddMatMat(1.0, T, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, G, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);  <span class="comment">// G&#39; = T G</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  Matrix&lt;Real&gt; MdashOld(rows, cols);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  MdashOld.AddMatMat(1.0, TInv, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, *M, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);  <span class="comment">// M&#39; = T^{-T} M</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  Matrix&lt;Real&gt; MdashNew(MdashOld);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  Real objf_impr = 0.0;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> = 0; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a> &lt; rows; <a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>++) {</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    SpMatrix&lt;Real&gt; Qsum(Q1);</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    Qsum.AddSp(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>), Q2);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    SubVector&lt;Real&gt; mdash_n = MdashNew.Row(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    SubVector&lt;Real&gt; gdash_n = Gdash.Row(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    Matrix&lt;Real&gt; QsumInv(Qsum);</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      QsumInv.Invert();</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      Real old_objf = <a class="code" href="group__matrix__funcs__scalar.html#ga4750cd6f7a02a013435779588056b153">VecVec</a>(mdash_n, gdash_n)</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;          - 0.5 * <a class="code" href="namespacekaldi.html#ac866d011552acc8736c1d20eb1e73b3f">VecSpVec</a>(mdash_n, Qsum, mdash_n);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      mdash_n.AddMatVec(1.0, QsumInv, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, gdash_n, 0.0); <span class="comment">// m&#39;_n := g&#39;_n * (Q_1 + d_n Q_2)^{-1}</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      Real new_objf = <a class="code" href="group__matrix__funcs__scalar.html#ga4750cd6f7a02a013435779588056b153">VecVec</a>(mdash_n, gdash_n)</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;          - 0.5 * <a class="code" href="namespacekaldi.html#ac866d011552acc8736c1d20eb1e73b3f">VecSpVec</a>(mdash_n, Qsum, mdash_n);</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <span class="keywordflow">if</span> (new_objf &lt; old_objf) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="keywordflow">if</span> (new_objf &lt; old_objf - 1.0e-05) {</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;          <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;In double quadratic matrix problem: objective &quot;</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;              <span class="stringliteral">&quot;function decreasing during optimization of &quot;</span> &lt;&lt; opts.name</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; old_objf &lt;&lt; <span class="stringliteral">&quot;-&gt;&quot;</span> &lt;&lt; new_objf &lt;&lt; <span class="stringliteral">&quot;, change is &quot;</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;              &lt;&lt; (new_objf - old_objf);</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Auxiliary function decreasing.&quot;</span>; <span class="comment">// Will be caught.</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        } <span class="keywordflow">else</span> {  <span class="comment">// Reset to old value, didn&#39;t improve (very close to optimum).</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;          MdashNew.Row(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>).CopyFromVec(MdashOld.Row(<a class="code" href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">n</a>));</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      }</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      objf_impr += new_objf - old_objf;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    }</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Matrix inversion or optimization failed during double &quot;</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;          <span class="stringliteral">&quot;quadratic problem, solving for&quot;</span> &lt;&lt; opts.name</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;: trying more stable approach.&quot;</span>;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      objf_impr += <a class="code" href="namespacekaldi.html#a941b06a30750affb2e1d42d5ab78fd99">SolveQuadraticProblem</a>(Qsum, gdash_n, opts, &amp;mdash_n);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    }</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  }</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  M-&gt;AddMatMat(1.0, T, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, MdashNew, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0); <span class="comment">// M := T^T M&#39;.</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordflow">return</span> objf_impr;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a941b06a30750affb2e1d42d5ab78fd99"><div class="ttname"><a href="namespacekaldi.html#a941b06a30750affb2e1d42d5ab78fd99">kaldi::SolveQuadraticProblem</a></div><div class="ttdeci">double SolveQuadraticProblem(const SpMatrix&lt; double &gt; &amp;H, const VectorBase&lt; double &gt; &amp;g, const SolverOptions &amp;opts, VectorBase&lt; double &gt; *x)</div><div class="ttdef"><b>Definition:</b> <a href="sp-matrix_8cc_source.html#l00635">sp-matrix.cc:635</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_ac866d011552acc8736c1d20eb1e73b3f"><div class="ttname"><a href="namespacekaldi.html#ac866d011552acc8736c1d20eb1e73b3f">kaldi::VecSpVec</a></div><div class="ttdeci">template double VecSpVec(const VectorBase&lt; double &gt; &amp;v1, const SpMatrix&lt; double &gt; &amp;M, const VectorBase&lt; double &gt; &amp;v2)</div></div>
<div class="ttc" id="namespacekaldi_html_aac2c220416519a2b0a7ad822ee2ef972"><div class="ttname"><a href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">kaldi::MatrixIndexT</a></div><div class="ttdeci">int32 MatrixIndexT</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00098">matrix-common.h:98</a></div></div>
<div class="ttc" id="namespacernnlm_html_ab4871778d570f724a07823e0a2fb9884"><div class="ttname"><a href="namespacernnlm.html#ab4871778d570f724a07823e0a2fb9884">rnnlm::n</a></div><div class="ttdeci">struct rnnlm::@11::@12 n</div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__matrix__funcs__scalar_html_ga4750cd6f7a02a013435779588056b153"><div class="ttname"><a href="group__matrix__funcs__scalar.html#ga4750cd6f7a02a013435779588056b153">kaldi::VecVec</a></div><div class="ttdeci">Real VecVec(const VectorBase&lt; Real &gt; &amp;a, const VectorBase&lt; Real &gt; &amp;b)</div><div class="ttdoc">Returns dot product between v1 and v2. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-vector_8cc_source.html#l00037">kaldi-vector.cc:37</a></div></div>
<div class="ttc" id="namespacernnlm_html_a873684cefeb665f3d5e6b495de57fc0d"><div class="ttname"><a href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">rnnlm::d</a></div><div class="ttdeci">double d</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00064">mikolov-rnnlm-lib.cc:64</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gae6eded79725fb0ed1307d30476f419ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae6eded79725fb0ed1307d30476f419ee">&#9670;&nbsp;</a></span>SolveQuadraticMatrixProblem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Real SolveQuadraticMatrixProblem </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>Q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1SolverOptions.html">SolverOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>M</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximizes the auxiliary function : </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Q(x) = tr(M^T P Y) - 0.5 tr(P M Q M^T) \]" src="form_107.png"/>
</p>
<p> Like a numerically stable version of <img class="formulaInl" alt="$ M := Y Q^{-1} $" src="form_108.png"/>. </p>
<p>Assumes Q and P positive semidefinite, and matrix dimensions match enough to make expressions meaningful. This is mostly as described in the SGMM paper "the subspace Gaussian mixture
model &amp;ndash; a structured model for speech recognition", but the diagonal_precondition option is newly added, to handle problems where different dimensions have very different scaling (we recommend to use the option but it's set false for back compatibility). </p>

<p class="definition">Definition at line <a class="el" href="sp-matrix_8cc_source.html#l00729">729</a> of file <a class="el" href="sp-matrix_8cc_source.html">sp-matrix.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-matrix_8cc_source.html#l00355">MatrixBase&lt; Real &gt;::AddMat()</a>, <a class="el" href="sp-matrix_8cc_source.html#l00982">SpMatrix&lt; Real &gt;::AddMat2Sp()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00170">MatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="sp-matrix_8cc_source.html#l00922">SpMatrix&lt; Real &gt;::AddVec2Sp()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00817">VectorBase&lt; Real &gt;::ApplyFloor()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00457">VectorBase&lt; Real &gt;::ApplyPow()</a>, <a class="el" href="sp-matrix_8cc_source.html#l00631">SolverOptions::Check()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00293">VectorBase&lt; Real &gt;::CopyDiagFromSp()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00861">MatrixBase&lt; Real &gt;::CopyFromMat()</a>, <a class="el" href="sp-matrix_8h_source.html#l00448">SolverOptions::diagonal_precondition</a>, <a class="el" href="sp-matrix_8h_source.html#l00445">SolverOptions::eps</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00781">VectorBase&lt; Real &gt;::InvertElements()</a>, <a class="el" href="sp-matrix_8cc_source.html#l00507">SpMatrix&lt; Real &gt;::IsZero()</a>, <a class="el" href="sp-matrix_8h_source.html#l00444">SolverOptions::K</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00132">KALDI_LOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00579">VectorBase&lt; Real &gt;::Max()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01318">MatrixBase&lt; Real &gt;::MulColsVec()</a>, <a class="el" href="sp-matrix_8h_source.html#l00446">SolverOptions::name</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="packed-matrix_8h_source.html#l00104">PackedMatrix&lt; Real &gt;::NumRows()</a>, <a class="el" href="sp-matrix_8h_source.html#l00447">SolverOptions::optimize_delta</a>, <a class="el" href="sp-matrix_8h_source.html#l00449">SolverOptions::print_debug_output</a>, <a class="el" href="sp-matrix_8cc_source.html#l00057">SpMatrix&lt; Real &gt;::SymPosSemiDefEig()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>, and <a class="el" href="sp-matrix_8cc_source.html#l00326">kaldi::TraceSpSp()</a>.</p>

<p class="reference">Referenced by <a class="el" href="sp-matrix_8h_source.html#l00454">SolverOptions::SolverOptions()</a>, <a class="el" href="sp-matrix_8cc_source.html#l01171">kaldi::TraceSpSpLower()</a>, <a class="el" href="matrix-lib-test_8cc_source.html#l03017">kaldi::UnitTestSolve()</a>, <a class="el" href="estimate-am-sgmm2-ebw_8cc_source.html#l00283">EbwAmSgmm2Updater::UpdateM()</a>, <a class="el" href="estimate-am-sgmm2_8cc_source.html#l01040">MleAmSgmm2Updater::UpdateM()</a>, <a class="el" href="estimate-am-sgmm2-ebw_8cc_source.html#l00524">EbwAmSgmm2Updater::UpdateN()</a>, <a class="el" href="estimate-am-sgmm2_8cc_source.html#l01486">MleAmSgmm2Updater::UpdateN()</a>, and <a class="el" href="ivector-extractor_8cc_source.html#l01233">IvectorExtractorStats::UpdateProjection()</a>.</p>
<div class="fragment"><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                                                 {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(Q.NumRows() == M-&gt;NumCols() &amp;&amp;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;               SigmaInv.NumRows() == M-&gt;NumRows() &amp;&amp; Y.NumRows() == M-&gt;NumRows()</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;               &amp;&amp; Y.NumCols() == M-&gt;NumCols() &amp;&amp; M-&gt;NumCols() != 0);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  opts.Check();</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> rows = M-&gt;NumRows(), cols = M-&gt;NumCols();</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordflow">if</span> (Q.IsZero(0.0)) {</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Zero quadratic term in quadratic matrix problem for &quot;</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;               &lt;&lt; opts.name &lt;&lt; <span class="stringliteral">&quot;: leaving it unchanged.&quot;</span>;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keywordflow">return</span> 0.0;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keywordflow">if</span> (opts.diagonal_precondition) {</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="comment">// We can re-cast the problem with a diagonal preconditioner in the space</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="comment">// of Q (columns of M).  Helps to improve the condition of Q.</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    Vector&lt;Real&gt; Q_diag(cols);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    Q_diag.CopyDiagFromSp(Q);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    Q_diag.ApplyFloor(std::numeric_limits&lt;Real&gt;::min() * 1.0E+3);</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    Vector&lt;Real&gt; Q_diag_sqrt(Q_diag);</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    Q_diag_sqrt.ApplyPow(0.5);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    Vector&lt;Real&gt; Q_diag_inv_sqrt(Q_diag_sqrt);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    Q_diag_inv_sqrt.InvertElements();</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    Matrix&lt;Real&gt; M_scaled(*M);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    M_scaled.MulColsVec(Q_diag_sqrt);</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    Matrix&lt;Real&gt; Y_scaled(Y);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    Y_scaled.MulColsVec(Q_diag_inv_sqrt);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    SpMatrix&lt;Real&gt; Q_scaled(cols);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    Q_scaled.AddVec2Sp(1.0, Q_diag_inv_sqrt, Q, 0.0);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    Real ans;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    SolverOptions new_opts(opts);</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    new_opts.diagonal_precondition = <span class="keyword">false</span>;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    ans = <a class="code" href="namespacekaldi.html#a1fbe3fcf5a2ae931e07d7fe7def64817">SolveQuadraticMatrixProblem</a>(Q_scaled, Y_scaled, SigmaInv,</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                                      new_opts, &amp;M_scaled);</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    M-&gt;CopyFromMat(M_scaled);</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    M-&gt;MulColsVec(Q_diag_inv_sqrt);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  Matrix&lt;Real&gt; Ybar(Y);</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keywordflow">if</span> (opts.optimize_delta) {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    Matrix&lt;Real&gt; Qfull(Q);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    Ybar.AddMatMat(-1.0, *M, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, Qfull, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 1.0);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  } <span class="comment">// Ybar = Y - M Q.</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  Matrix&lt;Real&gt; U(cols, cols);</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  Vector&lt;Real&gt; l(cols);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  Q.SymPosSemiDefEig(&amp;l, &amp;U);  <span class="comment">// does svd Q = U L V^T and checks that Q == U L U^T to within a tolerance.</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="comment">// floor l.</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  Real f = std::max&lt;Real&gt;(<span class="keyword">static_cast&lt;</span>Real<span class="keyword">&gt;</span>(opts.eps), l.Max() / opts.K);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> nfloored = 0;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; cols; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {  <span class="comment">// floor l.</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">if</span> (l(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) &lt; f) { nfloored++; l(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) = f; }</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="keywordflow">if</span> (nfloored != 0 &amp;&amp; opts.print_debug_output)</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Solving matrix problem for &quot;</span> &lt;&lt; opts.name</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;: floored &quot;</span> &lt;&lt; nfloored &lt;&lt; <span class="stringliteral">&quot; eigenvalues. &quot;</span>;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  Matrix&lt;Real&gt; tmpDelta(rows, cols);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  tmpDelta.AddMatMat(1.0, Ybar, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, U, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);  <span class="comment">// tmpDelta = Ybar * U.</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  l.InvertElements(); <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(1.0/l.Max() != 0);  <span class="comment">// check not infinite.  eps should take care of this.</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  tmpDelta.MulColsVec(l);  <span class="comment">// tmpDelta = Ybar * U * \tilde{L}^{-1}</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  Matrix&lt;Real&gt; Delta(rows, cols);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  Delta.AddMatMat(1.0, tmpDelta, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, U, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);  <span class="comment">// Delta = Ybar * U * \tilde{L}^{-1} * U^T</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  Real auxf_before, auxf_after;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  SpMatrix&lt;Real&gt; MQM(rows);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  Matrix&lt;Real&gt; &amp;SigmaInvY(tmpDelta);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  { Matrix&lt;Real&gt; SigmaInvFull(SigmaInv);  SigmaInvY.AddMatMat(1.0, SigmaInvFull, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, Y, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0); }</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  {  <span class="comment">// get auxf_before.      Q(x) = tr(M^T SigmaInv Y) - 0.5 tr(SigmaInv M Q M^T).</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    MQM.AddMat2Sp(1.0, *M, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, Q, 0.0);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    auxf_before = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(*M, SigmaInvY, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a>) - 0.5*<a class="code" href="group__matrix__funcs__scalar.html#gaf0aea8570a4e17db11f5a29fad7a5ade">TraceSpSp</a>(SigmaInv, MQM);</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  }</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  Matrix&lt;Real&gt; Mhat(Delta);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordflow">if</span> (opts.optimize_delta) Mhat.AddMat(1.0, *M);  <span class="comment">// Mhat = Delta + M.</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  {  <span class="comment">// get auxf_after.</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    MQM.AddMat2Sp(1.0, Mhat, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, Q, 0.0);</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    auxf_after = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(Mhat, SigmaInvY, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a>) - 0.5*<a class="code" href="group__matrix__funcs__scalar.html#gaf0aea8570a4e17db11f5a29fad7a5ade">TraceSpSp</a>(SigmaInv, MQM);</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  }</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="keywordflow">if</span> (auxf_after &lt; auxf_before) {</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">if</span> (auxf_after &lt; auxf_before - 1.0e-10)</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Optimizing matrix auxiliary function for &quot;</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                 &lt;&lt; opts.name &lt;&lt; <span class="stringliteral">&quot;, auxf decreased &quot;</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                 &lt;&lt; auxf_before &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; auxf_after &lt;&lt; <span class="stringliteral">&quot;, change is &quot;</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                 &lt;&lt; (auxf_after-auxf_before);</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keywordflow">return</span> 0.0;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    M-&gt;CopyFromMat(Mhat);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">return</span> auxf_after - auxf_before;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_aac2c220416519a2b0a7ad822ee2ef972"><div class="ttname"><a href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">kaldi::MatrixIndexT</a></div><div class="ttdeci">int32 MatrixIndexT</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00098">matrix-common.h:98</a></div></div>
<div class="ttc" id="namespacekaldi_html_a1fbe3fcf5a2ae931e07d7fe7def64817"><div class="ttname"><a href="namespacekaldi.html#a1fbe3fcf5a2ae931e07d7fe7def64817">kaldi::SolveQuadraticMatrixProblem</a></div><div class="ttdeci">template double SolveQuadraticMatrixProblem(const SpMatrix&lt; double &gt; &amp;Q, const MatrixBase&lt; double &gt; &amp;Y, const SpMatrix&lt; double &gt; &amp;SigmaInv, const SolverOptions &amp;opts, MatrixBase&lt; double &gt; *M)</div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="group__matrix__funcs__scalar_html_gaf0aea8570a4e17db11f5a29fad7a5ade"><div class="ttname"><a href="group__matrix__funcs__scalar.html#gaf0aea8570a4e17db11f5a29fad7a5ade">kaldi::TraceSpSp</a></div><div class="ttdeci">Real TraceSpSp(const SpMatrix&lt; Real &gt; &amp;A, const SpMatrix&lt; OtherReal &gt; &amp;B)</div><div class="ttdoc">Returns tr(A B). </div><div class="ttdef"><b>Definition:</b> <a href="sp-matrix_8cc_source.html#l00367">sp-matrix.cc:367</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00132">kaldi-error.h:132</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gaf957f3398e0409677329fece304de0b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf957f3398e0409677329fece304de0b9">&#9670;&nbsp;</a></span>SolveQuadraticProblem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Real kaldi::SolveQuadraticProblem </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>H</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1SolverOptions.html">SolverOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>x</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximizes the auxiliary function </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Q(x) = x.g - 0.5 x^T H x \]" src="form_105.png"/>
</p>
<p> using a numerically stable method. </p>
<p>Like a numerically stable version of <img class="formulaInl" alt="$ x := Q^{-1} g. $" src="form_106.png"/> Assumes H positive semidefinite. Returns the objective-function change. </p>

</div>
</div>
<a id="ga4318e745ace6367bd00b2911089e9e79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4318e745ace6367bd00b2911089e9e79">&#9670;&nbsp;</a></span>SortSvd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SortSvd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>U</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; Real &gt; *&#160;</td>
          <td class="paramname"><em>Vt</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>sort_on_absolute_value</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to ensure that SVD is sorted. </p>
<p>This function is made as generic as possible, to be applicable to other types of problems. s-&gt;Dim() should be the same as U-&gt;NumCols(), and we sort s from greatest to least absolute value (if sort_on_absolute_value == true) or greatest to least value otherwise, moving the columns of U, if it exists, and the rows of Vt, if it exists, around in the same way. Note: the "absolute value" part won't matter if this is an actual SVD, since singular values are non-negative. </p>
<p>Makes sure the Svd is sorted (from greatest to least absolute value). </p>

<p class="definition">Definition at line <a class="el" href="kaldi-matrix_8cc_source.html#l02534">2534</a> of file <a class="el" href="kaldi-matrix_8cc_source.html">kaldi-matrix.cc</a>.</p>

<p class="reference">References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00064">rnnlm::d</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00064">MatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00061">MatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00185">MatrixBase&lt; Real &gt;::Row()</a>, and <a class="el" href="namespacekaldi.html#af1752356a193f4d8a92608e5da7d80ab">kaldi::SortSvd()</a>.</p>

<p class="reference">Referenced by <a class="el" href="plda_8cc_source.html#l00220">Plda::ApplyTransform()</a>, <a class="el" href="am-sgmm2_8cc_source.html#l01297">kaldi::ComputeFeatureNormalizingTransform()</a>, <a class="el" href="ivector-compute-lda_8cc_source.html#l00094">kaldi::ComputeLdaTransform()</a>, <a class="el" href="matrix-functions_8cc_source.html#l00616">kaldi::ComputePca()</a>, <a class="el" href="nnet-utils_8cc_source.html#l00702">SvdApplier::DecomposeComponent()</a>, <a class="el" href="lda-estimate_8cc_source.html#l00085">LdaEstimate::Estimate()</a>, <a class="el" href="basis-fmllr-diag-gmm_8cc_source.html#l00219">BasisFmllrEstimate::EstimateFmllrBasis()</a>, <a class="el" href="get-feature-transform_8cc_source.html#l00040">FeatureTransformEstimate::EstimateInternal()</a>, <a class="el" href="fmllr-sgmm2_8cc_source.html#l00506">kaldi::EstimateSgmm2FmllrSubspace()</a>, <a class="el" href="ivector-plda-scoring-dense_8cc_source.html#l00029">kaldi::EstPca()</a>, <a class="el" href="ivector-extractor_8cc_source.html#l01267">IvectorExtractorStats::GetOrthogonalIvectorTransform()</a>, <a class="el" href="plda_8cc_source.html#l00537">PldaEstimator::GetOutput()</a>, <a class="el" href="_2nnet-component_8cc_source.html#l01261">AffineComponent::LimitRank()</a>, <a class="el" href="est-pca_8cc_source.html#l00025">main()</a>, <a class="el" href="nnet-limit-rank_8cc_source.html#l00031">LimitRankClass::operator()()</a>, <a class="el" href="nnet-precondition-online-test_8cc_source.html#l00128">OnlinePreconditionerSimple::PreconditionDirectionsCpu()</a>, <a class="el" href="natural-gradient-online-test_8cc_source.html#l00128">OnlineNaturalGradientSimple::PreconditionDirectionsCpu()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, <a class="el" href="natural-gradient-online_8cc_source.html#l00323">OnlineNaturalGradient::PreconditionDirectionsInternal()</a>, <a class="el" href="nnet-utils_8cc_source.html#l01086">kaldi::nnet3::ReduceRankOfComponents()</a>, <a class="el" href="qr_8cc_source.html#l00454">SpMatrix&lt; float &gt;::TopEigs()</a>, <a class="el" href="kaldi-matrix_8h_source.html#l00996">kaldi::TraceMat()</a>, <a class="el" href="matrix-lib-test_8cc_source.html#l03901">kaldi::UnitTestPca2()</a>, <a class="el" href="matrix-lib-test_8cc_source.html#l01360">kaldi::UnitTestSvdNodestroy()</a>, and <a class="el" href="plda_8cc_source.html#l00613">PldaUnsupervisedAdaptor::UpdatePlda()</a>.</p>
<div class="fragment"><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;                                                                                      {</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> num_singval = s-&gt;Dim();</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(U == NULL || U-&gt;NumCols() == num_singval);</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(Vt == NULL || Vt-&gt;NumRows() == num_singval);</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  std::vector&lt;std::pair&lt;Real, MatrixIndexT&gt; &gt; vec(num_singval);</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;  <span class="comment">// negative because we want revese order.</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = 0; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> &lt; num_singval; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>++) {</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;    Real val = (*s)(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>),</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;        sort_val = -(sort_on_absolute_value ? std::abs(val) : val);</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;    vec[<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>] = std::pair&lt;Real, MatrixIndexT&gt;(sort_val, <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>);</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;  }</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;  std::sort(vec.begin(), vec.end());</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;  Vector&lt;Real&gt; s_copy(*s);</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = 0; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> &lt; num_singval; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>++)</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    (*s)(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>) = s_copy(vec[<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>].second);</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;  <span class="keywordflow">if</span> (U != NULL) {</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    Matrix&lt;Real&gt; Utmp(*U);</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> dim = Utmp.NumRows();</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = 0; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> &lt; num_singval; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>++) {</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      <a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> oldidx = vec[<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>].second;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> e = 0; e &lt; dim; e++)</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;        (*U)(e, <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>) = Utmp(e, oldidx);</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    }</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;  }</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;  <span class="keywordflow">if</span> (Vt != NULL) {</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    Matrix&lt;Real&gt; Vttmp(*Vt);</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">MatrixIndexT</a> <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = 0; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> &lt; num_singval; <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>++)</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;      (*Vt).Row(<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>).CopyFromVec(Vttmp.Row(vec[<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>].second));</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;  }</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aac2c220416519a2b0a7ad822ee2ef972"><div class="ttname"><a href="namespacekaldi.html#aac2c220416519a2b0a7ad822ee2ef972">kaldi::MatrixIndexT</a></div><div class="ttdeci">int32 MatrixIndexT</div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00098">matrix-common.h:98</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="namespacernnlm_html_a873684cefeb665f3d5e6b495de57fc0d"><div class="ttname"><a href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">rnnlm::d</a></div><div class="ttdeci">double d</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00064">mikolov-rnnlm-lib.cc:64</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
