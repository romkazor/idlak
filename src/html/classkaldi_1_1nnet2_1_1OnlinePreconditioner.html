<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: OnlinePreconditioner Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classkaldi_1_1nnet2_1_1OnlinePreconditioner.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">OnlinePreconditioner Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Keywords for search: natural gradient, naturalgradient, NG-SGD.  
 <a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for OnlinePreconditioner:</div>
<div class="dyncontent">
<div class="center"><img src="classkaldi_1_1nnet2_1_1OnlinePreconditioner__coll__graph.png" border="0" usemap="#OnlinePreconditioner_coll__map" alt="Collaboration graph"/></div>
<map name="OnlinePreconditioner_coll__map" id="OnlinePreconditioner_coll__map">
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae5a325f51ed0d376954386aecddc7bca"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ae5a325f51ed0d376954386aecddc7bca">OnlinePreconditioner</a> ()</td></tr>
<tr class="separator:ae5a325f51ed0d376954386aecddc7bca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb9bffca178027f3e5d52ec73a1ee0fe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#afb9bffca178027f3e5d52ec73a1ee0fe">SetRank</a> (int32 rank)</td></tr>
<tr class="separator:afb9bffca178027f3e5d52ec73a1ee0fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af830848160afd5bf477387d1c5825d8c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af830848160afd5bf477387d1c5825d8c">SetUpdatePeriod</a> (int32 update_period)</td></tr>
<tr class="separator:af830848160afd5bf477387d1c5825d8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92a77e900ccaf0f3a722e2a4a9dedb77"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a92a77e900ccaf0f3a722e2a4a9dedb77">SetNumSamplesHistory</a> (<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> num_samples_history)</td></tr>
<tr class="separator:a92a77e900ccaf0f3a722e2a4a9dedb77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a885862c5b0a0cf88d75bee40f5cf29f2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a885862c5b0a0cf88d75bee40f5cf29f2">SetAlpha</a> (<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha)</td></tr>
<tr class="separator:a885862c5b0a0cf88d75bee40f5cf29f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35086953bbc759bd2ac9cb660d87d83f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a35086953bbc759bd2ac9cb660d87d83f">TurnOnDebug</a> ()</td></tr>
<tr class="separator:a35086953bbc759bd2ac9cb660d87d83f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf6a1777407d36e2173dd1de0e60b322"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#acf6a1777407d36e2173dd1de0e60b322">GetNumSamplesHistory</a> () const</td></tr>
<tr class="separator:acf6a1777407d36e2173dd1de0e60b322"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecff47257feb076ddd824437cd4bb760"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aecff47257feb076ddd824437cd4bb760">GetAlpha</a> () const</td></tr>
<tr class="separator:aecff47257feb076ddd824437cd4bb760"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fd2929c7565d8aeebac17374c7ae45d"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1fd2929c7565d8aeebac17374c7ae45d">GetRank</a> () const</td></tr>
<tr class="separator:a1fd2929c7565d8aeebac17374c7ae45d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58d61a9b39bd466823c1d1710615dd90"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a58d61a9b39bd466823c1d1710615dd90">GetUpdatePeriod</a> () const</td></tr>
<tr class="separator:a58d61a9b39bd466823c1d1710615dd90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40de84aa34756dd2c783f5f8a131670a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a40de84aa34756dd2c783f5f8a131670a">PreconditionDirections</a> (<a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *R, <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *row_prod, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *scale)</td></tr>
<tr class="separator:a40de84aa34756dd2c783f5f8a131670a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada10af0e24fbd9b9b6524207d33849c2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ada10af0e24fbd9b9b6524207d33849c2">OnlinePreconditioner</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html">OnlinePreconditioner</a> &amp;other)</td></tr>
<tr class="separator:ada10af0e24fbd9b9b6524207d33849c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64f8f91edb72016058b1f1f34d8e13be"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html">OnlinePreconditioner</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a64f8f91edb72016058b1f1f34d8e13be">operator=</a> (const <a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html">OnlinePreconditioner</a> &amp;other)</td></tr>
<tr class="separator:a64f8f91edb72016058b1f1f34d8e13be"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a0ecfb5492a4bb8115f1b875c13ae40c9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a0ecfb5492a4bb8115f1b875c13ae40c9">PreconditionDirectionsInternal</a> (const int32 t, const <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> rho_t, const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;d_t, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *WJKL_t, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *X_t, <a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *row_prod, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *scale)</td></tr>
<tr class="separator:a0ecfb5492a4bb8115f1b875c13ae40c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bdc60d5b8ab06b11d20695a71da1024"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a2bdc60d5b8ab06b11d20695a71da1024">ComputeEt</a> (const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;d_t, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> beta_t, <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *e_t, <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *sqrt_e_t, <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *inv_sqrt_e_t) const</td></tr>
<tr class="separator:a2bdc60d5b8ab06b11d20695a71da1024"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d2db282e47c56f778322ddf9631a0ee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9d2db282e47c56f778322ddf9631a0ee">ComputeZt</a> (int32 N, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> rho_t, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;d_t, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;inv_sqrt_e_t, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;K_t, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;L_t, <a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; double &gt; *Z_t) const</td></tr>
<tr class="separator:a9d2db282e47c56f778322ddf9631a0ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa648b298424a1fc8789b6c7efa4d2c8d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa648b298424a1fc8789b6c7efa4d2c8d">ComputeWt1</a> (int32 N, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;d_t, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;d_t1, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> rho_t, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> rho_t1, const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;U_t, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;sqrt_c_t, const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;inv_sqrt_e_t, const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;W_t, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *J_t, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *W_t1) const</td></tr>
<tr class="separator:aa648b298424a1fc8789b6c7efa4d2c8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04f608ae169f9f8893c5611d379ce5ae"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a04f608ae169f9f8893c5611d379ce5ae">ReorthogonalizeXt1</a> (const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;d_t1, <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> rho_t1, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *W_t1, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *temp_W, <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *temp_O)</td></tr>
<tr class="separator:a04f608ae169f9f8893c5611d379ce5ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af101bbf82527b43a60a43a287270fd0f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af101bbf82527b43a60a43a287270fd0f">Init</a> (const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;R0)</td></tr>
<tr class="separator:af101bbf82527b43a60a43a287270fd0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8dcc86ffa0412cb5f8dcb8d6c98eca5a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a8dcc86ffa0412cb5f8dcb8d6c98eca5a">InitDefault</a> (int32 D)</td></tr>
<tr class="separator:a8dcc86ffa0412cb5f8dcb8d6c98eca5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9146ef05a20cd050436475ff208c6ae"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ae9146ef05a20cd050436475ff208c6ae">Eta</a> (int32 N) const</td></tr>
<tr class="separator:ae9146ef05a20cd050436475ff208c6ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d419f9b6bc532b8960a93ce3f54f3be"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1d419f9b6bc532b8960a93ce3f54f3be">SelfTest</a> () const</td></tr>
<tr class="separator:a1d419f9b6bc532b8960a93ce3f54f3be"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:a898dc92e6358fb2aa0306c4ce31b3a7b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a898dc92e6358fb2aa0306c4ce31b3a7b">InitOrthonormalSpecial</a> (<a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *R)</td></tr>
<tr class="memdesc:a898dc92e6358fb2aa0306c4ce31b3a7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function creates a matrix with orthonormal rows that is like the following matrix, except with each row normalized to have unit 2-norm: [ 1.1 0 1 0 1 0 0 1.1 0 1 0 1 ] The reason why the first element in each row is 1.1 and not 1, is for symmetry-breaking...  <a href="#a898dc92e6358fb2aa0306c4ce31b3a7b">More...</a><br /></td></tr>
<tr class="separator:a898dc92e6358fb2aa0306c4ce31b3a7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:af679b81005104cca1fc03ef8ee3b36d0"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a></td></tr>
<tr class="separator:af679b81005104cca1fc03ef8ee3b36d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab35b32394fce8242b6fb4ae4ba4e54e1"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">update_period_</a></td></tr>
<tr class="separator:ab35b32394fce8242b6fb4ae4ba4e54e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af659a9e1c6ede20999b0996a58f97f34"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">num_samples_history_</a></td></tr>
<tr class="separator:af659a9e1c6ede20999b0996a58f97f34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43efd606b8c638dd071888c30b741e91"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a></td></tr>
<tr class="separator:a43efd606b8c638dd071888c30b741e91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a008c4e6cc13410d1b983ad2b06fffeaf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">epsilon_</a></td></tr>
<tr class="separator:a008c4e6cc13410d1b983ad2b06fffeaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0ae63e5e17bafaf1ab9c9328517bb5b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">delta_</a></td></tr>
<tr class="separator:aa0ae63e5e17bafaf1ab9c9328517bb5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd17f633a8fc0939bc5bd0e83bd7153c"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">t_</a></td></tr>
<tr class="separator:abd17f633a8fc0939bc5bd0e83bd7153c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3c6b16d7d97db660d96144a3239dc01"><td class="memItemLeft" align="right" valign="top">int32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab3c6b16d7d97db660d96144a3239dc01">num_updates_skipped_</a></td></tr>
<tr class="separator:ab3c6b16d7d97db660d96144a3239dc01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bffda16ce504620d0ea2d1118cd0653"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">self_debug_</a></td></tr>
<tr class="separator:a1bffda16ce504620d0ea2d1118cd0653"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a1f65814903de3b91358880a8955c1c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1CuMatrix.html">CuMatrix</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a></td></tr>
<tr class="separator:a5a1f65814903de3b91358880a8955c1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c611c2de39a87a3ad90640fd024b048"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">rho_t_</a></td></tr>
<tr class="separator:a9c611c2de39a87a3ad90640fd024b048"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af12dc036070d7e3229a0232e214c226e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a></td></tr>
<tr class="separator:af12dc036070d7e3229a0232e214c226e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12a31e639df35867380f95cc14b9f139"><td class="memItemLeft" align="right" valign="top">std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a12a31e639df35867380f95cc14b9f139">read_write_mutex_</a></td></tr>
<tr class="separator:a12a31e639df35867380f95cc14b9f139"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a642038c403825903d5c2de21ccdb334b"><td class="memItemLeft" align="right" valign="top">std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a642038c403825903d5c2de21ccdb334b">update_mutex_</a></td></tr>
<tr class="separator:a642038c403825903d5c2de21ccdb334b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Keywords for search: natural gradient, naturalgradient, NG-SGD. </p>
<p>This method is explained in the paper "Parallel training of DNNs with Natural Gradient and Parameter Averaging" by D. Povey, X. Zhang and S. Khudanpur, ICLR Workshop, 2015, where it is referred to as online NG-SGD. Note that the method exported from this header is just the core of the algorithm, and some outer-level parts of it are implemented in class NaturalGradientAffineComponent.</p>
<p>The rest of this extended comment describes the way we keep updated an estimate of the inverse of a scatter matrix, in an online way. This is the same as the estimation of one of the A or B quantities in the paper. This comment is slightly redundant with the paper- actually it precedes the paper- but we keep it in case it is useful in understanging our method.</p>
<p>We consider the problem of doing online estimation of a (scaled-identity plus low-rank) approximation of a Fisher matrix... since the Fisher matrix is a scatter of vector-valued derivatives and we will be given the derivatives (or at least terms in a factorization of the derivatives which need not concern us right now), we can just think of the present task as being the online accumulation of a (low-rank plus scaled-identity) approximation to a variance of a distribution with mean zero.</p>
<p>Later on we'll think about how to get easy access to the inverse of this approximate variance, which is what we really need.</p>
<p>Our approximation to the Fisher matrix (the scatter of derivatives) will be of the following form (and just think of this as an approximate variance matrix of some arbitrary quantities).</p>
<p>F_t =(def) R_t^T D_t R_t +  I</p>
<p>(t is the minibatch index), where R_t is an R by D matrix with orthonormal rows (1 &lt;= R &lt; D is our chosen rank), D_t is a positive-definite diagonal matrix, and  &gt; 0. Suppose the dimension of F_t is D. Let the vectors whose variance we are approximating be provided in minibatches of size M (M can vary from iteration to iteration, but it won't vary in the normal case, so we omit the subscript t). The batch of gradients is given as X_t  Re^{M  D}, i.e. each row is one of the vectors whose scatter we're estimating. On the t'th iteration, define the scatter S_t of the input vectors X_t as:</p>
<p>S_t =(def) 1/N X_t^T X_t (eqn:St)</p>
<p>(where N is the minibatch size). Be careful not to confuse the rank R with with input X_t (we would typeface X_t in bold if this were not plain text, to make the distinction clearer). We want F_t to approach some kind of time-weighted average of the S_t quantities, to the extent permitted by the limitation of the rank R. We want the F_t quantities to stay "fresh" (since we'll be doing this in a SGD context and the parameters will be slowly changing). We use a constant 0 &lt;  &lt; 1 to control the updating rate. Our update for R_t is based on the power method. Define the smoothed scatter</p>
<p>T_t =(def)  S_t + (1-) F_t</p>
<p>we'll use this in place of the observed scatter S_t, to slow down the update. Defining</p>
<p>Y_t =(def) R_t T_t</p>
<p>which can be expanded as follows: Y_t = R_t (  S_t + (1-) F_t ) = R_t (  S_t + (1-) (R_t^T D_t R_t +  I) ) = R_t (  S_t + (1-) (R_t^T D_t R_t +  I) ) =  R_t S_t + (1-) (D_t +  I) R_t</p>
<p>It is useful to think of Y_t as having each of the top eigenvectors of the scatter scaled by the corresponding eigenvalue . We compute the following R by R matrix: Z_t =(def) Y_t Y_t^T and do the symmetric eigenvalue decomposition Z_t = U_t C_t U_t^T where C_t is diagonal and U_t orthogonal; the diagonal elements of C_t will be positive (since  &gt; 0, T_t is positive definite; since R_t has full row rank and T_t is positive definite, Y_t has full row rank; hence Z_t is positive definite). The diagonal elements of C_t can be thought of as corresponding to the squares of our current estimate of the top eigenvalues of the scatter matrix. [we should check that no element of C_t is &lt;= 0.]</p>
<p>It is easy to show that C_t^{-0.5} U_t^T Z_t U_t C_t^{-0.5} = I, so (C_t^{-0.5} U_t^T Y_t) (Y_t^T U_t C_t^{-0.5}) = I. Define R_{t+1} =(def) C_t^{-0.5} U_t^T Y_t</p>
<p>and it's clear that R_{t+1} R_{t+1}^T = I. We will set D_{t+1} =(def) C_t^{0.5} - {t+1} I (eqn:dt1)</p>
<p>which ensures that for each row r of R_{t+1}, the variance of our scatter matrix F_{t+1} will be the square root of the corresponding diagonal element of C_t. This makes sense because, as we have pointed out, the diagonal elements of C_t can be thought of as corresponding to squared eigenvalues. But a proper treatment of this would require convergence analysis that would get quite complicated. We will choose {t+1} in order to ensure that tr(F_{t+1}) = tr(T_t).</p>
<p>For any t, tr(F_t) = D  + tr(D_t) tr(T_t) =  tr(S_t) + (1-) tr(F_t) =  tr(S_t) + (1-) (D  + tr(D_t)) Expanding out D_{t+1} from (eqn:dt1) in the expression for tr(F_{t+1}) below: tr(F_{t+1}) = D {t+1} + tr(D_{t+1}) tr(F_{t+1}) = D {t+1} + tr(C_t^{0.5} - {t+1} I) = (D - R) {t+1} + tr(C_t^{0.5}) and equating tr(F_{t+1}) with T_t (since F_{t+1} is supposed to be a low-rank approximation to T_t), we have tr(F_{t+1}) = tr(T_t) (D - R) {t+1} + tr(C_t^{0.5}) =  tr(S_t) + (1-) (D  + tr(D_t))</p>
<p>Solving for {t+1}, {t+1} = 1/(D - R) ( tr(S_t) + (1-)(D  + tr(D_t)) - tr(C_t^{0.5})). (eqn:rhot1)</p>
<p>Note that it is technically possible that diagonal elements of of D_{t+1} may be negative, but we can still show that F_{t+1} is strictly positive definite if F_t was strictly positive definite.</p>
<p>If the quantities for which we are computing the Fisher matrix are all zero for some, reason, the sequence of F_t will geometrically approach zero, which would cause problems with inversion; to prevent this happening, after setting D_{t+1} and {t+1} as above, we floor {t+1} to a small value (like 1.0e-10).</p>
<p>OK, we have described the updating of R_t, D_t and . Next, we need to figure out how to efficiently multiply by the inverse of F_t. Our experience from working with the old preconditioning method was that it's best not to use the inverse of the Fisher matrix itself, but a version of the Fisher matrix that's smoothed with some constant times the identity. Below, ( is a configuration value, e.g. 4.0 seemed to work well). The following formula is designed to ensure that the smoothing varies proportionally with the scale of F_t:</p>
<p>G_t =(def) F_t + /D tr(F_t) I = R_t^T D_t R_t + ( + /D tr(F_t)) I = R_t^T D_t R_t +  I where  =(def)  + /D tr(F_t) = (1+) + /D tr(D_t) (eqn:betat2)</p>
<p>Define {X}_t =(def)  X_t G_t^{-1}. the factor of  is inserted arbitrarily as it just happens to be convenient to put unit scale on X_t in the formula for {X}_t; it will anyway be canceled out in the next step. Then our final preconditioned minibatch of vectors is: {X}_t =  {X}_t where  = sqrt(tr(X_t X_t^T) / tr({X}_t {X}_t^T). The factor of  ensures that {X}_t is scaled to have the same overall 2-norm as the input X_t. We found in previous versions of this method that this rescaling was helpful, as otherwise there are certain situations (e.g. at the start of training) where the preconditioned derivatives can get very large. Note that this rescaling introduces a small bias into the training, because now the scale applied to a given sample depends on that sample itself, albeit in an increasingly diluted way as the minibatch size gets large.</p>
<p>To efficiently compute G_t^{-1}, we will use the Woodbury matrix identity. Writing the Woodbury formula for the symmetric case, (A + U D U^T)^{-1} = A^{-1} - A^{-1} U (D^{-1} + U^T A^{-1} U)^{-1} U^T A^{-1} Substituting A =  I, D = D_t and U = R_t^T, this becomes G_t^{-1} = 1/ I - 1/^2 R_t^T (D_t^{-1} + 1/ I)^{-1} R_t = 1/ (I - R_t^T E_t R_t) where E_t =(def) 1/ (D_t^{-1} + 1/ I)^{-1}, (eqn:etdef) so e_{tii} = 1/ * 1/(1/d_{tii} + 1/) (eqn:tii) = 1/(/d_{tii} + 1)</p>
<p>We would like an efficient-to-compute expression for {X}_t, without too many separate invocations of kernels on the GPU. {X}_t =  X_t G_t^{-1} = X_t - X_t R_t^T E_t R_t For efficient operation on the GPU, we want to reduce the number of high-dimensional operations that we do (defining "high-dimension" as anything involving D or M, but not R, since R is likely small, such as 20). We define W_t =(def) E_t^{0.5} R_t. We will actually be storing W_t on the GPU rather than R_t, in order to reduce the number of operations on the GPU. We can now write:</p>
<p>{X}_t = X_t - X_t W_t^T W_t (eqn:pt2)</p>
<p>The following, which we'll compute on the GPU, are going to be useful in computing quantities like Z_t:</p>
<p>H_t =(def) X_t W_t^T (dim is N by R) J_t =(def) H_t^T X_t (dim is R by D) = W_t X_t^T X_t K_t =(def) J_t J_t^T (dim is R by R, symmetric).. transfer this to CPU. L_t =(def) H_t^T H_t (dim is R by R, symmetric).. transfer this to CPU. = W_t X_t^T X_t W_t^T Note: L_t may also be computed as L_t = J_t W_t^T which may be more efficient if D &lt; N.</p>
<p>Note: after we have computed H_t we can directly compute {X}_t = X_t - H_t W_t</p>
<p>We need to determine how Y_t and Z_t relate to the quantities we just defined. First, we'll expand out H_t, J_t, K_t and L_t in terms of the more fundamental quantities. H_t = X_t R_t^T E_t^{0.5} J_t = E_t^{0.5} R_t X_t^T X_t K_t = E_t^{0.5} R_t X_t^T X_t X_t^T X_t R_t^T E_t^{0.5} L_t = E_t^{0.5} R_t X_t^T X_t R_t^T E_t^{0.5}</p>
<p>we wrote above that Y_t =  R_t S_t + (1-) (D_t +  I) R_t so Y_t = /N R_t X_t^T X_t + (1-) (D_t +  I) R_t = /N E_t^{-0.5} J_t + (1-) (D_t +  I) R_t (eqn:yt) We will expand Z_t using the expression for Y_t in the line above: Z_t = Y_t Y_t^T = (/N)^2 E_t^{-0.5} J_t J_t^T E_t^{-0.5} +(/N)(1-) E_t^{-0.5} J_t R_t^T (D_t +  I) +(/N)(1-) (D_t +  I) R_t J_t^T E_t^{-0.5} +(1-)^2 (D_t +  I)^2 = (/N)^2 E_t^{-0.5} K_t E_t^{-0.5} +(/N)(1-) E_t^{-0.5} L_t E_t^{-0.5} (D_t +  I) +(/N)(1-) (D_t +  I) E_t^{-0.5} L_t E_t^{-0.5} +(1-)^2 (D_t +  I)^2 (eqn:Zt) We compute Z_t on the CPU using the expression above, and then do the symmetric eigenvalue decomposition (also on the CPU): Z_t = U_t C_t U_t^T. and we make sure the eigenvalues are sorted from largest to smallest, for reasons that will be mentioned later.</p>
<p>Mathematically, no diagonal element of C_t can be less than (1-)^2 ^2, and since negative or zero elements of C_t would cause us a problem later, we floor C_t to this value. (see below regarding how we ensure R_{t+1} has orthonormal rows).</p>
<p>We will continue the discussion below regarding what we do with C_t and U_t. Next, we need to digress briefly and describe how to compute tr({X}_t {X}_t^T) and tr(X_t X_t^2), since these appear in expressions for  (needed to produce the output {X}_t), and for {t+1}. It happens that we need, for purposes of appying "max_change" in the neural net code, the squared 2-norm of each row of the output {X}_t. In order to be able to compute , it's most convenient to compute this squared row-norm for each row of {X}_t, as a vector, to compute tr({X}_t {X}_t^2) from this vector as its sum, and to then work back to compute tr(X_t X_t^2) from the relation between {X}_t and X_t. We can then scale the row-norms we computed for {X}_t, so they apply to {X}_t.</p>
<p>For current purposes, you can imagine that we computed tr({X}_t {X}_t^T) directly. Using (from eqn:pt2) {X}_t = X_t - X_t W_t^T W_t, we can expand tr({X}_t {X}_t^T) as: tr({X}_t {X}_t^T) = tr(X_t X_t^T) + tr(X_t W_t^T W_t W_t^T W_t X_t^T)</p><ul>
<li>2 tr(X_t W_t^T W_t X_t^T) = tr(X_t X_t^T) + tr(W_t X_t^T X_t W_t^T W_t W_t^T)</li>
<li>2 tr(W_t X_t^T X_t W_t^T) = tr(X_t X_t^T) + tr(L_t W_t W_t^T) - 2 tr(L_t) = tr(X_t X_t^T) + tr(L_t E_t) - 2 tr(L_t) and all quantities have already been computed (or are quick to compute, such as the small traces on the right), except tr(X_t X_t^T), so we can write</li>
</ul>
<p>tr(X_t X_t^T) = tr({X}_t {X}_t^T) - tr(L_t E_t) + 2 tr(L_t) and the above expression can be used to obtain tr(X_t X_t^2). We can then do  &lt;&ndash; sqrt(tr(X_t X_t^T) / tr({X}_t {X}_t^T)). (or one if the denominator is zero), and then {X}_t &lt;&ndash;  {X}_t We can then output the per-row squared-l2-norms of Q by scaling those we computed from P by ^2.</p>
<p>OK, the digression on how to compute  and tr(X_t X_t^T) is over. We now return to the computation of R_{t+1}, W_{t+1}, {t+1}, D_{t+1} and E_{t+1}.</p>
<p>We found above in (eqn:rhot1) {t+1} = 1/(D - R) ( tr(S_t) + (1-)(D  + tr(D_t)) - tr(C_t^{0.5})). Expanding out S_t from its definition in (eqn:St), {t+1} = 1/(D - R) (/N tr(X_t X_t^T) + (1-)(D  + tr(D_t)) - tr(C_t^{0.5})). We can compute this directly as all the quantities involved are already known or easy to compute. Next, from (eqn:dt1), we compute D_{t+1} = C_t^{0.5} - {t+1} I At this point if {t+1} is smaller than some small value , e.g. 1.0e-10, we set it to ; as mentioned, we do this to stop F_t approaching zero if all inputs are zero. Next, if any diagonal element D_{t+1,i,i} has absolute value less than , we set it to +. This is to ensure that diagonal elements of E are never zero, which would cause problems.</p>
<p>Next, we compute (from eqn:betat2, eqn:etdef, eqn:tii), {t+1} = {t+1} (1+) + /D tr(D_{t+1}) E_{t+1} = 1/{t+1} (D_{t+1}^{-1} + 1/{t+1} I)^{-1}, i.e.: e_{tii} = 1/({t+1}/d_{t+1,ii} + 1)</p>
<p>We'll want to store D_{t+1}. We next want to compute W_{t+1}.</p>
<p>Before computing W_{t+1}, we need to find an expression for R_{t+1} = C_t^{-0.5} U_t^T Y_t Expanding out Y_t using the expression in (eqn:yt), R_{t+1} = C_t^{-0.5} U_t^T (/N E_t^{-0.5} J_t + (1-) (D_t +  I) R_t) = (/N C_t^{-0.5} U_t^T E_t^{-0.5}) J_t +((1-) C_t^{-0.5} U_t^T (D_t +  I) E_t^{-0.5}) W_t</p>
<p>What we actually want is W_{t+1} = E_{t+1}^{0.5} R_{t+1}: W_{t+1} = (/N E_{t+1}^{0.5} C_t^{-0.5} U_t^T E_t^{-0.5}) J_t +((1-) E_{t+1}^{0.5} C_t^{-0.5} U_t^T (D_t +  I) E_t^{-0.5}) W_t and to minimize the number of matrix-matrix multiplies we can factorize this as: W_{t+1} = A_t B_t A_t = (/N) E_{t+1}^{0.5} C_t^{-0.5} U_t^T E_t^{-0.5} B_t = J_t + (1-)/(/N) (D_t +  I) W_t [note: we use the fact that (D_t +  I) and E_t^{-0.5} commute because they are diagonal].</p>
<p>A_t is computed on the CPU and transferred from there to the GPU, B_t is computed on the PGU, and the multiplication of A_t with B_t is done on the GPU.</p>
<p>Keeping R_t orthogonal *</p>
<p>Our method requires the R_t matrices to be orthogonal (which we define to mean that R_t R_t^T = I). If roundoff error causes this equality to be significantly violated, it could cause a problem for the stability of our method. We now address our method for making sure that the R_t values stay orthogonal. We do this in the algorithm described above, after creating W_{t+1}. This extra step is only executed if the condition number of C_t (i.e. the ratio of its largest to smallest diagonal element) exceeds a specified threshold, such as 1.0e+06 [this is tested before applying the floor to C_t]. The threshold was determined empirically by finding the largest value needed to ensure a certain level of orthogonality in R_{t+1}. For purposes of the present discussion, since R_{t+1} is not actually stored, define it as E_{t+1}^{-0.5} W_{t+1}. Define the following (and we will just use t instead of t+1 below, as all quantities have the same subscript):</p>
<p>O_t =(def) R_t R_t^T = E_t^{-0.5} W_t W_t^T E_t^{-0.5}</p>
<p>(and we would compute this by computing W_t W_t^T on the GPU, transferring it to the CPU, and doing the rest there). If O_t is not sufficiently close to the unit matrix, we can re-orthogonalize as follows: Do the Cholesky decomposition O_t = C C^T Clearly C^{-1} O_t C^{-T} = I, so if we correct R_t with: R_t &lt;&ndash; C^{-1} R_t we can ensure orthogonality. If R_t's first k rows are orthogonal, this transform will not affect them, because of its lower-triangular structure... this is good because (thanks to the eigenvalue sorting), the larger eigenvectors are first and it is more critical to keep them pointing in the same direction. Any loss of orthogonality will be dealt with by modifying the smaller eigenvectors. As a modification to W_t, this would be: W_t &lt;&ndash; (E_t^{0.5} C^{-1} E_t^{-0.5}) W_t, and the matrix in parentheses is computed on the CPU, transferred to the GPU, and the multiplication is done there.</p>
<p>Initialization *</p>
<p>Now, a note on what we do on time t = 0, i.e. for the first minibatch. We initialize X_0 to the top R eigenvectors of 1/N X_0 X_0^T, where N is the minibatch size (num-rows of R0). If L is the corresponding RxR diagonal matrix of eigenvalues, then we will set D_0 = L -  I. We set  to ensure that tr(F_0) = 1/N tr(X_0 X_0^T), tr(D_0) -  D = 1/N tr(X_0 X_0^T), tr(L) +  R -  D = 1/N tr(X_0 X_0^T)  = (1/N tr(X_0 X_0^T) - tr(L)) / (D - R)</p>
<p>We then floor  to  (e.g. 1.0e-10) and also floor the diagonal elements of D_0 to ; this ensures that we won't crash for zero inputs.</p>
<p>A note on multi-threading. This technique was really designed for use with a GPU, where we won't have multi-threading, but we want it to work also on a CPU, where we may have multiple worker threads. Our approach is as follows (we do this when we're about to start updating the parameters R_t, D_t,  and derived quantities):</p>
<p>For time t &gt; 0 (where the matrices are already initialized), before starting the part of the computation that updates the parameters (R_t, D_t,  and derived quantities), we try to lock a mutex that guards the <a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html" title="Keywords for search: natural gradient, naturalgradient, NG-SGD. ">OnlinePreconditioner</a>. If we can lock it right away, we go ahead and do the update, but if not, we just abandon the attempt to update those quantities.</p>
<p>We will have another mutex to ensure that when we access quantities like W_t,  they are all "in sync" (and we don't access them while they are being written by another thread). This mutex will only be locked for short periods of time.</p>
<p>Note: it might be a good idea to make sure that the R_t still retain orthonormal rows even in the presence of roundoff, without errors accumulating. My instinct is that this isn't going to be a problem. </p>

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00413">413</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ae5a325f51ed0d376954386aecddc7bca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5a325f51ed0d376954386aecddc7bca">&#9670;&nbsp;</a></span>OnlinePreconditioner() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html">OnlinePreconditioner</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00027">27</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>.</p>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                                          :</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a>(40), <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">update_period_</a>(1), <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">num_samples_history_</a>(2000.0), <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a>(4.0),</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">epsilon_</a>(1.0e-10), <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">delta_</a>(5.0e-04), <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">t_</a>(-1),</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab3c6b16d7d97db660d96144a3239dc01">num_updates_skipped_</a>(0), <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">self_debug_</a>(<span class="keyword">false</span>) { }</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af679b81005104cca1fc03ef8ee3b36d0"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">kaldi::nnet2::OnlinePreconditioner::rank_</a></div><div class="ttdeci">int32 rank_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00516">nnet-precondition-online.h:516</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_abd17f633a8fc0939bc5bd0e83bd7153c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">kaldi::nnet2::OnlinePreconditioner::t_</a></div><div class="ttdeci">int32 t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00546">nnet-precondition-online.h:546</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_aa0ae63e5e17bafaf1ab9c9328517bb5b"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">kaldi::nnet2::OnlinePreconditioner::delta_</a></div><div class="ttdeci">BaseFloat delta_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00543">nnet-precondition-online.h:543</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af659a9e1c6ede20999b0996a58f97f34"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">kaldi::nnet2::OnlinePreconditioner::num_samples_history_</a></div><div class="ttdeci">BaseFloat num_samples_history_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00527">nnet-precondition-online.h:527</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ab35b32394fce8242b6fb4ae4ba4e54e1"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">kaldi::nnet2::OnlinePreconditioner::update_period_</a></div><div class="ttdeci">int32 update_period_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00521">nnet-precondition-online.h:521</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a008c4e6cc13410d1b983ad2b06fffeaf"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">kaldi::nnet2::OnlinePreconditioner::epsilon_</a></div><div class="ttdeci">BaseFloat epsilon_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00537">nnet-precondition-online.h:537</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a1bffda16ce504620d0ea2d1118cd0653"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">kaldi::nnet2::OnlinePreconditioner::self_debug_</a></div><div class="ttdeci">bool self_debug_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00555">nnet-precondition-online.h:555</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ab3c6b16d7d97db660d96144a3239dc01"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab3c6b16d7d97db660d96144a3239dc01">kaldi::nnet2::OnlinePreconditioner::num_updates_skipped_</a></div><div class="ttdeci">int32 num_updates_skipped_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00552">nnet-precondition-online.h:552</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a43efd606b8c638dd071888c30b741e91"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">kaldi::nnet2::OnlinePreconditioner::alpha_</a></div><div class="ttdeci">BaseFloat alpha_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00531">nnet-precondition-online.h:531</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ada10af0e24fbd9b9b6524207d33849c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada10af0e24fbd9b9b6524207d33849c2">&#9670;&nbsp;</a></span>OnlinePreconditioner() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html">OnlinePreconditioner</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html">OnlinePreconditioner</a> &amp;&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00595">595</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                                                                           :</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a>(other.rank_), <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">update_period_</a>(other.update_period_),</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">num_samples_history_</a>(other.num_samples_history_),</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a>(other.alpha_), <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">epsilon_</a>(other.epsilon_), <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">delta_</a>(other.delta_),</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">t_</a>(other.t_), <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab3c6b16d7d97db660d96144a3239dc01">num_updates_skipped_</a>(other.num_updates_skipped_),</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">self_debug_</a>(other.self_debug_), <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a>(other.W_t_),</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">rho_t_</a>(other.rho_t_), <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a>(other.d_t_) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="comment">// use default constructor for the mutexes.</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af679b81005104cca1fc03ef8ee3b36d0"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">kaldi::nnet2::OnlinePreconditioner::rank_</a></div><div class="ttdeci">int32 rank_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00516">nnet-precondition-online.h:516</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af12dc036070d7e3229a0232e214c226e"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">kaldi::nnet2::OnlinePreconditioner::d_t_</a></div><div class="ttdeci">Vector&lt; BaseFloat &gt; d_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00559">nnet-precondition-online.h:559</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_abd17f633a8fc0939bc5bd0e83bd7153c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">kaldi::nnet2::OnlinePreconditioner::t_</a></div><div class="ttdeci">int32 t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00546">nnet-precondition-online.h:546</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_aa0ae63e5e17bafaf1ab9c9328517bb5b"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">kaldi::nnet2::OnlinePreconditioner::delta_</a></div><div class="ttdeci">BaseFloat delta_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00543">nnet-precondition-online.h:543</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a5a1f65814903de3b91358880a8955c1c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">kaldi::nnet2::OnlinePreconditioner::W_t_</a></div><div class="ttdeci">CuMatrix&lt; BaseFloat &gt; W_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00557">nnet-precondition-online.h:557</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af659a9e1c6ede20999b0996a58f97f34"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">kaldi::nnet2::OnlinePreconditioner::num_samples_history_</a></div><div class="ttdeci">BaseFloat num_samples_history_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00527">nnet-precondition-online.h:527</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ab35b32394fce8242b6fb4ae4ba4e54e1"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">kaldi::nnet2::OnlinePreconditioner::update_period_</a></div><div class="ttdeci">int32 update_period_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00521">nnet-precondition-online.h:521</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a008c4e6cc13410d1b983ad2b06fffeaf"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">kaldi::nnet2::OnlinePreconditioner::epsilon_</a></div><div class="ttdeci">BaseFloat epsilon_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00537">nnet-precondition-online.h:537</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a9c611c2de39a87a3ad90640fd024b048"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">kaldi::nnet2::OnlinePreconditioner::rho_t_</a></div><div class="ttdeci">BaseFloat rho_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00558">nnet-precondition-online.h:558</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a1bffda16ce504620d0ea2d1118cd0653"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">kaldi::nnet2::OnlinePreconditioner::self_debug_</a></div><div class="ttdeci">bool self_debug_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00555">nnet-precondition-online.h:555</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ab3c6b16d7d97db660d96144a3239dc01"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab3c6b16d7d97db660d96144a3239dc01">kaldi::nnet2::OnlinePreconditioner::num_updates_skipped_</a></div><div class="ttdeci">int32 num_updates_skipped_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00552">nnet-precondition-online.h:552</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a43efd606b8c638dd071888c30b741e91"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">kaldi::nnet2::OnlinePreconditioner::alpha_</a></div><div class="ttdeci">BaseFloat alpha_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00531">nnet-precondition-online.h:531</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a2bdc60d5b8ab06b11d20695a71da1024"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2bdc60d5b8ab06b11d20695a71da1024">&#9670;&nbsp;</a></span>ComputeEt()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeEt </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>d_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>beta_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>e_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>sqrt_e_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>inv_sqrt_e_t</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00577">577</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8cc_source.html#l00457">VectorBase&lt; Real &gt;::ApplyPow()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00228">VectorBase&lt; Real &gt;::CopyFromVec()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00064">rnnlm::d</a>, <a class="el" href="kaldi-vector_8h_source.html#l00069">VectorBase&lt; Real &gt;::Data()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00781">VectorBase&lt; Real &gt;::InvertElements()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00501">OnlinePreconditioner::ComputeWt1()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00184">OnlinePreconditioner::ReorthogonalizeXt1()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00255">OnlinePreconditioner::SelfTest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                                                                                {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="comment">// e_{tii} = 1/(\beta_t/d_{tii} + 1)</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  int32 D = d_t.Dim();</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *<a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = d_t.Data();</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *e = e_t-&gt;Data();</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; D; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    e[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1.0 / (beta_t / d[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]  +  1);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  sqrt_e_t-&gt;CopyFromVec(*e_t);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  sqrt_e_t-&gt;ApplyPow(0.5);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  inv_sqrt_e_t-&gt;CopyFromVec(*sqrt_e_t);</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  inv_sqrt_e_t-&gt;InvertElements();</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacernnlm_html_a873684cefeb665f3d5e6b495de57fc0d"><div class="ttname"><a href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">rnnlm::d</a></div><div class="ttdeci">double d</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00064">mikolov-rnnlm-lib.cc:64</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa648b298424a1fc8789b6c7efa4d2c8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa648b298424a1fc8789b6c7efa4d2c8d">&#9670;&nbsp;</a></span>ComputeWt1()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeWt1 </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>d_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>d_t1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>rho_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>rho_t1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>U_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>sqrt_c_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>inv_sqrt_e_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>W_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>J_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>W_t1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00501">501</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrix_8cc_source.html#l01369">CuMatrixBase&lt; Real &gt;::AddDiagVecMat()</a>, <a class="el" href="cu-matrix_8cc_source.html#l01278">CuMatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00531">OnlinePreconditioner::alpha_</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00577">OnlinePreconditioner::ComputeEt()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00492">OnlinePreconditioner::Eta()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00781">VectorBase&lt; Real &gt;::InvertElements()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, and <a class="el" href="kaldi-vector_8cc_source.html#l00693">VectorBase&lt; Real &gt;::Sum()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>.</p>
<div class="fragment"><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                                                                            {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  int32 R = d_t.Dim(), D = W_t.NumCols();</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> eta = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ae9146ef05a20cd050436475ff208c6ae">Eta</a>(N);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="comment">// \beta_{t+1} = \rho_{t+1} (1+\alpha) + \alpha/D tr(D_{t+1})</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> beta_t1 = rho_t1 * (1.0 + <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a>) + <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a> * d_t1.Sum() / D;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(beta_t1 &gt; 0.0);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  Vector&lt;BaseFloat&gt; e_t1(R, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>), sqrt_e_t1(R, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>),</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      inv_sqrt_e_t1(R, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a2bdc60d5b8ab06b11d20695a71da1024">ComputeEt</a>(d_t1, beta_t1, &amp;e_t1, &amp;sqrt_e_t1, &amp;inv_sqrt_e_t1);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  Vector&lt;BaseFloat&gt; inv_sqrt_c_t(sqrt_c_t);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  inv_sqrt_c_t.InvertElements();</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  Vector&lt;BaseFloat&gt; w_t_coeff(R);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; R; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    w_t_coeff(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) = (1.0 - eta) / (eta/N) * (d_t(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) + rho_t);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  CuVector&lt;BaseFloat&gt; w_t_coeff_gpu(w_t_coeff);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="comment">// B_t = J_t + (1-\eta)/(\eta/N) (D_t + \rho_t I) W_t</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  J_t-&gt;AddDiagVecMat(1.0, w_t_coeff_gpu, W_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 1.0);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="comment">// A_t = (\eta/N) E_{t+1}^{0.5} C_t^{-0.5} U_t^T E_t^{-0.5} B_t</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  Matrix&lt;BaseFloat&gt; A_t(U_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; R; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> i_factor = (eta / N) * sqrt_e_t1(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) * inv_sqrt_c_t(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; R; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> j_factor = inv_sqrt_e_t(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      A_t(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) *= i_factor * j_factor;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    }</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  }</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="comment">// W_{t+1} = A_t B_t</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  CuMatrix&lt;BaseFloat&gt; A_t_gpu(A_t);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  W_t1-&gt;AddMatMat(1.0, A_t_gpu, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, *J_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a2bdc60d5b8ab06b11d20695a71da1024"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a2bdc60d5b8ab06b11d20695a71da1024">kaldi::nnet2::OnlinePreconditioner::ComputeEt</a></div><div class="ttdeci">void ComputeEt(const VectorBase&lt; BaseFloat &gt; &amp;d_t, BaseFloat beta_t, VectorBase&lt; BaseFloat &gt; *e_t, VectorBase&lt; BaseFloat &gt; *sqrt_e_t, VectorBase&lt; BaseFloat &gt; *inv_sqrt_e_t) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00577">nnet-precondition-online.cc:577</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ae9146ef05a20cd050436475ff208c6ae"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ae9146ef05a20cd050436475ff208c6ae">kaldi::nnet2::OnlinePreconditioner::Eta</a></div><div class="ttdeci">BaseFloat Eta(int32 N) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00492">nnet-precondition-online.cc:492</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a43efd606b8c638dd071888c30b741e91"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">kaldi::nnet2::OnlinePreconditioner::alpha_</a></div><div class="ttdeci">BaseFloat alpha_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00531">nnet-precondition-online.h:531</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9d2db282e47c56f778322ddf9631a0ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d2db282e47c56f778322ddf9631a0ee">&#9670;&nbsp;</a></span>ComputeZt()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ComputeZt </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>rho_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>d_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>inv_sqrt_e_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>K_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1MatrixBase.html">MatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>L_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1SpMatrix.html">SpMatrix</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>Z_t</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00546">546</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8cc_source.html#l00955">VectorBase&lt; Real &gt;::Add()</a>, <a class="el" href="kaldi-vector_8h_source.html#l00063">VectorBase&lt; Real &gt;::Dim()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00492">OnlinePreconditioner::Eta()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>.</p>
<div class="fragment"><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                                                                  {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="comment">// Use doubles because the range of quantities in Z_t can get large (fourth</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="comment">// power of data), and we want to avoid overflow.  This routine is fast.</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> eta = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ae9146ef05a20cd050436475ff208c6ae">Eta</a>(N);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  Vector&lt;BaseFloat&gt; d_t_rho_t(d_t);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  d_t_rho_t.Add(rho_t);  <span class="comment">// now d_t_rho_t is diag(D_t + \rho_t I).</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordtype">double</span> etaN = eta / N, eta1 = 1.0 - eta,</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      etaN_sq = etaN * etaN, eta1_sq = eta1 * eta1,</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      etaN_eta1 = etaN * eta1;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  int32 R = d_t.Dim();</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; R; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordtype">double</span> inv_sqrt_e_t_i = inv_sqrt_e_t(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>), d_t_rho_t_i = d_t_rho_t(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;= <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="keywordtype">double</span> inv_sqrt_e_t_j = inv_sqrt_e_t(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>), d_t_rho_t_j = d_t_rho_t(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>),</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;          L_t_i_j = 0.5 * (L_t(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) + L_t(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>)),</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;          K_t_i_j = 0.5 * (K_t(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) + K_t(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="comment">// See (eqn:Zt) in header.</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      (*Z_t)(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) = etaN_sq * inv_sqrt_e_t_i * K_t_i_j * inv_sqrt_e_t_j</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;          + etaN_eta1 * inv_sqrt_e_t_i * L_t_i_j * inv_sqrt_e_t_j * d_t_rho_t_j</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          + etaN_eta1 * d_t_rho_t_i * inv_sqrt_e_t_i * L_t_i_j * inv_sqrt_e_t_j</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          + (i == <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> ? eta1_sq * d_t_rho_t_i * d_t_rho_t_i : 0.0);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  }</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;}</div><div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ae9146ef05a20cd050436475ff208c6ae"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ae9146ef05a20cd050436475ff208c6ae">kaldi::nnet2::OnlinePreconditioner::Eta</a></div><div class="ttdeci">BaseFloat Eta(int32 N) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00492">nnet-precondition-online.cc:492</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae9146ef05a20cd050436475ff208c6ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9146ef05a20cd050436475ff208c6ae">&#9670;&nbsp;</a></span>Eta()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> Eta </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>N</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00492">492</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00527">OnlinePreconditioner::num_samples_history_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00501">OnlinePreconditioner::ComputeWt1()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00546">OnlinePreconditioner::ComputeZt()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>.</p>
<div class="fragment"><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                                                 {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">num_samples_history_</a> &gt; 0.0);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> ans = 1.0 - exp(-N / <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">num_samples_history_</a>);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="comment">// Don&#39;t let eta approach 1 too closely, as it can lead to NaN&#39;s appearing if</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="comment">// the input is all zero.</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">if</span> (ans &gt; 0.9) ans = 0.9;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keywordflow">return</span> ans;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af659a9e1c6ede20999b0996a58f97f34"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">kaldi::nnet2::OnlinePreconditioner::num_samples_history_</a></div><div class="ttdeci">BaseFloat num_samples_history_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00527">nnet-precondition-online.h:527</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aecff47257feb076ddd824437cd4bb760"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aecff47257feb076ddd824437cd4bb760">&#9670;&nbsp;</a></span>GetAlpha()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> GetAlpha </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00424">424</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">References <a class="el" href="nnet-precondition-online_8h_source.html#l00531">OnlinePreconditioner::alpha_</a>.</p>
<div class="fragment"><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a>; }</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a43efd606b8c638dd071888c30b741e91"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">kaldi::nnet2::OnlinePreconditioner::alpha_</a></div><div class="ttdeci">BaseFloat alpha_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00531">nnet-precondition-online.h:531</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acf6a1777407d36e2173dd1de0e60b322"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf6a1777407d36e2173dd1de0e60b322">&#9670;&nbsp;</a></span>GetNumSamplesHistory()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> GetNumSamplesHistory </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00423">423</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">References <a class="el" href="nnet-precondition-online_8h_source.html#l00527">OnlinePreconditioner::num_samples_history_</a>.</p>
<div class="fragment"><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">num_samples_history_</a>; }</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af659a9e1c6ede20999b0996a58f97f34"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">kaldi::nnet2::OnlinePreconditioner::num_samples_history_</a></div><div class="ttdeci">BaseFloat num_samples_history_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00527">nnet-precondition-online.h:527</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1fd2929c7565d8aeebac17374c7ae45d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fd2929c7565d8aeebac17374c7ae45d">&#9670;&nbsp;</a></span>GetRank()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 GetRank </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00425">425</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">References <a class="el" href="nnet-precondition-online_8h_source.html#l00516">OnlinePreconditioner::rank_</a>.</p>
<div class="fragment"><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a>; }</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af679b81005104cca1fc03ef8ee3b36d0"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">kaldi::nnet2::OnlinePreconditioner::rank_</a></div><div class="ttdeci">int32 rank_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00516">nnet-precondition-online.h:516</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a58d61a9b39bd466823c1d1710615dd90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58d61a9b39bd466823c1d1710615dd90">&#9670;&nbsp;</a></span>GetUpdatePeriod()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 GetUpdatePeriod </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00426">426</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">References <a class="el" href="nnet-precondition-online_8cc_source.html#l00577">OnlinePreconditioner::ComputeEt()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00501">OnlinePreconditioner::ComputeWt1()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00546">OnlinePreconditioner::ComputeZt()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00492">OnlinePreconditioner::Eta()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00123">OnlinePreconditioner::Init()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">OnlinePreconditioner::InitDefault()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00045">OnlinePreconditioner::InitOrthonormalSpecial()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00027">OnlinePreconditioner::OnlinePreconditioner()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">OnlinePreconditioner::operator=()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00145">OnlinePreconditioner::PreconditionDirections()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00184">OnlinePreconditioner::ReorthogonalizeXt1()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00255">OnlinePreconditioner::SelfTest()</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00521">OnlinePreconditioner::update_period_</a>.</p>
<div class="fragment"><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">update_period_</a>; }</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ab35b32394fce8242b6fb4ae4ba4e54e1"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">kaldi::nnet2::OnlinePreconditioner::update_period_</a></div><div class="ttdeci">int32 update_period_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00521">nnet-precondition-online.h:521</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af101bbf82527b43a60a43a287270fd0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af101bbf82527b43a60a43a287270fd0f">&#9670;&nbsp;</a></span>Init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Init </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>R0</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00123">123</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-precondition-online_8h_source.html#l00559">OnlinePreconditioner::d_t_</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">OnlinePreconditioner::InitDefault()</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00145">OnlinePreconditioner::PreconditionDirections()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00516">OnlinePreconditioner::rank_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00558">OnlinePreconditioner::rho_t_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00546">OnlinePreconditioner::t_</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00557">OnlinePreconditioner::W_t_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00145">OnlinePreconditioner::PreconditionDirections()</a>.</p>
<div class="fragment"><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                                                 {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  int32 D = R0.NumCols();</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">// for locking reasons it&#39;s better to use a different object.</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ae5a325f51ed0d376954386aecddc7bca">OnlinePreconditioner</a> this_copy(*<span class="keyword">this</span>);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  this_copy.InitDefault(D);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  CuMatrix&lt;BaseFloat&gt; R0_copy(R0.NumRows(), R0.NumCols(), <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">// number of iterations with the same data from a pseudorandom start.</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">// this is a faster way of starting than doing eigenvalue decomposition.</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  int32 num_init_iters = 3;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_init_iters; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scale;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    R0_copy.CopyFromMat(R0);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    this_copy.PreconditionDirections(&amp;R0_copy, NULL, &amp;scale);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a> = this_copy.rank_;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a>.Swap(&amp;this_copy.W_t_);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a>.Swap(&amp;this_copy.d_t_);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">rho_t_</a> = this_copy.rho_t_;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">t_</a> = 0;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ae5a325f51ed0d376954386aecddc7bca"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ae5a325f51ed0d376954386aecddc7bca">kaldi::nnet2::OnlinePreconditioner::OnlinePreconditioner</a></div><div class="ttdeci">OnlinePreconditioner()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00027">nnet-precondition-online.cc:27</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af679b81005104cca1fc03ef8ee3b36d0"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">kaldi::nnet2::OnlinePreconditioner::rank_</a></div><div class="ttdeci">int32 rank_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00516">nnet-precondition-online.h:516</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af12dc036070d7e3229a0232e214c226e"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">kaldi::nnet2::OnlinePreconditioner::d_t_</a></div><div class="ttdeci">Vector&lt; BaseFloat &gt; d_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00559">nnet-precondition-online.h:559</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_abd17f633a8fc0939bc5bd0e83bd7153c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">kaldi::nnet2::OnlinePreconditioner::t_</a></div><div class="ttdeci">int32 t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00546">nnet-precondition-online.h:546</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a5a1f65814903de3b91358880a8955c1c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">kaldi::nnet2::OnlinePreconditioner::W_t_</a></div><div class="ttdeci">CuMatrix&lt; BaseFloat &gt; W_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00557">nnet-precondition-online.h:557</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a9c611c2de39a87a3ad90640fd024b048"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">kaldi::nnet2::OnlinePreconditioner::rho_t_</a></div><div class="ttdeci">BaseFloat rho_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00558">nnet-precondition-online.h:558</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8dcc86ffa0412cb5f8dcb8d6c98eca5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8dcc86ffa0412cb5f8dcb8d6c98eca5a">&#9670;&nbsp;</a></span>InitDefault()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void InitDefault </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>D</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">75</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-precondition-online_8h_source.html#l00531">OnlinePreconditioner::alpha_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00559">OnlinePreconditioner::d_t_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00543">OnlinePreconditioner::delta_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00537">OnlinePreconditioner::epsilon_</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00045">OnlinePreconditioner::InitOrthonormalSpecial()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00527">OnlinePreconditioner::num_samples_history_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00516">OnlinePreconditioner::rank_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00558">OnlinePreconditioner::rho_t_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00546">OnlinePreconditioner::t_</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00557">OnlinePreconditioner::W_t_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00123">OnlinePreconditioner::Init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                                              {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a> &gt;= D) {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Rank &quot;</span> &lt;&lt; <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a> &lt;&lt; <span class="stringliteral">&quot; of online preconditioner is &gt;= dim &quot;</span> &lt;&lt; D</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;, setting it to &quot;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;               &lt;&lt; (D - 1) &lt;&lt; <span class="stringliteral">&quot; (but this is probably still too high)&quot;</span>;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a> = D - 1;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  }</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a> == 0) {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// Dimension of input data was 1, so the natural gradient preconditioner</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// would always be the unit matrix.</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// We&#39;ll handle this as a special case, for generality.</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">num_samples_history_</a> &gt; 0.0 &amp;&amp; <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">num_samples_history_</a> &lt;= 1.0e+6);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a> &gt;= 0.0);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a> &gt; 0);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">epsilon_</a> &gt; 0.0 &amp;&amp; <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">epsilon_</a> &lt;= 1.0e-05);  <span class="comment">// plausible values.</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">delta_</a> &gt; 0.0 &amp;&amp; <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">delta_</a> &lt;= 1.0e-02);  <span class="comment">// plausible values.</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">// to initialize, in the equation</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">//   F_t =(def) R_t^T D_t R_t + \rho_t I</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">// we will set the orthogonal R_t to a special orthogonal matrix with no zero</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// rows or columns (see the function), rho_t to epsilon,</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">// and D_t to epsilon.  But we don&#39;t store R_t directly.  Instead, we store</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="comment">//   W_t =(def)  E_t^{0.5} R_t,</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">// where E_t =(def)  1/\beta_t (D_t^{-1} + 1/\beta_t I)^{-1}</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">// from (eqn:tii),</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">//  e_{tii} =   1/(\beta_t/d_{tii} + 1),</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// where</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// \beta_t =(def) \rho_t + \alpha/D tr(F_t)</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">//         =      epsilon + alpha/D * (epsilon * D + epsilon * rank)</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="comment">//         =     epsilon * (1 + alpha * (D + rank) / D)</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="comment">// And  d_{tii} is epsilon, so</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">//  e_{tii} =   1/((1 + alpha * (D + rank) / D) + 1)  [for each i.]</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">//          =   1/(2 + alpha * (D + rank) / D)).</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> epsilon = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">epsilon_</a>;  <span class="comment">// we could make this a bit more.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">rho_t_</a> = epsilon;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a>.Resize(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a>, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a>.Set(epsilon);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a>.Resize(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a>, D, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="comment">// after the next line, W_ will store the orthogonal matrix R_t.</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a898dc92e6358fb2aa0306c4ce31b3a7b">InitOrthonormalSpecial</a>(&amp;<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a>);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> E_tii = 1.0 / ( 2.0 + (D + <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a>) * <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a> / D );</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">// W_t =(def) E_t^{0.5} R_t.</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a>.Scale(sqrt(E_tii));</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">t_</a> = 0;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af679b81005104cca1fc03ef8ee3b36d0"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">kaldi::nnet2::OnlinePreconditioner::rank_</a></div><div class="ttdeci">int32 rank_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00516">nnet-precondition-online.h:516</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af12dc036070d7e3229a0232e214c226e"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">kaldi::nnet2::OnlinePreconditioner::d_t_</a></div><div class="ttdeci">Vector&lt; BaseFloat &gt; d_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00559">nnet-precondition-online.h:559</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_abd17f633a8fc0939bc5bd0e83bd7153c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">kaldi::nnet2::OnlinePreconditioner::t_</a></div><div class="ttdeci">int32 t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00546">nnet-precondition-online.h:546</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a898dc92e6358fb2aa0306c4ce31b3a7b"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a898dc92e6358fb2aa0306c4ce31b3a7b">kaldi::nnet2::OnlinePreconditioner::InitOrthonormalSpecial</a></div><div class="ttdeci">static void InitOrthonormalSpecial(CuMatrixBase&lt; BaseFloat &gt; *R)</div><div class="ttdoc">This function creates a matrix with orthonormal rows that is like the following matrix, except with each row normalized to have unit 2-norm: [ 1.1 0 1 0 1 0 0 1.1 0 1 0 1 ] The reason why the first element in each row is 1.1 and not 1, is for symmetry-breaking... </div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00045">nnet-precondition-online.cc:45</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_aa0ae63e5e17bafaf1ab9c9328517bb5b"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">kaldi::nnet2::OnlinePreconditioner::delta_</a></div><div class="ttdeci">BaseFloat delta_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00543">nnet-precondition-online.h:543</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a5a1f65814903de3b91358880a8955c1c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">kaldi::nnet2::OnlinePreconditioner::W_t_</a></div><div class="ttdeci">CuMatrix&lt; BaseFloat &gt; W_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00557">nnet-precondition-online.h:557</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af659a9e1c6ede20999b0996a58f97f34"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">kaldi::nnet2::OnlinePreconditioner::num_samples_history_</a></div><div class="ttdeci">BaseFloat num_samples_history_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00527">nnet-precondition-online.h:527</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a008c4e6cc13410d1b983ad2b06fffeaf"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">kaldi::nnet2::OnlinePreconditioner::epsilon_</a></div><div class="ttdeci">BaseFloat epsilon_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00537">nnet-precondition-online.h:537</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a9c611c2de39a87a3ad90640fd024b048"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">kaldi::nnet2::OnlinePreconditioner::rho_t_</a></div><div class="ttdeci">BaseFloat rho_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00558">nnet-precondition-online.h:558</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a43efd606b8c638dd071888c30b741e91"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">kaldi::nnet2::OnlinePreconditioner::alpha_</a></div><div class="ttdeci">BaseFloat alpha_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00531">nnet-precondition-online.h:531</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a898dc92e6358fb2aa0306c4ce31b3a7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a898dc92e6358fb2aa0306c4ce31b3a7b">&#9670;&nbsp;</a></span>InitOrthonormalSpecial()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void InitOrthonormalSpecial </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>R</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function creates a matrix with orthonormal rows that is like the following matrix, except with each row normalized to have unit 2-norm: [ 1.1 0 1 0 1 0 0 1.1 0 1 0 1 ] The reason why the first element in each row is 1.1 and not 1, is for symmetry-breaking... </p>
<p>we don't want any weighted sum of all these rows to be all ones, because the derivative in that direction can be zero in some architectures and it causes us to have to do an inefficient CPU-based renormalization. </p>

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00045">45</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrix_8cc_source.html#l03244">CuMatrixBase&lt; Real &gt;::AddElements()</a>, <a class="el" href="cu-matrix_8cc_source.html#l01278">CuMatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="cu-matrix_8cc_source.html#l00595">CuMatrixBase&lt; Real &gt;::IsUnit()</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, and <a class="el" href="cu-matrix_8cc_source.html#l00476">CuMatrixBase&lt; Real &gt;::SetZero()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">OnlinePreconditioner::InitDefault()</a>.</p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                                                                            {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  int32 num_rows = R-&gt;NumRows(), num_cols = R-&gt;NumCols();</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_cols &gt;= num_rows);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  R-&gt;SetZero();</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  std::vector&lt;MatrixElement&lt;BaseFloat&gt; &gt; elems;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  elems.reserve(num_cols);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> first_elem = 1.1;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keywordflow">for</span> (int32 r = 0; r &lt; num_rows; r++) {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    std::vector&lt;int32&gt; cols;  <span class="comment">// columns that have an entry for this row</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">for</span> (int32 c = r; c &lt; num_cols; c += num_rows)</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      cols.push_back(c);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> normalizer = 1.0 / sqrt(first_elem * first_elem +</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                                      cols.size() - 1);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; cols.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      int32 c = cols[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <a class="code" href="structMatrixElement.html">MatrixElement&lt;BaseFloat&gt;</a> e = { r, c,</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                                     normalizer * (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0 ? first_elem :</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                                                   <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>(1.0)) };</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      elems.push_back(e);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  }</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  R-&gt;AddElements(1.0, elems);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  { <span class="comment">// TODO: remove this testing code.</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    CuMatrix&lt;BaseFloat&gt; prod(num_rows, num_rows);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    prod.AddMatMat(1.0, *R, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, *R, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(prod.IsUnit());</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div><div class="ttc" id="structMatrixElement_html"><div class="ttname"><a href="structMatrixElement.html">MatrixElement</a></div><div class="ttdef"><b>Definition:</b> <a href="cu-matrixdim_8h_source.html#l00041">cu-matrixdim.h:41</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a64f8f91edb72016058b1f1f34d8e13be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64f8f91edb72016058b1f1f34d8e13be">&#9670;&nbsp;</a></span>operator=()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html">OnlinePreconditioner</a> &amp; operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html">OnlinePreconditioner</a> &amp;&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">605</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-precondition-online_8h_source.html#l00531">OnlinePreconditioner::alpha_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00559">OnlinePreconditioner::d_t_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00543">OnlinePreconditioner::delta_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00537">OnlinePreconditioner::epsilon_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00527">OnlinePreconditioner::num_samples_history_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00516">OnlinePreconditioner::rank_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00558">OnlinePreconditioner::rho_t_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00555">OnlinePreconditioner::self_debug_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00546">OnlinePreconditioner::t_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00521">OnlinePreconditioner::update_period_</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00557">OnlinePreconditioner::W_t_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>.</p>
<div class="fragment"><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                                       {</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a> = other.rank_;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">update_period_</a> = other.update_period_;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">num_samples_history_</a> = other.num_samples_history_;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a> = other.alpha_;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">epsilon_</a> = other.epsilon_;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">delta_</a> = other.delta_;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">t_</a> = other.t_;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">self_debug_</a> = other.self_debug_;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a> = other.W_t_;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">rho_t_</a> = other.rho_t_;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a> = other.d_t_;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af679b81005104cca1fc03ef8ee3b36d0"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">kaldi::nnet2::OnlinePreconditioner::rank_</a></div><div class="ttdeci">int32 rank_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00516">nnet-precondition-online.h:516</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af12dc036070d7e3229a0232e214c226e"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">kaldi::nnet2::OnlinePreconditioner::d_t_</a></div><div class="ttdeci">Vector&lt; BaseFloat &gt; d_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00559">nnet-precondition-online.h:559</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_abd17f633a8fc0939bc5bd0e83bd7153c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">kaldi::nnet2::OnlinePreconditioner::t_</a></div><div class="ttdeci">int32 t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00546">nnet-precondition-online.h:546</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_aa0ae63e5e17bafaf1ab9c9328517bb5b"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">kaldi::nnet2::OnlinePreconditioner::delta_</a></div><div class="ttdeci">BaseFloat delta_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00543">nnet-precondition-online.h:543</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a5a1f65814903de3b91358880a8955c1c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">kaldi::nnet2::OnlinePreconditioner::W_t_</a></div><div class="ttdeci">CuMatrix&lt; BaseFloat &gt; W_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00557">nnet-precondition-online.h:557</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af659a9e1c6ede20999b0996a58f97f34"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">kaldi::nnet2::OnlinePreconditioner::num_samples_history_</a></div><div class="ttdeci">BaseFloat num_samples_history_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00527">nnet-precondition-online.h:527</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ab35b32394fce8242b6fb4ae4ba4e54e1"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">kaldi::nnet2::OnlinePreconditioner::update_period_</a></div><div class="ttdeci">int32 update_period_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00521">nnet-precondition-online.h:521</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a008c4e6cc13410d1b983ad2b06fffeaf"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">kaldi::nnet2::OnlinePreconditioner::epsilon_</a></div><div class="ttdeci">BaseFloat epsilon_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00537">nnet-precondition-online.h:537</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a9c611c2de39a87a3ad90640fd024b048"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">kaldi::nnet2::OnlinePreconditioner::rho_t_</a></div><div class="ttdeci">BaseFloat rho_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00558">nnet-precondition-online.h:558</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a1bffda16ce504620d0ea2d1118cd0653"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">kaldi::nnet2::OnlinePreconditioner::self_debug_</a></div><div class="ttdeci">bool self_debug_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00555">nnet-precondition-online.h:555</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a43efd606b8c638dd071888c30b741e91"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">kaldi::nnet2::OnlinePreconditioner::alpha_</a></div><div class="ttdeci">BaseFloat alpha_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00531">nnet-precondition-online.h:531</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a40de84aa34756dd2c783f5f8a131670a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40de84aa34756dd2c783f5f8a131670a">&#9670;&nbsp;</a></span>PreconditionDirections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PreconditionDirections </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>row_prod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *&#160;</td>
          <td class="paramname"><em>scale</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00145">145</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-vector_8cc_source.html#l00567">CuVectorBase&lt; Real &gt;::AddDiagMat2()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00559">OnlinePreconditioner::d_t_</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00123">OnlinePreconditioner::Init()</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, <a class="el" href="cu-matrix_8h_source.html#l00596">CuMatrixBase&lt; Real &gt;::Range()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00563">OnlinePreconditioner::read_write_mutex_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00558">OnlinePreconditioner::rho_t_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00546">OnlinePreconditioner::t_</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00557">OnlinePreconditioner::W_t_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00123">OnlinePreconditioner::Init()</a>, <a class="el" href="nnet-precondition-online-test_8cc_source.html#l00262">kaldi::nnet2::UnitTestPreconditionDirectionsOnline()</a>, and <a class="el" href="_2nnet-component_8cc_source.html#l01869">AffineComponentPreconditionedOnline::Update()</a>.</p>
<div class="fragment"><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                      {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordflow">if</span> (X_t-&gt;NumCols() == 1) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// If the dimension of the space equals one then our natural gradient update</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// with rescaling becomes a no-op, but the code wouldn&#39;t naturally handle it</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// because rank would be zero.  Support this as a special case.</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (row_prod)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      row_prod-&gt;AddDiagMat2(1.0, *X_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    *scale = 1.0;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordflow">if</span> (row_prod == NULL) {</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    CuVector&lt;BaseFloat&gt; row_prod_tmp(X_t-&gt;NumRows());</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a40de84aa34756dd2c783f5f8a131670a">PreconditionDirections</a>(X_t, &amp;row_prod_tmp, scale);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a12a31e639df35867380f95cc14b9f139">read_write_mutex_</a>.lock();</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">t_</a> == -1) <span class="comment">// not initialized</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af101bbf82527b43a60a43a287270fd0f">Init</a>(*X_t);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">// Now t_ &gt;= 0.</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="comment">// We create local copies  of the class variables... this is intended for</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="comment">// multi-threaded safety so we can&#39;t read them in an inconsistent state,</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="comment">// but we don&#39;t really waste anything here (a copy of W_t is needed anyway,</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="comment">// if we&#39;re to update it).</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  int32 t = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">t_</a>, R = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a>.NumRows(), D = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a>.NumCols();</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="comment">// space for W_t, J_t, K_t, L_t.</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  CuMatrix&lt;BaseFloat&gt; WJKL_t(2 * R, D + R);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  WJKL_t.Range(0, R, 0, D).CopyFromMat(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> rho_t(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">rho_t_</a>);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  Vector&lt;BaseFloat&gt; d_t(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a>);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a12a31e639df35867380f95cc14b9f139">read_write_mutex_</a>.unlock();</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a0ecfb5492a4bb8115f1b875c13ae40c9">PreconditionDirectionsInternal</a>(t, rho_t, d_t, &amp;WJKL_t, X_t, row_prod, scale);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a12a31e639df35867380f95cc14b9f139"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a12a31e639df35867380f95cc14b9f139">kaldi::nnet2::OnlinePreconditioner::read_write_mutex_</a></div><div class="ttdeci">std::mutex read_write_mutex_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00563">nnet-precondition-online.h:563</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af12dc036070d7e3229a0232e214c226e"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">kaldi::nnet2::OnlinePreconditioner::d_t_</a></div><div class="ttdeci">Vector&lt; BaseFloat &gt; d_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00559">nnet-precondition-online.h:559</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_abd17f633a8fc0939bc5bd0e83bd7153c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">kaldi::nnet2::OnlinePreconditioner::t_</a></div><div class="ttdeci">int32 t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00546">nnet-precondition-online.h:546</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a5a1f65814903de3b91358880a8955c1c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">kaldi::nnet2::OnlinePreconditioner::W_t_</a></div><div class="ttdeci">CuMatrix&lt; BaseFloat &gt; W_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00557">nnet-precondition-online.h:557</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a40de84aa34756dd2c783f5f8a131670a"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a40de84aa34756dd2c783f5f8a131670a">kaldi::nnet2::OnlinePreconditioner::PreconditionDirections</a></div><div class="ttdeci">void PreconditionDirections(CuMatrixBase&lt; BaseFloat &gt; *R, CuVectorBase&lt; BaseFloat &gt; *row_prod, BaseFloat *scale)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00145">nnet-precondition-online.cc:145</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a9c611c2de39a87a3ad90640fd024b048"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">kaldi::nnet2::OnlinePreconditioner::rho_t_</a></div><div class="ttdeci">BaseFloat rho_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00558">nnet-precondition-online.h:558</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af101bbf82527b43a60a43a287270fd0f"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af101bbf82527b43a60a43a287270fd0f">kaldi::nnet2::OnlinePreconditioner::Init</a></div><div class="ttdeci">void Init(const CuMatrixBase&lt; BaseFloat &gt; &amp;R0)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00123">nnet-precondition-online.cc:123</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a0ecfb5492a4bb8115f1b875c13ae40c9"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a0ecfb5492a4bb8115f1b875c13ae40c9">kaldi::nnet2::OnlinePreconditioner::PreconditionDirectionsInternal</a></div><div class="ttdeci">void PreconditionDirectionsInternal(const int32 t, const BaseFloat rho_t, const Vector&lt; BaseFloat &gt; &amp;d_t, CuMatrixBase&lt; BaseFloat &gt; *WJKL_t, CuMatrixBase&lt; BaseFloat &gt; *X_t, CuVectorBase&lt; BaseFloat &gt; *row_prod, BaseFloat *scale)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00300">nnet-precondition-online.cc:300</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0ecfb5492a4bb8115f1b875c13ae40c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ecfb5492a4bb8115f1b875c13ae40c9">&#9670;&nbsp;</a></span>PreconditionDirectionsInternal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PreconditionDirectionsInternal </td>
          <td>(</td>
          <td class="paramtype">const int32&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>rho_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>d_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>WJKL_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>X_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuVectorBase.html">CuVectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>row_prod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> *&#160;</td>
          <td class="paramname"><em>scale</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">300</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-vector_8cc_source.html#l00955">VectorBase&lt; Real &gt;::Add()</a>, <a class="el" href="cu-vector_8cc_source.html#l00567">CuVectorBase&lt; Real &gt;::AddDiagMat2()</a>, <a class="el" href="cu-matrix_8cc_source.html#l01278">CuMatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00531">OnlinePreconditioner::alpha_</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00817">VectorBase&lt; Real &gt;::ApplyFloor()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00457">VectorBase&lt; Real &gt;::ApplyPow()</a>, <a class="el" href="kaldi-math_8h_source.html#l00264">kaldi::ApproxEqual()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00577">OnlinePreconditioner::ComputeEt()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00501">OnlinePreconditioner::ComputeWt1()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00546">OnlinePreconditioner::ComputeZt()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00211">MatrixBase&lt; Real &gt;::CopyLowerToUpper()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00559">OnlinePreconditioner::d_t_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00543">OnlinePreconditioner::delta_</a>, <a class="el" href="qr_8cc_source.html#l00433">SpMatrix&lt; Real &gt;::Eig()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00537">OnlinePreconditioner::epsilon_</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00492">OnlinePreconditioner::Eta()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00135">KALDI_VLOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00033">kaldi::kTrans</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00579">VectorBase&lt; Real &gt;::Max()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00552">OnlinePreconditioner::num_updates_skipped_</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00516">OnlinePreconditioner::rank_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00563">OnlinePreconditioner::read_write_mutex_</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00184">OnlinePreconditioner::ReorthogonalizeXt1()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00558">OnlinePreconditioner::rho_t_</a>, <a class="el" href="packed-matrix_8cc_source.html#l00033">PackedMatrix&lt; Real &gt;::Scale()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00962">VectorBase&lt; Real &gt;::Scale()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00555">OnlinePreconditioner::self_debug_</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00255">OnlinePreconditioner::SelfTest()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02534">kaldi::SortSvd()</a>, <a class="el" href="cu-vector_8cc_source.html#l00291">CuVectorBase&lt; Real &gt;::Sum()</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00693">VectorBase&lt; Real &gt;::Sum()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00546">OnlinePreconditioner::t_</a>, <a class="el" href="sp-matrix_8cc_source.html#l00171">SpMatrix&lt; Real &gt;::Trace()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l02646">kaldi::TraceMatMat()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00567">OnlinePreconditioner::update_mutex_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00521">OnlinePreconditioner::update_period_</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00557">OnlinePreconditioner::W_t_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00145">OnlinePreconditioner::PreconditionDirections()</a>.</p>
<div class="fragment"><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                      {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  int32 N = X_t-&gt;NumRows(),  <span class="comment">// Minibatch size.</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      D = X_t-&gt;NumCols(),  <span class="comment">// Dimensions of vectors we&#39;re preconditioning</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      R = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a>;  <span class="comment">// Rank of correction to unit matrix.</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(R &gt; 0 &amp;&amp; R &lt; D);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> eta = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ae9146ef05a20cd050436475ff208c6ae">Eta</a>(N);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  CuMatrix&lt;BaseFloat&gt; H_t(N, R);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keyword">const</span> CuSubMatrix&lt;BaseFloat&gt; W_t(*WJKL_t, 0, R, 0, D);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="comment">// Below, WJ_t and LK_t are combinations of two matrices,</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="comment">// which we define in order to combine two separate multiplications into one.</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  CuSubMatrix&lt;BaseFloat&gt; J_t(*WJKL_t, R, R, 0, D),</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      L_t(*WJKL_t, 0, R, D, R),</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      K_t(*WJKL_t, R, R, D, R),</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      WJ_t(*WJKL_t, 0, 2 * R, 0, D),</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      LK_t(*WJKL_t, 0, 2 * R, D, R);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  H_t.AddMatMat(1.0, *X_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, W_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);  <span class="comment">// H_t = X_t W_t^T</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordtype">bool</span> locked = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a642038c403825903d5c2de21ccdb334b">update_mutex_</a>.try_lock();</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">if</span> (locked) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">// Just hard-code it here that we do 10 updates before skipping any.</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> num_initial_updates = 10;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">t_</a> &gt; t || (<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab3c6b16d7d97db660d96144a3239dc01">num_updates_skipped_</a> &lt; <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">update_period_</a> - 1 &amp;&amp;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                   <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">t_</a> &gt;= num_initial_updates)) {</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a642038c403825903d5c2de21ccdb334b">update_mutex_</a>.unlock();</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="comment">// We got the lock but we were already beaten to it by another thread, or</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="comment">// we don&#39;t want to update yet due to update_period_ &gt; 1 (this saves</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="comment">// compute), so release the lock.</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      locked = <span class="keyword">false</span>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  }</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">if</span> (!locked) {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">// We&#39;re not updating the parameters, either because another thread is</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="comment">// working on updating them, or because another thread already did so from</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// the same or later starting point (making our update stale), or because</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">// update_period_ &gt; 1.  We just apply the preconditioning and return.</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// note: we don&#39;t bother with any locks before incrementing</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">// num_updates_skipped_ below, because the worst that could happen is that,</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">// on very rare occasions, we could skip one or two more updates than we</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">// intended.</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab3c6b16d7d97db660d96144a3239dc01">num_updates_skipped_</a>++;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> tr_Xt_XtT = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(*X_t, *X_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">// X_hat_t = X_t - H_t W_t</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    X_t-&gt;AddMatMat(-1.0, H_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, W_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 1.0);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">// each element i of row_prod will be inner product of row i of X_hat_t with</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">// itself.</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    row_prod-&gt;AddDiagMat2(1.0, *X_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> tr_Xhat_XhatT = row_prod-&gt;Sum();</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(tr_Xhat_XhatT == tr_Xhat_XhatT);  <span class="comment">// Check for NaN.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> gamma_t = (tr_Xhat_XhatT == 0.0 ? 1.0 :</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                         sqrt(tr_Xt_XtT / tr_Xhat_XhatT));</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    *scale = gamma_t;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  }</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  J_t.AddMatMat(1.0, H_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, *X_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);  <span class="comment">// J_t = H_t^T X_t</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordtype">bool</span> compute_lk_together = (N &gt; D);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keywordflow">if</span> (compute_lk_together) {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">// do the following two multiplies in one operation...</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">// note</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">// L_t = W_t J_t^T</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">// K_t = J_t J_t^T</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment">// Note: L_t was defined as L_t = J_t W_t^T, but it&#39;s actually symmetric,</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment">// so we can compute it as L_t = W_t J_t^T.</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    LK_t.AddMatMat(1.0, WJ_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, J_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    K_t.SymAddMat2(1.0, J_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    L_t.SymAddMat2(1.0, H_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>, 0.0);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  Matrix&lt;BaseFloat&gt; LK_cpu(LK_t);  <span class="comment">// contains L and K on the CPU.</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  SubMatrix&lt;BaseFloat&gt; L_t_cpu(LK_cpu, 0, R, 0, R),</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      K_t_cpu(LK_cpu, R, R, 0, R);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordflow">if</span> (!compute_lk_together) {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="comment">// the SymAddMat2 operations only set the lower triangle and diagonal.</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    L_t_cpu.CopyLowerToUpper();</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    K_t_cpu.CopyLowerToUpper();</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">// beta_t = \rho_t(1+\alpha) + \alpha/D tr(D_t)</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> beta_t = rho_t * (1.0 + <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a>) + <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a> * d_t.Sum() / D;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  Vector&lt;BaseFloat&gt; e_t(R), sqrt_e_t(R), inv_sqrt_e_t(R);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a2bdc60d5b8ab06b11d20695a71da1024">ComputeEt</a>(d_t, beta_t, &amp;e_t, &amp;sqrt_e_t, &amp;inv_sqrt_e_t);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(5) &lt;&lt; <span class="stringliteral">&quot;e_t = &quot;</span> &lt;&lt; e_t;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="comment">// The double-precision Z_t here, and the scaling, is to avoid potential</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="comment">// overflow, because Z_t is proportional to the fourth power of data.</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  SpMatrix&lt;double&gt; Z_t_double(R);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9d2db282e47c56f778322ddf9631a0ee">ComputeZt</a>(N, rho_t, d_t, inv_sqrt_e_t, K_t_cpu, L_t_cpu, &amp;Z_t_double);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> z_t_scale = std::max&lt;double&gt;(1.0, Z_t_double.Trace());</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  Z_t_double.Scale(1.0 / z_t_scale);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  SpMatrix&lt;BaseFloat&gt; Z_t_scaled(Z_t_double);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  Matrix&lt;BaseFloat&gt; U_t(R, R);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  Vector&lt;BaseFloat&gt; c_t(R);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="comment">// do the symmetric eigenvalue decomposition Z_t = U_t C_t U_t^T.</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  Z_t_scaled.Eig(&amp;c_t, &amp;U_t);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <a class="code" href="group__matrix__funcs__misc.html#ga4318e745ace6367bd00b2911089e9e79">SortSvd</a>(&amp;c_t, &amp;U_t);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  c_t.Scale(z_t_scale);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> condition_threshold = 1.0e+06;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="comment">// must_reorthogonalize will be true if the last diagonal element of c_t is</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="comment">// negative, since we don&#39;t take the absolute value, but this is the right</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="comment">// thing anyway.</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordtype">bool</span> must_reorthogonalize = (c_t(0) &gt; condition_threshold * c_t(R - 1));</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> c_t_floor = pow(rho_t * (1 - eta), 2);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  int32 nf;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  c_t.ApplyFloor(c_t_floor, &amp;nf);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordflow">if</span> (nf &gt; 0)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    must_reorthogonalize = <span class="keyword">true</span>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">if</span> (nf &gt; 0 &amp;&amp; <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">self_debug_</a>) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Floored &quot;</span> &lt;&lt; nf &lt;&lt; <span class="stringliteral">&quot; elements of C_t.&quot;</span>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> tr_Xt_XtT_check;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">self_debug_</a>)</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    tr_Xt_XtT_check = <a class="code" href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">TraceMatMat</a>(*X_t, *X_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kTrans</a>);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  X_t-&gt;AddMatMat(-1.0, H_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, W_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 1.0);  <span class="comment">// X_hat_t = X_t - H_t W_t</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="comment">// set *row_prod to inner products of each row of X_hat_t with itself.</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  row_prod-&gt;AddDiagMat2(1.0, *X_t, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> tr_Xhat_XhatT = row_prod-&gt;Sum();</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="comment">//  tr(X_t X_t^T) = tr(X_hat_t X_hat_t^T) - tr(L_t E_t) + 2 tr(L_t)</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordtype">double</span> tr_Xt_XtT = tr_Xhat_XhatT;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; R; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    tr_Xt_XtT += L_t_cpu(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>) * (2.0 - e_t(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">self_debug_</a>) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(tr_Xt_XtT, tr_Xt_XtT_check));</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  }</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> gamma_t = (tr_Xhat_XhatT == 0.0 ? 1.0 :</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                       sqrt(tr_Xt_XtT / tr_Xhat_XhatT));</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  *scale = gamma_t;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  Vector&lt;BaseFloat&gt; sqrt_c_t(c_t);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  sqrt_c_t.ApplyPow(0.5);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="comment">// \rho_{t+1} = 1/(D - R) (\eta/N tr(X_t X_t^T) + (1-\eta)(D \rho_t + tr(D_t)) - tr(C_t^{0.5})).</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> rho_t1 = 1.0 / (D - R) * (eta / N * tr_Xt_XtT</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                                      + (1-eta)*(D * rho_t + d_t.Sum())</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                                      - sqrt_c_t.Sum());</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="comment">// D_{t+1} = C_t^{0.5} - \rho_{t+1} I</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  Vector&lt;BaseFloat&gt; d_t1(sqrt_c_t);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  d_t1.Add(-rho_t1);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> floor_val = std::max(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">epsilon_</a>, <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">delta_</a> * sqrt_c_t.Max());</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordflow">if</span> (rho_t1 &lt; floor_val)</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    rho_t1 = floor_val;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  d_t1.ApplyFloor(floor_val);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  CuMatrix&lt;BaseFloat&gt; W_t1(R, D);  <span class="comment">// W_{t+1}</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa648b298424a1fc8789b6c7efa4d2c8d">ComputeWt1</a>(N, d_t, d_t1, rho_t, rho_t1, U_t, sqrt_c_t, inv_sqrt_e_t,</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;             W_t, &amp;J_t, &amp;W_t1);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordflow">if</span> (must_reorthogonalize) {</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">self_debug_</a>) {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Reorthogonalizing.&quot;</span>;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    }</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a04f608ae169f9f8893c5611d379ce5ae">ReorthogonalizeXt1</a>(d_t1,</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                       rho_t1,</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                       &amp;W_t1,</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                       &amp;J_t,</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                       &amp;L_t);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="comment">// Commit the new parameters.</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a12a31e639df35867380f95cc14b9f139">read_write_mutex_</a>.lock();</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">t_</a> == t);  <span class="comment">// we already ensured this.</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">t_</a> = t + 1;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab3c6b16d7d97db660d96144a3239dc01">num_updates_skipped_</a> = 0;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a>.Swap(&amp;W_t1);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a>.CopyFromVec(d_t1);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">rho_t_</a> = rho_t1;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">self_debug_</a>)</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1d419f9b6bc532b8960a93ce3f54f3be">SelfTest</a>();</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a12a31e639df35867380f95cc14b9f139">read_write_mutex_</a>.unlock();</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a642038c403825903d5c2de21ccdb334b">update_mutex_</a>.unlock();</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a12a31e639df35867380f95cc14b9f139"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a12a31e639df35867380f95cc14b9f139">kaldi::nnet2::OnlinePreconditioner::read_write_mutex_</a></div><div class="ttdeci">std::mutex read_write_mutex_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00563">nnet-precondition-online.h:563</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_aa648b298424a1fc8789b6c7efa4d2c8d"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa648b298424a1fc8789b6c7efa4d2c8d">kaldi::nnet2::OnlinePreconditioner::ComputeWt1</a></div><div class="ttdeci">void ComputeWt1(int32 N, const VectorBase&lt; BaseFloat &gt; &amp;d_t, const VectorBase&lt; BaseFloat &gt; &amp;d_t1, BaseFloat rho_t, BaseFloat rho_t1, const MatrixBase&lt; BaseFloat &gt; &amp;U_t, const VectorBase&lt; BaseFloat &gt; &amp;sqrt_c_t, const VectorBase&lt; BaseFloat &gt; &amp;inv_sqrt_e_t, const CuMatrixBase&lt; BaseFloat &gt; &amp;W_t, CuMatrixBase&lt; BaseFloat &gt; *J_t, CuMatrixBase&lt; BaseFloat &gt; *W_t1) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00501">nnet-precondition-online.cc:501</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af679b81005104cca1fc03ef8ee3b36d0"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">kaldi::nnet2::OnlinePreconditioner::rank_</a></div><div class="ttdeci">int32 rank_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00516">nnet-precondition-online.h:516</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af12dc036070d7e3229a0232e214c226e"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">kaldi::nnet2::OnlinePreconditioner::d_t_</a></div><div class="ttdeci">Vector&lt; BaseFloat &gt; d_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00559">nnet-precondition-online.h:559</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_abd17f633a8fc0939bc5bd0e83bd7153c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#abd17f633a8fc0939bc5bd0e83bd7153c">kaldi::nnet2::OnlinePreconditioner::t_</a></div><div class="ttdeci">int32 t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00546">nnet-precondition-online.h:546</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a1d419f9b6bc532b8960a93ce3f54f3be"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1d419f9b6bc532b8960a93ce3f54f3be">kaldi::nnet2::OnlinePreconditioner::SelfTest</a></div><div class="ttdeci">void SelfTest() const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00255">nnet-precondition-online.cc:255</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_aa0ae63e5e17bafaf1ab9c9328517bb5b"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">kaldi::nnet2::OnlinePreconditioner::delta_</a></div><div class="ttdeci">BaseFloat delta_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00543">nnet-precondition-online.h:543</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a2bdc60d5b8ab06b11d20695a71da1024"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a2bdc60d5b8ab06b11d20695a71da1024">kaldi::nnet2::OnlinePreconditioner::ComputeEt</a></div><div class="ttdeci">void ComputeEt(const VectorBase&lt; BaseFloat &gt; &amp;d_t, BaseFloat beta_t, VectorBase&lt; BaseFloat &gt; *e_t, VectorBase&lt; BaseFloat &gt; *sqrt_e_t, VectorBase&lt; BaseFloat &gt; *inv_sqrt_e_t) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00577">nnet-precondition-online.cc:577</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a9d2db282e47c56f778322ddf9631a0ee"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9d2db282e47c56f778322ddf9631a0ee">kaldi::nnet2::OnlinePreconditioner::ComputeZt</a></div><div class="ttdeci">void ComputeZt(int32 N, BaseFloat rho_t, const VectorBase&lt; BaseFloat &gt; &amp;d_t, const VectorBase&lt; BaseFloat &gt; &amp;inv_sqrt_e_t, const MatrixBase&lt; BaseFloat &gt; &amp;K_t, const MatrixBase&lt; BaseFloat &gt; &amp;L_t, SpMatrix&lt; double &gt; *Z_t) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00546">nnet-precondition-online.cc:546</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa538d6ef272b2ad113f1860fccbc2c3e2">kaldi::kTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00033">matrix-common.h:33</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ae9146ef05a20cd050436475ff208c6ae"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ae9146ef05a20cd050436475ff208c6ae">kaldi::nnet2::OnlinePreconditioner::Eta</a></div><div class="ttdeci">BaseFloat Eta(int32 N) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00492">nnet-precondition-online.cc:492</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a5a1f65814903de3b91358880a8955c1c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">kaldi::nnet2::OnlinePreconditioner::W_t_</a></div><div class="ttdeci">CuMatrix&lt; BaseFloat &gt; W_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00557">nnet-precondition-online.h:557</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a642038c403825903d5c2de21ccdb334b"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a642038c403825903d5c2de21ccdb334b">kaldi::nnet2::OnlinePreconditioner::update_mutex_</a></div><div class="ttdeci">std::mutex update_mutex_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00567">nnet-precondition-online.h:567</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacekaldi_html_a94b9f349754706b9d6f38bb5ccc11c77"><div class="ttname"><a href="namespacekaldi.html#a94b9f349754706b9d6f38bb5ccc11c77">kaldi::TraceMatMat</a></div><div class="ttdeci">Real TraceMatMat(const MatrixBase&lt; Real &gt; &amp;A, const MatrixBase&lt; Real &gt; &amp;B, MatrixTransposeType trans)</div><div class="ttdoc">We need to declare this here as it will be a friend function. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02646">kaldi-matrix.cc:2646</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ab35b32394fce8242b6fb4ae4ba4e54e1"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">kaldi::nnet2::OnlinePreconditioner::update_period_</a></div><div class="ttdeci">int32 update_period_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00521">nnet-precondition-online.h:521</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a008c4e6cc13410d1b983ad2b06fffeaf"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">kaldi::nnet2::OnlinePreconditioner::epsilon_</a></div><div class="ttdeci">BaseFloat epsilon_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00537">nnet-precondition-online.h:537</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a04f608ae169f9f8893c5611d379ce5ae"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a04f608ae169f9f8893c5611d379ce5ae">kaldi::nnet2::OnlinePreconditioner::ReorthogonalizeXt1</a></div><div class="ttdeci">void ReorthogonalizeXt1(const VectorBase&lt; BaseFloat &gt; &amp;d_t1, BaseFloat rho_t1, CuMatrixBase&lt; BaseFloat &gt; *W_t1, CuMatrixBase&lt; BaseFloat &gt; *temp_W, CuMatrixBase&lt; BaseFloat &gt; *temp_O)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00184">nnet-precondition-online.cc:184</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a9c611c2de39a87a3ad90640fd024b048"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">kaldi::nnet2::OnlinePreconditioner::rho_t_</a></div><div class="ttdeci">BaseFloat rho_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00558">nnet-precondition-online.h:558</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00135">kaldi-error.h:135</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a1bffda16ce504620d0ea2d1118cd0653"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">kaldi::nnet2::OnlinePreconditioner::self_debug_</a></div><div class="ttdeci">bool self_debug_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00555">nnet-precondition-online.h:555</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ab3c6b16d7d97db660d96144a3239dc01"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab3c6b16d7d97db660d96144a3239dc01">kaldi::nnet2::OnlinePreconditioner::num_updates_skipped_</a></div><div class="ttdeci">int32 num_updates_skipped_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00552">nnet-precondition-online.h:552</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00264">kaldi-math.h:264</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a43efd606b8c638dd071888c30b741e91"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">kaldi::nnet2::OnlinePreconditioner::alpha_</a></div><div class="ttdeci">BaseFloat alpha_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00531">nnet-precondition-online.h:531</a></div></div>
<div class="ttc" id="group__matrix__funcs__misc_html_ga4318e745ace6367bd00b2911089e9e79"><div class="ttname"><a href="group__matrix__funcs__misc.html#ga4318e745ace6367bd00b2911089e9e79">kaldi::SortSvd</a></div><div class="ttdeci">void SortSvd(VectorBase&lt; Real &gt; *s, MatrixBase&lt; Real &gt; *U, MatrixBase&lt; Real &gt; *Vt, bool sort_on_absolute_value)</div><div class="ttdoc">Function to ensure that SVD is sorted. </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-matrix_8cc_source.html#l02534">kaldi-matrix.cc:2534</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a04f608ae169f9f8893c5611d379ce5ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04f608ae169f9f8893c5611d379ce5ae">&#9670;&nbsp;</a></span>ReorthogonalizeXt1()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ReorthogonalizeXt1 </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1VectorBase.html">VectorBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>d_t1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>rho_t1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>W_t1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>temp_W</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classkaldi_1_1CuMatrixBase.html">CuMatrixBase</a>&lt; <a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> &gt; *&#160;</td>
          <td class="paramname"><em>temp_O</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00184">184</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-matrix_8cc_source.html#l01278">CuMatrixBase&lt; Real &gt;::AddMatMat()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00531">OnlinePreconditioner::alpha_</a>, <a class="el" href="tp-matrix_8cc_source.html#l00088">TpMatrix&lt; Real &gt;::Cholesky()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00577">OnlinePreconditioner::ComputeEt()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00339">CuMatrixBase&lt; Real &gt;::CopyFromMat()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l00957">MatrixBase&lt; Real &gt;::CopyFromTp()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="tp-matrix_8cc_source.html#l00031">TpMatrix&lt; Real &gt;::Invert()</a>, <a class="el" href="sp-matrix_8cc_source.html#l00480">SpMatrix&lt; Real &gt;::IsUnit()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00126">KALDI_ERR</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00050">kaldi::kTakeLower</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="packed-matrix_8h_source.html#l00133">PackedMatrix&lt; Real &gt;::Max()</a>, <a class="el" href="cu-matrix_8cc_source.html#l00779">CuMatrixBase&lt; Real &gt;::MulRowsVec()</a>, <a class="el" href="cu-matrix_8h_source.html#l00215">CuMatrixBase&lt; Real &gt;::NumCols()</a>, <a class="el" href="cu-matrix_8h_source.html#l00214">CuMatrixBase&lt; Real &gt;::NumRows()</a>, <a class="el" href="kaldi-matrix_8cc_source.html#l01947">MatrixBase&lt; Real &gt;::OrthogonalizeRows()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00555">OnlinePreconditioner::self_debug_</a>, <a class="el" href="kaldi-vector_8cc_source.html#l00693">VectorBase&lt; Real &gt;::Sum()</a>, and <a class="el" href="cu-matrix_8cc_source.html#l01340">CuMatrixBase&lt; Real &gt;::SymAddMat2()</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>.</p>
<div class="fragment"><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                     {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">// threshold is a configuration value: a desired threshold on orthogonality,</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="comment">// below which we won&#39;t reorthogonalize.</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> threshold = 1.0e-03;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  int32 R = W_t1-&gt;NumRows(), D = W_t1-&gt;NumCols();</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> beta_t1 = rho_t1 * (1.0 + <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a>) + <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a> * d_t1.Sum() / D;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  Vector&lt;BaseFloat&gt; e_t1(R, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>), sqrt_e_t1(R, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>),</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      inv_sqrt_e_t1(R, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a2bdc60d5b8ab06b11d20695a71da1024">ComputeEt</a>(d_t1, beta_t1, &amp;e_t1, &amp;sqrt_e_t1, &amp;inv_sqrt_e_t1);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  temp_O-&gt;SymAddMat2(1.0, *W_t1, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="comment">// O_t =  E_t^{-0.5} W_t W_t^T E_t^{-0.5}</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  Matrix&lt;BaseFloat&gt; O_mat(*temp_O);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  SpMatrix&lt;BaseFloat&gt; O(O_mat, <a class="code" href="namespacekaldi.html#a1e7deac168cc2b1002cc25ab544d0f90ab23bc41c203345e3a080b4f011f7aa40">kTakeLower</a>);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; R; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> i_factor = inv_sqrt_e_t1(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;= <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> j_factor = inv_sqrt_e_t1(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      O(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) *= i_factor * j_factor;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordflow">if</span> (O.IsUnit(threshold)) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">self_debug_</a>) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Not reorthogonalizing since already orthognoal: &quot;</span> &lt;&lt; O;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  TpMatrix&lt;BaseFloat&gt; C(R);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordflow">try</span> {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    C.Cholesky(O);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    C.Invert();  <span class="comment">// Now it&#39;s C^{-1}.</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">if</span> (!(C.Max() &lt; 100.0))</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Cholesky out of expected range, &quot;</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;reorthogonalizing with Gram-Schmidt&quot;</span>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  } <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">// We do a Gram-Schmidt orthogonalization, which is a bit less efficient but</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// more robust than the method using Cholesky.</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Cholesky or Invert() failed while re-orthogonalizing R_t. &quot;</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;Re-orthogonalizing on CPU.&quot;</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    Matrix&lt;BaseFloat&gt; cpu_W_t1(*W_t1);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    cpu_W_t1.OrthogonalizeRows();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    W_t1-&gt;CopyFromMat(cpu_W_t1);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// at this point cpu_W_t1 represents R_{t+1}- it has orthonormal</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// rows.  Do: W_{t+1} = E_{t+1}^{0.5} R_{t+1}</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    CuVector&lt;BaseFloat&gt; sqrt_e_t1_gpu(sqrt_e_t1);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    W_t1-&gt;MulRowsVec(sqrt_e_t1_gpu);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="comment">// Next, compute (E_t^{0.5} C^{-1} E_t^{-0.5})</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="comment">// but it&#39;s really t+1, not t.</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; R; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> i_factor = sqrt_e_t1(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="comment">// skip j == i because i_factor * j_factor == 1 for j == i.</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> j_factor = inv_sqrt_e_t1(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      C(i, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) *= i_factor * j_factor;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  O_mat.CopyFromTp(C);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  temp_O-&gt;CopyFromMat(O_mat);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  temp_W-&gt;CopyFromMat(*W_t1);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  W_t1-&gt;AddMatMat(1.0, *temp_O, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, *temp_W, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a2bdc60d5b8ab06b11d20695a71da1024"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a2bdc60d5b8ab06b11d20695a71da1024">kaldi::nnet2::OnlinePreconditioner::ComputeEt</a></div><div class="ttdeci">void ComputeEt(const VectorBase&lt; BaseFloat &gt; &amp;d_t, BaseFloat beta_t, VectorBase&lt; BaseFloat &gt; *e_t, VectorBase&lt; BaseFloat &gt; *sqrt_e_t, VectorBase&lt; BaseFloat &gt; *inv_sqrt_e_t) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00577">nnet-precondition-online.cc:577</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00126">kaldi-error.h:126</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a1e7deac168cc2b1002cc25ab544d0f90ab23bc41c203345e3a080b4f011f7aa40"><div class="ttname"><a href="namespacekaldi.html#a1e7deac168cc2b1002cc25ab544d0f90ab23bc41c203345e3a080b4f011f7aa40">kaldi::kTakeLower</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00050">matrix-common.h:50</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a1bffda16ce504620d0ea2d1118cd0653"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">kaldi::nnet2::OnlinePreconditioner::self_debug_</a></div><div class="ttdeci">bool self_debug_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00555">nnet-precondition-online.h:555</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a43efd606b8c638dd071888c30b741e91"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">kaldi::nnet2::OnlinePreconditioner::alpha_</a></div><div class="ttdeci">BaseFloat alpha_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00531">nnet-precondition-online.h:531</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1d419f9b6bc532b8960a93ce3f54f3be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d419f9b6bc532b8960a93ce3f54f3be">&#9670;&nbsp;</a></span>SelfTest()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void SelfTest </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00255">255</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="cu-sp-matrix_8cc_source.html#l00130">CuSpMatrix&lt; Real &gt;::AddMat2()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00531">OnlinePreconditioner::alpha_</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00577">OnlinePreconditioner::ComputeEt()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00559">OnlinePreconditioner::d_t_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00543">OnlinePreconditioner::delta_</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00537">OnlinePreconditioner::epsilon_</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="sp-matrix_8cc_source.html#l00480">SpMatrix&lt; Real &gt;::IsUnit()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00129">KALDI_WARN</a>, <a class="el" href="matrix-common_8h_source.html#l00034">kaldi::kNoTrans</a>, <a class="el" href="matrix-common_8h_source.html#l00039">kaldi::kUndefined</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00558">OnlinePreconditioner::rho_t_</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00557">OnlinePreconditioner::W_t_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>.</p>
<div class="fragment"><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                          {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">rho_t_</a> &gt;= <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">epsilon_</a>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> d_t_max = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a>.Max(), d_t_min = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a>.Min();</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(d_t_min &gt;= <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">epsilon_</a>);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(d_t_min &gt; 0.9 * <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">delta_</a> * d_t_max);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">rho_t_</a> &gt; 0.9 * <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">delta_</a> * d_t_max);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  int32 D = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a>.NumCols(), R = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a>.NumRows();</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> beta_t = <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">rho_t_</a> * (1.0 + <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a>) + <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a> * <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a>.Sum() / D;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  Vector&lt;BaseFloat&gt; e_t(R, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>), sqrt_e_t(R, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>),</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      inv_sqrt_e_t(R, <a class="code" href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kUndefined</a>);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a2bdc60d5b8ab06b11d20695a71da1024">ComputeEt</a>(<a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a>, beta_t, &amp;e_t, &amp;sqrt_e_t, &amp;inv_sqrt_e_t);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  CuSpMatrix&lt;BaseFloat&gt; S(R);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  S.AddMat2(1.0, <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">W_t_</a>, <a class="code" href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kNoTrans</a>, 0.0);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  SpMatrix&lt;BaseFloat&gt; O(S);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; R; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> i_factor = inv_sqrt_e_t(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt;= <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> j_factor = inv_sqrt_e_t(<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      O(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>) *= i_factor * j_factor;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordflow">if</span> (!O.IsUnit(1.0e-04) || O(0, 0) != O(0, 0)) {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> worst_error = 0.0;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    int32 worst_i = 0, worst_j = 0;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; R; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keywordflow">for</span> (int32 <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; R; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> elem = O(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> error = fabs(elem - (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> ? 1.0 : 0.0));</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">if</span> (error &gt; worst_error || error != error) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;          worst_error = error;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;          worst_i = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;          worst_j = <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">if</span> (worst_error &gt; 1.0e-02 || worst_error != worst_error) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Failed to verify W_t (worst error: O[&quot;</span> &lt;&lt; worst_i &lt;&lt; <span class="charliteral">&#39;,&#39;</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                 &lt;&lt; worst_j &lt;&lt; <span class="stringliteral">&quot;] = &quot;</span> &lt;&lt; O(worst_i, worst_j)</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;, d_t = &quot;</span> &lt;&lt; <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">d_t_</a>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;}</div><div class="ttc" id="namespacekaldi_html_ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126"><div class="ttname"><a href="namespacekaldi.html#ab4ace1fea44c7724ab9a76d70abad80baf2cd3231820315500697550960956126">kaldi::kUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00039">matrix-common.h:39</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af12dc036070d7e3229a0232e214c226e"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af12dc036070d7e3229a0232e214c226e">kaldi::nnet2::OnlinePreconditioner::d_t_</a></div><div class="ttdeci">Vector&lt; BaseFloat &gt; d_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00559">nnet-precondition-online.h:559</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_aa0ae63e5e17bafaf1ab9c9328517bb5b"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#aa0ae63e5e17bafaf1ab9c9328517bb5b">kaldi::nnet2::OnlinePreconditioner::delta_</a></div><div class="ttdeci">BaseFloat delta_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00543">nnet-precondition-online.h:543</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a2bdc60d5b8ab06b11d20695a71da1024"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a2bdc60d5b8ab06b11d20695a71da1024">kaldi::nnet2::OnlinePreconditioner::ComputeEt</a></div><div class="ttdeci">void ComputeEt(const VectorBase&lt; BaseFloat &gt; &amp;d_t, BaseFloat beta_t, VectorBase&lt; BaseFloat &gt; *e_t, VectorBase&lt; BaseFloat &gt; *sqrt_e_t, VectorBase&lt; BaseFloat &gt; *inv_sqrt_e_t) const</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8cc_source.html#l00577">nnet-precondition-online.cc:577</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a5a1f65814903de3b91358880a8955c1c"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a5a1f65814903de3b91358880a8955c1c">kaldi::nnet2::OnlinePreconditioner::W_t_</a></div><div class="ttdeci">CuMatrix&lt; BaseFloat &gt; W_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00557">nnet-precondition-online.h:557</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d"><div class="ttname"><a href="namespacekaldi.html#a610f4f6c3c8fe58b76713f593b9d724fa6decd3b781a809d748e5221d49f0ab5d">kaldi::kNoTrans</a></div><div class="ttdef"><b>Definition:</b> <a href="matrix-common_8h_source.html#l00034">matrix-common.h:34</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00129">kaldi-error.h:129</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a008c4e6cc13410d1b983ad2b06fffeaf"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a008c4e6cc13410d1b983ad2b06fffeaf">kaldi::nnet2::OnlinePreconditioner::epsilon_</a></div><div class="ttdeci">BaseFloat epsilon_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00537">nnet-precondition-online.h:537</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a9c611c2de39a87a3ad90640fd024b048"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a9c611c2de39a87a3ad90640fd024b048">kaldi::nnet2::OnlinePreconditioner::rho_t_</a></div><div class="ttdeci">BaseFloat rho_t_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00558">nnet-precondition-online.h:558</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a43efd606b8c638dd071888c30b741e91"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">kaldi::nnet2::OnlinePreconditioner::alpha_</a></div><div class="ttdeci">BaseFloat alpha_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00531">nnet-precondition-online.h:531</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a885862c5b0a0cf88d75bee40f5cf29f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a885862c5b0a0cf88d75bee40f5cf29f2">&#9670;&nbsp;</a></span>SetAlpha()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetAlpha </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>alpha</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00634">634</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="nnet-precondition-online_8h_source.html#l00531">OnlinePreconditioner::alpha_</a>, and <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>.</p>
<div class="fragment"><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                                                   {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(alpha &gt;= 0.0);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">alpha_</a> = alpha;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;}</div><div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a43efd606b8c638dd071888c30b741e91"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a43efd606b8c638dd071888c30b741e91">kaldi::nnet2::OnlinePreconditioner::alpha_</a></div><div class="ttdeci">BaseFloat alpha_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00531">nnet-precondition-online.h:531</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a92a77e900ccaf0f3a722e2a4a9dedb77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92a77e900ccaf0f3a722e2a4a9dedb77">&#9670;&nbsp;</a></span>SetNumSamplesHistory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetNumSamplesHistory </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&#160;</td>
          <td class="paramname"><em>num_samples_history</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00629">629</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00527">OnlinePreconditioner::num_samples_history_</a>.</p>
<div class="fragment"><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                                                             {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_samples_history &gt; 0.0 &amp;&amp;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;               num_samples_history &lt; 1.0e+6);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">num_samples_history_</a> = num_samples_history;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af659a9e1c6ede20999b0996a58f97f34"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af659a9e1c6ede20999b0996a58f97f34">kaldi::nnet2::OnlinePreconditioner::num_samples_history_</a></div><div class="ttdeci">BaseFloat num_samples_history_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00527">nnet-precondition-online.h:527</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afb9bffca178027f3e5d52ec73a1ee0fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb9bffca178027f3e5d52ec73a1ee0fe">&#9670;&nbsp;</a></span>SetRank()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetRank </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>rank</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00621">621</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00516">OnlinePreconditioner::rank_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online-test_8cc_source.html#l00262">kaldi::nnet2::UnitTestPreconditionDirectionsOnline()</a>.</p>
<div class="fragment"><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                                             {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(rank &gt; 0);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">rank_</a> = rank;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_af679b81005104cca1fc03ef8ee3b36d0"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#af679b81005104cca1fc03ef8ee3b36d0">kaldi::nnet2::OnlinePreconditioner::rank_</a></div><div class="ttdeci">int32 rank_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00516">nnet-precondition-online.h:516</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af830848160afd5bf477387d1c5825d8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af830848160afd5bf477387d1c5825d8c">&#9670;&nbsp;</a></span>SetUpdatePeriod()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetUpdatePeriod </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>update_period</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8cc_source.html#l00625">625</a> of file <a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a>.</p>

<p class="reference">References <a class="el" href="kaldi-error_8h_source.html#l00168">KALDI_ASSERT</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00521">OnlinePreconditioner::update_period_</a>.</p>
<div class="fragment"><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                                                              {</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(update_period &gt; 0);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">update_period_</a> = update_period;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;}</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_ab35b32394fce8242b6fb4ae4ba4e54e1"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#ab35b32394fce8242b6fb4ae4ba4e54e1">kaldi::nnet2::OnlinePreconditioner::update_period_</a></div><div class="ttdeci">int32 update_period_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00521">nnet-precondition-online.h:521</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00168">kaldi-error.h:168</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a35086953bbc759bd2ac9cb660d87d83f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35086953bbc759bd2ac9cb660d87d83f">&#9670;&nbsp;</a></span>TurnOnDebug()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void TurnOnDebug </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00422">422</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">References <a class="el" href="nnet-precondition-online_8h_source.html#l00555">OnlinePreconditioner::self_debug_</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online-test_8cc_source.html#l00262">kaldi::nnet2::UnitTestPreconditionDirectionsOnline()</a>.</p>
<div class="fragment"><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;{ <a class="code" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">self_debug_</a> = <span class="keyword">true</span>; }</div><div class="ttc" id="classkaldi_1_1nnet2_1_1OnlinePreconditioner_html_a1bffda16ce504620d0ea2d1118cd0653"><div class="ttname"><a href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html#a1bffda16ce504620d0ea2d1118cd0653">kaldi::nnet2::OnlinePreconditioner::self_debug_</a></div><div class="ttdeci">bool self_debug_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-precondition-online_8h_source.html#l00555">nnet-precondition-online.h:555</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a43efd606b8c638dd071888c30b741e91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43efd606b8c638dd071888c30b741e91">&#9670;&nbsp;</a></span>alpha_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> alpha_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00531">531</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00501">OnlinePreconditioner::ComputeWt1()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00424">OnlinePreconditioner::GetAlpha()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">OnlinePreconditioner::InitDefault()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">OnlinePreconditioner::operator=()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00184">OnlinePreconditioner::ReorthogonalizeXt1()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00255">OnlinePreconditioner::SelfTest()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00634">OnlinePreconditioner::SetAlpha()</a>.</p>

</div>
</div>
<a id="af12dc036070d7e3229a0232e214c226e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af12dc036070d7e3229a0232e214c226e">&#9670;&nbsp;</a></span>d_t_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1Vector.html">Vector</a>&lt;<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&gt; d_t_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00559">559</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00123">OnlinePreconditioner::Init()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">OnlinePreconditioner::InitDefault()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">OnlinePreconditioner::operator=()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00145">OnlinePreconditioner::PreconditionDirections()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00255">OnlinePreconditioner::SelfTest()</a>.</p>

</div>
</div>
<a id="aa0ae63e5e17bafaf1ab9c9328517bb5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0ae63e5e17bafaf1ab9c9328517bb5b">&#9670;&nbsp;</a></span>delta_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> delta_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00543">543</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">OnlinePreconditioner::InitDefault()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">OnlinePreconditioner::operator=()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00255">OnlinePreconditioner::SelfTest()</a>.</p>

</div>
</div>
<a id="a008c4e6cc13410d1b983ad2b06fffeaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a008c4e6cc13410d1b983ad2b06fffeaf">&#9670;&nbsp;</a></span>epsilon_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> epsilon_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00537">537</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">OnlinePreconditioner::InitDefault()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">OnlinePreconditioner::operator=()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00255">OnlinePreconditioner::SelfTest()</a>.</p>

</div>
</div>
<a id="af659a9e1c6ede20999b0996a58f97f34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af659a9e1c6ede20999b0996a58f97f34">&#9670;&nbsp;</a></span>num_samples_history_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> num_samples_history_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00527">527</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00492">OnlinePreconditioner::Eta()</a>, <a class="el" href="nnet-precondition-online_8h_source.html#l00423">OnlinePreconditioner::GetNumSamplesHistory()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">OnlinePreconditioner::InitDefault()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">OnlinePreconditioner::operator=()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00629">OnlinePreconditioner::SetNumSamplesHistory()</a>.</p>

</div>
</div>
<a id="ab3c6b16d7d97db660d96144a3239dc01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3c6b16d7d97db660d96144a3239dc01">&#9670;&nbsp;</a></span>num_updates_skipped_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 num_updates_skipped_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00552">552</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>.</p>

</div>
</div>
<a id="af679b81005104cca1fc03ef8ee3b36d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af679b81005104cca1fc03ef8ee3b36d0">&#9670;&nbsp;</a></span>rank_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 rank_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00516">516</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00425">OnlinePreconditioner::GetRank()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00123">OnlinePreconditioner::Init()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">OnlinePreconditioner::InitDefault()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">OnlinePreconditioner::operator=()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00621">OnlinePreconditioner::SetRank()</a>.</p>

</div>
</div>
<a id="a12a31e639df35867380f95cc14b9f139"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12a31e639df35867380f95cc14b9f139">&#9670;&nbsp;</a></span>read_write_mutex_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::mutex read_write_mutex_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00563">563</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00145">OnlinePreconditioner::PreconditionDirections()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>.</p>

</div>
</div>
<a id="a9c611c2de39a87a3ad90640fd024b048"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c611c2de39a87a3ad90640fd024b048">&#9670;&nbsp;</a></span>rho_t_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> rho_t_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00558">558</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00123">OnlinePreconditioner::Init()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">OnlinePreconditioner::InitDefault()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">OnlinePreconditioner::operator=()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00145">OnlinePreconditioner::PreconditionDirections()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00255">OnlinePreconditioner::SelfTest()</a>.</p>

</div>
</div>
<a id="a1bffda16ce504620d0ea2d1118cd0653"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bffda16ce504620d0ea2d1118cd0653">&#9670;&nbsp;</a></span>self_debug_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> self_debug_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00555">555</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">OnlinePreconditioner::operator=()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00184">OnlinePreconditioner::ReorthogonalizeXt1()</a>, and <a class="el" href="nnet-precondition-online_8h_source.html#l00422">OnlinePreconditioner::TurnOnDebug()</a>.</p>

</div>
</div>
<a id="abd17f633a8fc0939bc5bd0e83bd7153c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd17f633a8fc0939bc5bd0e83bd7153c">&#9670;&nbsp;</a></span>t_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 t_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00546">546</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00123">OnlinePreconditioner::Init()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">OnlinePreconditioner::InitDefault()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">OnlinePreconditioner::operator=()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00145">OnlinePreconditioner::PreconditionDirections()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>.</p>

</div>
</div>
<a id="a642038c403825903d5c2de21ccdb334b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a642038c403825903d5c2de21ccdb334b">&#9670;&nbsp;</a></span>update_mutex_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::mutex update_mutex_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00567">567</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>.</p>

</div>
</div>
<a id="ab35b32394fce8242b6fb4ae4ba4e54e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab35b32394fce8242b6fb4ae4ba4e54e1">&#9670;&nbsp;</a></span>update_period_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int32 update_period_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00521">521</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8h_source.html#l00426">OnlinePreconditioner::GetUpdatePeriod()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">OnlinePreconditioner::operator=()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00625">OnlinePreconditioner::SetUpdatePeriod()</a>.</p>

</div>
</div>
<a id="a5a1f65814903de3b91358880a8955c1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a1f65814903de3b91358880a8955c1c">&#9670;&nbsp;</a></span>W_t_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1CuMatrix.html">CuMatrix</a>&lt;<a class="el" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a>&gt; W_t_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nnet-precondition-online_8h_source.html#l00557">557</a> of file <a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="nnet-precondition-online_8cc_source.html#l00123">OnlinePreconditioner::Init()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00075">OnlinePreconditioner::InitDefault()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00605">OnlinePreconditioner::operator=()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00145">OnlinePreconditioner::PreconditionDirections()</a>, <a class="el" href="nnet-precondition-online_8cc_source.html#l00300">OnlinePreconditioner::PreconditionDirectionsInternal()</a>, and <a class="el" href="nnet-precondition-online_8cc_source.html#l00255">OnlinePreconditioner::SelfTest()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>nnet2/<a class="el" href="nnet-precondition-online_8h_source.html">nnet-precondition-online.h</a></li>
<li>nnet2/<a class="el" href="nnet-precondition-online_8cc_source.html">nnet-precondition-online.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacekaldi.html">kaldi</a></li><li class="navelem"><a class="el" href="namespacekaldi_1_1nnet2.html">nnet2</a></li><li class="navelem"><a class="el" href="classkaldi_1_1nnet2_1_1OnlinePreconditioner.html">OnlinePreconditioner</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
